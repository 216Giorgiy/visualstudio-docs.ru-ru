---
title: "Пошаговое руководство. Профилирование из командной строки с помощью метода инструментирования | Microsoft Docs"
ms.custom: ""
ms.date: "12/15/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-ide-debug"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "средства профилирования, пошаговые руководства"
  - "средства повышения производительности, пошаговые руководства"
  - "средства повышения производительности, средства командной строки"
ms.assetid: 1c6f1586-3d6a-431f-bedf-c54088e280ba
caps.latest.revision: 15
caps.handback.revision: 15
author: "mikejo5000"
ms.author: "mikejo"
manager: "ghogen"
---
# Пошаговое руководство. Профилирование из командной строки с помощью метода инструментирования
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

Это пошаговое руководство описывает профилирование автономного приложения [!INCLUDE[dnprdnshort](../code-quality/includes/dnprdnshort_md.md)] для сбора подробных сведений об использовании времени и подсчете вызовов с помощью метода инструментирования средств профилирования.  Это руководство описывает выполнение следующих операций:  
  
-   использование инструмента командной строки [VSInstr](../profiling/vsinstr.md) для создания инструментированных двоичных файлов;  
  
-   использование инструмента [VSPerfCLREnv](../profiling/vsperfclrenv.md), чтобы установить переменные среды для сбора данных профилирования .NET;  
  
-   использование инструмента [VSPerfCmd](../profiling/vsperfcmd.md) для сбора данных профилирования;  
  
-   использование инструмента [VSPerfReport](../profiling/vsperfreport.md) для создания файлов отчетов по данным профилирования.  
  
## Обязательные компоненты  
  
-   [!INCLUDE[vsprvsts](../code-quality/includes/vsprvsts_md.md)]  
  
-   Средний уровень знания языка C\#  
  
-   Средний уровень опыта работы со средствами командной строки  
  
-   Копия примера [Пример PeopleTrax](../profiling/peopletrax-sample-profiling-tools.md).  
  
-   Для работы со сведениями, полученными при профилировании, рекомендуется включить отладочные символы.  Для получения дополнительной информации см. [Практическое руководство. Справочная информация о символах Windows](../profiling/how-to-reference-windows-symbol-information.md).  
  
## Профилирование из командной строки с помощью метода инструментирования  
 Инструментирование представляет собой метод профилирования, с помощью которого в особым образом построенные версии профилированных двоичных файлов внедряются функции\-зонды. Эти зонды собирают временную информацию о входе и выходе функций в инструментированном модуле.  Поскольку данный метод профилирования является более активным, чем выборка, он приводит к значительному увеличению нагрузки.  Инструментированные двоичные файлы увеличиваются в размере по сравнению с двоичными файлами для отладки или выпуска. Кроме того, такие файлы не предназначены для развертывания.  
  
> [!NOTE]
>  Не отправляйте инструментированные двоичные файлы своим заказчикам.  Использование инструментированных двоичных файлов влечет за собой целый ряд рисков.  Такие двоичные файлы содержат сведения, позволяющие упростить задачу реконструирования приложения, а также подвергают пользователей угрозам безопасности.  
  
#### Профилирование приложения PeopleTrax с помощью метода инструментирования  
  
1.  Установите пример приложения PeopleTrax и выполните построение окончательной версии.  
  
2.  Откройте командную строку и добавьте каталог **Средств профилирования** в локальную переменную Path.  
  
3.  Измените рабочую папку на каталог, содержащий двоичные файлы PeopleTrax.  
  
4.  Создайте каталог для файлов отчетов.  Введите следующую команду:  
  
    ```  
    md Reports  
    ```  
  
5.  Воспользуйтесь инструментом командной строки VSInstr для инструментирования двоичных файлов приложения.  Последовательно выполните следующие команды в командной строке:  
  
    ```  
    VSInstr PeopleTrax.exe  
    VSInstr PeopleTrax.exe  
    VSInstr People.dll  
    VSInstr Person.dll  
    VSInstr Operation.dll  
    ```  
  
     **Примечание**.   По умолчанию перед инструментированием средство VSInstr создает резервную копию исходного файла.  Файл резервной копии имеет расширение ORIG.  Например, исходная версия файла "MyApp.exe" будет сохранена как "MyApp.exe.orig".  
  
6.  Установите соответствующие переменные среды с помощью следующей команды:  
  
    ```  
    VsPerfCLREnv /traceon  
    ```  
  
7.  Чтобы запустить профилировщик, введите в командной строке следующую команду:  
  
    ```  
    VsPerfCmd /start:trace /output:Reports\Report.vsp  
    ```  
  
8.  Запустив профилировщик в режиме трассировки, запустите инструментированную версию процесса PeopleTrax.exe для сбора данных.  
  
     Открывается окно приложения **PeopleTrax**.  
  
9. Щелкните **Получить пользователей**.  
  
     Выполняется заполнение таблицы данных PeopleTrax.  
  
10. Щелкните **Экспорт данных**.  
  
     Открывается Блокнот, в котором отображается новый файл, содержащий список пользователей из приложения **PeopleTrax**.  
  
11. Закройте Блокнот и приложение **PeopleTrax**.  
  
12. Завершите работу профилировщика.  Введите следующую команду:  
  
    ```  
    VSPerfCmd /shutdown  
    ```  
  
13. Сбросьте соответствующие переменные среды с помощью следующей команды:  
  
    ```  
    VSPerfCLREnv /off  
    ```  
  
14. Используйте инструмент VSPerfReport для создания отчетов в виде файлов со значениями, разделенными запятыми \(.csv\).  Type:  
  
    ```  
    VSPerfReport Reports\Report.vsp /output:Reports /summary:all  
    ```  
  
     Можно анализировать созданные отчеты в редакторе электронных таблиц или использовать [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] IDE для анализа данных профилирования в файле Report.vsp.  Для получения дополнительной информации см. [Анализ данных средств профилирования](../profiling/analyzing-performance-tools-data.md).  
  
## См. также  
 [Общие сведения о сеансе анализа производительности](../profiling/performance-session-overview.md)   
 [Профилирование из командной строки](../profiling/using-the-profiling-tools-from-the-command-line.md)   
 [VSPerfCmd](../profiling/vsperfcmd.md)   
 [Общие сведения о значениях выборочных данных](../profiling/understanding-sampling-data-values.md)   
 [Представления отчетов средств профилирования](../profiling/performance-report-views.md)