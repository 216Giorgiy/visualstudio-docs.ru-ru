---
title: "Практическое руководство. Присоединение профилировщика к автономному приложению .NET Framework для сбора данных об использовании памяти при помощи командной строки | Microsoft Docs"
ms.custom: ""
ms.date: "12/16/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-ide-debug"
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: 9a869fa4-3c98-4e08-b5d9-f43523059f0e
caps.latest.revision: 33
caps.handback.revision: 33
author: "mikejo5000"
ms.author: "mikejo"
manager: "ghogen"
---
# Практическое руководство. Присоединение профилировщика к автономному приложению .NET Framework для сбора данных об использовании памяти при помощи командной строки
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

В этом разделе описан порядок использования программ командной строки средств профилирования [!INCLUDE[vsPreShort](../code-quality/includes/vspreshort_md.md)] для присоединения профилировщика к запущенному автономному \(клиентскому\) приложению .NET Framework и сбора данных об использовании памяти.  
  
> [!NOTE]
>  Программы командной строки средств профилирования расположены в подкаталоге \\Team Tools\\Performance Tools каталога установки [!INCLUDE[vs_current_short](../code-quality/includes/vs_current_short_md.md)].  На 64\-разрядных компьютерах доступны 64\-разрядные и 32\-разрядные версии средств.  Для использования программ командной строки профилировщика необходимо добавить путь к этим программам в переменную среды PATH окна Командная строка или указать этот путь при вызове команды.  Для получения дополнительной информации см. [Указание пути к средствам командной строки](../profiling/specifying-the-path-to-profiling-tools-command-line-tools.md).  
  
 Для присоединения к приложению .NET Framework и сбора данных об использовании памяти нужно воспользоваться программой [VSPerfCLREnv.cmd](../profiling/vsperfclrenv.md), чтобы инициализировать соответствующие переменные среды перед запуском целевого приложения.  Когда профилировщик присоединен к приложению можно воспользоваться программой **VSPerfCmd.exe** для приостановки и возобновления сбора данных.  
  
 Чтобы завершить сеанс профилирования, необходимо отсоединить профилировщик от всех профилируемых процессов и явным образом завершить его работу.  В большинстве случаев рекомендуется удалять в конце сеанса значения переменных среды, используемые для профилирования.  
  
## Присоединение профилировщика  
  
#### Присоединение профилировщика к выполняющемуся приложению .NET Framework  
  
1.  Откройте окно командной строки.  
  
2.  Инициализируйте переменные среды, используемые для профилирования.  Type:  
  
     **VSPerfClrEnv** {**\/samplegc** &#124; **\/samplegclife**} \[**\/samplelineoff**\]  
  
    -   Параметры **\/samplegc** и **\/samplegclife** позволяют указать, нужно ли собирать только данные о выделении памяти или же следует собирать как данные о выделении памяти, так и данные о времени существования объекта.  Задать нужно один и только один параметр.  
  
        |Команда|Описания|  
        |-------------|--------------|  
        |**\/samplegc**|Сбор данных исключительно о выделении памяти.|  
        |**\/samplegclife**|Сбор данных о выделении памяти и времени существования объектов.|  
  
    -   Параметр **\/samplelineoff** отключает сбор данных о номерах строк исходного кода.  
  
3.  Запустите профилировщик.  Type:  
  
     **VSPerfCmd \/start:sample \/output:** `OutputFile` \[`Options`\]  
  
    -   Параметр [\/start](../profiling/start.md)**:sample** обеспечивает инициализацию профилировщика.  
  
    -   Параметр [\/output](../profiling/output.md)**:**`OutputFile` является обязательным при использовании параметра **\/start**.  Параметр `OutputFile` задает имя и расположение файла с данными профилирования \(VSP\-файла\).  
  
     С параметром **\/start:sample** можно использовать любые из следующих параметров.  
  
    |Команда|Описание|  
    |-------------|--------------|  
    |[\/user](../profiling/user-vsperfcmd.md) **:**\[`Domain`**\\**\]`UserName`|Задает домен и имя пользователя учетной записи, которая является владельцем профилируемого процесса.  Этот параметр является обязательным только в том случае, если процесс выполняется от имени пользователя, отличного от пользователя, который выполнил вход в систему.  Имя владельца процесса отображается в столбце "Имя пользователя" на вкладке "Процессы" диспетчера задач Windows.|  
    |[\/crosssession &#124; \/cs](../profiling/crosssession.md)|Включает профилирование процессов в других сеансах.  Этот параметр является обязательным, если приложение выполняется в рамках другого сеанса.  Идентификатор сеанса отображается в столбце "Код сеанса" на вкладке "Процессы" диспетчера задач Windows.  Для **\/crosssession** может быть задано сокращение **\/CS**.|  
    |[\/wincounter](../profiling/wincounter.md) **:** `WinCounterPath`|Задает счетчик производительности Windows, данные которого следует собирать в процессе профилирования.|  
    |[\/automark](../profiling/automark.md) **:** `Interval`|Используйте только с **\/wincounter**.  Задает интервал времени \(в миллисекундах\) между событиями сбора данных счетчика производительности Windows.  Значение по умолчанию — 500 мс.|  
  
4.  При необходимости запустите целевое приложение обычным образом.  
  
5.  Присоедините профилировщик к целевому приложению.  Type:  
  
     **VSPerfCmd**  [\/attach](../profiling/attach.md) **:**{`PID`&#124;`ProcName`} \[[\/targetclr](../profiling/targetclr.md)**:**`Version`\]  
  
    -   `PID` определяет идентификатор процесса целевого приложения.  Параметр `ProcessName` задает имя процесса.  Обратите внимание, что если при заданном значении `ProcessName` выполняется несколько процессов с таким же именем, результаты будут непредсказуемыми.  Диспетчер задач Windows позволяет просмотреть идентификаторы всех запущенных процессов.  
  
    -   **\/targetclr:** `Version` задает версию среды CLR для профилирования, если в приложении загружено несколько версий среды выполнения.  Необязательно.  
  
## Управление сбором данных  
 Когда выполняется целевое приложение, можно управлять сбором данных путем запуска и остановки записи данных в файл с помощью параметров **VSPerfCmd.exe**.  Управление сбором данных позволяет собирать данные на различных этапах выполнения программы, например, при запуске или завершении работы приложения.  
  
#### Запуск и остановка сбора данных  
  
-   Следующие пары параметров используются для запуска и остановки сбора данных.  Задайте каждый параметр в отдельной строке командной строки.  Запуск и приостановка сбора данных могут выполняться неоднократно.  
  
    |Команда|Описание|  
    |-------------|--------------|  
    |[\/globalon \/globaloff](../profiling/globalon-and-globaloff.md)|Запускает \(**\/globalon**\) или останавливает \(**\/globaloff**\) сбор данных для всех процессов.|  
    |[\/processon](../profiling/processon-and-processoff.md) **:** `PID` [\/processoff](../profiling/processon-and-processoff.md)**:**`PID`|Запускает \(**\/processon**\) или останавливает \(**\/processoff**\) сбор данных для процесса с указанным значением `PID`.|  
    |[\/attach](../profiling/attach.md) **:**{`PID`&#124;`ProcName`} [\/detach](../profiling/detach.md)\[**:**{`PID`&#124;`ProcName`}\]|**\/attach** запускает сбор данных для процесса, определяемого идентификатором `PID` или именем процесса \(ProcName\).  **\/detach** останавливает сбор данных для указанного процесса или, если он не задан, для всех процессов.|  
  
## Завершение сеанса профилирования  
 Чтобы завершить сеанс профилирования, необходимо отсоединить профилировщик от всех профилируемых процессов и явным образом завершить его работу.  Чтобы отсоединить профилировщик от приложения, для которого выполнялось профилирование методом выборки, закройте приложение или выполните команду **VSPerfCmd \/detach**.  Затем для завершения работы профилировщика и закрытия файла данных профилирования используется параметр **VSPerfCmd \/shutdown**.  Команда **VSPerfClrEnv \/off** удаляет значения переменных среды, используемые для профилирования.  
  
#### Завершение сеанса профилирования  
  
1.  Чтобы отсоединить профилировщик от целевого приложения, выполните одно из следующих действий.  
  
    -   Введите **VSPerfCmd \/detach**.  
  
         – или –  
  
    -   Закройте целевое приложение.  
  
2.  Завершите работу профилировщика.  Type:  
  
     **VSPerfCmd**  [\/shutdown](../profiling/shutdown.md)  
  
3.  \(Необязательно.\) Удалите переменные среды, используемые для профилирования.  Type:  
  
     **VSPerfCmd \/off**  
  
## См. также  
 [Профилирование автономных приложений](../profiling/command-line-profiling-of-stand-alone-applications.md)   
 [Представления данных в памяти .NET](../profiling/dotnet-memory-data-views.md)