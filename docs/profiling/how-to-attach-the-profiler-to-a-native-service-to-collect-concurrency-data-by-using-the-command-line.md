---
title: "Практическое руководство. Присоединение профилировщика к собственной службе для сбора данных параллелизма при помощи командной строки | Microsoft Docs"
ms.custom: ""
ms.date: "12/15/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-ide-debug"
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: 283a1ee1-b43e-4daf-95ae-1311925a42a8
caps.latest.revision: 22
caps.handback.revision: 22
author: "mikejo5000"
ms.author: "mikejo"
manager: "ghogen"
---
# Практическое руководство. Присоединение профилировщика к собственной службе для сбора данных параллелизма при помощи командной строки
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

В этом разделе описан порядок использования программ командной строки средств профилирования [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] для присоединения профилировщика к собственной \(C\/C\+\+\) службе и сбора данных параллелизма потока и процесса с помощью метода выборки.  
  
> [!NOTE]
>  Функции усиленной безопасности в Windows 8 и Windows Server 2012 требуют значительных изменений в способе сбора данных профилировщиком Visual Studio на этих платформах.  Для Приложений Магазина Windows также требуются новые методы сбора.  См. раздел [Профилирование приложений для Windows 8 и Windows Server 2012](../profiling/performance-tools-on-windows-8-and-windows-server-2012-applications.md).  
  
> [!NOTE]
>  Программы командной строки средств профилирования расположены в подкаталоге \\Team Tools\\Performance Tools каталога установки Visual Studio.  На 64\-разрядных компьютерах доступны 64\-разрядные и 32\-разрядные версии средств.  Для использования профилировщика через командную строку необходимо добавить путь к этим средствам в переменную среды PATH окна **Командная строка** или указать этот путь при вызове команды.  Для получения дополнительной информации см. [Указание пути к средствам командной строки](../profiling/specifying-the-path-to-profiling-tools-command-line-tools.md).  
  
 Пока профилировщик присоединен к службе, можно приостанавливать и возобновлять сбор данных.  Чтобы завершить сеанс профилирования, необходимо отсоединить профилировщик от службы и явным образом завершить его работу.  
  
## Присоединение профилировщика  
 Чтобы присоединить профилировщик к собственной службе, используются параметры **VSPerfCmd \/start** и **\/attach** для инициализации профилировщика и присоединения его к целевому приложению.  Команды **\/start** и **\/attach** с соответствующими параметрами можно указать в одной командной строке.  Для приостановки сбора данных при запуске целевого приложения можно также добавить параметр **\/globaloff**.  Далее для начала сбора данных используется параметр **\/globalon**.  
  
#### Присоединение профилировщика к собственной службе  
  
1.  Если служба не выполняется, запустите ее.  
  
2.  Чтобы запустить профилировщик, в командной строке введите следующее выражение:  
  
     [VSPerfCmd](../profiling/vsperfcmd.md) **\/start:concurrency  \/output:**`OutputFile` \[`Options`\]  
  
    -   Параметр [\/output](../profiling/output.md)**:**`OutputFile` является обязательным при использовании параметра **\/start**.  Параметр `OutputFile` задает имя и расположение файла с данными профилирования \(VSP\-файла\).  
  
     С параметром **\/start** можно использовать любые из параметров, представленных в следующей таблице.  
  
    > [!NOTE]
    >  Для большинства служб требуются параметры **\/user** и **\/crosssession**.  
  
    |Команда|Описание|  
    |-------------|--------------|  
    |[\/user](../profiling/user-vsperfcmd.md) **:**\[`Domain\`\]`UserName`|Задает необязательные домен и имя пользователя учетной записи, которой требуется предоставить доступ к профилировщику.|  
    |[\/crosssession](../profiling/crosssession.md)|Включает профилирование процессов в других сеансах входа в систему.|  
    |[\/wincounter](../profiling/wincounter.md) **:** `WinCounterPath`|Задает счетчик производительности Windows, данные которого следует собирать в процессе профилирования.|  
    |[\/automark](../profiling/automark.md) **:** `Interval`|Используйте только с **\/wincounter**.  Задает интервал времени \(в миллисекундах\) между событиями сбора данных счетчика производительности Windows.  Значение по умолчанию — 500.|  
    |[\/events](../profiling/events-vsperfcmd.md) **:** `Config`|Задает событие трассировки событий Windows, данные которого следует собирать в процессе профилирования.  События трассировки событий Windows собираются в отдельный ETL\-файл.|  
  
3.  Чтобы присоединить профилировщик к службе, в командной строке введите следующую команду:  
  
     **VSPerfCmd \/attach:** `PID`  
  
     `PID` задает идентификатор процесса или имя процесса целевого приложения.  Диспетчер задач Windows позволяет просмотреть идентификаторы всех запущенных процессов.  
  
## Управление сбором данных  
 Пока выполняется целевое приложение, можно управлять сбором данных путем запуска и остановки записи данных в файл с помощью параметров VSPerfCmd.exe.  Управление сбором данных позволяет собирать данные на различных этапах выполнения программы, например, при запуске или завершении работы приложения.  
  
#### Запуск и остановка сбора данных  
  
-   Пары параметров в следующей таблице используются для запуска и остановки сбора данных.  Задайте каждый параметр в отдельной строке командной строки.  Запуск и приостановка сбора данных могут выполняться неоднократно.  
  
    |Команда|Описание|  
    |-------------|--------------|  
    |[\/globalon \/globaloff](../profiling/globalon-and-globaloff.md)|Запускает \(**\/globalon**\) или останавливает \(**\/globaloff**\) сбор данных для всех процессов.|  
    |[\/processon](../profiling/processon-and-processoff.md) **:** `PID` [\/processoff](../profiling/processon-and-processoff.md)**:**`PID`|Запускает \(**\/processon**\) или останавливает \(**\/processoff**\) сбор данных для процесса с указанным идентификатором процесса \(`PID`\).|  
    |[\/attach](../profiling/attach.md) **:**{`PID`&#124;`ProcName`} [\/detach](../profiling/detach.md)\[**:**{`PID`&#124;`ProcName`}\]|**\/attach** запускает сбор данных для процесса, определяемого по идентификатору \(`PID`\) или имени \(*ProcName*\).  **\/detach** останавливает сбор данных для указанного процесса или, если он не задан, для всех процессов.|  
  
## Завершение сеанса профилирования  
 При завершении сеанса профилирования профилировщик не должен собирать данные.  Остановить процесс сбора данных от собственной службы, для которой выполняется профилирование методом параллелизма, можно посредством остановки службы или использования параметра **VSPerfCmd \/detach**.  Затем для завершения работы профилировщика и закрытия файла с данными профилирования используется параметр **VSPerfCmd \/shutdown**.  
  
#### Завершение сеанса профилирования  
  
1.  Отсоедините профилировщик от целевого приложения с помощью остановки службы или ввода в командную строку следующей команды.  
  
     Введите **VSPerfCmd \/detach**.  
  
2.  Завершите работу профилировщика с помощью следующей команды командной строки:  
  
     **VSPerfCmd**  [\/shutdown](../profiling/shutdown.md)