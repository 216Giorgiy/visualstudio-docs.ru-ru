---
title: "Удаленная кроссплатформенная отладка с помощью Инструментов Python для Visual Studio | Документация Майкрософт"
ms.custom: 
ms.date: 3/7/2017
ms.prod: visual-studio-dev15
ms.reviewer: 
ms.suite: 
ms.technology:
- devlang-python
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: aa667357-763f-4ce6-8e47-48f9337658a8
caps.latest.revision: 1
author: kraigb
ms.author: kraigb
manager: ghogen
translation.priority.ht:
- cs-cz
- de-de
- es-es
- fr-fr
- it-it
- ja-jp
- ko-kr
- pl-pl
- pt-br
- ru-ru
- tr-tr
- zh-cn
- zh-tw
translationtype: Human Translation
ms.sourcegitcommit: 7d726441c2d6953bd7b50451bec7fff05d5d71b0
ms.openlocfilehash: 7634da4bdc2b0186f410acb4eaf57a70ddea3e91
ms.lasthandoff: 03/10/2017

---

# <a name="remotely-debugging-python-code"></a>Удаленная отладка кода Python

Инструменты Python для Visual Studio (PTVS) позволяют локально и удаленно запускать приложения Python на компьютере Windows (см. статью [Remote Debugging](../debugger/remote-debugging.md) (Удаленная отладка)). Также с помощью [библиотеки ptvsd](https://pypi.python.org/pypi/ptvsd) они могут выполнять удаленную отладку, используя другую операционную систему, другое устройство или реализацию Python, отличную от CPython.

При работе c ptvsd для отлаживаемого кода Python создается сервер отладки, к которому может подключаться Visual Studio. Для этого нужно внести лишь небольшое изменение в код для импорта и запуска сервера и в некоторых случаях скорректировать на удаленном компьютере настройки сети и брандмауэра, чтобы разрешить подключения TCP.

Обзор удаленной отладки можно найти в видео [Deep Dive: Cross-Platform Remote Debugging](https://youtu.be/y1Qq7BrV6Cc) (Подробное рассмотрение: удаленная кроссплатформенная отладка) (размещено на youtube.com, длительность 6 мин 22 с).

> [!VIDEO https://www.youtube.com/embed/y1Qq7BrV6Cc]

## <a name="preparing-the-script-for-debugging"></a>Подготовка скрипта к отладке

1. Создайте на удаленном компьютере файл Python следующим кодом:

  ```python
  import random

  guesses_made = 0
  name = raw_input('Hello! What is your name?\n')
  number = random.randint(1, 20)
  print 'Well, {0}, I am thinking of a number between 1 and 20.'.format(name)

  while guesses_made < 6:
      guess = int(raw_input('Take a guess: '))
      guesses_made += 1
      if guess < number:
          print 'Your guess is too low.'
      if guess > number:
          print 'Your guess is too high.'
      if guess == number:
          break
  if guess == number:
      print 'Good job, {0}! You guessed my number in {1} guesses!'.format(name, guesses_made)
  else:
      print 'Nope. The number I was thinking of was {0}'.format(number)
  ```
 
1. Установите в своей среде пакет `ptvsd` с помощью команды `pip install ptvsd`.

1. Включите удаленную отладку, добавив в скрипт приведенный ниже код. Он должен размещаться как можно раньше, до любого другого кода. (Это не является строгим требованием, но для всех фоновых потоков, созданных до вызова функции `enable_attach`, отладка невозможна).

   ```python
   import ptvsd
   ptvsd.enable_attach(secret='my_secret')
   ```

   Параметр `secret`, передаваемый в `enable_attach`, позволяет ограничить доступ для выполнения скрипта. При подключении нужно указать этот секрет в Visual Studio, иначе все подключения будут отклоняться. Вы можете отключить это поведение, используя команду `enable_attach(secret=None)`. Тогда подключиться сможет любой желающий.

1. Сохраните файл и запустите скрипт на удаленном компьютере. Обратите внимание, что вызов `enable_attach` выполняется в фоновом режиме и ожидает входящих подключений. При необходимости после `enable_attach` можно вызвать функцию `wait_for_attach`, чтобы заблокировать выполнение программы до подключения отладчика.

Помимо `enable_attach` и `wait_for_attach`, ptvsd предоставляет вспомогательную функцию `break_into_debugger`, которая обрабатывается как программная точка останова, если присоединен отладчик. Существует также функция `is_attached`, которая возвращает значение `True`, если присоединен отладчик (но вы не обязаны проверять этот результат, прежде чем вызывать любые другие функции `ptvsd`).

## <a name="attaching-remotely-from-python-tools"></a>Удаленное подключение с помощью Инструментов Python

В следующем примере мы установим простую точку останова, чтобы прервать выполнение удаленного процесса.

1. Скопируйте удаленный файл на локальный компьютер и откройте его в Visual Studio. Вы можете разместить этот файл в любом каталоге, но его имя должно совпадать с именем скрипта на удаленном компьютере, к которому вы будете подключаться.

1. Выберите пункт меню **Отладка > Присоединение к процессу**, чтобы открыть диалоговое окно "Присоединение к процессу".

1. Для параметра **Транспорт** установите значение **Удаленная отладка Python**.

1. Введите адрес удаленного компьютера в поле **Квалификатор** и нажмите клавишу ВВОД. После этого вы должны увидеть список процессов, доступных на удаленном компьютере.

![Ввод квалификатора и вывод списка процессов](media/remote-debugging-qualifier.png)

1. Если на этом этапе происходит ошибка, это может означать, что секретный код введен неправильно, версия `ptvsd` не соответствует используемой на PTVS или невозможно установить сетевое подключение. Зачастую неудачные попытки подключения связаны с тем, что на удаленном компьютере работает брандмауэр, который блокирует открытие порта сервера отладки (по умолчанию порт 5678). Вы можете изменить настройки брандмауэра или использовать другой порт. Если вы предпочитаете второй вариант, явно укажите порт в вызове `enable_attach`, используя параметр `address` следующим образом:

  ```python
  ptvsd.enable_attach(secret = 'my_secret', address = ('0.0.0.0', 8080))
  ```

  Здесь используется такой же формат адреса, как и в стандартном сокете модуля Python для сокетов типа `AF_INET`. Дополнительные сведения см. в [документации Python](http://docs.python.org/3/library/socket.html#socket-families). 

1. Когда в списке появится нужный процесс, дважды щелкните его, чтобы подключиться. Visual Studio откроет средства отладки, а скрипт продолжит выполняться. В скрипте из приведенного выше примера можно вызвать срабатывание точки останова. Для этого нужно ввести любое число.

    ![Срабатывание точки останова](media/remote-debugging-breakpoint-hit.png)

1. Теперь вы можете использовать все стандартные возможности отладки PTVS. 

1. Когда вы завершите отладку, Visual Studio отключается от скрипта, который продолжит выполняться на удаленном компьютере. Сервер отладки также продолжит работу в фоновом потоке, а значит вы можете снова подключиться к процессу позже, повторив эту процедуру.


## <a name="securing-the-debugger-connection-with-ssl"></a>Защита подключения отладчика с помощью протокола SSL

По умолчанию подключение PTVS к серверу удаленной отладки не защищено. Подключиться к серверу может любой пользователь, имеющий секрет, а все данные передаются в виде обычного текста. Следовательно, другие пользователи сети могут перехватить эти данные или организовать атаку "посредника". Чтобы избежать этого даже при отладке по незащищенным сетям или Интернету, сервер отладки поддерживает протокол SSL. 

Для защиты канала вам потребуется сертификат SSL. Вы можете создать самозаверяющий сертификат самостоятельно, как описано в [документации по стандартному модулю Python `ssl`](http://docs.python.org/3/library/ssl.html#self-signed-certificates). Чтобы предотвратить атаки "посредника", созданный сертификат необходимо добавить в хранилище корневого центра сертификации на компьютере Windows, выполняющем PTVS. Это можно сделать с помощью диспетчера сертификатов (certmgr.msc), как описано в ветке форума [How do I export certificates and/or private keys?](https://answers.microsoft.com/en-us/windows/forum/windows_10-security/how-do-i-export-certificates-andor-private-keys/7722900a-e848-4076-bc50-9e2f5e3c66ac) (Как экспортировать сертификаты и (или) закрытые ключи?). Обратите внимание, что для импорта нужно использовать отдельный файл сертификата, а не единый файл, объединенный с закрытым ключом. 

Когда вы получите сертификат, создадите и зарегистрируете файлы закрытого ключа, следует добавить сертификат и ключ в вызов `enable_attach` в отлаживаемом скрипте. Для этого вам понадобятся параметры `certfile` и `keyfile`, значение которых совпадает со значением стандартной функции Python `ssl.wrap_socket`. Если, например, файл сертификата называется `my_cert.cer`, а файл ключа — `my_cert.key`, команда должна выглядеть так: 

```python
ptvsd.enable_attach(secret='my_secret', certfile='my_cert.cer', keyfile='my_cert.key')
```

Процесс подключения выполняется точно так же, как описано выше, но теперь вместо схемы `tcp://` в квалификаторе нужно указать `tcps://`: 

![Выбор транспорта удаленной отладки с использованием протокола SSL](media/remote-debugging-qualifier-ssl.png)

Если вы не добавите сертификат в корневое хранилище центра сертификации, вы увидите такое предупреждение: 

![Предупреждение о сертификате SSL](media/remote-debugging-ssl-warning.png)

Вы можете игнорировать это сообщение и продолжить отладку. Канал будет шифроваться для защиты от перехвата, но вы будете уязвимы для атак "посредника".

