---
title: "Шаблоны веб-приложений для Python в Visual Studio | Документация Майкрософт"
description: "Обзор шаблонов Visual Studio для веб-приложений, написанных на языке Python с помощью платформ Bottle, Flask и Django, включая конфигурации отладки и публикацию в службе приложений Azure."
ms.custom: 
ms.date: 07/13/2017
ms.reviewer: 
ms.suite: 
ms.technology:
- devlang-python
dev_langs:
- python
ms.tgt_pltfrm: 
ms.topic: article
author: kraigb
ms.author: kraigb
manager: ghogen
ms.workload:
- python
- data-science
ms.openlocfilehash: b75aae5811fa2410cf169d3401184b8af7ca381d
ms.sourcegitcommit: c0a2385a16cc4f47d2e1ff23d35c4da40f5605e0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/23/2018
---
# <a name="python-web-application-project-templates"></a>Шаблоны проекта веб-приложений Python

Python в Visual Studio поддерживает разработку веб-проектов на платформах Bottle, Django и Flask с помощью шаблонов проектов и средства запуска отладки, которое можно настроить для работы с различными платформами. Для других платформ, например Pyramid, также можно использовать универсальный шаблон **веб-проекта**.

Visual Studio не включает в себя сами эти платформы. Вам нужно установить платформы отдельно, щелкнув проект правой кнопкой мыши и выбрав **Python > Install/upgrade framework...** (Python > Установить или обновить платформу).

При запуске созданный из шаблона проект (открывается с помощью команд **Файл > Создать > Проект...**) запускает веб-сервер с использованием случайно выбранного локального порта, открывает браузер по умолчанию при отладке и позволяет публиковать напрямую в Microsoft Azure.

![Новые шаблоны веб-проектов](media/template-web-new-project.png)

Каждый шаблон (Bottle, Flask и Django) имеет начальный сайт с несколькими страницами и статическими файлами. Этот код позволяет локально выполнить запуск и отладку сервера (некоторые параметры для этого кода необходимо получить из среды) и развернуть проект в Microsoft Azure (где необходимо указать объект [приложения WSGI](http://www.python.org/dev/peps/pep-3333/)).

При создании проекта из шаблона для конкретной платформы отображается диалоговое окно для установки необходимых пакетов с помощью pip. Чтобы при публикации веб-сайта были настроены правильные зависимости, для веб-проектов рекомендуется использовать [виртуальную среду](selecting-a-python-environment-for-a-project.md#using-virtual-environments).

![Диалоговое окно, с помощью которого можно установить необходимые пакеты для шаблона проекта](media/template-web-requirements-txt-wizard.png)

Выполняя развертывание в службе приложений Microsoft Azure, нужно выбрать версию Python в качестве [расширения сайта](https://aka.ms/PythonOnAppService) и установить пакеты вручную. Кроме того, поскольку при развертывании из Visual Studio служба приложений Azure **не** устанавливает пакеты из файла `requirements.txt` автоматически, используйте сведения о конфигурации, указанные в статье [Upgrading Python on Azure App Service](https://aka.ms/PythonOnAppService) (Обновление Python в службе приложений Azure).

Облачные службы Microsoft Azure *поддерживают* файл `requirements.txt`. Дополнительные сведения см. в статье [Проекты облачных служб Azure](python-azure-cloud-service-project-template.md).

## <a name="debugging"></a>Отладка

Когда вы запускаете отладку веб-проекта, Visual Studio локально запускает веб-сервер и открывает страницу с указанным здесь адресом и портом в браузере по умолчанию. Чтобы указать дополнительные параметры, щелкните правой кнопкой мыши проект, выберите **Свойства** и откройте вкладку **Веб-средство запуска**:

  ![Свойства веб-средства запуска для универсального веб-шаблона](media/template-web-launcher-properties.png)

Параметры группы **Отладка**:

- Параметры **Пути поиска**, **Аргументы сценария**, **Аргументы интерпретатора** и **Путь к интерпретатору** ничем не отличаются от используемых в режиме [обычной отладки](debugging-python-in-visual-studio.md).
- **URL-адрес для запуска** — задает URL-адрес, который открывается в браузере. По умолчанию для него используется значение `localhost`.
- **Номер порта.** Это порт, который будет использоваться, если в URL-адресе не указан порт (по умолчанию Visual Studio автоматически выбирает порт). Этот параметр позволяет переопределить значение по умолчанию переменной среды `SERVER_PORT`, которое используется шаблонами для настройки порта, прослушиваемого локальным сервером отладки.

Свойства, указанные в группах **команды запуска сервера** и **команды отладки сервера** (последняя группа находится ниже в окне, показанном на рисунке), определяют, как будет запускаться веб-сервер. Так как для многих платформ требуется использовать сценарий вне текущего проекта, можно настроить сценарий здесь и передать модуль автозагрузки как параметр.

- **Команда** — может содержать сценарий Python (файл `*.py`), имя модуля (как и в `python.exe -m module_name`) или одну строку кода (как и в `python.exe -c "code"`). Значение в раскрывающемся списке указывает, какой из этих типов будет использоваться.
- **Аргументы** — содержимое этого поля передается в командной строке после команды.
- **Среда** — разделенный символом новой строки список пар `NAME=VALUE`, определяющих переменные среды. Эти переменные задаются после всех свойств, которые могут изменить среду, например номер порта или пути поиска, и поэтому могут перезаписать эти значения.

Любое свойство проекта и любую переменную среды можно указать, используя синтаксис MSBuild, например `$(StartupFile) --port $(SERVER_PORT)`.
`$(StartupFile)` — это относительный путь к файлу запуска, а `{StartupModule}` — импортируемое имя файла запуска. `$(SERVER_HOST)` и `$(SERVER_PORT)` являются обычными переменными среды, автоматически задаваемые свойствами **URL-адрес для запуска** и **Номер порта** или с помощью свойства **Среда**.

> [!Note]
> Значения в группе **команды запуска сервера** используются при выборе команды **Отладка > Start Server (Запуск сервера)** или нажатии клавиш CTR+F5. Значения в группе **команды отладки сервера** используются при выборе команды **Отладка > Start Debug Server (Запустить сервер отладки)** или нажатии клавиши F5.

### <a name="sample-bottle-configuration"></a>Пример конфигурации Bottle

Шаблон **веб-проекта Bottle** содержит стандартный код, который выполняет необходимую настройку. Импортированное приложение Bottle может не содержать этот код, однако в этом случае следующие параметры запускают приложение с помощью установленного модуля `bottle`:

- Группа **команды запуска сервера**:
  - **Команда**: `bottle` (модуль);
  - **Аргументы**: `--bind=%SERVER_HOST%:%SERVER_PORT% {StartupModule}:app`.

- Группа **команды отладки сервера**:
  - **Команда**: `bottle` (модуль);
  - **Аргументы**: `--debug --bind=%SERVER_HOST%:%SERVER_PORT% {StartupModule}:app`.

При отладке с помощью Visual Studio мы не рекомендуем использовать параметр `--reload`.

### <a name="sample-pyramid-configuration"></a>Пример конфигурации приложения Pyramid

В настоящее время для создания приложений Pyramid лучше всего использовать средство командной строки `pcreate`. После создания приложения его можно импортировать с помощью шаблона [На основе существующего кода Python](managing-python-projects-in-visual-studio.md#creating-a-project-from-existing-files). Затем настройте параметры в свойствах **универсального веб-проекта**. Эти параметры предполагают, что платформа Pyramid установлена в виртуальной среде в `..\env`.

- Группа **отладки**:
  - **Порт сервера**: 6543 (или заданный в INI-файлах).

- Группа **команды запуска сервера**:
  - Команда: `..\env\scripts\pserve-script.py` (сценарий);
  - Аргументы: `Production.ini`

- Группа **команды отладки сервера**:
    - Команда: `..\env\scripts\pserve-script.py` (сценарий);
    - Аргументы: `Development.ini`

> [!Tip]
> Скорее всего, потребуется настроить свойство **Working Directory** (Рабочая папка) проекта, так как приложения Pyramid обычно находятся на один уровень каталога ниже, чем верхний элемент дерева исходного кода.

### <a name="other-configurations"></a>Другие конфигурации

Если у вас есть параметры для другой платформы, которыми вы хотите поделиться, или вы хотите запросить параметры для такой платформы, откройте обращение в [репозитории GitHub](https://github.com/Microsoft/PTVS/issues).

## <a name="publishing-to-azure-app-service"></a>Публикация в службу приложений Azure

Существует два основных способа публикации проекта в службу приложений Azure. Во-первых, развертывание из системы управления версиями можно выполнять так же, как и для других языков программирования, как описано в [документации по Azure](http://azure.microsoft.com/en-us/documentation/articles/web-sites-publish-source-control/). Чтобы выполнить публикацию из Visual Studio напрямую, щелкните правой кнопкой мыши проект и выберите **Опубликовать**:

![Команда публикации в контекстном меню проекта](media/template-web-publish-command.png)

После выбора команды мастер поможет создать веб-узел или импортировать параметры публикации, предварительно просмотреть измененные файлы и выполнить публикацию на удаленном сервере.

При создании сайта в службе приложений нужно установить Python и все пакеты, от которых зависит работа сайта. Вы можете сначала опубликовать сайт, однако он не будет работать, пока вы не настроите Python.

Чтобы установить Python в службе приложений, мы рекомендуем использовать [расширения сайта](http://www.siteextensions.net/packages?q=Tags%3A%22python%22) (siteextensions.net). Это оптимизированные и перепакованные копии [официальных выпусков](https://www.python.org) Python для службы приложений Azure.

Расширение сайта можно развернуть с помощью [портала Azure](https://portal.azure.com/). Выберите колонку **Инструменты разработчика > Расширения** для службы приложений, элемент **Добавить** и прокрутите список, чтобы найти элементы Python:

![Добавление расширения сайта на портале Azure](media/template-web-site-extensions.png)

При использовании шаблонов развертывания JSON можно указать расширение сайта как его ресурс:

```json
{
    "resources": [
    {
        "apiVersion": "2015-08-01",
        "name": "[parameters('siteName')]",
        "type": "Microsoft.Web/sites",
        ...
    },
    "resources": [
    {
        "apiVersion": "2015-08-01",
        "name": "python352x64",
        "type": "siteextensions",
        "properties": { },
        "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('siteName'))]"
        ]
    },
    ...
}
```

Наконец, можно выполнить вход с помощью [консоли разработки](https://github.com/projectkudu/kudu/wiki/Kudu-console) и установить расширения сайта.

В настоящее время для установки пакетов рекомендуется использовать консоль разработки, после того как вы установили расширения сайта и выполнили pip напрямую. Очень важно указать полный путь к Python. Иначе может быть использован ошибочный путь. Как правило, нет необходимости использовать виртуальную среду. Пример:

```command
c:\Python35\python.exe -m pip install -r D:\home\site\wwwroot\requirements.txt

c:\Python27\python.exe -m pip install -r D:\home\site\wwwroot\requirements.txt
```

При развертывании в службе приложений Azure сайт работает в фоновом режиме по отношению к Microsoft IIS. Чтобы сайт работал со службами IIS, нужно добавить по меньшей мере файл `web.config`. Можно использовать шаблоны для некоторых общих целей развертывания, которые можно добавить, щелкнув правой кнопкой мыши проект и выбрав **Добавить > Создать элемент...** (см. диалоговое окно ниже). Подобные конфигурации можно легко изменить для других целей. Сведения о доступных параметрах конфигурации см. в [справочнике по настройке IIS](https://www.iis.net/configreference).

![Шаблоны элементов Azure](media/template-web-azure-items.png)

К доступным элементам относятся:

- Файл Azure web.config (FastCGI): добавляет файл `web.config`, когда приложение предоставляет объект [WSGI](https://wsgi.readthedocs.io/en/latest/) для обработки входящих подключений.
- Файл Azure web.config (HttpPlatformHandler): добавляет файл `web.config`, когда приложение прослушивает сокет для входящих подключений.
- Статические файлы Azure web.config: при наличии одного из вышеперечисленных файлов `web.config` добавьте его в подкаталог, чтобы исключить из обработки приложением.
- Файл Azure web.config для удаленной отладки: добавляет необходимые файлы для удаленной отладки через WebSockets.
- Файлы для поддержки веб-роли: содержат скрипты развертывания по умолчанию для веб-ролей облачной службы.
- Файлы для поддержки рабочей роли: содержат скрипты запуска и развертывания по умолчанию для рабочих ролей облачной службы.

Если вы добавили шаблон отладки `web.config` в проект и планируете использовать удаленную отладку Python, нужно опубликовать сайт в конфигурации "Отладка". Этот параметр не входит в текущую активную конфигурацию решения, и для него всегда по умолчанию используется значение "Выпуск". Чтобы его изменить, откройте вкладку **Параметры** и используйте в мастере публикации поле со списком **Конфигурация** (дополнительные сведения о создании и развертывании веб-приложения Azure см. в [документации по Azure](https://azure.microsoft.com/develop/python/)):

![Изменение конфигурации публикации](media/template-web-publish-config.png)

С помощью команды **Преобразовать в проект облачной службы Microsoft Azure** (см. рисунок ниже) можно добавить проект облачной службы в решение. Этот проект включает параметры развертывания и конфигурации для используемых виртуальных машин и служб. Используйте команду **Опубликовать** в облачном проекте, чтобы выполнить развертывание в облачных службах. С помощью команды **Опубликовать** в проекте Python можно по-прежнему выполнить развертывание на веб-сайтах. Дополнительные сведения см. в статье [Проекты облачных служб Azure для Python](python-azure-cloud-service-project-template.md).

![Команда "Преобразовать в проект облачной службы Microsoft Azure"](media/template-web-convert-menu.png)
