---
title: Удаленная отладка Azure с помощью Python
description: Сведения о настройке удаленной отладки приложения Python с помощью Visual Studio в Службе приложений Azure.
ms.date: 06/26/2018
ms.prod: visual-studio-dev15
ms.technology: vs-python
ms.topic: conceptual
author: kraigb
ms.author: kraigb
manager: douge
ms.workload:
- python
- data-science
ms.openlocfilehash: 29e4be790aef7dcb16031df91f76fd92b840bdf6
ms.sourcegitcommit: 4f82c178b1ac585dcf13b515cc2a9cb547d5f949
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/30/2018
ms.locfileid: "39341791"
---
# <a name="remotely-debug-python-code-on-azure"></a>Удаленная отладка кода Python в Azure

[Поддержка Python в Visual Studio](installing-python-support-in-visual-studio.md) включает возможность удаленной отладки кода Python, который выполняется в службе приложений Azure. В отличие от обычной удаленной отладки, в этом сценарии нет прямого доступа к целевому компьютеру по протоколу TCP. Поэтому в Visual Studio есть прокси-сервер для предоставления доступа к протоколу отладчика по HTTP. В проектах, созданных с использованием веб-шаблона, этот прокси-сервер автоматически настраивается в созданном файле *web.debug.config*. Также удаленная отладка активируется при публикации проекта с конфигурацией **отладки**. Этот процесс описан в разделе [Публикация в службу приложений Azure](publishing-python-web-applications-to-azure-from-visual-studio.md).

Так как для удаленной отладки в Azure используются веб-сокеты, они должны быть включены для вашей службы приложения. Для этого перейдите на [портал Azure](https://portal.azure.com), откройте страницу **Параметры** > **Параметры приложения** и установите для параметра **Общие параметры** > **Веб-сокеты** значение **Включено**, а затем нажмите **Сохранить**, чтобы применить изменения. (Обратите внимание, что функция **Отладка** здесь не имеет отношения к отладке Python).

![Включение веб-сокетов на портале Azure](media/azure-remote-debugging-enable-web-sockets.png)

## <a name="attach-with-server-explorer"></a>Присоединение с помощью обозревателя сервера

Когда проект правильно развернут и для него включены веб-сокеты, вы можете подключиться к службе приложений из **обозревателя сервера** в Visual Studio (**Вид** > **Обозреватель сервера**). Найдите нужный сайт в разделе **Azure** > **Служба приложений**, открыв соответствующую группу ресурсов, щелкните его правой кнопкой мыши и выберите действие **Подключить отладчик (Python)**. (Другая команда, **Подключить отладчик**, действует для приложений .NET, работающих под управлением служб IIS, и будет полезна только в тех случаях, когда рядом с приложением Python размещен код .NET.)

Теперь вы можете перейти в Visual Studio непосредственно к набору инструкций для прямого подключения, как описано ниже в разделе [Подключение без обозревателя сервера](#attach-without-server-explorer). Если вы не видите команды **Подключить отладчик (Python)** или Visual Studio не может подключиться к сайту, воспользуйтесь статьей [Устранение неполадок с удаленной отладкой для Python и Azure](debugging-remote-python-code-on-azure-troubleshooting.md).

При успешном подключении Visual Studio переключается в представление отладчика. Панель инструментов указывает, какой процесс проходит отладку, например URI `wss://`:

![Отладка веб-сайта, размещенного в службе приложений Azure](media/azure-remote-debugging-attached.png)

После подключения процесс отладки мало чем отличается от обычной удаленной отладки, за исключением нескольких ограничений. В частности, веб-сервер IIS, который обрабатывает входящие запросы и передает их в код Python с помощью FastCGI, имеет время ожидания обработки запроса. По умолчанию это 90 секунд. Если длительность обработки запроса превышает время ожидания (например, из-за прерывания процесса в точке останова), службы IIS завершают процесс, что приводит к закрытию сеанса отладки. 

## <a name="attach-without-server-explorer"></a>Подключение без обозревателя сервера

Вы можете подключить отладчик напрямую к службе приложений. Для этого выполните инструкции, указанные на странице информации о прокси-сервере WebSocket, которую Visual Studio развертывает на вашем сайте по адресу *\<url_адрес_сайта>/ptvsd*, например *ptvsdemo.azurewebsites.net/ptvsd*. Открыв эту страницу, вы заодно убедитесь, что прокси-сервер настроен правильно:

![Страница информации о прокси удаленной отладки в Azure](media/azure-remote-debugging-proxy-info-page.png)

Как уже было сказано, создайте URL-адрес с использованием секрета из файла *web.debug.config*, который создается заново при каждой публикации проекта. По умолчанию этот файл скрыт в **обозревателе решений** и не включается в проект. Чтобы открыть его, следует выбрать функцию "Показать все файлы" или использовать сторонний редактор. Открыв этот файл, найдите параметр appSetting с именем `WSGI_PTVSD_SECRET`:

![Определение конечной точки отладчика в службе приложений Azure](media/azure-remote-debugging-secret.png)

Теперь вам нужно создать URL-адрес в формате `wss://<secret>@<site_name>.azurewebsites.net/ptvsd`, заменив здесь &lt;secret&gt; и &lt;site_name&gt; соответствующими значениями.

Чтобы подключить отладчик, выберите действие **Отладка** > **Присоединиться к процессу**, затем выберите значение **Удаленная отладка Python** в раскрывающемся списке **Транспорт**, введите полученный URL-адрес в текстовое поле **Квалификатор** и нажмите клавишу **ВВОД**. Если Visual Studio успешно подключится к службе приложений, вы увидите в списке один процесс Python. Выберите его и нажмите **Присоединить**, чтобы запустить отладку:

![Диалоговое окно "Присоединение к процессу" для присоединения к веб-сайту Azure](media/azure-remote-debugging-manual-attach.png)
