---
title: Удаленная отладка Azure с помощью Python
description: Сведения о настройке удаленной отладки приложения Python с помощью Visual Studio в Службе приложений Azure.
ms.date: 07/12/2017
ms.prod: visual-studio-dev15
ms.technology: vs-python
ms.topic: conceptual
author: kraigb
ms.author: kraigb
manager: douge
ms.workload:
- python
- data-science
ms.openlocfilehash: 11a624ec6582e5e07e51de6d4ab29b84dc53d4a1
ms.sourcegitcommit: 928885ace538bef5b25961358d4f166d648f196a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/27/2018
ms.locfileid: "32031895"
---
# <a name="remotely-debugging-python-code-on-azure"></a>Удаленная отладка кода Python а Azure

[Поддержка Python в Visual Studio](installing-python-support-in-visual-studio.md) включает возможность удаленной отладки кода Python, который выполняется в службе приложений Azure. В отличие от обычной удаленной отладки, в этом сценарии нет прямого доступа к целевому компьютеру по протоколу TCP. Поэтому в Visual Studio есть прокси-сервер для предоставления доступа к протоколу отладчика по HTTP. В проектах, созданных с использованием веб-шаблона, этот прокси-сервер автоматически настраивается в созданном файле `web.debug.config`. Также удаленная отладка активируется при публикации проекта с конфигурацией отладки. Этот процесс описан в разделе о [публикации в Службе приложений Azure](publishing-python-web-applications-to-azure-from-visual-studio.md).

Поскольку для удаленной отладки в Azure используются веб-сокеты, они должны быть включены для вашей службы приложения. Для этого перейдите на [портал Azure](https://portal.azure.com), откройте страницу **Параметры > Параметры приложения** и установите для параметра **Общие параметры > Веб-сокеты** значение **Включено**, а затем нажмите **Сохранить**, чтобы применить изменения. (Обратите внимание, что функция **Отладка** здесь не имеет отношения к отладке Python).

![Включение веб-сокетов на портале Azure](media/azure-remote-debugging-enable-web-sockets.png)

Когда проект правильно развернут и для него включены веб-сокеты, вы можете подключиться к службе приложений из **обозревателя сервера** в Visual Studio (**Просмотр > Обозреватель сервера**). Найдите нужный сайт в разделе **Azure > Служба приложений**, открыв соответствующую группу ресурсов, щелкните его правой кнопкой мыши и выберите действие **Подключить отладчик (Python)**. (Другая команда, **Подключить отладчик**, действует для приложений .NET, работающих под управлением служб IIS, и будет полезна только в тех случаях, когда рядом с приложением Python размещен код .NET.)

Теперь вы можете перейти в Visual Studio непосредственно к набору инструкций для прямого подключения, как описано ниже в разделе [Подключение без обозревателя серверов](#attaching-without-server-explorer). Если вы не видите команды **Подключить отладчик (Python)** или Visual Studio не может подключиться к сайту, воспользуйтесь статьей [Устранение неполадок с удаленной отладкой Azure с помощью инструментов Python для Visual Studio](debugging-remote-python-code-on-azure-troubleshooting.md).

При успешном подключении Visual Studio переключается в представление отладчика. Панель инструментов указывает, какой процесс проходит отладку, например URI `wss://`:

![Отладка веб-сайта, размещенного в службе приложений Azure](media/azure-remote-debugging-attached.png)

После подключения процесс отладки мало чем отличается от обычной удаленной отладки, за исключением нескольких ограничений. В частности, веб-сервер IIS, который обрабатывает входящие запросы и передает их в код Python с помощью FastCGI, имеет время ожидания обработки запроса. По умолчанию это 90 секунд. Если длительность обработки запроса превышает время ожидания (например, из-за прерывания процесса в точке останова), службы IIS завершают процесс, что приводит к закрытию сеанса отладки. 

## <a name="attaching-without-server-explorer"></a>Подключение без обозревателя серверов

Вы можете подключить отладчик напрямую к службе приложений. Для этого выполните инструкции, указанные на странице информации о прокси-сервере WebSocket, которую Visual Studio развертывает на вашем сайте по адресу `<site_url>/ptvsd`, например так: `ptvsdemo.azurewebsites.net/ptvsd`. Открыв эту страницу, вы заодно убедитесь, что прокси-сервер настроен правильно:

![Страница информации о прокси удаленной отладки в Azure](media/azure-remote-debugging-proxy-info-page.png)

Как уже сказано, создайте URL-адрес с использованием секрета из файла `web.debug.config`, который создается заново при каждой публикации проекта. По умолчанию этот файл скрыт в обозревателе решений и не включается в проект. Чтобы открыть его, следует выбрать функцию "Показать все файлы" или использовать сторонний редактор. Открыв этот файл, найдите параметр appSetting с именем `WSGI_PTVSD_SECRET`:

![Определение конечной точки отладчика в службе приложений Azure](media/azure-remote-debugging-secret.png)

Теперь вам нужно создать URL-адрес в формате `wss://<secret>@<site_name>.azurewebsites.net/ptvsd`, заменив здесь &lt;secret&gt; и &lt;site_name&gt; соответствующими значениями.

Чтобы подключить отладчик, выберите действие **Отладка > Присоединиться к процессу**, затем выберите значение **Удаленная отладка Python** в раскрывающемся списке **Транспорт**, введите полученный URL-адрес в текстовое поле **Квалификатор** и нажмите клавишу ВВОД. Если Visual Studio успешно подключится к службе приложений, вы увидите в списке один процесс Python. Выберите его и нажмите **Присоединить**, чтобы запустить отладку:

![Диалоговое окно "Присоединение к процессу" для присоединения к веб-сайту Azure](media/azure-remote-debugging-manual-attach.png)
