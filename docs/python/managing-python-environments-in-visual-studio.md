---
title: "Управление окружениями Python в Visual Studio | Документация Майкрософт"
description: "Использование окна окружений Python в Visual Studio для управления глобальными и виртуальными окружениями, настройка пользовательских окружений, установка интерпретаторов Python, установка пакетов, задание путей для поиска и управление окружениями для проектов Visual Studio."
ms.custom: 
ms.date: 02/13/2018
ms.reviewer: 
ms.suite: 
ms.technology:
- devlang-python
ms.devlang: python
ms.tgt_pltfrm: 
ms.topic: article
author: kraigb
ms.author: kraigb
manager: ghogen
ms.workload:
- python
- data-science
ms.openlocfilehash: 6abf950f7af86bf65b14752bd1cd9df4a6e292e5
ms.sourcegitcommit: a07b789cc41ed72664f2c700c1f114476e7b0ddd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2018
---
# <a name="python-environments"></a>Среды Python

*Окружение* Python — это контекст, в котором выполняется код Python. Окружение состоит из интерпретатора, библиотеки (обычно это стандартная библиотека Python) и нескольких установленных пакетов. Вместе они определяют, какие языковые конструкции и синтаксис допустимы, какие возможности операционной системы доступны и какие пакеты можно использовать.

В Visual Studio вы можете управлять всеми окружениями с помощью [окна окружений Python](#managing-python-environments-in-visual-studio), как указано в этой статье. Для каждого проекта вы можете выбрать окружение для выполнения кода, отладки, проверки синтаксиса, отображения сведений об импорте и подсказок с элементами для завершения кода, а также любых других задач, относящихся к интерпретатору и установленным библиотекам. Кроме того, Visual Studio поддерживает базу данных IntelliSense для каждого окружения, которая обеспечивает автозавершение при вводе кода.

Также Visual Studio позволяет использовать виртуальные окружения, файлы `requirements.txt` и пути поиска.

**Примечание.** Если вы только начинаете работу с Python в Visual Studio, ознакомьтесь с необходимыми базовыми сведениями в следующих статьях:

- [Работа с Python в Visual Studio](overview-of-python-tools-for-visual-studio.md)
- [Установка поддержки Python в Visual Studio](installing-python-support-in-visual-studio.md)

## <a name="global-and-virtual-environments"></a>Глобальные и виртуальные окружения

Есть два типа окружений Python: глобальные и виртуальные.

**Глобальные окружения.** Каждая установка Python (например, Python 2.7, Python 3.6 и Anaconda 4.4.0, — см. раздел о [выборе и установке интерпретаторов Python](#selecting-and-installing-python-interpreters)) поддерживает собственное окружение. Каждое окружение состоит из определенного интерпретатора Python, его стандартной библиотеки и набора предварительно установленных пакетов. Установив пакет в глобальном окружении, мы предоставляем к нему доступ для всех проектов, в которых оно используется. Если окружение находится в защищенной области файловой системы (например, в `c:\program files`), для установки пакетов требуются привилегии администратора.

Глобальные окружения доступны для всех проектов на компьютере. В Visual Studio вы можете выбрать одно глобальное окружение по умолчанию, которое будет использоваться для всех проектов, если вы не укажете другое для определенного проекта. Дополнительные сведения см. в разделе о [выборе окружения для проекта](#selecting-an-environment-for-a-project).

**Виртуальные окружения.** Пакеты, установленные в глобальном окружении, доступны для всех проектов, в которых оно используется. Из-за этого могут возникать конфликты, например, когда двум проектам требуются несовместимые пакеты или разные версии одного пакета. Виртуальные окружения позволяют избежать таких конфликтов. В них применяются интерпретатор и стандартная библиотека из глобального окружения, но раздельные хранилища пакетов в изолированных папках.

В Visual Studio вы можете создать для конкретного проекта виртуальное окружение, которое хранится во вложенной папке проекта (см. раздел о [создании виртуальных окружений](#creating-virtual-environments)). Кроме того, виртуальное окружение определяется в файле проекта. Также в файл проекта `requirements.txt` Visual Studio записывает все пакеты, которые вы устанавливаете в этом виртуальном окружении. Если вы предоставляете общий доступ к проекту, и другие разработчики открывают его на своих компьютерах, в Visual Studio можно повторно создать виртуальное окружение.

### <a name="selecting-and-installing-python-interpreters"></a>Выбор и установка интерпретаторов Python

По умолчанию при установке рабочей нагрузки Python для разработки в Visual Studio 2017 также устанавливается Python 3 (64-разрядная версия). При необходимости вы можете установить 32-разрядную и 64-разрядную версии Python 2, Python 3, Anaconda 2 и Anaconda 3, как описано в руководстве по [установке](installing-python-support-in-visual-studio.md). Кроме того, можно вручную установить любой интерпретатор из приведенной ниже таблицы. Visual Studio определит его. (Например, если вы установили Anaconda 3 перед установкой Visual Studio, вам не нужно снова устанавливать этот дистрибутив с помощью установщика Visual Studio.)

Для Visual Studio 2015 и более ранних версий нужно вручную установить один из интерпретаторов.

В Visual Studio (любой версии) автоматически создается окружение для каждого установленного интерпретатора Python при проверке реестра (в соответствии с [описанием регистрации Python в реестре Windows 514 PEP](https://www.python.org/dev/peps/pep-0514/)). Если Visual Studio не удается обнаружить установленное окружение, см. руководство по [созданию окружения для существующего интерпретатора](#creating-an-environment-for-an-existing-interpreter).

| Интерпретатор | Описание: |
| --- | --- |
| [CPython](https://www.python.org/) | Собственный и самый используемый интерпретатор доступен в 32- и 64-разрядных версиях (рекомендуется 32-разрядная). Он предоставляет последние возможности языка, максимальную совместимость пакета Python, полную поддержку отладки и взаимодействие с [IPython](http://ipython.org/). См. также статью о [сравнении Python 2 и Python 3](http://wiki.python.org/moin/Python2orPython3). Имейте в виду, что Visual Studio 2015 и более ранние версии не поддерживают Python 3.6 и в них может появиться ошибка "Не поддерживаемая версия Python 3.6". Используйте Python 3.5 или более раннюю версию. |
| [IronPython](https://github.com/IronLanguages/ironpython2) | Реализация .NET для Python (доступна 32- и 64-разрядная версия), обеспечивающая взаимодействие с C#, F# и Visual Basic, доступ к API-интерфейсам .NET, стандартную отладку Python (но не отладку в смешанном режиме C++) и отладку в смешанном режиме IronPython и C#. Однако IronPython не поддерживает виртуальные среды. |
| [Anaconda](https://www.continuum.io) | Открытая платформа для анализа и обработки данных на базе Python, которая включает в себя последнюю версию CPython и большинство пакетов со сложной установкой. Рекомендуем использовать этот интерпретатор, если вы не можете определиться. |
| [PyPy](http://www.pypy.org/) | Реализация JIT для Python с высокопроизводительной трассировкой, которая хорошо подходит для долго выполняющихся программ и ситуаций, когда вы обнаружили проблемы с производительностью, которые не удается устранить другими способами. Работает с Visual Studio, но имеет ограниченную поддержку расширенных возможностей отладки. |
| [Jython](http://www.jython.org/) | Реализация Python на виртуальной машине Java (JVM). Аналогично IronPython, код, выполняемый в Jython, может взаимодействовать с классами и библиотеками Java, но не может использовать многие библиотеки, предназначенные для CPython. Работает с Visual Studio, но имеет ограниченную поддержку расширенных возможностей отладки. |

Сведения о новых способах обнаружения сред Python см. в статье [PTVS Environment Detection](https://github.com/Microsoft/PTVS/wiki/Extensibility-Environments) (Обнаружение среды PTVS) на сайте github.com.

## <a name="managing-python-environments-in-visual-studio"></a>Управление средами Python в Visual Studio

Чтобы открыть окно окружений Python, последовательно выберите в меню **Просмотр > Другие окна > Окружения Python** или щелкните правой кнопкой узел проекта **Окружения Python** в обозревателе решений и выберите **Просмотреть все окружения Python**:

    ![View All Environments command in Solution Explorer](media/environments-view-all.png)

В любом случае в обозревателе решений откроется окно со средами Python в виде одноуровневой вкладки.

![Окно со средами Python](media/environments-default-view.png)

В примере выше видно, что установлена версия Python 3.4 (32-разрядный интерпретатор CPython) вместе с 32- и 64-разрядной версиями IronPython 2.7. Для всех новых проектов используется выделенное окружение по умолчанию, то есть Python 3.4. Если среды не отображаются, это значит, вы установили Инструменты Python для Visual Studio версии 2015 или более ранней, но еще не установили интерпретатор Python (см. сведения в разделе [Выбор и установка интерпретаторов Python](#selecting-and-installing-python-interpreters) выше). Команда **+Настроить** позволяет [создать окружение для существующего интерпретатора](#create-an-environment-for-an-existing-interpreter).

> [!Tip]
> Visual Studio обнаруживает обновления для существующих интерпретаторов, например обновление Python 2.7.11 до версии 2.7.14, с помощью установщиков с сайта python.org. В ходе установки старое окружение исчезнет из списка **окружений Python**, прежде чем на его месте появится обновление.

Справа от каждого окружения в списке есть элемент управления, который позволяет открыть интерактивное окно для этого окружения. Также может отображаться еще один элемент управления, отвечающий за обновление базы данных IntelliSense для этого окружения.

Под списком окружений есть раскрывающийся список с параметрами **Обзор**, **Пакеты** и **IntelliSense**. Они описаны далее в этом разделе. Если достаточно широко развернуть окно **Окружения Python**, эти параметры отображаются в виде вкладок. Такой вариант может оказаться для вас более удобным:

![Развернутое окно Python Environments (Среды Python)](media/environments-expanded-view.png)

> [!Note]
> Несмотря на то что Visual Studio учитывает параметр system-site-packages, его нельзя изменить из среды Visual Studio.

|   |   |
|---|---|
| ![значок кинокамеры для видео](../install/media/video-icon.png "Просмотреть видео") | [Просмотрите видео (Microsoft Virtual Academy)](https://mva.microsoft.com/en-US/training-courses/python-tools-for-visual-studio-2017-18121?l=qrDmN4LWE_8305918567) об окружениях Python в Visual Studio (2 мин 35 с).|

### <a name="creating-an-environment-for-an-existing-interpreter"></a>Создание среды для существующего интерпретатора

Если Visual Studio не удается обнаружить интерпретатор (например, если он установлен в нестандартном расположении), вы можете создать окружение следующим образом:

1. Чтобы создать новую среду, в [окне сред Python](#managing-python-environments-in-visual-studio) выберите **Настраиваемая...**. После этого откроется [вкладка **Настройка**](#configure-tab), как показано ниже.

    ![Представление по умолчанию для новой настраиваемой среды](media/environments-custom-1.png)

1. Введите имя среды в поле **Описание**.
1. Введите или найдите путь к интерпретатору в поле **Prefix path** (Префикс пути).
1. Выберите **Auto Detect** (Автоматическое обнаружение), чтобы Visual Studio заполнила оставшиеся поля, или заполните их вручную.
1. Выберите **Применить**, чтобы сохранить среду.
1. Чтобы удалить среду, щелкните **Удалить** на вкладке **Настройка**. Для автоматически обнаруженных сред этот параметр не предлагается. Дополнительные сведения можно найти в следующем разделе.

### <a name="moving-an-existing-interpreter"></a>Перемещение существующего интерпретатора

Если вы переместите существующий интерпретатор в новое расположение в файловой системе, Visual Studio не отследит такое изменение автоматически и вам потребуется обновить соответствующее окружение вручную:

- Если изначально для этого интерпретатора вы создавали среду самостоятельно, измените параметры среды, чтобы она указывала на новое расположение.

- Если изначально среда была обнаружена автоматически, это означает, что она была установлена с помощью другого установщика, который создал известные для Visual Studio записи реестра. В этом случае следует вернуть интерпретатор Python в исходное расположение. Затем удалите его с помощью установщика, который очистит записи реестра. После этого установите интерпретатор заново в нужном расположении. Перезапустите программу Visual Studio, и она автоматически обнаружит новое расположение. Такой процесс позволяет гарантировать, что установщик правильно применит все дополнительные действия и настройки.

### <a name="overview-tab"></a>Вкладка "Обзор"

Содержит основные сведения и команды для окружения:

![Вкладка обзора сред Python](media/environments-overview-tab.png)

| Команда | Описание: |
| --- | --- |
| По умолчанию использовать это окружение для новых проектов | Задает активное окружение, при загрузке базы данных IntelliSense в котором система Visual Studio может ненадолго перестать отвечать. Среды с множеством пакетов могут не отвечать дольше. |
| Посетите веб-сайт распространителя | Открывает в браузере URL-адрес, указанный в дистрибутиве Python. Например, для Python 3.x открывается сайт python.org. |
| Открыть интерактивное окно | Открывает [интерактивное окно (REPL)](python-interactive-repl-in-visual-studio.md) для этого окружения в Visual Studio, применяя все [скрипты запуска (см. ниже)](#startup-scripts). |
| Просмотреть интерактивные скрипты | См. раздел о [скриптах запуска](#startup-scripts). |
| Использовать интерактивный режим IPython | Если параметр задан, по умолчанию открывается интерактивное окно с IPython. Это позволяет использовать встроенные графики и расширенный синтаксис IPython, например `name?`, для просмотра справки и `!command` для команд оболочки. Этот параметр рекомендуется использовать при работе с дистрибутивом Anaconda, так как ему требуются дополнительные пакеты. Дополнительные сведения см. в разделе [Использование IPython в интерактивном окне](interactive-repl-ipython.md). |
| Открыть в PowerShell | Запускает интерпретатор в окне команд PowerShell. |
| (Ссылки на папки) | Предоставляет быстрый доступ к папке установки окружения, интерпретатору python.exe и интерпретатору pythonw.exe. Папка открывается в проводнике, а интерпретаторы — в окне консоли. |

#### <a name="startup-scripts"></a>Скрипты запуска

Используя интерактивные окна в повседневной работе, удобно разработать вспомогательные функции для регулярного применения. Например, можно создать функцию, открывающую кадр данных в Excel, и сохранить этот код как скрипт запуска, чтобы он всегда был доступен в интерактивном окне.

Скрипты запуска содержат код, автоматически загружаемый и запускаемый интерактивным окном, включая импорты, определения функций и все остальное. Ссылки на такие скрипты выполняются двумя способами:

1. При установке окружения Visual Studio создает папку `Documents\Visual Studio 2017\Python Scripts\<environment>`, где &lt;environment&gt' совпадает с именем окружения. Вы легко можете перейти в папку окружения с помощью команды **Просмотреть интерактивные сценарии**. При запуске интерактивного окна для этого окружения оно загружает и выполняет все найденные файлы `.py` в алфавитном порядке.

1. Элемент управления **Сценарии** на вкладке **Инструменты > Параметры > Инструменты Python > Интерактивные окна** (см. раздел [Параметры интерактивных окон](python-support-options-and-settings-in-visual-studio.md#interactive-windows-options)) позволяет указать дополнительную папку для скриптов запуска, которые загружаются и выполняются во всех окружениях. Однако сейчас эта функция не работает.

### <a name="configure-tab"></a>Вкладка "Настройка"

На этой вкладке содержатся параметры, которые приведены в таблице ниже. Если этой вкладки нет в списке, это значит, Visual Studio автоматически управляет всеми сведениями.

![Вкладка настройки сред Python](media/environments-configure-tab.png)

| Поле | Описание: |
| --- | --- |
| **Описание** | Имя среды. |
| **Prefix path** (Префикс пути) | Расположение базовой папки интерпретатора. Если заполнить это значение и щелкнуть **Автовыбор**, Visual Studio пытается заполнить другие поля автоматически. |
| **Interpreter path** (Путь к интерпретатору) | Путь к исполняемому файлу интерпретатора. Обычно он состоит из префикса пути, за которым следует `python.exe`. |
| **Windowed interpreter** (Оконный интерпретатор) | Путь к неконсольному исполняемому файлу. Обычно он состоит из префикса пути, за которым следует `pythonw.exe`. |
| **Library path** (Путь к библиотеке) | Корень стандартной библиотеки, но это значение может игнорироваться, если Visual Studio может запросить более точный путь через интерпретатор. |
| **Версия языка** | Выбирается в раскрывающемся меню. |
| **Архитектура** | Обычно обнаруживается и заполняется автоматически. В противном случае указывается 32- или 64-разрядная версия. |
| **Path environment variable** (Переменная среды пути) | Переменная среды, которую интерпретатор использует, чтобы найти пути поиска. Visual Studio изменяет значение переменной при запуске Python, чтобы он содержал пути поиска проекта. Обычно для этого свойства должно быть присвоено значение `PYTHONPATH`, но некоторые интерпретаторы используют другое значение. |

### <a name="pip-tab"></a>Вкладка pip

Эта вкладка позволяет управлять пакетами, установленными в окружении, а также находить и устанавливать новые пакеты (включая все зависимости). При поиске выполняется фильтрация по установленным пакетам и [PyPI](https://pypi.python.org). В поле поиска можно также ввести любую команду `pip install`, включая такие параметры, как `--user` или `--no-deps`.

![Вкладка pip сред Python](media/environments-pip-tab.png)

При установке пакета создаются вложенные папки в папке соответствующего окружения `Lib` в рамках файловой системы. Например, если Python 3.6 установлен в `c:\Python36`, пакеты устанавливаются в `c:\Python36\Lib`, а если Anaconda3 установлен в `c:\Program Files\Anaconda3`, то пакеты устанавливаются в `c:\Program Files\Anaconda3\Lib`.

Так как в последнем случае окружение находится в защищенной области файловой системы — `c:\Program Files`, Visual Studio требуется запустить `pip install` с повышенными привилегиями, разрешить создание вложенных папок для пакетов. Когда требуется повышение прав, Visual Studio отображает запрос "Для установки, обновления или удаления пакетов для этого окружения могут потребоваться права администратора":

![Запрос на повышение прав для установки пакетов](media/environments-pip-elevate.png)

Параметр **Повысить уровень прав** предоставляет pip права администратора для отдельной операции, что также распространяется на все запросы разрешений в операционной системе. Значение **Продолжить без прав администратора** позволяет попытаться установить пакет, однако pip завершается со сбоем при попытке создать папки с выходными данными, такими как "error: could not create 'C:\Program Files\Anaconda3\Lib\site-packages\png.py': Permission denied".

Значение **Всегда повышать уровень прав при установке и удалении пакетов** отключает отображение данного диалогового окна для соответствующего окружения. Чтобы снова включить отображение диалогового окна, откройте вкладку **Инструменты > Параметры > Инструменты Python > Общие** и нажмите кнопку **Сбросить все окончательно скрытые диалоговые окна**.

На этой же вкладке можно выбрать параметр **Всегда выполнять pip от имени администратора**, чтобы отключить диалоговое окно для всех окружений. См. раздел [Параметры вкладки "Общие"](python-support-options-and-settings-in-visual-studio.md#general-options).

### <a name="intellisense-tab"></a>Вкладка IntelliSense

На этой вкладке отображается текущее состояние выполнения IntelliSense для базы данных.

![Вкладка IntelliSense сред Python](media/environments-intellisense-tab.png)

База данных содержит метаданные всех библиотек среды, повышает скорость выполнения IntelliSense и сокращает использование памяти. Когда Visual Studio обнаруживает (или когда вы добавляете) новую среду, автоматически запускается компиляция базы данных путем анализа исходных файлов библиотеки. Этот процесс может занять от минуты до часа и более в зависимости от установленных компонентов. (Anaconda, например, содержит множество библиотек, поэтому компиляция базы данных занимает некоторое время.) После завершения вы получите подробности IntelliSense, и вам не придется снова обновлять базу данных (с помощью кнопки **Обновить базу данных**) до установки дополнительных библиотек.

Библиотеки, для которых еще не были скомпилированы данные, помечаются знаком **!**. Если база данных среды еще не скомпилирована, рядом с ней также отображается знак **!** в основном списке среды.

## <a name="selecting-an-environment-for-a-project"></a>Выбор окружения для проекта

Среды конкретных проектов нужны, чтобы проект всегда выполнялся в конкретной среде, игнорируя глобальную среду по умолчанию. Например, если глобальная среда по умолчанию — CPython, но проекту требуются IronPython и некоторые библиотеки, которые не установлены в этой среде, нужна среда конкретного проекта.

Среды проектов приведены в обозревателе решений в узле Python Environments (Среды Python). Окружение, выделенное полужирным шрифтом, активно. Visual Studio использует его для отладки, импорта, автозавершения элементов, проверки синтаксиса и других задач, для которых требуется окружение.

![Среды проекта, отображаемые в обозревателе решений](media/environments-project.png)

Чтобы активировать другую среду для проекта, щелкните правой кнопкой мыши эту среду и выберите **Activate Environment** (Активировать среду).

Любую глобальную среду можно добавить в качестве среды проекта, щелкнув правой кнопкой мыши **Python Environments** (Среды Python) и выбрав команду **добавления или удаления сред Python**. В списке можно выбрать или отменить выбор тех окружений, которые доступны в проекте.

![Диалоговое окно добавления и удаления сред Python](media/environments-add-remove.png)

В обозревателе решений также можно развернуть среду, чтобы отобразить установленные пакеты (которые можно импортировать и использовать в коде, если среда активна).

![Пакеты Python для среды в обозревателе решений](media/environments-installed-packages.png)

Чтобы установить новые пакеты, щелкните правой кнопкой мыши среду, выберите **Install Python Package...** (Установить пакет Python...) и введите имя нужного пакета. Пакеты (вместе с зависимостями) скачиваются из репозитория [Python Package Index (PyPI)](https://pypi.python.org/pypi), который также можно использовать, чтобы найти доступные пакеты. В строке состояния Visual Studio и окне вывода отображаются сведения об установке. Чтобы удалить пакет, щелкните его правой кнопкой мыши и выберите команду **Удалить**.

> [!Note]
> В настоящее время поддержка управления пакетами Python находится на стадии разработки. Поэтому отображаемые записи могут быть неточными, а задания установки и удаления могут быть ненадежными или недоступными. Visual Studio использует диспетчер пакетов pip, если он доступен, и при необходимости скачивает и устанавливает его. Visual Studio также может использовать диспетчер пакетов простой установки (easy_install). Пакеты, установленные с помощью pip или команды easy_install из командной строки, также отображаются.

> [!Tip]
> Если пакет содержит исходный код собственных компонентов в файлах `*.pyd`, попытка pip установить пакет завершается сбоем. Если необходимая версия Visual Studio не установлена, pip не может скомпилировать эти компоненты. В этом случае отображается сообщение об ошибке: `error: Unable to find vcvarsall.bat`. Как правило, диспетчер `easy_install` может скачать предварительно скомпилированные двоичные файлы. Подходящий компилятор для более старых версий Python можно скачать по адресу [http://aka.ms/VCPython27](http://aka.ms/VCPython27). Дополнительные сведения см. в записи блога команды разработчиков Python [How to deal with the pain of “unable to find vcvarsall.bat”](https://blogs.msdn.microsoft.com/pythonengineering/2016/04/11/unable-to-find-vcvarsall-bat/) (Что делать в случае возникновения ошибки "Не удалось найти vcvarsall.bat").

## <a name="creating-virtual-environments"></a>Создание виртуальных окружений

1. В обозревателе решений щелкните правой кнопкой мыши **Python Environments** (Среды Python) и выберите **Add Virtual Environment...** (Добавить виртуальную среду...). После чего откроется следующее окно:

    ![Создание виртуальной среды](media/environments-add-virtual-1.png)

1. Укажите имя для создания виртуальной среды в пути к проекту или введите полный путь, чтобы создать ее в другом месте. (Чтобы обеспечить максимальную совместимость с другими средствами, в имени следует использовать только буквы и цифры.)

1. Выберите в качестве базового интерпретатора глобальную среду и нажмите кнопку **Создать**. Если `pip` и пакеты `virtualenv` или `venv` недоступны, они скачиваются и устанавливаются.

    Если указанный путь относится к существующему виртуальному окружению, обнаруживается базовый интерпретатор, а кнопка "Создать" изменяется на **Добавить**.

    ![Добавление существующей виртуальной среды](media/environments-add-virtual-2.png)

Чтобы добавить существующую виртуальную среду, можно также щелкнуть правой кнопкой мыши **Python Environments** (Среды Python) в обозревателе решений и выбрать команду **Add Existing Virtual Environment...** (Добавить существующую виртуальную среду...). Visual Studio автоматически обнаруживает базовый интерпретатор с помощью файла `orig-prefix.txt` в каталоге среды `lib`.

Как только виртуальная среда будет добавлена в проект, она появится в окне **Python Environments** (Среды Python). Вы можете активировать ее, как и любую другую среду, а также управлять ее пакетами. Если щелкнуть окружение правой кнопкой мыши и выбрать **Удалить**, удаляется либо ссылка на окружение, либо окружение и все связанные файлы на диске (но не базовый интерпретатор).

У виртуальных окружений есть недостаток. Они содержат жестко заданные пути к файлам, поэтому предоставить к ним общий доступ или перенести их на другие компьютеры разработки не так просто. К счастью, можно использовать файл `requirements.txt`, как описано в следующем разделе, чтобы получатели данных проекта могли без труда восстановить окружение.

## <a name="managing-required-packages-requirementstxt"></a>Управление необходимыми пакетами (requirements.txt)

Если вы используете проект совместно с другими пользователями с помощью системы сборки или планируете [опубликовать его в Microsoft Azure](python-azure-cloud-service-project-template.md), нужно указать требуемые для проекта внешние пакеты. Рекомендуется использовать файл [requirements.txt](http://pip.readthedocs.org/en/latest/user_guide.html#requirements-files) (readthedocs.org), содержащий список команд для pip, который устанавливает необходимые версии зависимых пакетов.

С технической точки зрения для отслеживания требований можно использовать любой файл (используя `-r <full path to file>` при установке пакета), но Visual Studio имеет встроенную поддержку `requirements.txt`.

- Если вы загрузили проект, содержащий файл `requirements.txt`, и хотите установить все указанные в нем пакеты, разверните узел **Среды Python** в окне **Обозреватель решений**, щелкните правой кнопкой мыши узел среды и выберите **Установить из файла requirements.txt**:

    ![Установка из файла requirements.txt](media/environments-requirements-txt-install.png)

- Если в проекте установлены все необходимые пакеты, можно щелкнуть среду правой кнопкой мыши в обозревателе решений и выбрать **Создать файл requirements.txt**, чтобы создать необходимый файл. Если файл уже существует, отображается запрос с вариантами обновления:

    ![Параметры обновления файла requirements.txt](media/environments-requirements-txt-replace.png)

  - **Replace entire file** (Заменить весь файл) удаляет все существующие элементы, комментарии и параметры.
  - **Обновить существующие записи** определяет требования к пакету и обновляет описатели версии в соответствии с установленной версией.
  - **Update and add entries** (Обновить и добавить записи) обновляет имеющиеся требования и добавляет все другие пакеты в конец файла.

Так как файлы `requirements.txt` предназначены для закрепления требований проекта, все установленные пакеты записываются с точными версиями. Такие версии позволяют легко воспроизвести ваше окружение на другом компьютере. Пакеты включены, даже если они были установлены с диапазоном версий, как зависимость от другого пакета или с установщиком, отличным от pip.

Если файл `requirements.txt` существует, когда вы добавляете новое виртуальное окружение, в диалоговом окне **Добавление виртуального окружения** предлагается параметр для автоматической установки пакетов. Это упрощает восстановление окружения на другом компьютере:

![Создание виртуальной среды при наличии файла requirements.txt](media/environments-requirements-txt.png)

Если pip не удается пакет, указанный в файле `requirements.txt`, установка завершается сбоем. В этом случае нужно вручную исключить этот пакет из файла или использовать [параметры pip](http://pip.readthedocs.org/en/latest/reference/pip_install.html#requirements-file-format) для указания ссылки на устанавливаемую версию пакета. Например, можно использовать [`pip wheel`](http://pip.readthedocs.org/en/latest/reference/pip_wheel.html) для компиляции зависимости и добавления параметра `--find-links <path>` в файл `requirements.txt`.

```output
C:\Project>pip wheel azure
Downloading/unpacking azure
    Running setup.py (path:C:\Project\env\build\azure\setup.py) egg_info for package azure

Building wheels for collected packages: azure
    Running setup.py bdist_wheel for azure
    Destination directory: c:\project\wheelhouse
Successfully built azure
Cleaning up...

C:\Project>type requirements.txt
--find-links wheelhouse
--no-index
azure==0.8.0

C:\Project>pip install -r requirements.txt -v
Downloading/unpacking azure==0.8.0 (from -r requirements.txt (line 3))
    Local files found: C:/Project/wheelhouse/azure-0.8.0-py3-none-any.whl
Installing collected packages: azure
Successfully installed azure
Cleaning up...
    Removing temporary dir C:\Project\env\build...
```

## <a name="search-paths"></a>Пути поиска

При стандартном использовании Python переменная среды `PYTHONPATH` (или `IRONPYTHONPATH` и т. д.) предоставляет путь поиска по умолчанию для файлов модулей. То есть, когда вы используете инструкцию `from <name> import...` или `import <name>`, в Python выполняется поиск совпадающего имени в следующих расположениях в указанном порядке:

1. Встроенные модули Python.
1. Папка с кодом Python, который вы используете.
1. Расположение по пути поиска модуля, определенное в переменной среды. (См. сведения в разделах о [пути поиска модуля](https://docs.python.org/2/tutorial/modules.html#the-module-search-path) и [переменных среды](https://docs.python.org/2/using/cmdline.html#envvar-PYTHONPATH) в основной документации Python.)

Тем не менее Visual Studio игнорирует переменную среды для пути поиска, даже если она задана для всей системы. На самом деле она не учитывается именно *из-за* того, что задана для всей системы, так как в этом случае возникают некоторые вопросы, на которые нельзя ответить автоматически: для какого окружения предназначены указанные модули — для Python 2.7 или Python 3.3, нужно ли переопределять стандартные модули библиотеки и знает ли разработчик о подобном поведении или это попытка атаки.

Таким образом, в Visual Studio можно напрямую указать пути поиска как в окружениях, так и в проектах. Код, который выполняется или отлаживается в Visual Studio, получает пути поиска из переменной `PYTHONPATH` (и других ее аналогов). Если вы добавляете пути поиска, Visual Studio проверяет библиотеки в этих расположениях и создает для них базы данных IntelliSense (это может занять некоторое время в зависимости от числа библиотек).

Чтобы добавить путь поиска, в обозревателе решений щелкните правой кнопкой мыши элемент **Search Paths** (Пути поиска), выберите пункт **Add Folder to Search Path...** (Добавить папку для пути поиска…) и выберите нужную папку. Этот путь используется для любой среды, связанной с проектом. (Если окружение создано на основе Python 3, может произойти ошибка при попытке добавить путь поиска для модулей Python 2.7.)

Файлы с расширением `.zip` или `.egg` также можно добавить в качестве путей поиска. Для этого нужно выбрать **Add Zip Archive to Search Path...** (Добавить ZIP-архив к пути поиска...). Как и при использовании папок, содержимое этих файлов проверяется и предоставляется для IntelliSense.

Если вы регулярно используете одни и те же пути поиска и содержимое изменяется нечасто, может быть более эффективным установить компоненты в папку пакетов сайта. В этом случае путь поиска анализируется и сохраняется в базе данных IntelliSense. Он всегда связан с предполагаемым окружением, и его не нужно добавлять для каждого проекта.
