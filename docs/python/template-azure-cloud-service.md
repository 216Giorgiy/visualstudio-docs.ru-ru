---
title: "Шаблон проекта облачной службы Azure для Python | Документация Майкрософт"
ms.custom: 
ms.date: 7/13/2017
ms.prod: visual-studio-dev15
ms.reviewer: 
ms.suite: 
ms.technology:
- devlang-python
ms.devlang: python
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: a2ce82ee-8c73-419a-bbd2-4c3513fd394d
caps.latest.revision: 11
author: kraigb
ms.author: kraigb
manager: ghogen
ms.translationtype: HT
ms.sourcegitcommit: 6d25db4639f2c8391c1e32542701ea359f560178
ms.openlocfilehash: b90240dbb25e45827cbe8cd728dfcff23b1a8884
ms.contentlocale: ru-ru
ms.lasthandoff: 07/18/2017

---

# <a name="azure-cloud-service-projects-for-python"></a>Проекты облачных служб Azure для Python

Visual Studio предоставляет шаблоны, которые помогут быстро начать разработку облачных служб Azure с использованием Python.

[Облачная служба](http://go.microsoft.com/fwlink/?LinkId=306052) состоит из произвольного числа *рабочих ролей* и *веб-ролей*, каждая из которых выполняет концептуально независимую задачу и может реплицироваться на несколько виртуальных машин для целей масштабирования. Веб-роли служат для размещения интерфейсных веб-приложений. При использовании Python для создания такого приложения можно подходит любая веб-платформа с поддержкой WSGI (любая, поддерживаемая [шаблоном веб-проекта](template-web.md)). Рабочие роли предназначены для длительных рабочих процессов, которые не взаимодействуют с пользователями напрямую. Обычно они используют библиотеки для работы с [данными](http://go.microsoft.com/fwlink/?LinkId=401571) и [службой приложений](http://go.microsoft.com/fwlink/?LinkId=401572), которые можно установить с помощью `pip install`&nbsp;[`azure`](http://pypi.org/project/azure).

Эта статья содержит сведения о шаблоне проекта и других возможностях Visual Studio 2017 (в более ранних версиях эти функции также доступны, но с некоторыми отличиями). Дополнительные сведения о работе с Azure в Python вы найдете в [центре Azure для разработчиков Python](http://go.microsoft.com/fwlink/?linkid=254360).

## <a name="create-a-project"></a>Создание проекта

1. Установите [пакет SDK Azure .NET для Visual Studio](https://www.visualstudio.com/vs/azure-tools/), который потребуется для использования шаблона облачной службы.
1. В Visual Studio выберите **Файл > Новый > Проект...**, выполните поиск по запросу "Python Azure" и выберите из списка результатов **облачную службу Azure**:

    ![Шаблон облачного проекта Azure для Python](media/template-azure-cloud-project.png)

1. Выберите одну или несколько ролей, которые вы хотите включить в проект. Облачные проекты могут объединять роли, написанные на разных языках, поэтому каждую часть приложения вы можете создавать на том языке, который для нее подходит лучше всего. Чтобы добавить в проект новые роли позднее, когда вы уже закроете это диалоговое окно, щелкните правой кнопкой мыши **Роли** в обозревателе решений и выберите один из элементов из раздела **Добавить**.

    ![Добавление ролей в шаблон облачного проекта Azure](media/template-azure-cloud-service-project-wizard.png)

1. При создании отдельных проектов ролей может потребоваться установка дополнительных пакетов Python, например платформы Django, Bottle или Flask, если выбранная роль использует одну из них.

1. После добавление новой роли в проект отображаются инструкции по ее настройке. Обычно изменения конфигурации не требуются, но настройка может пригодиться для персонализации некоторых проектов. Обратите внимание, что при одновременном добавлении нескольких ролей остаются открытыми только инструкции для настройки последней из них. Инструкции и советы по устранению неполадок для других ролей вы можете найти в соответствующих файлах `readme.mht`, которые располагаются в корневом каталоге роли или в папке `bin`.

1. Папка проекта `bin` содержит один или два скрипта PowerShell, которые позволяют настроить удаленную виртуальную машину, например установить на ней Python, изменить файл [requirements.txt](#dependencies) для проекта или настроить службу IIS, если это потребуется. Вы можете изменять эти файлы, насколько потребуется для вашего развертывания. Но учтите, что основные параметры можно изменять другими способами (см. ниже раздел [Настройка развертывания роли](#configuring-role-deployment)). Мы не рекомендуем удалять эти файлы, поскольку при их отсутствии используются прежние версии скриптов настройки.

    ![Файлы поддержки рабочей роли](media/template-azure-cloud-service-worker-role-support-files.png)

    Чтобы добавить скрипты настройки в новый проект, щелкните проект правой кнопкой мыши, выберите **Установка > Новый элемент...** и выберите **Файлы поддержки веб-роли** или **Файлы поддержки рабочей роли**.
   

## <a name="configuring-role-deployment"></a>Настройка развертывания роли

Скрипты PowerShell, размещенные в папке `bin` проекта роли, управляют развертыванием этой роли. Их можно изменять для настройки конфигурации.

- `ConfigureCloudService.ps1` используется для веб-ролей и рабочих ролей, чаще всего для установки и настройки зависимостей и указания версии Python.
- `LaunchWorker.ps1` используется только для рабочих ролей. Этот скрипт позволяет изменить поведение при запуске, добавить аргументы командной строки или добавить переменные среды.

Оба файла содержат инструкции для настройки. Также вы можете установить любую версию Python на ваше усмотрение, добавив другую задачу в основной файл проекта облачной службы `ServiceDefinition.csdef` и указав для переменной `PYTHON` значение пути к файлу `python.exe` (или его аналогу). Если задано значение `PYTHON`, Python не устанавливается из NuGet.

Вот как можно выполнить дополнительные настройки.

1. Установите пакеты с помощью `pip`, обновив файл `requirements.txt` в корневом каталоге проекта. Скрипт `ConfigureCloudService.ps1` устанавливает этот файл при развертывании.
1. Задайте переменные среды, изменив файл `web.config` (для веб-ролей) или раздел `Runtime` файла `ServiceDefinition.csdef` (для рабочих ролей).
1. Укажите скрипт и аргументы для рабочей роли, изменив командную строки в разделе `Runtime/EntryPoint` файла `ServiceDefinitions.csdef`.
1. Укажите основной скрипт обработчика для веб-роли в файле `web.config`.

## <a name="testing-role-deployment"></a>Тестирование развертывания роли

При создании ролей вы можете протестировать облачный проект локально с помощью эмулятора облачной службы. Этот эмулятор включен в средства пакета SDK для Azure и представляет собой ограниченную версию среды, в которой облачная служба публикуется в Azure.

Чтобы запустить эмулятор, следует указать облачный проект в качестве стартового проекта для вашего решения. Для этого щелкните проект правой кнопкой мыши и выберите **Назначить запускаемым проектом**. Затем выберите **Отладка > Начать отладку** (клавиша F5) или **Отладка > Запуск без отладки** (клавиши Ctrl+F5).

Обратите внимание, что ограничения эмулятора не позволяют выполнять отладку кода Python. Поэтому мы рекомендуем для отладки ролей запускать их независимо друг от друга, а эмулятор использовать только для интеграционного тестирования перед публикацией.


## <a name="deploying-a-role"></a>Развертывание роли

Чтобы открыть **Мастер публикации**, выберите проект роли в Обозревателе решений и запустите из главного меню команду **Сборка > Публикация** или щелкните проект правой кнопкой мыши и выберите действие **Публикация**.

Процесс публикации включает два этапа. Сначала Visual Studio создает один пакет, содержащий все роли облачной службы. Именно этот пакет развертывается в Azure, которая инициализирует одну или несколько виртуальных машин для каждой роли и развертывает источник.

При активации каждой виртуальной машины она выполняет скрипт `ConfigureCloudService.ps1` и устанавливает все зависимости. По умолчанию скрипт устанавливает последнюю версию Python из [NuGet](https://www.nuget.org/packages?q=Tags%3A%22python%22+Authors%3A%22Python+Software+Foundation%22) и все пакеты, указанные в файле `requirements.txt`. 

Если это рабочая роль, в конце развертывания она выполняет `LaunchWorker.ps1`, который запускает настроенный скрипт Python. Веб-роль инициализирует службу IIS и начинает обработку веб-запросов.


## <a name="dependencies"></a>Зависимости

В рамках облачной службы скрипт `ConfigureCloudService.ps1` использует `pip` для установки набора зависимостей Python. Их следует указать в файле `requirements.txt` (это имя можно изменить в файле `ConfigureCloudService.ps1`). Этот файл исполняется командой `pip install -r requirements.txt` в процессе инициализации.

Обратите внимание, что экземпляры облачной службы не содержат компилятор C, поэтому все библиотеки с расширениями C должны содержать предварительно скомпилированные двоичные файлы.

PIP и его зависимости, а также указанные в файле `requirements.txt` пакеты скачиваются автоматически и могут создавать оплачиваемый сетевой трафик. В разделе [Управление необходимыми пакетами](python-environments.md#managing-required-packages) подробно описаны правила управления файлами `requirements.txt`.

## <a name="troubleshooting"></a>Устранение неполадок

Если веб-роль или рабочая роль неправильно работают после развертывания, проверьте следующее.

- Проект Python должен содержать папку bin\ со следующими (по меньшей мере) файлами:
    - `ConfigureCloudService.ps1`
    - `LaunchWorker.ps1` (для рабочих ролей)
    - `ps.cmd`

- Проект Python должен содержать файл `requirements.txt` со списком всех зависимостей (или набор файлов колеса).
- Включите удаленный рабочий стол для облачной службы и проверьте файлы журнала.
- Журналы для `ConfigureCloudService.ps1` и `LaunchWorker.ps1` хранятся в папке `C:\Resources\Directory\%RoleId%.DiagnosticStore\LogFiles` на удаленном компьютере.
- Веб-роли могут создавать дополнительные журналы в папке, путь к которой указан в файле `web.config`, а точнее в параметре appSetting `WSGI_LOG`. Также работает обычное ведение журналов IIS или FastCGI.
- В настоящее время выходные данные или сообщения об ошибках, которые выводит рабочая роль Python, можно просмотреть только в файле `LaunchWorker.ps1.log`.
