---
title: "Пошаговое руководство. Обновление диаграммы на листе с помощью переключателей | Microsoft Docs"
ms.custom: ""
ms.date: "02/02/2017"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "office-development"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
helpviewer_keywords: 
  - "элементы управления [разработка решений Office в Visual Studio], обновление листов"
  - "листы, обновление с помощью управляемых элементов управления"
  - "листы, использование переключателей"
ms.assetid: cacc43a3-6d95-4a47-b943-3457d97a16f8
caps.latest.revision: 58
author: "kempb"
ms.author: "kempb"
manager: "ghogen"
caps.handback.revision: 57
---
# Пошаговое руководство. Обновление диаграммы на листе с помощью переключателей
  В этом пошаговом руководстве описываются основные принципы использования переключателей в листе Microsoft Office Excel для предоставления пользователям возможности быстрого переключения параметров.  В этом случае параметры изменяют стиль диаграммы.  
  
 [!INCLUDE[appliesto_xlalldoc](../vsto/includes/appliesto-xlalldoc-md.md)]  
  
 Для просмотра результатов в готовом примере обратитесь к примеру элементов управления Excel в разделе [Образцы и пошаговые руководства разработки Office](../vsto/office-development-samples-and-walkthroughs.md).  
  
 В данном пошаговом руководстве рассмотрены следующие задачи:  
  
-   добавление группы переключателей на лист;  
  
-   изменение стиля диаграммы при выборе определенного параметра.  
  
> [!NOTE]  
>  Отображаемые на компьютере имена или расположения некоторых элементов пользовательского интерфейса Visual Studio могут отличаться от указанных в следующих инструкциях.  Эти элементы определяются используемым выпуском Visual Studio и его параметрами.  Дополнительные сведения см. в разделе [Customizing Development Settings in Visual Studio](http://msdn.microsoft.com/ru-ru/22c4debb-4e31-47a8-8f19-16f328d7dcd3).  
  
## Обязательные компоненты  
 Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.  
  
-   [!INCLUDE[vsto_vsprereq](../vsto/includes/vsto-vsprereq-md.md)]  
  
-   [!INCLUDE[Excel_15_short](../vsto/includes/excel-15-short-md.md)] или [!INCLUDE[Excel_14_short](../vsto/includes/excel-14-short-md.md)].  
  
## Добавление диаграммы на лист  
 Разработчик может создать проект книги Excel, который настраивает существующую рабочую книгу.  В этом пошаговом руководстве в рабочую книгу будет добавлена диаграмма, а рабочая книга будет использована в новом решении Excel.  Источником данных в этом пошаговом руководстве является лист с именем **Данные для диаграммы**.  
  
#### Добавление данных  
  
1.  Откройте Microsoft Excel.  
  
2.  Щелкните правой кнопкой мыши лист **Лист3**, затем в появившемся контекстном меню выберите команду **Переименовать**.  
  
3.  Укажите для листа имя Данные для диаграммы.  
  
4.  Добавьте на лист **Данные для диаграммы** следующие данные. При этом ячейка A4 должна быть левым верхним углом, а ячейка E8 — правым верхним углом.  
  
    ||Q1|Q2|Q3|Q4|  
    |-|--------|--------|--------|--------|  
    |Запад|500|550|550|600|  
    |Восток|600|625|675|700|  
    |Север|450|470|490|510|  
    |Юг|800|750|775|790|  
  
 Затем добавьте на первый лист диаграмму, отображающую эти данные.  
  
#### Добавление диаграммы в Excel  
  
1.  На вкладке **Вставка** в группе **Диаграммы** щелкните элемент **Столбцы**, а затем — **Все типы диаграмм**.  
  
2.  В диалоговом окне **Вставка диаграммы** нажмите кнопку **ОК**.  
  
3.  На вкладке **Конструктор** в группе **Данные** щелкните пункт **Выбор данных**.  
  
4.  В диалоговом окне **Выбор источника данных** в окне **Диаграмма** щелкните пункт **Диапазон данных** и очистите все выборы по умолчанию.  
  
5.  На листе **Данные для диаграммы** выберите блок ячеек, содержащий числа, верхней левой ячейкой которого является A4, а нижней правой — E8.  
  
6.  В диалоговом окне **Выбор источника данных** нажмите кнопку **ОК**.  
  
7.  Переместите диаграмму, чтобы правый верхний угол был выровнен по ячейке **E2**.  
  
8.  Сохраните файл для управления C\# и именование ним **ExcelChart.xlsx**.  
  
9. Закройте приложение Excel.  
  
## Создание нового проекта  
 На этом этапе на основе книги **ExcelChart** будет создан проект рабочей книги Excel.  
  
#### Создание нового проекта  
  
1.  Создайте проект книги Excel с именем **Моя диаграмма Excel**.  Выберите в мастере параметр **Скопировать существующий документ**.  
  
     Дополнительные сведения см. в разделе [Практическое руководство. Создание проектов Office в Visual Studio](../vsto/how-to-create-office-projects-in-visual-studio.md).  
  
2.  Щелкните buttonand **Обзор**  перейти в книгу, созданную ранее в этом пошаговом руководстве.  
  
3.  Нажмите кнопку **ОК**.  
  
     Созданная книга Excel открывается в конструкторе Visual Studio. Проект **Моя диаграмма Excel** добавляется в **Обозреватель решений**.  
  
## Установка значений свойств диаграммы  
 При создании нового проекта рабочей книги Excel, использующего существующую рабочую книгу, элементы управления ведущего приложения автоматически создаются для всех именованных диапазонов, объектов списка и диаграмм в рабочей книге.  Имя элемента управления <xref:Microsoft.Office.Tools.Excel.Chart> можно изменить с помощью окна **Свойства**.  
  
#### Изменение имени элемента управления "Диаграмма"  
  
1.  Выберите элемент управления <xref:Microsoft.Office.Tools.Excel.Chart> в конструкторе и измените следующие свойства в окне **Свойства**:  
  
    |Свойство|Значение|  
    |--------------|--------------|  
    |**Имя**|**dataChart**|  
    |**HasLegend**|**false**|  
  
## Добавление элементов управления  
 В этом листе переключатели используются для предоставления пользователям возможности быстрого изменения стиля диаграммы.  В то же время переключатели должны быть взаимоисключающими — если выбран один переключатель, то другие переключатели в группе выбрать невозможно.  Это поведение не реализуется по умолчанию при добавлении нескольких переключателей на лист.  
  
 Для реализации этого поведения можно сгруппировать переключатели на пользовательском элементе управления, написать для него программный код, а затем добавить элемент на лист.  
  
#### Добавление пользовательского элемента управления  
  
1.  В **обозревателе решений** выберите проект **Моя диаграмма Excel**.  
  
2.  В меню **Проект** выберите команду **Добавить новый элемент**.  
  
3.  В диалоговом окне **Добавить новый элемент** щелкните **Пользовательский элемент управления**, назовите элемент управления **ChartOptions** и нажмите кнопку **Добавить**.  
  
#### Добавление переключателей в пользовательский элемент управления  
  
1.  Если пользовательский элемент управления не видим в конструкторе, дважды щелкните **ChartOptions** в **обозревателе решений**.  
  
2.  Перетащите элемент управления **Переключатель** с вкладки **Стандартные элементы управленияПанели элементов** в пользовательский элемент управления и измените следующие свойства:  
  
    |Свойство|Значение|  
    |--------------|--------------|  
    |**Имя**|**columnChart**|  
    |**Текст.**|Гистограмма|  
  
3.  Добавьте второй переключатель в пользовательский элемент управления и измените следующие свойства:  
  
    |Свойство|Значение|  
    |--------------|--------------|  
    |**Имя**|**barChart**|  
    |**Текст.**|Линейчатая диаграмма|  
  
4.  Добавьте третий переключатель в пользовательский элемент управления и измените следующие свойства:  
  
    |Свойство|Значение|  
    |--------------|--------------|  
    |**Имя**|**lineChart**|  
    |**Текст.**|График|  
  
5.  Добавьте четвертый переключатель в пользовательский элемент управления и измените следующие свойства.  
  
    |Свойство|Значение|  
    |--------------|--------------|  
    |**Имя**|**areaBlockChart**|  
    |**Текст.**|Заполненная диаграмма|  
  
 Затем напишите код, обновляющий диаграмму при нажатии переключателя.  
  
## Изменение стиля диаграммы при выборе определенного переключателя  
 Теперь можно добавить код, который изменяет стиль диаграммы.  Для этого необходимо создать для пользовательского элемента управления открытое событие, добавить свойство для задания типа выбора и создать обработчик событий `CheckedChanged` каждого переключателя.  
  
#### Создание события и свойства пользовательского элемента управления  
  
1.  В **обозревателе решений** щелкните правой кнопкой мыши пользовательский элемент управления и выберите команду **Перейти к коду**.  
  
2.  Добавьте в класс `ChartOptions` код для создания события `SelectionChanged` и свойства `Selection`:  
  
     [!code-csharp[Trin_VstcoreProgrammingControlsExcel#13](../snippets/csharp/VS_Snippets_OfficeSP/Trin_VstcoreProgrammingControlsExcel/CS/ChartOptions.cs#13)]
     [!code-vb[Trin_VstcoreProgrammingControlsExcel#13](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_VstcoreProgrammingControlsExcel/VB/ChartOptions.vb#13)]  
  
#### Обработка события переключателей CheckedChanged  
  
1.  Задайте тип диаграммы в обработчике событий `CheckedChanged` переключателя `areaBlockChart` и вызовите событие:  
  
     [!code-csharp[Trin_VstcoreProgrammingControlsExcel#14](../snippets/csharp/VS_Snippets_OfficeSP/Trin_VstcoreProgrammingControlsExcel/CS/ChartOptions.cs#14)]
     [!code-vb[Trin_VstcoreProgrammingControlsExcel#14](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_VstcoreProgrammingControlsExcel/VB/ChartOptions.vb#14)]  
  
2.  Задайте тип диаграммы в обработчике событий `CheckedChanged` переключателя `barChart`.  
  
     [!code-csharp[Trin_VstcoreProgrammingControlsExcel#15](../snippets/csharp/VS_Snippets_OfficeSP/Trin_VstcoreProgrammingControlsExcel/CS/ChartOptions.cs#15)]
     [!code-vb[Trin_VstcoreProgrammingControlsExcel#15](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_VstcoreProgrammingControlsExcel/VB/ChartOptions.vb#15)]  
  
3.  Задайте тип диаграммы в обработчике событий `CheckedChanged` переключателя `columnChart`:  
  
     [!code-csharp[Trin_VstcoreProgrammingControlsExcel#16](../snippets/csharp/VS_Snippets_OfficeSP/Trin_VstcoreProgrammingControlsExcel/CS/ChartOptions.cs#16)]
     [!code-vb[Trin_VstcoreProgrammingControlsExcel#16](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_VstcoreProgrammingControlsExcel/VB/ChartOptions.vb#16)]  
  
4.  Задайте тип диаграммы в обработчике событий `CheckedChanged` переключателя `lineChart`:  
  
     [!code-csharp[Trin_VstcoreProgrammingControlsExcel#17](../snippets/csharp/VS_Snippets_OfficeSP/Trin_VstcoreProgrammingControlsExcel/CS/ChartOptions.cs#17)]
     [!code-vb[Trin_VstcoreProgrammingControlsExcel#17](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_VstcoreProgrammingControlsExcel/VB/ChartOptions.vb#17)]  
  
5.  В C\# необходимо добавить обработчики событий для переключателей.  Можно добавить код в конструктор `ChartOptions` после вызова `InitializeComponent`.  Дополнительные сведения о создании обработчиков событий см. в разделе [Практическое руководство. Создание обработчиков событий в проектах Office](../vsto/how-to-create-event-handlers-in-office-projects.md).  
  
     [!code-csharp[Trin_VstcoreProgrammingControlsExcel#18](../snippets/csharp/VS_Snippets_OfficeSP/Trin_VstcoreProgrammingControlsExcel/CS/ChartOptions.cs#18)]  
  
## Добавление пользовательского элемента управления на лист  
 При построении решения новый пользовательский элемент управления автоматически добавляется в **Панель элементов**.  После этого можно перетащить элемент управления с **Панели элементов** на лист.  
  
#### Добавление пользовательского элемента управления на лист  
  
1.  В меню **Построение** выберите **Построить решение**.  
  
     Пользовательский элемент управления **ChartOptions** добавляется в **Панель элементов**.  
  
2.  В **обозревателе решений** щелкните правой кнопкой мыши **Sheet1.vb** или **Sheet1.cs** и выберите **Открыть в конструкторе**.  
  
3.  Перетащите элемент управления **ChartOptions** с **Панели элементов** на лист.  
  
     В проект добавится новый элемент управления с именем `my_Excel_Chart_ChartOptions1`.  
  
4.  Измените имя этого элемента управления на ChartOptions1.  
  
## Изменение типа диаграммы  
 Для изменения типа диаграммы создайте обработчик событий, задающий стиль диаграммы в соответствии с параметром, выбранным в пользовательском элементе управления.  
  
#### Изменение типа диаграммы, отображаемой на листе  
  
1.  Добавьте следующий обработчик событий в класс `Sheet1`:  
  
     [!code-csharp[Trin_VstcoreProgrammingControlsExcel#19](../snippets/csharp/VS_Snippets_OfficeSP/Trin_VstcoreProgrammingControlsExcel/CS/Sheet1.cs#19)]
     [!code-vb[Trin_VstcoreProgrammingControlsExcel#19](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_VstcoreProgrammingControlsExcel/VB/Sheet1.vb#19)]  
  
2.  В C\# необходимо добавлять обработчик событий для пользовательского элемента управления в событие <xref:Microsoft.Office.Tools.Excel.Worksheet.Startup>, как показано ниже.  Дополнительные сведения о создании обработчиков событий см. в разделе [Практическое руководство. Создание обработчиков событий в проектах Office](../vsto/how-to-create-event-handlers-in-office-projects.md).  
  
     [!code-csharp[Trin_VstcoreProgrammingControlsExcel#20](../snippets/csharp/VS_Snippets_OfficeSP/Trin_VstcoreProgrammingControlsExcel/CS/Sheet1.cs#20)]  
  
## Тестирование приложения  
 Теперь можно выполнить тестирование рабочей книги, чтобы убедиться в том, что стиль диаграммы обновляется соответствующим образом при выборе переключателя.  
  
#### Проверка рабочей книги  
  
1.  Нажмите клавишу F5 для запуска проекта.  
  
2.  Выберите различные переключатели.  
  
3.  Убедитесь, что стиль диаграммы меняется в соответствии с выбранным параметром.  
  
## Следующие действия  
 В этом пошаговом руководстве были рассмотрены основные принципы использования переключателей и стилей диаграмм на рабочих листах.  Далее будут рассмотрены следующие задачи:  
  
-   Развертывание проекта.  Дополнительные сведения см. в разделе [Развертывание решения Office](../vsto/deploying-an-office-solution.md).  
  
-   Заполнение текстового поля с помощью кнопки.  Дополнительные сведения см. в разделе [Пошаговое руководство. Отображение текста в текстовом поле рабочего листа с помощью кнопки](../vsto/walkthrough-displaying-text-in-a-text-box-in-a-worksheet-using-a-button.md).  
  
-   Изменение форматирования листа с использованием флажков.  Дополнительные сведения см. в разделе [Пошаговое руководство. Изменение форматирования листа с использованием элементов управления CheckBox](../vsto/walkthrough-changing-worksheet-formatting-using-checkbox-controls.md).  
  
## См. также  
 [Пошаговые руководства с использованием Excel](../vsto/walkthroughs-using-excel.md)  
  
  