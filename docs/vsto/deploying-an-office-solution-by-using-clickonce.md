---
title: "Развертывание решения Office с помощью ClickOnce | Документы Microsoft"
ms.custom: 
ms.date: 02/02/2017
ms.reviewer: 
ms.suite: 
ms.technology: office-development
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- Office development in Visual Studio, deploying solutions
- ClickOnce deployment [Office development in Visual Studio], deploying solutions
ms.assetid: feb516b3-5e4d-449a-9fd2-347d08d90252
caps.latest.revision: "59"
author: gewarren
ms.author: gewarren
manager: ghogen
ms.openlocfilehash: 5ae3fceb52e0a99ee87a12a650333b3bc8cf1420
ms.sourcegitcommit: f40311056ea0b4677efcca74a285dbb0ce0e7974
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2017
---
# <a name="deploying-an-office-solution-by-using-clickonce"></a>Развертывание решения Office с помощью ClickOnce
  Решение Office можно развернуть быстрее, если использовать ClickOnce. При публикации обновлений решение автоматически обнаруживает и устанавливает их. Однако для использования ClickOnce необходимо устанавливать решение отдельно для каждого пользователя компьютера. Поэтому следует рассмотреть возможность использования установщика Windows (MSI), если несколько пользователей будут запускать решение на одном и том же компьютере.  
  
## <a name="in-this-topic"></a>Содержание раздела  
  
-   [Публикация решения](#Publish)  
  
-   [Выбрать способ предоставления доверия решению](#Trust)  
  
-   [Помощь пользователям при установке решения](#Helping)  
  
-   [Размещение документа решения на компьютере конечного пользователя (только для настроек уровня документа)](#Put)  
  
-   [Размещение документа решения на сервере, на котором выполняется SharePoint (только для настроек уровня документа)](#SharePoint)  
  
-   [Создание пользовательского установщика](#Custom)  
  
-   [Публикация обновления](#Update)  
  
-   [Изменение расположения установки решения](#Location)  
  
-   [Откат решения к более ранней версии](#Roll)  
  
 Дополнительные сведения о развертывании решения Office путем создания файла установщика Windows см. в разделе [развертывание решения Office с помощью установщика Windows](../vsto/deploying-an-office-solution-by-using-windows-installer.md).  
  
##  <a name="Publish"></a>Публикация решения  
 Решение можно опубликовать с помощью **мастер публикации** или **конструктора проектов**. В этой процедуре будет использоваться **конструктора проектов** , так как он содержит полный набор параметров публикации. В разделе [публикации мастер &#40; разработка решений Office в Visual Studio &#41;](../vsto/publish-wizard-office-development-in-visual-studio.md).  
  
#### <a name="to-publish-the-solution"></a>Публикация решения  
  
1.  В **обозревателе решений**, выберите узел, который совпадает с именем проекта.  
  
2.  В строке меню выберите **проекта**, *ProjectName* **свойства**.  
  
3.  В **конструктора проектов**, выберите **публикации** вкладка, на следующем рисунке.  
  
     ![Вкладка публикации в конструкторе проектов](../vsto/media/vsto-publishtab.png "вкладка публикации в конструкторе проектов")  
  
4.  В **расположением папки публикации (FTP-сервер или путь к файлу)** введите путь к папке, где требуется **конструктора проектов** скопирует файлы решения.  
  
     Можно ввести путь любого из следующих типов.  
  
    -   Локальный путь (например, *C:\FolderName\FolderName*).  
  
    -   Соглашения об универсальных именах (UNC) путь к папке в сети (например,  *\\\ServerName\FolderName*).  
  
    -   Относительный путь (например, *PublishFolder\\*, — это папка, в которую происходит публикация проекта по умолчанию).  
  
5.  В **URL-адрес папки установки** введите полный путь расположения, где конечные пользователи смогут найти решение.  
  
     Если вы не знаете, расположение, ничего не вводите в это поле. По умолчанию ClickOnce ищет обновления в папке, из которой пользователи устанавливают решение.  
  
6.  Нажмите кнопку **Необходимые компоненты** .  
  
7.  В **необходимые компоненты** диалогового окна убедитесь, что **создать программу установки для необходимых компонентов** установлен флажок.  
  
8.  В **выберите устанавливаемые необходимые компоненты** выберите флажки для **установщик Windows версии 4.5** и соответствующий пакет .NET Framework.  
  
     Например если решение предназначено [!INCLUDE[net_v45](../vsto/includes/net-v45-md.md)], установите флажки для **установщик Windows версии 4.5** и **Microsoft .NET Framework 4.5 Full**.  
  
9. Если решение предназначено для .NET Framework 4.5, также выберите **Visual Studio 2010 Tools для Office Runtime** флажок.  
  
    > [!NOTE]  
    >  По умолчанию этот флажок не отображается. Чтобы отобразить этот флажок, необходимо создать пакет начального загрузчика. В разделе [создания пакета загрузчика для Office 2013 VSTO надстройки с помощью Visual Studio 2012](http://blogs.msdn.com/b/vsto/archive/2012/12/21/creating-a-bootstrapper-package-for-an-office-2013-vsto-add-in-with-visual-studio-2012.aspx).  
  
10. В разделе **укажите место установки для необходимых компонентов**, выберите один из параметров, которые отображаются, а затем выберите **ОК** кнопки.  
  
     В таблице ниже представлено описание каждого из этих параметров.  
  
    |Параметр|Описание|  
    |------------|-----------------|  
    |**Скачать необходимые компоненты с веб-сайта поставщика компонентов**|Пользователю будет предложено загрузить и установить эти необходимые компоненты у поставщика.|  
    |**Скачать необходимые компоненты с местоположения моего приложения**|Необходимое программное обеспечение устанавливается вместе с решением. Если выбран этот параметр, Visual Studio копирует все пакеты необходимых компонентов в расположение публикации автоматически. Чтобы этот параметр действовал, пакеты необходимых компонентов должны находиться на компьютере разработки.|  
    |**Скачать необходимые компоненты из следующего места**|Visual Studio скопирует все пакеты необходимых компонентов в указанное расположение и установит их вместе с решением.|  
  
     В разделе [диалоговое окно «необходимые условия»](/visualstudio/ide/reference/prerequisites-dialog-box).  
  
11. Выберите **обновления** кнопку, укажите частоту каждого конечного пользователя надстройку VSTO или настройкой для проверки наличия обновлений, а затем выберите **ОК** кнопки.  
  
    > [!NOTE]  
    >  При развертывании с помощью компакт-ДИСК или съемный накопитель, выберите **никогда не проверять наличие обновлений** переключатель.  
  
     Сведения о том, как публикация обновления см. в разделе [Публикация обновления](#Update).  
  
12. Выберите **параметры** кнопку, проверьте параметры в **параметры** диалогового окна, а затем нажмите **ОК** кнопки.  
  
13. Выберите **Опубликовать сейчас** кнопки.  
  
     Visual Studio добавить следующие папки и файлы в папку публикации, указанную ранее в этой процедуре.  
  
    -   **Файлы приложения** папки.  
  
    -   Программа установки.  
  
    -   Манифест развертывания, указывающий на манифест развертывания для последней версии.  
  
     **Файлы приложения** папка содержит вложенные папки для каждой публикуемой версии. Каждая вложенная папка для конкретной версии содержит следующие файлы.  
  
    -   Манифест приложения.  
  
    -   Манифест развертывания.  
  
    -   Сборки настройки.  
  
     На следующем рисунке показана структура папки публикации для надстройки VSTO Outlook.  
  
     ![Структура папки публикации](../vsto/media/publishfolderstructure.png "структура папки публикации")  
  
    > [!NOTE]  
    >  ClickOnce добавляет сборкам расширение .deploy, чтобы защищенная установка служб Internet Information Services (IIS) не блокировала файлы из-за небезопасного расширения. Когда пользователь установит решение, ClickOnce удалит расширение .deploy.  
  
14. Скопируйте файлы решения в папку установки, указанную ранее в этой процедуре.  
  
##  <a name="Trust"></a>Выбрать способ предоставления доверия решению  
 Прежде чем решение можно будет запускать на компьютерах пользователей, необходимо предоставить доверие. В противном случае пользователи должны будут ответить на запрос о доверии при установке решения. Чтобы предоставить доверие решению, подпишите манифест с помощью сертификата, который определяет известного и надежного издателя. В разделе [предоставление доверия решению с помощью подписи приложения и развертывания манифесты](../vsto/granting-trust-to-office-solutions.md#Signing).  
  
 При развертывании настройки уровня документа и размещении документа в папку на компьютере пользователя или предоставлении доступа к документу на сайте SharePoint, убедитесь, что Office доверяет расположению документа. В разделе [Присвоение уровня доверия документам](../vsto/granting-trust-to-documents.md).  
  
##  <a name="Helping"></a>Помощь пользователям при установке решения  
 Чтобы установить решение, пользователи могут запустить программу установки, открыть манифест развертывания или, в случае настройки уровня документа, открыть документ напрямую. Рекомендуемым способом является установка решения пользователями с помощью программы установки. Другие два способа не гарантируют, что необходимое программное обеспечение. Если пользователям необходимо открывать документ из расположения установки, они должны добавить это расположение в список надежных расположений в центре управления безопасностью приложения Office.  
  
### <a name="opening-the-document-of-a-document-level-customization"></a>Открытие документа настройки уровня документа  
 Пользователи могут открывать документы настройки уровня документа непосредственно из папки установки или путем копирования документа на локальный компьютер и открытия этой копии.  
  
 Рекомендуется открывать копии документов на компьютерах пользователей, чтобы несколько пользователей не пытались открывать один и тот же экземпляр документа одновременно. Чтобы обеспечить выполнение этого правила, можно настроить программу установки таким образом, чтобы она копировала документ на компьютеры пользователей. В разделе [размещение документа решения на компьютере конечного пользователя (только для настроек уровня документа)](#Put).  
  
### <a name="installing-the-solution-by-opening-the-deployment-manifest-from-an-iis-website"></a>Установка решения путем открытия манифеста развертывания с веб-сайта IIS  
 Пользователи могут установить решение Office путем открытия манифеста развертывания из Интернета. Однако защищенная установка IIS будет блокировать файлы с расширением .vsto. Тип MIME должен быть определен в IIS перед развертыванием решения Office с использованием IIS.  
  
##### <a name="to-add-the-vsto-mime-type-to-iis-60"></a>Добавление типа MIME .vsto в IIS 6.0  
  
1.  На сервере, на котором работает IIS 6.0, выберите **запустить**, **все программы**, **Администрирование**, **Диспетчер Internet Information Services (IIS)**.  
  
2.  Выберите имя компьютера, **веб-сайтов** папки или веб-сайт, который вы настраиваете.  
  
3.  В строке меню выберите **действия**, **свойства**.  
  
4.  На **заголовки HTTP** выберите **типы MIME** кнопки.  
  
5.  В **типы MIME** окно, выберите **New** кнопки.  
  
6.  В **тип MIME** окно, введите **.vsto** в качестве расширения и введите **приложения/x-ms-vsto** как MIME введите, а затем применить новые параметры.  
  
    > [!NOTE]  
    >  Чтобы изменения вступили в силу, необходимо перезапустить службу веб-публикаций или подождать, пока рабочий процесс будет перезапущен. После этого нужно очистить кэш диска браузера и снова попытаться открыть файл .vsto.  
  
##### <a name="to-add-the-vsto-mime-type-to-iis-70"></a>Добавление типа MIME .vsto в IIS 7,0  
  
1.  На сервере, на котором работает IIS 7.0, выберите **запустить**, **все программы**, **стандартные**.  
  
2.  Откройте контекстное меню для **командной строки**, а затем выберите **Запуск от имени администратора.**  
  
3.  В **откройте** введите следующий путь и нажмите кнопку **ОК** кнопки.  
  
    ```  
    %windir%\system32\inetsrv   
    ```  
  
4.  Введите следующую команду, а затем примените новые параметры.  
  
    ```  
    set config /section:staticContent /+[fileExtension='.vsto',mimeType='application/x-ms-vsto']  
    ```  
  
    > [!NOTE]  
    >  Чтобы изменения вступили в силу, необходимо перезапустить службу веб-публикаций или подождать, пока рабочий процесс будет перезапущен. После этого нужно очистить кэш диска браузера и снова попытаться открыть файл .vsto.  
  
##  <a name="Put"></a>Размещение документа решения на компьютере конечного пользователя (только для настроек уровня документа)  
 Можно скопировать документ решения на компьютере конечного пользователя для их путем создания действия после развертывания. Таким образом, у пользователя нет вручную копировать документ из расположения установки на свой компьютер после установки решения. Необходимо создать класс, который определяет действие, выполняемое после развертывания, сборки и опубликовать решение, изменить манифест приложения и повторно подпишите манифест приложения и развертывания.  
  
 В следующих процедурах предполагается, что имя проекта является **ExcelWorkbook** и опубликовать решение, чтобы **C:\publish** на локальном компьютере.  
  
### <a name="create-a-class-that-defines-the-post-deployment-action"></a>Создание класса, определяющего действие, выполняемое после развертывания  
  
1.  В строке меню выберите **Файл**, **Добавить**, **Новый проект**.  
  
2.  В **Добавление нового проекта** диалогового **установленные шаблоны** области, выберите **Windows** папки.  
  
3.  В **шаблоны** области, выберите **библиотеки классов** шаблона.  
  
4.  В **имя** введите **FileCopyPDA**, а затем выберите **ОК** кнопки.  
  
5.  В **обозревателе решений**, выберите **FileCopyPDA** проекта.  
  
6.  В строке меню выберите **Проект**, **Добавить ссылку**.  
  
7.  На **.NET** добавьте ссылки на Microsoft.VisualStudio.Tools.Applications.Runtime и Microsoft.VisualStudio.Tools.Applications.ServerDocument.  
  
8.  Переименуйте класс в `FileCopyPDA`, а затем замените содержимое файла следующим кодом. Этот код выполняет следующие задачи:  
  
    -   Копирует документ на рабочий стол пользователя.  
  
    -   Изменяет свойства _AssemblyLocation с относительным на полный путь к манифесту развертывания.  
  
    -   Удаляет файл, когда пользователь удаляет решение.  
  
     [!code-vb[Trin_ExcelWorkbookPDA#7](../vsto/codesnippet/VisualBasic/trin_excelworkbookpda/filecopypda/class1.vb#7)]
     [!code-csharp[Trin_ExcelWorkbookPDA#7](../vsto/codesnippet/CSharp/trin_excelworkbookpda/filecopypda/class1.cs#7)]  
  
### <a name="build-and-publish-the-solution"></a>Сборка и публикация решения  
  
1.  В **обозревателе решений**, откройте контекстное меню для **FileCopyPDA** проекта, а затем выберите **сборки**.  
  
2.  Откройте контекстное меню для **ExcelWorkbook** проекта, а затем выберите **сборки**.  
  
3.  Откройте контекстное меню для **ExcelWorkbook** проекта, а затем выберите **добавить ссылку**.  
  
4.  В **добавить ссылку** диалогового окна выберите **проекты** выберите **FileCopyPDA**и нажмите кнопку **ОК** кнопки.  
  
5.  В **обозревателе решений**, выберите **ExcelWorkbook** проекта.  
  
6.  В строке меню выберите **проекта**, **новую папку**.  
  
7.  Ввод **данные**, а затем нажмите клавишу ВВОД.  
  
8.  В **обозревателе решений**, выберите **данные** папки.  
  
9. В строке меню выберите **проекта**, **Добавление существующего элемента**.  
  
10. В **Добавление существующего элемента** диалоговое окно, перейдите в каталог вывода для **ExcelWorkbook** проекта, выбор **ExcelWorkbook.xlsx** файла, а затем выберите  **Добавить** кнопки.  
  
11. В **обозревателе решений** выберите **ExcelWorkbook.xlsx** файла.  
  
12. В **свойства** измените **действие при построении** свойства **содержимого** и **Копировать в выходной каталог** свойства  **Копировать, если новее**.  
  
     После завершения этих шагов проект будет похоже на следующем рисунке.  
  
     ![Структура в действии после развертывания проекта. ] (../vsto/media/vsto-postdeployment.png "Структура в действии после развертывания проекта.")  
  
13. Публикация **ExcelWorkbook** проекта.  
  
### <a name="modify-the-application-manifest"></a>Изменение манифеста приложения  
  
1.  Откройте **c:\publish** каталога с помощью **проводнике**.  
  
2.  Откройте **файлы приложения** , а затем откройте папку, соответствующую последней опубликованной версии решения.  
  
3.  Откройте **ExcelWorkbook.dll.manifest** файл в текстовом редакторе, таком как Блокнот.  
  
4.  После элемента `</vstav3:update>` добавьте следующий код. Для атрибута класса `<vstav3:entryPoint>` элемент, используйте следующий синтаксис: *ИмяПространстваИмен.ИмяКласса*. В следующем примере имя класса совпадает с именем пространства имен, поэтому имя точки входа будет иметь вид `FileCopyPDA.FileCopyPDA`.  
  
    ```  
    <vstav3:postActions>  
      <vstav3:postAction>  
        <vstav3:entryPoint  
          class="FileCopyPDA.FileCopyPDA">  
          <assemblyIdentity  
            name="FileCopyPDA"  
            version="1.0.0.0"  
            language="neutral"  
            processorArchitecture="msil" />  
        </vstav3:entryPoint>  
        <vstav3:postActionData>  
        </vstav3:postActionData>  
      </vstav3:postAction>  
    </vstav3:postActions>  
    ```  
  
### <a name="re-sign-the-application-and-deployment-manifests"></a>Повторное подписывание манифестов приложения и развертывания  
  
1.  В **%USERPROFILE%\Documents\Visual Studio 2013\Projects\ExcelWorkbook\ExcelWorkbook** папку, скопируйте **ExcelWorkbook_TemporaryKey.pfx** файл сертификата, а затем вставьте его в  *PublishFolder* **\Application Files\ExcelWorkbook**\__MostRecentPublishedVersion_ папки.
  
2.  Откройте командную строку Visual Studio, а затем перейдите к **c:\publish\Application Files\ExcelWorkbook**\__MostRecentPublishedVersion_ папку (например, **c:\publish\Application Files\ExcelWorkbook_1_0_0_4**).  
  
3.  Подпишите обновленный манифест приложения с помощью следующей команды:  
  
    ```  
    mage -sign ExcelWorkbook.dll.manifest -certfile ExcelWorkbook_TemporaryKey.pfx  
    ```  
  
     Появится сообщение "ExcelWorkbook.dll.manifest успешно подписан".  
  
4.  Измените **c:\publish** папки и затем обновления и выполните развертывание манифеста, выполнив следующую команду:  
  
    ```  
    mage -update ExcelWorkbook.vsto -appmanifest "Application Files\Ex  
    celWorkbookMostRecentVersionNumber>\ExcelWorkbook.dll.manifest" -certfile "Application Files\ExcelWorkbookMostRecentVersionNumber>\ExcelWorkbook_TemporaryKey.pfx"  
    ```  
  
    > [!NOTE]  
    >  В предыдущем примере замените MostRecentVersionNumber номер версии последней опубликованной версии решения (например, **1_0_0_4**).  
  
     Появится сообщение "ExcelWorkbook.vsto успешно подписан".  
  
5.  Скопируйте файл ExcelWorkbook.vsto **c:\publish\Application Files\ExcelWorkbook**\__MostRecentVersionNumber_ каталога.  
  
##  <a name="SharePoint"></a>Размещение документа решения на сервере, на котором выполняется SharePoint (только для настроек уровня документа)  
 Настройки уровня документа можно публиковать для пользователей с помощью SharePoint. Когда пользователь открывает документ с сайта SharePoint, среда выполнения автоматически устанавливает решение на локальном компьютере пользователя из общей сетевой папки. После локальной установки решения настройка продолжит работать, даже если документ будет скопирован в другое место, например на рабочий стол.  
  
#### <a name="to-put-the-document-on-a-server-thats-running-sharepoint"></a>Размещение документа на сервере с SharePoint  
  
1.  Добавьте документ решения в библиотеку документов на сайте SharePoint.  
  
2.  Воспользуйтесь одним из следующих подходов, выполнив соответствующие инструкции.  
  
    -   С помощью средства настройки Office добавьте сервер с SharePoint в центр управления безопасностью в Word или Excel на всех компьютерах пользователей.  
  
         В разделе [политик безопасности и параметров в Office 2010](http://go.microsoft.com/fwlink/?LinkId=99227).  
  
    -   Убедитесь, что каждый пользователь выполнил следующие действия.  
  
        1.  На локальном компьютере откройте Word или Excel, выберите **файл** , а затем выберите **параметры** кнопки.  
  
        2.  В **Центр управления безопасностью** диалогового окна выберите **надежные расположения** кнопки.  
  
        3.  Выберите **Разрешить надежные расположения в моей сети (не рекомендуется)** флажок и нажмите кнопку **добавить новое расположение** кнопки.  
  
        4.  В **путь** введите URL-адрес библиотеки документов SharePoint, которая содержит загруженный документ (например, *http://SharePointServerName/TeamName/ProjectName/DocumentLibraryName*).  
  
             Не следует добавлять имя веб-страницы по умолчанию, например default.aspx или AllItems.aspx.  
  
        5.  Выберите **вложенные папки, также являются доверенными** флажок и нажмите кнопку **ОК** кнопки.  
  
             Когда пользователь откроет документ с сайта SharePoint, будут установлены настройки. Пользователь может скопировать документ себе на рабочий стол. Настройка все равно будет работать, поскольку свойства в документе указывают на сетевое расположение документа.  
  
##  <a name="Custom"></a>Создание пользовательского установщика  
 Можно создать пользовательский установщик для решения Office, а не с помощью программы установки, который создается автоматически при публикации решения. Например, можно запустить установку с помощью скрипта входа или устанавливать решение с помощью пакетного файла без взаимодействия с пользователем. Эти сценарии оптимальны, если все необходимые компоненты уже установлены на компьютерах пользователей.  
  
 В рамках пользовательского процесса установки вызовите средство установки решений Office (VSTOInstaller.exe), которое по умолчанию установлено в следующем расположении:  
  
 %commonprogramfiles%\microsoft shared\VSTO\10.0\VSTOInstaller.exe  
  
 Если это средство находится в другой папке, воспользуйтесь разделом реестра HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VSTO Runtime Setup\v4\InstallerPath или HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\VSTO Runtime Setup\v4\InstallerPath, чтобы найти путь к нему.  
  
 При запуске VSTOinstaller.exe можно использовать следующие параметры.  
  
|Параметр|Определение|  
|---------------|----------------|  
|/Install или /I|Установка решения. За данным параметром должен следовать путь к манифесту развертывания. Можно указать путь на локальном компьютере, в общей папке с именем по универсальным правилам именования (UNC). Можно указать локальный путь (*C:\FolderName\PublishFolder*), относительным (*публикации\\*), или полным (*\\\ServerName\ Имя папки* или http://*ServerName/FolderName*).|  
|/Uninstall или /U|Удаление решения. За данным параметром должен следовать путь к манифесту развертывания. Можно указать путь на локальном компьютере к общей папке UNC. Можно указать локальный путь (*c:\FolderName\PublishFolder*), относительным (*публикации\\*), или полным (*\\\ServerName\ Имя папки* или http://*ServerName/FolderName*).|  
|/Silent или /S|Установка или удаление без запроса ввода данных пользователем и без отображения сообщений. Если требуется запрос о доверии, настройки не установлены или обновлены.|  
|/Help или /?|Отображение справочных сведений.|  
  
 При запуске VSTOinstaller.exe могут появляться следующие коды ошибок.  
  
|Код ошибки|Определение|  
|----------------|----------------|  
|0|Решение было успешно установлено или удалено, или появилась справка VSTOInstaller.|  
|-100|Один или несколько параметров командной строки недопустимы или заданы более одного раза. Дополнительные сведения, введите «vstoinstaller /?» или в разделе [создания пользовательского установщика для решения Office ClickOnce](http://msdn.microsoft.com/en-us/3e5887ed-155f-485d-b8f6-3c02c074085e).|  
|-101|Один или несколько параметров командной строки недопустимы. Для получения дополнительных сведений введите команду "vstoinstaller /?".|  
|-200|Недопустимый URI-адрес манифеста развертывания. Для получения дополнительных сведений введите команду "vstoinstaller /?".|  
|-201|Не удалось установить решение, так как манифест развертывания недействителен. В разделе [манифесты развертывания для решений Office](../vsto/deployment-manifests-for-office-solutions.md).|  
|-202|Не удалось установить решение, поскольку Visual Studio Tools для Office раздел манифеста приложения является недопустимым. В разделе [манифесты приложений для решений Office](../vsto/application-manifests-for-office-solutions.md).|  
|-203|Не удалось установить решение из-за ошибки загрузки. Проверьте URI-адрес манифеста развертывания или расположение файла в сети и повторите попытку.|  
|-300|Не удалось установить решение, так как произошло исключение безопасности. В разделе [обеспечение безопасности решений Office](../vsto/securing-office-solutions.md).|  
|-400|Не удалось установить решение.|  
|-401|Не удалось удалить решение.|  
|-500|Операция была отменена, поскольку решение не может быть установлено или удалено или не удалось загрузить манифест развертывания.|  
  
##  <a name="Update"></a>Публикация обновления  
 Чтобы обновить решение, опубликуйте его раз с помощью **конструктора проектов** или **мастер публикации**, а затем скопируйте обновленное решение в папку установки. При копировании файлов в папку установки убедитесь, что предыдущие файлы перезаписываются.  
  
 При очередном решение будет выполнять проверку обновлений, он будет поиск и загрузка новой версии автоматически.  
  
##  <a name="Location"></a>Изменение расположения установки решения  
 Путь установки можно добавлять и изменять после публикации решения. При необходимости можно изменить путь установки по одной из следующих причин:  
  
-   путь установки неизвестен на момент компиляции программы установки;  
  
-   файлы решения копируются в другое расположение;  
  
-   изменились имя или адрес сервера, на котором размещены файлы установки.  
  
 Чтобы изменить путь установки решения, необходимо обновить программу установки, после чего пользователи должны запустить ее. Для настроек уровня документа пользователи должны также обновить свойство в своем документе, чтобы оно указывало на новое расположение.  
  
> [!NOTE]  
>  Если вы не хотите просить пользователей обновлять свойства в своих документах, можно предложить им получить обновленный документ из расположения установки.  
  
#### <a name="to-change-the-installation-path-in-the-setup-program"></a>Изменение пути установки в программе установки  
  
1.  Откройте **командной строки** окон, а затем перейдите в папку установки.  
  
2.  Запустите программу установки с параметром `/url`, который принимает новый путь установки в строковом формате.  
  
     В следующем примере показано, как изменить путь к папке установки на расположение на веб-сайте компании Fabrikam, но вместо URL-адреса можно подставить любой путь:  
  
    ```  
    setup.exe /url="http://www.fabrikam.com/newlocation"  
    ```  
  
    > [!NOTE]  
    >  Если появляется сообщение о том, что подпись исполняемого файла станет недействительной, это означает, что сертификат, с помощью которого было подписано решение, стал недействительным, а издатель неизвестен. В результате пользователям необходимо будет подтвердить, что они доверяют источнику решения, прежде чем они смогут установить его.  
  
    > [!NOTE]  
    >  Чтобы просмотреть текущее значение URL-адреса, выполните команду `setup.exe /url`.  
  
 Для настроек на уровне документа пользователям необходимо открыть документ и обновите его свойства _AssemblyLocation. Ниже описано, как пользователи могут выполнить эту задачу.  
  
#### <a name="to-update-the-assemblylocation-property-in-a-document"></a>Обновление свойства _AssemblyLocation в документе  
  
1.  На **файл** выберите **сведения**, который на следующем рисунке показан.  
  
     ![Вкладка «сведения» в Excel](../vsto/media/vsto-infotab.png "вкладка «сведения» в Excel")  
  
2.  В **свойства** выберите **дополнительные свойства**, как показано ниже.  
  
     ![Дополнительные свойства в Excel. ] (../vsto/media/vsto-advanceddocumentproperties.png "Дополнительных свойств в Excel.")  
  
3.  На **настраиваемый** вкладке **свойства** выберите _AssemblyLocation, как показано на следующем рисунке.  
  
     ![Свойство AssemblyLocation. ] (../vsto/media/vsto-assemblylocationproperty.png "Свойство AssemblyLocation.")  
  
     **Значение** поле содержит идентификатор манифеста развертывания.  
  
4.  Перед идентификатором введите полный путь к документу и вертикальную черту в формате *путь*|*идентификатор* (например, *File://ServerName/ Имя папки и имя файла | 74744e4b-e4d6-41eb-84f7-ad20346fe2d9*.  
  
     Дополнительные сведения о формате идентификатора см. в разделе [Общие сведения о свойствах пользовательского документа](../vsto/custom-document-properties-overview.md).  
  
5.  Выберите **ОК** кнопки, а затем сохраните и закройте документ.  
  
6.  Чтобы установить решение в указанном расположении, запустите программу установки без параметра "/url".  
  
##  <a name="Roll"></a>Откат решения к более ранней версии  
 При откате решения пользователи возвращаются к более ранней версии этого решения.  
  
#### <a name="to-roll-back-a-solution"></a>Откат решения  
  
1.  Откройте расположение установки решения.  
  
2.  В папке публикации верхнего уровня удалите манифест развертывания (VSTO-файл).  
  
3.  Найдите вложенную папку версии, к которой требуется вернуться.  
  
4.  Скопируйте манифест развертывания из этой папки в папку публикации верхнего уровня.  
  
     Например, чтобы откатить решение, которое называется **OutlookAddIn1** от версии 1.0.0.1 к версии 1.0.0.0, скопируйте файл **OutlookAddIn1.vsto** из **OutlookAddIn1_1_0_0_0** папки. Вставьте файл верхнего уровня в папку публикации, перезаписав манифест развертывания для **OutlookAddIn1_1_0_0_1** , уже существует.  
  
     На следующем рисунке показана структура папок публикации для данного примера.  
  
     ![Структура папки публикации](../vsto/media/publishfolderstructure.png "структура папки публикации")  
  
     Когда пользователь в следующий раз откроет приложение или настроенный документ, будет обнаружено изменение манифеста развертывания. Предыдущая версия решения Office будет запущена из кэша ClickOnce.  
  
> [!NOTE]  
>  Локальные данные сохраняются только для одной предыдущей версии решения. При откате двух версий локальные данные не сохраняются. Дополнительные сведения о локальных данных см. в разделе [доступ к локальным и удаленным данным в приложениях ClickOnce](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).  
  
## <a name="see-also"></a>См. также  
 [Развертывание решения Office](../vsto/deploying-an-office-solution.md)   
 [Публикация решений Office](../vsto/deploying-an-office-solution-by-using-clickonce.md)   
 [Как: публикация решения Office с помощью ClickOnce](http://msdn.microsoft.com/en-us/2b6c247e-bc04-4ce4-bb64-c4e79bb3d5b8)   
 [Как: установка решения ClickOnce Office](http://msdn.microsoft.com/en-us/14702f48-9161-4190-994c-78211fe18065)   
 [Как: публикация решения Office уровня документа на сервере SharePoint с помощью ClickOnce](http://msdn.microsoft.com/en-us/2408e809-fb78-42a1-9152-00afa1522e58)   
 [Создание пользовательского установщика для решения ClickOnce Office](http://msdn.microsoft.com/en-us/3e5887ed-155f-485d-b8f6-3c02c074085e)  
  
  
