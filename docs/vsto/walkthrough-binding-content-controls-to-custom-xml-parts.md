---
title: "Пошаговое руководство. Привязка элементов управления содержимым к пользовательским XML-частям"
ms.custom: ""
ms.date: "02/02/2017"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "office-development"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
helpviewer_keywords: 
  - "элементы управления содержимым [разработка решений Office в Visual Studio], привязка данных"
  - "настраиваемые XML-части, привязка к элементам управления содержимым"
  - "привязка данных [разработка решений Office в Visual Studio], элементы управления содержимым"
  - "DatePickerContentControl, привязка к пользовательской XML-части"
  - "DropDownListContentControl, привязка элементов к пользовательской XML-части"
  - "PlainTextContentControl, привязка к пользовательской XML-части"
ms.assetid: 10d67769-6157-4703-a10c-d33e988f9095
caps.latest.revision: 51
author: "kempb"
ms.author: "kempb"
manager: "ghogen"
caps.handback.revision: 50
---
# Пошаговое руководство. Привязка элементов управления содержимым к пользовательским XML-частям
  В этом пошаговом руководстве показано, как привязать элементы управления содержимым в настройке на уровне документа для Word к XML\-данным, хранящимся в документе.  
  
 [!INCLUDE[appliesto_wdalldoc](../vsto/includes/appliesto-wdalldoc-md.md)]  
  
 Word позволяет хранить данные XML, которые называют *пользовательскими XML\-частями*, в документе.  Вы можете управлять отображением этих данных, привязывая элементы управления содержимым к элементам в пользовательской XML\-части.  Пример документа в этом пошаговом руководстве отображает данные о сотрудниках, которые хранятся в пользовательской XML\-части.  При открытии документа элементы управления содержимым показывают значения XML\-элементов.  Любые изменения, внесенные в текст в элементах управления содержимым, сохраняются в пользовательской XML\-части.  
  
 В данном пошаговом руководстве рассмотрены следующие задачи:  
  
-   добавление элементов управления содержимым в документ Word в проекте на уровне документа во время разработки;  
  
-   создание файла XML\-данных и XML\-схемы, которая определяет элементы для привязки к элементам управления содержимым;  
  
-   добавление схемы XML к документу во время разработки;  
  
-   добавление содержимого XML\-файла к пользовательской XML\-части в документе во время выполнения;  
  
-   привязка элементов управления содержимым к элементам в пользовательской XML\-части;  
  
-   привязка <xref:Microsoft.Office.Tools.Word.DropDownListContentControl> к набору значений, определенных в схеме XML.  
  
 [!INCLUDE[note_settings_general](../sharepoint/includes/note-settings-general-md.md)]  
  
## Обязательные компоненты  
 Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.  
  
-   [!INCLUDE[vsto_vsprereq](../vsto/includes/vsto-vsprereq-md.md)]  
  
-   Microsoft Word.  
  
## Создание проекта документа Word  
 Создайте документ Word, который будет использоваться в этом руководстве.  
  
#### Создание проекта документа Word  
  
1.  Создайте документ Word с именем EmployeeControls.  Создайте документ для решения.  Дополнительные сведения см. в статье [Практическое руководство. Создание проектов Office в Visual Studio](../vsto/how-to-create-office-projects-in-visual-studio.md).  
  
     [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] открывает в конструкторе новый документ Word и добавляет проект EmployeeControls в **обозреватель решений**.  
  
## Добавление элементов управления содержимым в документ  
 Создайте таблицу, содержащую три различных типа элементов управления содержимым, в которой пользователь может просмотреть или изменить сведения о сотруднике.  
  
#### Порядок добавления элементов управления содержимым в документ  
  
1.  В документе Word, размещенном в конструкторе [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)], выберите вкладку **Вставить** на ленте.  
  
2.  В группе **Таблицы** выберите **Таблица** и вставьте таблицу с двумя столбцами и тремя строками.  
  
3.  Введите текст в первый столбец, как показано в следующем столбце:  
  
    ||  
    |-|  
    |Имя сотрудника|  
    |Дата приема на работу|  
    |Заголовок|  
  
4.  Выберите первую строку во втором столбце таблицы \(рядом с элементом **Имя сотрудника**\).  
  
5.  На ленте перейдите на вкладку **Разработчик**.  
  
    > [!NOTE]  
    >  Если вкладка **Разработчик** не отображается, сделайте ее видимой.  Дополнительные сведения см. в разделе [Практическое руководство. Отображение вкладки разработчика на ленте](../vsto/how-to-show-the-developer-tab-on-the-ribbon.md).  
  
6.  В группе **Элементы управления** нажмите кнопку **Текст** ![PlainTextContentControl](~/vsto/media/plaintextcontrol.gif "PlainTextContentControl"), чтобы добавить <xref:Microsoft.Office.Tools.Word.PlainTextContentControl> в первую ячейку.  
  
7.  Выберите вторую строку во втором столбце таблицы \(рядом с элементом **Дата приема на работу**\).  
  
8.  В группе **Элементы управления** нажмите кнопку **Выбор даты** ![DatePickerContentControl](~/vsto/media/datepicker.gif "DatePickerContentControl"), чтобы добавить <xref:Microsoft.Office.Tools.Word.DatePickerContentControl> во вторую ячейку.  
  
9. Выберите третью строку во втором столбце таблицы \(рядом с элементом **Должность**\).  
  
10. В группе **Элементы управления** нажмите кнопку **Раскрывающийся список** ![DropDownListContentControl](~/vsto/media/dropdownlist.gif "DropDownListContentControl"), чтобы добавить <xref:Microsoft.Office.Tools.Word.DropDownListContentControl> в последнюю ячейку.  
  
 Вот и весь пользовательский интерфейс для этого проекта.  При запуске проекта можно ввести текст в первой строке и выбрать дату во второй строке.  Следующий шаг — присоединение данных, которые будут отображаться в документе, к XML\-файлу.  
  
## Создание файла данных XML  
 Как правило, вы будете получать XML\-данные для хранения в пользовательской XML\-части из внешнего источника, например файла или базы данных.  В этом пошаговом руководстве создается XML\-файл, содержащий данные о сотрудниках, помеченные элементами, которые необходимо привязать к элементам управления содержимым в документе.  Чтобы сделать данные доступными во время выполнения, внедрите XML\-файл в качестве ресурса в сборке настройки.  
  
#### Создание файла данных  
  
1.  В меню **Проект** выберите пункт **Добавить новый элемент**.  
  
     Будет открыто диалоговое окно **Добавление нового элемента**.  
  
2.  В области **Шаблоны** выберите пункт **XML\-файл**.  
  
3.  Введите имя файла **employees.xml**, а затем нажмите кнопку **Добавить**.  
  
     Файл **employees.xml** открывается в редакторе кода.  
  
4.  Замените содержимое файла **employees.xml** следующим текстом.  
  
    ```  
  
    <employees xmlns="http://schemas.microsoft.com/vsto/samples">  
      <employee>  
        <name>Karina Leal</name>  
        <hireDate>1999-04-01</hireDate>  
        <title>Manager</title>  
      </employee>  
    </employees>  
    ```  
  
5.  В **обозревателе решений** выберите файл **employees.xml**.  
  
6.  В окне **Свойства** выберите свойство **Действие при сборке** и измените значение на **Внедренный ресурс**.  
  
     Этот шаг внедряет XML\-файл в качестве ресурса в сборку при построении проекта.  Так вы получите возможность доступа к содержимому XML\-файла во время выполнения.  
  
## Создание схемы XML  
 Если вам необходимо привязать элемент управления содержимым к одному элементу в пользовательской XML\-части, необязательно использовать схему XML.  Однако для привязки <xref:Microsoft.Office.Tools.Word.DropDownListContentControl> к набору значений необходимо создать схему XML, которая проверяет созданный ранее файл XML\-данных.  Схема XML определяет возможные значения для элемента `title`.  Вы привяжете <xref:Microsoft.Office.Tools.Word.DropDownListContentControl> к этому элементу далее в этом пошаговом руководстве.  
  
#### Порядок создания схемы XML  
  
1.  В меню **Проект** выберите пункт **Добавить новый элемент**.  
  
     Будет открыто диалоговое окно **Добавление нового элемента**.  
  
2.  В области **Шаблоны** выберите пункт **XML\-схема**.  
  
3.  Введите для схемы имя **employees.xsd** и нажмите кнопку **Добавить**.  
  
     Открывается конструктор схем.  
  
4.  В **обозревателе решений** откройте контекстное меню для файла **employees.xsd** и выберите пункт **Просмотреть код**.  
  
5.  Замените содержимое файла **employees.xml** следующей схемой.  
  
    ```  
  
    <xs:schema xmlns="http://schemas.microsoft.com/vsto/samples"   
        targetNamespace="http://schemas.microsoft.com/vsto/samples"  
        xmlns:xs="http://www.w3.org/2001/XMLSchema"  
        elementFormDefault="qualified">  
      <xs:element name="employees" type="EmployeesType"></xs:element>  
      <xs:complexType name="EmployeesType">  
        <xs:all>  
          <xs:element name="employee" type="EmployeeType"/>  
        </xs:all>  
      </xs:complexType>  
      <xs:complexType name="EmployeeType">  
        <xs:sequence>  
          <xs:element name="name" type="xs:string" minOccurs="1" maxOccurs="1"/>  
          <xs:element name="hireDate" type="xs:date" minOccurs="1" maxOccurs="1"/>  
          <xs:element name="title" type="TitleType" minOccurs="1" maxOccurs="1"/>  
        </xs:sequence>  
      </xs:complexType>  
      <xs:simpleType name="TitleType">  
        <xs:restriction base="xs:string">  
          <xs:enumeration value ="Engineer"/>  
          <xs:enumeration value ="Designer"/>  
          <xs:enumeration value ="Manager"/>  
        </xs:restriction>  
      </xs:simpleType>  
    </xs:schema>  
    ```  
  
6.  В меню **Файл** щелкните **Сохранить все**, чтобы сохранить изменения в файлах **employees.xml** и **employees.xsd**.  
  
## Добавление схемы XML к документу во время разработки  
 XML\-схему необходимо присоединить к документу, чтобы привязать <xref:Microsoft.Office.Tools.Word.DropDownListContentControl> к допустимым значениям элемента `title`.  
  
#### Добавление схемы XML к документу \([!INCLUDE[Word_15_short](../vsto/includes/word-15-short-md.md)]\)  
  
1.  Активируйте **EmployeeControls.docx** в конструкторе.  
  
2.  На ленте откройте вкладку **Разработчик**, а затем нажмите кнопку **Надстройки**.  
  
3.  В диалоговом окне **Шаблоны и надстройки** выберите вкладку **XML\-схема**, а затем нажмите кнопку **Добавить схему**.  
  
4.  Перейдите к созданной ранее схеме **employees.xsd**, которая расположена в каталоге проекта, а затем нажмите кнопку **Открыть**.  
  
5.  Нажмите кнопку **ОК** в диалоговом окне **Параметры схемы**.  
  
6.  Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Шаблоны и надстройки**.  
  
#### Добавление схемы XML к документу \(Word 2010\)  
  
1.  Активируйте **EmployeeControls.docx** в конструкторе.  
  
2.  На ленте перейдите на вкладку **Разработчик**.  
  
3.  В группе **XML** нажмите кнопку **Схема**.  
  
4.  В диалоговом окне **Шаблоны и надстройки** выберите вкладку **XML\-схема**, а затем нажмите кнопку **Добавить схему**.  
  
5.  Перейдите к созданной ранее схеме **employees.xsd**, которая расположена в каталоге проекта, а затем нажмите кнопку **Открыть**.  
  
6.  Нажмите кнопку **ОК** в диалоговом окне **Параметры схемы**.  
  
7.  Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Шаблоны и надстройки**.  
  
     Откроется панель задач **структуры XML**.  
  
8.  Закройте панель задач **Структура XML**.  
  
## Добавление пользовательской XML\-части в документ  
 Перед привязкой элементов управления содержимым к элементам в XML\-файле необходимо добавить содержимое XML\-файла в новую пользовательскую XML\-часть в документе.  
  
#### Порядок добавления пользовательской XML\-части в документ  
  
1.  В **обозревателе решений** откройте контекстное меню для файла **ThisDocument.cs** или **ThisDocument.vb** и выберите команду **Просмотреть код**.  
  
2.  Добавьте в класс `ThisDocument` следующие объявления.  В этом коде объявляются несколько объектов, которые будут использоваться для добавления пользовательской XML\-части в документ.  
  
     [!code-csharp[Trin_ContentControlXmlPartWalkthrough#1](../snippets/csharp/VS_Snippets_OfficeSP/Trin_ContentControlXmlPartWalkthrough/CS/ThisDocument.cs#1)]
     [!code-vb[Trin_ContentControlXmlPartWalkthrough#1](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_ContentControlXmlPartWalkthrough/VB/ThisDocument.vb#1)]  
  
3.  Добавьте следующий метод в класс `ThisDocument`.  Этот метод получает содержимое файла данных XML, внедренного в сборку в качестве ресурса, и возвращает содержимое в виде XML\-строки.  
  
     [!code-csharp[Trin_ContentControlXmlPartWalkthrough#3](../snippets/csharp/VS_Snippets_OfficeSP/Trin_ContentControlXmlPartWalkthrough/CS/ThisDocument.cs#3)]
     [!code-vb[Trin_ContentControlXmlPartWalkthrough#3](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_ContentControlXmlPartWalkthrough/VB/ThisDocument.vb#3)]  
  
4.  Добавьте следующий метод в класс `ThisDocument`.  Метод `AddCustomXmlPart` создает пользовательскую XML\-часть, которая содержит XML\-строку, передаваемую в метод.  
  
     Чтобы пользовательская XML\-часть создавалась всего один раз, метод создает ее, только если пользовательская XML\-часть с соответствующим идентификатором GUID еще не существует в документе.  При первом вызове этого метода он сохраняет значение свойства <xref:Microsoft.Office.Core._CustomXMLPart.Id%2A> в строке `employeeXMLPartID`.  Значение `employeeXMLPartID` строки хранится в документе, поскольку он был объявлен с помощью атрибута <xref:Microsoft.VisualStudio.Tools.Applications.Runtime.CachedAttribute>.  
  
     [!code-csharp[Trin_ContentControlXmlPartWalkthrough#4](../snippets/csharp/VS_Snippets_OfficeSP/Trin_ContentControlXmlPartWalkthrough/CS/ThisDocument.cs#4)]
     [!code-vb[Trin_ContentControlXmlPartWalkthrough#4](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_ContentControlXmlPartWalkthrough/VB/ThisDocument.vb#4)]  
  
## Привязка элементов управления содержимым к элементам в пользовательской XML\-части  
 Привяжите каждый элемент управления содержимым к элементу в пользовательской XML\-части с помощью свойства **XMLMapping** каждого элемента управления.  
  
#### Порядок привязки элементов управления содержимым к элементам в пользовательской XML\-части  
  
1.  Добавьте следующий метод в класс `ThisDocument`.  Он привязывает каждый элемент управления содержимым к элементу в пользовательской XML\-части и задает формат отображения даты <xref:Microsoft.Office.Tools.Word.DatePickerContentControl>.  
  
     [!code-csharp[Trin_ContentControlXmlPartWalkthrough#5](../snippets/csharp/VS_Snippets_OfficeSP/Trin_ContentControlXmlPartWalkthrough/CS/ThisDocument.cs#5)]
     [!code-vb[Trin_ContentControlXmlPartWalkthrough#5](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_ContentControlXmlPartWalkthrough/VB/ThisDocument.vb#5)]  
  
## Выполнение кода после открытия документа  
 Создайте пользовательскую XML\-часть и привяжите пользовательские элементы управления к данным при открытии документа.  
  
#### Порядок выполнения кода после открытия документа  
  
1.  Добавьте в метод `ThisDocument_Startup` класса `ThisDocument` следующий код.  Этот код получает строку XML из файла **employees.xml**, добавляет строку XML к новой пользовательской XML\-части в документе и привязывает элементы управления содержимым к элементам в XML\-части.  
  
     [!code-csharp[Trin_ContentControlXmlPartWalkthrough#2](../snippets/csharp/VS_Snippets_OfficeSP/Trin_ContentControlXmlPartWalkthrough/CS/ThisDocument.cs#2)]
     [!code-vb[Trin_ContentControlXmlPartWalkthrough#2](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_ContentControlXmlPartWalkthrough/VB/ThisDocument.vb#2)]  
  
## Тестирование проекта  
 При открытии документа элементы управления содержимым отображают данные из элементов в пользовательской XML\-части.  Вы можете щелкнуть <xref:Microsoft.Office.Tools.Word.DropDownListContentControl> для выбора одного из трех допустимых значений элемента `title`, которые определены в файле **employees.xsd**.  Если изменить данные в любом из элементов управления содержимым, новые значения сохраняются в пользовательской XML\-части в документе.  
  
#### Проверка элементов управления содержимым  
  
1.  Нажмите клавишу F5, чтобы запустить проект.  
  
2.  Убедитесь, что таблица в документе похожа на следующую таблицу.  Каждая строка во втором столбце извлекается из элемента в пользовательской XML\-части в документе.  
  
    |||  
    |-|-|  
    |Имя сотрудника|**Karina Leal**|  
    |Дата приема на работу|**1 апреля 1999 г.**|  
    |Заголовок|**Руководитель**|  
  
3.  Выберите ячейку справа от ячейки «Имя сотрудника» и введите другое имя.  
  
4.  Выберите ячейку справа от ячейки «Дата приема на работу» и выберите другую дату в элементе выбора даты.  
  
5.  Выберите ячейку справа от ячейки «Должность» и выберите новый элемент из раскрывающегося списка.  
  
6.  Сохраните и закройте документ.  
  
7.  В проводнике откройте папку \\bin\\Debug в папке проекта.  
  
8.  Откройте контекстное меню для файла EmployeeControls.docx и выберите команду **Переименовать**.  
  
9. Укажите для файла имя EmployeeControls.docx.zip.  
  
     Документ EmployeeControls.docx сохраняется в формате Open XML.  Переименовав этот документ с расширением ZIP, можно просмотреть содержимое документа.  Дополнительные сведения о формате Open XML см. в технической статье [Введение форматов файлов Office \(2007\) Open XML](http://msdn.microsoft.com/ru-ru/96018532-f62c-4da7-bbff-16b96a483fbf).  
  
10. Откройте файл EmployeeControls.docx.zip.  
  
11. Откройте папку **customXml**.  
  
12. Откройте контекстное меню для файла **item2.xml** и выберите команду **Открыть**.  
  
     Этот файл содержит пользовательскую XML\-часть, которая была добавлена в документ.  
  
13. Убедитесь, что элементы `name`, `hireDate` и `title` содержат новые значения, введенные в элементы управления содержимым в документе.  
  
14. Закройте файл **item2.xml**.  
  
## Следующие действия  
 Дополнительные сведения об использовании элементов управления содержимым см. в следующих разделах.  
  
-   Использование всех доступных элементов управления содержимым для создания шаблона.  Дополнительные сведения см. в разделе [Пошаговое руководство. Создание шаблона с помощью элементов управления содержимым](../vsto/walkthrough-creating-a-template-by-using-content-controls.md).  
  
-   Изменение данных в пользовательских XML\-частях при закрытии документа.  При следующем открытии документа пользователем элементы управления содержимым, привязанные к XML\-элементам, покажут новые данные.  
  
-   Использование элементов управления содержимым для защиты частей документов.  Дополнительные сведения см. в разделе [Практическое руководство. Защита частей документов с помощью элементов управления содержимым](../vsto/how-to-protect-parts-of-documents-by-using-content-controls.md).  
  
## См. также  
 [Автоматизация Word с помощью расширенных объектов](../vsto/automating-word-by-using-extended-objects.md)   
 [Элементы управления содержимым](../vsto/content-controls.md)   
 [Практическое руководство. Добавление элементов управления содержимым в документы Word](../vsto/how-to-add-content-controls-to-word-documents.md)   
 [Практическое руководство. Защита частей документов с помощью элементов управления содержимым](../vsto/how-to-protect-parts-of-documents-by-using-content-controls.md)   
 [Общие сведения о ведущих элементах и элементах управления ведущего приложения](../vsto/host-items-and-host-controls-overview.md)   
 [Программные ограничения ведущих элементов и элементов управления ведущего приложения](../vsto/programmatic-limitations-of-host-items-and-host-controls.md)   
 [Добавление элементов управления в документы Office во время выполнения](../vsto/adding-controls-to-office-documents-at-run-time.md)  
  
  