---
title: "Пошаговое руководство. Сложная привязка данных в проекте уровня документа | Microsoft Docs"
ms.custom: ""
ms.date: "02/02/2017"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "office-development"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
helpviewer_keywords: 
  - "сложные данные [разработка решений Office в Visual Studio]"
  - "данные [разработка решений Office в Visual Studio], привязка данных"
  - "привязка данных [разработка решений Office в Visual Studio], несколько столбцов"
  - "несколько столбцов - привязка данных [разработка решений Office в Visual Studio]"
ms.assetid: 32ffad3d-fba4-476a-99b8-ef440434f4e1
caps.latest.revision: 50
author: "kempb"
ms.author: "kempb"
manager: "ghogen"
caps.handback.revision: 49
---
# Пошаговое руководство. Сложная привязка данных в проекте уровня документа
  В этом пошаговом руководстве демонстрируются основные сведения о сложной привязке данных в проекте уровня документа.  Можно связывать множество ячеек в листе Microsoft Office Excel с полями в базе данных Northwind SQL Server.  
  
 [!INCLUDE[appliesto_xlalldoc](../vsto/includes/appliesto-xlalldoc-md.md)]  
  
 В данном пошаговом руководстве рассмотрены следующие задачи:  
  
-   Добавление источника данных к проекту книги.  
  
-   Добавление элементов управления с привязкой к данным на лист.  
  
-   Сохранение измененных данных обратно в базу данных.  
  
 [!INCLUDE[note_settings_general](../sharepoint/includes/note-settings-general-md.md)]  
  
## Обязательные компоненты  
 Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.  
  
-   [!INCLUDE[vsto_vsprereq](../vsto/includes/vsto-vsprereq-md.md)]  
  
-   [!INCLUDE[Excel_15_short](../vsto/includes/excel-15-short-md.md)] или [!INCLUDE[Excel_14_short](../vsto/includes/excel-14-short-md.md)].  
  
-   Доступ к серверу с примером базы данных "Northwind" SQL Server.  
  
-   Разрешения на чтение из базы данных SQL Server и запись в нее.  
  
## Создание нового проекта  
 На первом этапе необходимо создать проект книги Excel.  
  
#### Создание нового проекта  
  
1.  Создайте проект книги Excel с именем **Сложная привязка данных**.  Выберите в мастере **Создать новый документ**.  
  
     Дополнительные сведения см. в разделе [Практическое руководство. Создание проектов Office в Visual Studio](../vsto/how-to-create-office-projects-in-visual-studio.md).  
  
     Созданная книга Excel открывается в конструкторе Visual Studio. Проект "Сложная привязка данных" добавляется в **Обозреватель решений**.  
  
## Создание источника данных  
 Чтобы добавить типизированный набор данных в проект, следует использовать окно **Источники данных**.  
  
#### Создание источника данных  
  
1.  Если окно **Источники данных** не отображается, его отображение в строке меню, выбирая **Вид**, **Другие окна**, **Источники данных**.  
  
2.  Выберите **Добавить новый источник данных**, чтобы запустить **Мастер настройки источника данных**.  
  
3.  Выберите **База данных** и нажмите **Далее**.  
  
4.  Выберите подключение к базе данных SQL Server "Northwind" или добавьте новое подключение с помощью кнопки **Новое подключение**.  
  
5.  После выбора или создания подключения нажмите **Далее**.  
  
6.  Чтобы сохранить подключение, снимите флажок, если он установлен, и нажмите **Далее**.  
  
7.  В окне **Объекты базы данных** разверните узел **Таблицы**.  
  
8.  Установите флажок рядом с таблицей **Сотрудники**.  
  
9. Нажмите кнопку **Готово**.  
  
 Мастер добавит таблицу **Сотрудники** в окно **Источники данных**.  Также к проекту добавляется типизированный набор данных, который отображается в **Обозревателе решений**.  
  
## Добавление элементов управления на лист  
 Если книга открыта, на листе отобразится таблица **Сотрудники**.  Пользователи смогут изменять данные и сохранять изменения в базе данных, нажимая кнопку.  
  
 Чтобы автоматически привязать лист к таблице, можно добавить на лист элемент управления <xref:Microsoft.Office.Tools.Excel.ListObject> из окна **Источники данных**.  Чтобы разрешить пользователям сохранять изменения, нужно добавить элемент управления <xref:System.Windows.Forms.Button> с **панели элементов**.  
  
#### Добавление объекта списка  
  
1.  Убедитесь, что книга **Мои сложные данные Binding.xlsx** открыта в конструкторе Visual Studio, и отображается **Лист1**.  
  
2.  Откройте окно **Источники данных** и выберите узел **Сотрудники**.  
  
3.  Щелкните стрелку раскрывающегося списка, которая появляется после выбора элемента.  
  
4.  Выберите в раскрывающемся списке **ListObject**.  
  
5.  Перетащите таблицу **Сотрудники** в ячейку **А6**.  
  
     В ячейке **А6** будет создан элемент управления <xref:Microsoft.Office.Tools.Excel.ListObject> с именем `EmployeesListObject`.  Одновременно в проект добавляются элемент управления <xref:System.Windows.Forms.BindingSource> с именем `EmployeesBindingSource`, адаптер таблиц и экземпляр класса <xref:System.Data.DataSet>.  Элемент управления связан с объектом <xref:System.Windows.Forms.BindingSource>, который в свою очередь связан с экземпляром <xref:System.Data.DataSet>.  
  
#### Добавление кнопки  
  
1.  Со вкладки **Стандартные элементы управленияПанели элементов** перетащите элемент управления <xref:System.Windows.Forms.Button> в ячейку **A4** листа.  
  
 Следующим шагом будет добавление текста к кнопке при открытии листа.  
  
## Инициализация элемента управления  
 Добавьте текст к кнопке в обработчике событий <xref:Microsoft.Office.Tools.Excel.Worksheet.Startup>.  
  
#### Инициализация элемента управления  
  
1.  В **Обозревателе решений** щелкните правой кнопкой мыши **Лист1.vb** или **Лист1.cs** и выберите в контекстном меню команду **Перейти к коду**.  
  
2.  Добавьте следующий код в метод `Sheet1_Startup`, чтобы задать текст для кнопки b`utton`:  
  
     [!code-csharp[Trin_VstcoreDataExcel#8](../snippets/csharp/VS_Snippets_OfficeSP/Trin_VstcoreDataExcel/CS/Sheet3.cs#8)]
     [!code-vb[Trin_VstcoreDataExcel#8](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_VstcoreDataExcel/VB/Sheet3.vb#8)]  
  
3.  Добавьте обработчик событий для события <xref:System.Windows.Forms.Control.Click> в метод `Sheet1_Startup` \(только в C\#\).  
  
     [!code-csharp[Trin_VstcoreDataExcel#9](../snippets/csharp/VS_Snippets_OfficeSP/Trin_VstcoreDataExcel/CS/Sheet3.cs#9)]  
  
 Теперь добавьте код, обрабатывающий событие кнопки <xref:System.Windows.Forms.Control.Click>.  
  
## Сохранение изменений в базе данных  
 Любые изменения данных существуют только в локальном наборе данных до тех пор, пока они не будут явным образом сохранены обратно в базу данных.  
  
#### Сохранение изменений в базе данных  
  
1.  Добавьте обработчик событий для события <xref:System.Windows.Forms.Control.Click> кнопки b`utton`, а затем добавьте следующий код, чтобы зафиксировать изменения в наборе данных в базе данных:  
  
     [!code-csharp[Trin_VstcoreDataExcel#10](../snippets/csharp/VS_Snippets_OfficeSP/Trin_VstcoreDataExcel/CS/Sheet3.cs#10)]
     [!code-vb[Trin_VstcoreDataExcel#10](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_VstcoreDataExcel/VB/Sheet3.vb#10)]  
  
## Тестирование приложения  
 Теперь можно приступить к тестированию книги, чтобы проверить корректность отображения данных, а также возможность оперировать данными в объекте списка.  
  
#### Тестирование привязки данных  
  
-   Нажмите клавишу F5.  
  
     При открытии книги необходимо убедиться, что объект списка заполнен данными из таблицы **Сотрудники**.  
  
#### Изменение данных  
  
1.  Щелкните ячейку **B7**, в которой должна стоять фамилия **Даволио**.  
  
2.  Введите фамилию Куликов и нажмите клавишу ВВОД.  
  
#### Изменение заголовка столбца  
  
1.  Щелкните ячейку, в которой содержится заголовок столбца **Фамилия**.  
  
2.  Введите "Фамилия сотрудника" с пробелом между двумя словами и нажмите клавишу ВВОД.  
  
#### Сохранение данных  
  
1.  На листе выберите пункт **Сохранить**.  
  
2.  Закройте приложение Excel.  Когда отобразится окно с запросом о сохранении изменений, нажмите кнопку **Нет**.  
  
3.  Нажмите клавишу F5, чтобы повторно запустить проект.  
  
     Объект списка заполняется данными из таблицы **Сотрудники**.  
  
4.  Обратите внимание, что в ячейке **B7** осталась фамилия Куликов — это изменение, которое было сохранено в базе данных.  Заголовок столбца **Фамилия** был воссоздан в исходном виде, поскольку заголовок столбца не привязан к базе данных, и изменения на листе не были сохранены.  
  
#### Добавление новых строк  
  
1.  Выберите ячейку в объекте списка.  
  
     В нижней части списка появляется новая строка со звездочкой \(**\***\) в первой ячейке.  
  
2.  Добавьте в пустую строку следующие данные:  
  
    |КодСотрудника|LastName|FirstName|Заголовок|  
    |-------------------|--------------|---------------|---------------|  
    |10|Егоров|Вадим|Менеджер по продажам|  
  
#### Удаление строк  
  
-   Щелкните правой кнопкой мыши номер 16 \(строку 16\) с самого левого края листа и выберите команду **Удалить**.  
  
#### Сортировка строк в списке  
  
1.  Выберите ячейку в списке.  
  
     В заголовке каждого столбца появятся кнопки со стрелками.  
  
2.  Нажмите кнопку со стрелкой в заголовке столбца **LastName**.  
  
3.  Выберите пункт **Сортировка по возрастанию**.  
  
     Строки будут отсортированы в алфавитном порядке по фамилии.  
  
#### Фильтр данных  
  
1.  Выберите ячейку в списке.  
  
2.  Нажмите кнопку со стрелкой в заголовке столбца **Title**.  
  
3.  Выберите пункт **Торговый представитель**.  
  
     В списке будут оставлены только те строки, в которых в столбце **Заголовок** стоит текст **Торговый представитель**.  
  
4.  Снова нажмите кнопку со стрелкой в заголовке столбца **Title**.  
  
5.  Выберите **\(Все\)**.  
  
     Фильтр удаляется и отображаются все строки.  
  
## Следующие действия  
 Данное пошаговое руководство демонстрирует основы привязки таблицы в базе данных к объекту списка.  Далее будут рассмотрены следующие задачи:  
  
-   Кэширование данных для использования в автономном режиме.  Дополнительные сведения см. в разделе [Практическое руководство. Кэширование данных для автономного использования или для использования на сервере](../vsto/how-to-cache-data-for-use-offline-or-on-a-server.md).  
  
-   Развертывание решения.  Дополнительные сведения см. в разделе [Развертывание решения Office](../vsto/deploying-an-office-solution.md).  
  
-   Создание отношения "основной\-подробности" между полем и таблицей.  Дополнительные сведения см. в разделе [Пошаговое руководство. Создание иерархического отношения с помощью кэшированного набора данных](../vsto/walkthrough-creating-a-master-detail-relation-using-a-cached-dataset.md).  
  
## См. также  
 [Привязка данных к элементам управления в решениях Office](../vsto/binding-data-to-controls-in-office-solutions.md)   
 [Данные в решениях Office](../vsto/data-in-office-solutions.md)   
 [Пошаговое руководство. Простая привязка данных в проекте уровня документа](../vsto/walkthrough-simple-data-binding-in-a-document-level-project.md)  
  
  