---
title: ": Пошаговое | Документы Microsoft"
ms.custom: 
ms.date: 02/02/2017
ms.reviewer: 
ms.suite: 
ms.technology: office-development
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- data [Office development in Visual Studio], binding data
- complex data [Office development in Visual Studio]
- multiple column data binding [Office development in Visual Studio]
- data binding [Office development in Visual Studio], multiple columns
ms.assetid: 32ffad3d-fba4-476a-99b8-ef440434f4e1
caps.latest.revision: "50"
author: gewarren
ms.author: gewarren
manager: ghogen
ms.workload: office
ms.openlocfilehash: 10d35a0cec1e927fbc264d64ef911503f68f1606
ms.sourcegitcommit: 32f1a690fc445f9586d53698fc82c7debd784eeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2017
---
# <a name="walkthrough-complex-data-binding-in-a-document-level-project"></a>Пошаговое руководство. Сложная привязка данных в проекте уровня документа
  В этом пошаговом руководстве демонстрируются основные принципы сложная привязка данных в проекте уровня документа. Можно привязать несколько ячеек в лист Microsoft Office Excel к полям базы данных "Борей" SQL Server.  
  
 [!INCLUDE[appliesto_xlalldoc](../vsto/includes/appliesto-xlalldoc-md.md)]  
  
 В данном пошаговом руководстве рассмотрены следующие задачи:  
  
-   Добавление источника данных к проекту книги.  
  
-   Добавление элементов управления с привязкой к данным на лист.  
  
-   Сохранение изменений данных в базе данных.  
  
 [!INCLUDE[note_settings_general](../sharepoint/includes/note-settings-general-md.md)]  
  
## <a name="prerequisites"></a>Предварительные требования  
 Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.  
  
-   [!INCLUDE[vsto_vsprereq](../vsto/includes/vsto-vsprereq-md.md)]  
  
-   [!INCLUDE[Excel_15_short](../vsto/includes/excel-15-short-md.md)] или [!INCLUDE[Excel_14_short](../vsto/includes/excel-14-short-md.md)].  
  
-   Доступ к серверу с образцом базы данных "Борей" SQL Server.  
  
-   Разрешения на чтение и запись в базу данных SQL Server.  
  
## <a name="creating-a-new-project"></a>Создание нового проекта  
 Первым шагом является создание проекта книги Excel.  
  
#### <a name="to-create-a-new-project"></a>Создание нового проекта  
  
1.  Создайте проект книги Excel с именем **сложная привязка данных**. В мастере выберите **создания документа**.  
  
     Дополнительные сведения см. в разделе [How to: Create Office Projects in Visual Studio](../vsto/how-to-create-office-projects-in-visual-studio.md).  
  
     Visual Studio открывает новую книгу Excel в конструкторе и добавляет **сложная привязка данных** проекта **обозревателе решений**.  
  
## <a name="creating-the-data-source"></a>Создание источника данных  
 С помощью окна **Источники данных** добавьте типизированный набор данных в свой проект.  
  
#### <a name="to-create-the-data-source"></a>Создание источника данных  
  
1.  Если окно **Источники данных** не отображается, откройте его, выбрав в строке меню пункты **Вид**, **Другие окна**, **Источники данных**.  
  
2.  Выберите команду **Добавить новый источник данных** , чтобы запустить **Мастер настройки источника данных**.  
  
3.  Выберите **базы данных** и нажмите кнопку **Далее**.  
  
4.  Выберите подключение данных к базе данных Northwind SQL Server или добавьте новое подключение с помощью **новое подключение** кнопки.  
  
5.  После выбора или создания подключения нажмите кнопку **Далее**.  
  
6.  Удалить параметр, чтобы сохранить подключение, если он установлен, а затем щелкните **Далее**.  
  
7.  Разверните **таблиц** узел в **объектов базы данных** окна.  
  
8.  Установите флажок рядом с **сотрудников** таблицы.  
  
9. Нажмите кнопку **Готово**.  
  
 Мастер добавит **сотрудников** таблицы, к **источники данных** окна. Он также добавляет типизированный набор данных в проект, который является видимым в **обозревателе решений**.  
  
## <a name="adding-controls-to-the-worksheet"></a>Добавление элементов управления на лист  
 На листе отобразится **сотрудников** таблицы при открытии книги. Пользователи смогут вносить изменения в данные и затем сохранить эти изменения в базе данных путем нажатия кнопки.  
  
 Чтобы автоматически привязать лист к таблице, можно добавить <xref:Microsoft.Office.Tools.Excel.ListObject> управления в лист из **источники данных** окна. Чтобы разрешить пользователям сохранять изменения, добавьте <xref:System.Windows.Forms.Button> управления из **элементов**.  
  
#### <a name="to-add-a-list-object"></a>Добавление объекта списка  
  
1.  Убедитесь, что **Мои сложных данных Binding.xlsx** книга открыта в конструкторе Visual Studio с **Sheet1** отображается.  
  
2.  Откройте **источники данных** и выберите **сотрудников** узла.  
  
3.  Щелкните стрелку раскрывающегося списка, которая появляется.  
  
4.  Выберите **ListObject** в раскрывающемся списке.  
  
5.  Перетащите **сотрудников** таблицы ячейку **A6**.  
  
     Объект <xref:Microsoft.Office.Tools.Excel.ListObject> управления с именем `EmployeesListObject` создается в ячейке **A6**. В то же время <xref:System.Windows.Forms.BindingSource> с именем `EmployeesBindingSource`, адаптер таблиц и <xref:System.Data.DataSet> экземпляр добавляются в проект. Элемент управления привязан к <xref:System.Windows.Forms.BindingSource>, который, в свою очередь, привязан к <xref:System.Data.DataSet> экземпляра.  
  
#### <a name="to-add-a-button"></a>Добавление кнопки  
  
1.  Из **стандартные элементы управления** вкладке **элементов**, добавьте <xref:System.Windows.Forms.Button> управления ячейку **A4** листа.  
  
 Следующим шагом является добавление текста к кнопке при открытии листа.  
  
## <a name="initializing-the-control"></a>Инициализация элемента управления  
 Добавление текста к кнопке в <xref:Microsoft.Office.Tools.Excel.Worksheet.Startup> обработчика событий.  
  
#### <a name="to-initialize-the-control"></a>Для инициализации элемента управления  
  
1.  В **обозревателе решений**, щелкните правой кнопкой мыши **Sheet1.vb** или **Sheet1.cs**, а затем нажмите кнопку **Просмотр кода** в контекстном меню.  
  
2.  Добавьте следующий код в `Sheet1_Startup` метод, чтобы задать текст для кнопки b`utton`.  
  
     [!code-csharp[Trin_VstcoreDataExcel#8](../vsto/codesnippet/CSharp/Trin_VstcoreDataExcelCS/Sheet3.cs#8)]
     [!code-vb[Trin_VstcoreDataExcel#8](../vsto/codesnippet/VisualBasic/Trin_VstcoreDataExcelVB/Sheet3.vb#8)]  
  
3.  Только в C#, добавьте обработчик событий для <xref:System.Windows.Forms.Control.Click> события `Sheet1_Startup` метод.  
  
     [!code-csharp[Trin_VstcoreDataExcel#9](../vsto/codesnippet/CSharp/Trin_VstcoreDataExcelCS/Sheet3.cs#9)]  
  
 Теперь добавьте код для обработки <xref:System.Windows.Forms.Control.Click> события кнопки.  
  
## <a name="saving-changes-to-the-database"></a>Сохранение изменений в базе данных  
 Внесены изменения в данных существуют только в локальном наборе данных, пока не будет явно сохраняются в базе данных.  
  
#### <a name="to-save-changes-to-the-database"></a>Чтобы сохранить изменения в базу данных  
  
1.  Добавьте обработчик событий для <xref:System.Windows.Forms.Control.Click> событие b`utton`и добавьте следующий код, чтобы выполнить все изменения, внесенные в наборе данных обратно в базу данных.  
  
     [!code-csharp[Trin_VstcoreDataExcel#10](../vsto/codesnippet/CSharp/Trin_VstcoreDataExcelCS/Sheet3.cs#10)]
     [!code-vb[Trin_VstcoreDataExcel#10](../vsto/codesnippet/VisualBasic/Trin_VstcoreDataExcelVB/Sheet3.vb#10)]  
  
## <a name="testing-the-application"></a>Тестирование приложения  
 Теперь можно протестировать книгу, чтобы убедиться, что данные отображаются должным образом и что можно управлять данными в объекте списка.  
  
#### <a name="to-test-the-data-binding"></a>Для проверки привязки данных  
  
-   Нажмите клавишу F5.  
  
     Убедитесь, что при открытии книги, то объект списка заполняется данными из **сотрудников** таблицы.  
  
#### <a name="to-modify-data"></a>Для изменения данных  
  
1.  Щелкните ячейку **B7**, который должен содержать имя **Петров**.  
  
2.  Введите имя **Андерсон**, и нажмите клавишу ВВОД.  
  
#### <a name="to-modify-a-column-header"></a>Чтобы изменить заголовок столбца  
  
1.  Щелкните ячейку, содержащую заголовок столбца **LastName**.  
  
2.  Тип **Фамилия**, с пробелом между словами и нажмите клавишу ВВОД.  
  
#### <a name="to-save-data"></a>Для сохранения данных  
  
1.  Нажмите кнопку **Сохранить** на листе.  
  
2.  Выйдите из Excel. Нажмите кнопку **нет** при запросе сохраните внесенные изменения.  
  
3.  Нажмите клавишу F5 для повторного запуска проекта.  
  
     Объект списка заполняется данными из **сотрудников** таблицы.  
  
4.  Обратите внимание, что имя в ячейке **B7** по-прежнему **Андерсон**, представляющие собой данные изменения внесены и сохранены в базе данных. Заголовок столбца **LastName** изменилось обратно в исходном виде, поскольку заголовок столбца не привязан к базе данных, и изменения, внесенные в журнал не был сохранен.  
  
#### <a name="to-add-new-rows"></a>Добавление новых строк  
  
1.  Выберите ячейку в объекте-списке.  
  
     Появится новая строка в нижней части списка, заменяется звездочкой (**\***) в первую ячейку новой строки.  
  
2.  Добавьте следующие данные в пустой строке.  
  
    |КодСотрудника|LastName|FirstName|Заголовок|  
    |----------------|--------------|---------------|-----------|  
    |10|Климов|Сергей|Менеджер по продажам|  
  
#### <a name="to-delete-rows"></a>Для удаления строк  
  
-   Щелкните правой кнопкой мыши номер 16 (строку 16) с самого левого края листа, а затем нажмите кнопку **удалить**.  
  
#### <a name="to-sort-the-rows-in-the-list"></a>Для сортировки строк в списке  
  
1.  Выберите ячейку в списке.  
  
     В заголовке каждого столбца отображаются кнопки со стрелками.  
  
2.  Нажмите кнопку со стрелкой в **Фамилия** заголовок столбца.  
  
3.  Нажмите кнопку **Сортировка по возрастанию**.  
  
     Строки сортируются в алфавитном порядке по фамилии.  
  
#### <a name="to-filter-information"></a>Для фильтрации информации  
  
1.  Выберите ячейку в списке.  
  
2.  Нажмите кнопку со стрелкой в **заголовок** заголовок столбца.  
  
3.  Нажмите кнопку **Торговый представитель**.  
  
     В списке показаны только те строки, которые имеют **Торговый представитель** в **заголовок** столбца.  
  
4.  Нажмите кнопку со стрелкой в **заголовок** заголовок столбца еще раз.  
  
5.  Нажмите кнопку **(все)**.  
  
     Фильтр удаляется и отображаются все строки.  
  
## <a name="next-steps"></a>Следующие шаги  
 В этом пошаговом руководстве описываются основные принципы привязки таблицы в базе данных к объекту списка. Ниже приводятся некоторые из возможных последующих задач.  
  
-   Кэширование данных использовать в автономном режиме. Дополнительные сведения см. в разделе [как: кэширование данных для использования в автономном режиме или на сервере](../vsto/how-to-cache-data-for-use-offline-or-on-a-server.md).  
  
-   Развертывание решения. Дополнительные сведения см. в разделе [развертывание решения Office](../vsto/deploying-an-office-solution.md).  
  
-   Создание иерархического отношения между полем и таблицей. Дополнительные сведения см. в разделе [Пошаговое руководство: Создание отношения детализации Master с помощью набора данных в кэше](../vsto/walkthrough-creating-a-master-detail-relation-using-a-cached-dataset.md).  
  
## <a name="see-also"></a>См. также  
 [Привязка данных к элементам управления в решениях Office](../vsto/binding-data-to-controls-in-office-solutions.md)   
 [Данные в решениях Office](../vsto/data-in-office-solutions.md)   
 [Пошаговое руководство. Простая привязка данных в проекте уровня документа](../vsto/walkthrough-simple-data-binding-in-a-document-level-project.md)  
  
  