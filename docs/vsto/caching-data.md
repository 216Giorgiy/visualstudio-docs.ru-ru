---
title: "Кэширование данных"
ms.custom: ""
ms.date: "02/02/2017"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "office-development"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
helpviewer_keywords: 
  - "данные [разработка решений Office в Visual Studio], кэширование"
  - "кэширование данных [разработка решений Office в Visual Studio]"
  - "кэширование данных [разработка решений Office в Visual Studio], сведения о кэшировании данных"
ms.assetid: 6f34251e-7d31-4f2b-ac17-42fd2837c626
caps.latest.revision: 36
author: "kempb"
ms.author: "kempb"
manager: "ghogen"
caps.handback.revision: 35
---
# Кэширование данных
  Можно кэшировать объекты данных в настройках на уровне документа, чтобы обеспечить возможность доступа к данным в автономном режиме или без открытия Microsoft Office Word или Microsoft Office Excel.  Для кэширования объекта он должен иметь тип данных, отвечающий определенным требованиям для присоединения к кэшированным данным.  Многие общие типы данных платформы .NET Framework, включая <xref:System.String>, <xref:System.Data.DataSet> и <xref:System.Data.DataTable> отвечают этим требованиям.  
  
 [!INCLUDE[appliesto_alldoc](../vsto/includes/appliesto-alldoc-md.md)]  
  
 Существует два способа добавления объекта в кэш данных:  
  
-   Для добавления объекта в кэш данных при построении решения примените к объявлению объекта атрибут <xref:Microsoft.VisualStudio.Tools.Applications.Runtime.CachedAttribute>.  Дополнительные сведения см. в разделе [Практическое руководство. Кэширование данных для автономного использования или для использования на сервере](../vsto/how-to-cache-data-for-use-offline-or-on-a-server.md).  
  
-   Для добавления объекта к кэшу данных программными средствами воспользуйтесь методом `StartCaching` ведущего элемента, такого как класс `ThisDocument` или `ThisWorkbook`.  Дополнительные сведения см. в разделе [Практическое руководство. Программное кэширование источника данных в документе MS Office.](../vsto/how-to-programmatically-cache-a-data-source-in-an-office-document.md).  
  
 После добавления объекта в кэш данных можно получить доступ и изменять кэшированные, не запуская Word или Excel.  Дополнительные сведения см. в разделе [Доступ к данным в документах на сервере](../vsto/accessing-data-in-documents-on-the-server.md).  
  
## Требования для кэшируемых объектов данных  
 Чтобы кэшировать объект данных в решении, этот объект должен соответствовать следующим требованиям:  
  
-   Быть открытым полем чтения\-записи или свойством ведущего элемента, таким как классы `ThisDocument` или `ThisWorkbook`.  
  
-   Не должен быть индексатором или другим параметризированным свойством.  
  
 Кроме того, объект данных должен быть сериализован классом <xref:System.Xml.Serialization.XmlSerializer>. Это означает, что этот тип объекта должен иметь такие характеристики:  
  
-   Быть открытым типом.  
  
-   Иметь открытый конструктор без параметров.  
  
-   Не выполнять код, требующий дополнительных привилегий безопасности.  
  
-   Представлять только отрытые свойства чтения\-записи \(другие свойства будут игнорироваться\).  
  
-   Не представлять многомерные массивы \(вложенные массивы допускаются\).  
  
-   Не возвращать интерфейсы из свойств и полей.  
  
-   Если он является коллекцией, не реализовывать класс <xref:System.Collections.IDictionary>.  
  
 При кэшировании объекта данных в документ, среда выполнения [!INCLUDE[vsto_runtime](../vsto/includes/vsto-runtime-md.md)] сериализует объект в XML\-строку, которая сохраняется в *пользовательской части XML* документа.  Дополнительные сведения см. в разделе [Общие сведения о пользовательских XML-частях](../vsto/custom-xml-parts-overview.md).  
  
## Ограничения на размер кэшированных данных  
 Существуют некоторые ограничения общего объема данных, который можно добавить в кэш данных документа, а также размера каждого отдельного объекта в кэше данных.  Если превысить эти ограничения, приложение может неожиданно закрыться во время сохранения данных в кэш.  
  
 Чтобы избежать превышения этих ограничений, следуйте приведенным ниже правилам.  
  
-   Не добавляйте в кэш данных объект, превышающий 10 МБ.  
  
-   Не добавляйте более 100 МБ данных в кэш данных отдельного документа.  
  
 Это приблизительные значения.  Точные ограничения зависят от нескольких факторов, включая доступный объем ОЗУ и количество выполняемых процессов.  
  
## Управление поведением кэшированных объектов  
 Для получения более широких возможностей управления поведением кэшированных объектов можно реализовать интерфейс <xref:Microsoft.VisualStudio.Tools.Applications.Runtime.ICachedType> в типе кэшированного объекта.  Например, можно реализовать этот интерфейс, если необходимо контролировать способ уведомления пользователя при изменении объектов.  Примеры кода, в которых показано, как реализовать тип <xref:Microsoft.VisualStudio.Tools.Applications.Runtime.ICachedType>, см. в примере динамических элементов управления Word и в примере динамических элементов управления Excel класса `ControlCollection` в разделе [Образцы и пошаговые руководства разработки Office](../vsto/office-development-samples-and-walkthroughs.md).  
  
## Сохранение изменений в кэшированных данных в защищенных паролем документах  
 Если объекты данных кэшируются в документе, защищенном паролем, изменения, вносимые в кэшированные данные, не сохраняются.  Можно сохранить изменения в кэшированные данные путем переопределения двух методов.  Переопределите эти методы для временного удаления защиты при сохранении документа и примените защиту снова после сохранения.  
  
 Дополнительные сведения см. в разделе [Практическое руководство. Кэширование данных в документе, защищенном паролем](../vsto/how-to-cache-data-in-a-password-protected-document.md).  
  
## Предотвращение потери данных при добавлении нулевых значений в кэш данных  
 При добавлении объектов в кэш данных все кэшированные объекты должны быть инициализированы со значением **null** до сохранения и закрытия документа.  Если какой\-либо кэшированный объект имеет значение **null** при закрытии и сохранении документа, [!INCLUDE[vsto_runtime](../vsto/includes/vsto-runtime-md.md)] автоматически удалит из кэша данных все объекты.  
  
 Если к кэшу данных с помощью атрибута <xref:Microsoft.VisualStudio.Tools.Applications.Runtime.CachedAttribute> во время разработки добавлен объект со значением **null**, можно воспользоваться классом <xref:Microsoft.VisualStudio.Tools.Applications.ServerDocument> для инициализации кэшированных объектов данных до открытия документа.  Это полезно, если необходимо инициализировать кэшированные данные на сервере без установленного Word или Excel до того, как документ открыт конечным пользователем.  Дополнительные сведения см. в разделе [Доступ к данным в документах на сервере](../vsto/accessing-data-in-documents-on-the-server.md).  
  
## См. также  
 [Практическое руководство. Кэширование данных для автономного использования или для использования на сервере](../vsto/how-to-cache-data-for-use-offline-or-on-a-server.md)   
 [Практическое руководство. Программное кэширование источника данных в документе MS Office.](../vsto/how-to-programmatically-cache-a-data-source-in-an-office-document.md)   
 [Практическое руководство. Кэширование данных в документе, защищенном паролем](../vsto/how-to-cache-data-in-a-password-protected-document.md)   
 [Пошаговое руководство. Создание иерархического отношения с помощью кэшированного набора данных](../vsto/walkthrough-creating-a-master-detail-relation-using-a-cached-dataset.md)  
  
  