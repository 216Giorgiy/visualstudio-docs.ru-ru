---
title: "Рекомендации по обеспечению безопасности для решений Office | Документы Microsoft"
ms.custom: 
ms.date: 02/02/2017
ms.reviewer: 
ms.suite: 
ms.technology: office-development
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- troubleshooting Office development in Visual Studio, security
- trusted code [Office development in Visual Studio]
- blocked code [Office development in Visual Studio]
- Outlook [Office development in Visual Studio], object model guard
- malicious code [Office development in Visual Studio]
- Outlook object model guard [Office development in Visual Studio]
- security [Office development in Visual Studio], troubleshooting
author: TerryGLee
ms.author: tglee
manager: ghogen
ms.workload: office
ms.openlocfilehash: f7f2e865ccb94a9996e13f7cf3c695784623fded
ms.sourcegitcommit: f9fbf1f55f9ac14e4e5c6ae58c30dc1800ca6cda
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/10/2018
---
# <a name="specific-security-considerations-for-office-solutions"></a>Рекомендации по обеспечению безопасности для решений Office
  Средства безопасности, предоставляемые Microsoft .NET Framework и Microsoft Office, помогают защитить решения Office от различных угроз безопасности. В этом разделе описываются некоторые из этих угроз и даются рекомендации по защите от них. Здесь также приводятся сведения о влиянии параметров безопасности Microsoft Office на решения Office.  
  
 [!INCLUDE[appliesto_all](../vsto/includes/appliesto-all-md.md)]  
  
## <a name="trusted-code-is-repurposed-in-a-new-malicious-document"></a>Доверенный код переориентируется на новый, вредоносный документ  
 Злоумышленник может получить доверенный код, предназначенный для одной конкретной цели, например для загрузки личных сведений в заявление о приеме на работу, и использовать его в другом документе, например в учетной ведомости. Код не знает, что исходный документ не запущен, и может открыть доступ к другим процессам, таким как раскрытие личных сведений или выполнение кода с повышенными правами, при открытии другим пользователем. Кроме того, злоумышленник может просто изменить данные в листе таким образом, что при отправке жертве он ведет себя неожиданно. Изменяя значения, формулы или характеристики представления листа, связанного с кодом, злоумышленник может атаковать другого пользователя путем отправки измененного файла. Также возможно получение пользователями доступа к сведениям, которые они не должны видеть, в результате изменений значений в листе.  
  
 Поскольку расположение сборки и расположение документа должны иметь достаточные основания для выполнения, такую атаку непросто осуществить. Например, документы во вложениях электронной почты или на ненадежных серверах интрасети не имеют достаточных разрешений на выполнение.  
  
 Чтобы такая атака была возможна, сам код должен быть написан таким образом, чтобы он мог принимать решения на основе потенциально ненадежных данных. Примером является создания листа со скрытой ячейкой, содержащей имя сервера базы данных. Пользователь преобразует лист в ASPX-страницу, которая пытается подключиться к серверу с помощью проверки подлинности SQL и жестко заданного пароля SA. Злоумышленник может заменить содержимое скрытой ячейки именем другого компьютера и получить пароль SA. Чтобы избежать этой проблемы, не следует жестко кодировать пароли; кроме того, перед получением доступа к серверу следует всегда проверять идентификаторы серверов по внутреннему списку серверов, которые заведомо правильные.  
  
### <a name="recommendations"></a>Рекомендации  
  
-   Всегда проверяйте ввод и данные, поступили ли они от пользователя, документа, базы данных, веб-службы или любого другого источника.  
  
-   С осторожностью предоставляйте некоторые типы функциональности, такие как получение привилегированных данных от имени пользователя и помещение их на незащищенные листы.  
  
-   В зависимости от типа приложения может быть целесообразно удостоверяться, что исходный документ запущен, до выполнения любого кода. Например, проверяйте, выполняется ли код из документа, хранящегося в известном, безопасном расположении.  
  
-   Может быть полезно отображать предупреждение при открытии документа, если приложение выполняет какие-либо привилегированные действия. Например, можно создать экран-заставку или окно запуска, сообщающее, что приложение получит доступ к личным сведениям, и пользователь должен будет выбрать продолжение или отмену. Если конечный пользователь получит такое предупреждение из кажущегося безобидным документа, он сможет выйти из приложения, прежде чем что-либо будет повреждено.  
  
## <a name="code-is-blocked-by-the-outlook-object-model-guard"></a>Код, блокируемый системой безопасности объектной модели Outlook  
 Microsoft Office может запретить коду использовать определенные свойства, методы и объекты в объектной модели. Ограничивая доступ к этим объектам, Outlook помогает предотвратить злонамеренное использование объектной модели вирусами и червями электронной почты. Эта функция безопасности называется системой безопасности объектной модели Outlook. Если надстройка VSTO пытается использовать запрещенное свойство или метод при включенной системе безопасности объектной модели, Outlook отображает предупреждение системы безопасности, с помощью которого пользователь может остановить операцию или предоставить доступ к свойству или методу на ограниченный период времени. Если пользователь останавливает операцию, надстройки VSTO Outlook, созданные с помощью решений Office в Visual Studio, будут создавать исключение <xref:System.Runtime.InteropServices.COMException>.  
  
 Система безопасности объектной модели может по-разному влиять на надстройки VSTO, в зависимости от того, используется ли Outlook с Microsoft Exchange Server.  
  
-   Если Outlook не используется с Exchange, администратор может включать или отключать систему безопасности объектной модели для всех надстроек VSTO на компьютере.  
  
-   Если Outlook используется с Exchange, администратор может включать или отключать систему безопасности объектной модели для всех надстроек VSTO на компьютере, а также может указать, что определенные надстройки VSTO могут выполняться без задействования системы безопасности объектной модели. Администраторы также могут изменять поведение системы безопасности объектной модели в некоторых областях объектной модели. Например, администраторы могут автоматически разрешать надстройкам VSTO отправку электронной почты программными средствами, даже если система безопасности объектной модели включена.  
  
 Начиная с Outlook 2007 поведение объектной модели было изменено, чтобы улучшить взаимодействие с пользователем и разработчиком, продолжая поддерживать безопасность Outlook. Дополнительные сведения см. в разделе [Изменения в области безопасности кода в Outlook 2007](http://go.microsoft.com/fwlink/?LinkId=73429).  
  
### <a name="minimizing-object-model-guard-warnings"></a>Минимизация предупреждений системы безопасности объектной модели  
 Чтобы избежать излишних предупреждений системы безопасности при использовании ограниченных свойств и методов, убедитесь, что ваша надстройка VSTO получает объекты Outlook из поля `Application` класса `ThisAddIn` в проекте. Дополнительные сведения об этом поле см. в разделе [Programming VSTO Add-Ins](../vsto/programming-vsto-add-ins.md).  
  
 Система безопасности объектной модели считает надежными только объекты Outlook, полученные из этого объекта. В отличие от этого объекты, полученные в результате новый объект Microsoft.Office.Interop.Outlook.Application не являются доверенными, и Ограниченные свойства и методы будут вызывать предупреждения безопасности, если система безопасности объектной модели включена.  
  
 Следующий пример кода отображает предупреждение системы безопасности, если система безопасности объектной модели включена. Свойство To Microsoft.Office.Interop.Outlook.MailItem класса ограничен объектной модели. Объект Microsoft.Office.Interop.Outlook.MailItem является доверенным, поскольку код получает его из Microsoft.Office.Interop.Outlook.Application, созданного с помощью **новый** оператор, вместо получения его из `Application` поля.  
  
 [!code-csharp[Trin_VstcoreOutlookSecurity#1](../vsto/codesnippet/CSharp/Trin_VstcoreOutlookSecurity/ThisAddIn.cs#1)]
 [!code-vb[Trin_VstcoreOutlookSecurity#1](../vsto/codesnippet/VisualBasic/Trin_VstcoreOutlookSecurity/ThisAddIn.vb#1)]  
  
 В следующем примере кода демонстрируется использование ограниченного свойству объекта Microsoft.Office.Interop.Outlook.MailItem, который является доверенным для объектной модели. Код использует доверенное `Application` поля Microsoft.Office.Interop.Outlook.MailItem.  
  
 [!code-csharp[Trin_VstcoreOutlookSecurity#2](../vsto/codesnippet/CSharp/Trin_VstcoreOutlookSecurity/ThisAddIn.cs#2)]
 [!code-vb[Trin_VstcoreOutlookSecurity#2](../vsto/codesnippet/VisualBasic/Trin_VstcoreOutlookSecurity/ThisAddIn.vb#2)]  
  
> [!NOTE]  
>  Если Outlook используется с Exchange, получение всех объектов Outlook из `ThisAddIn.Application` не гарантирует, что надстройка VSTO будет иметь доступ ко всей объектной модели Outlook. Например если администратор Exchange установил в Outlook автоматический запрет на все попытки для доступа к адресной информации при помощи объектной модели Outlook, то Outlook не разрешит доступ к свойству в предыдущем примере, несмотря на то, что в примере кода используется доверенное `ThisAddIn.Application` поля.  
  
### <a name="specifying-which-add-ins-to-trust-when-using-exchange"></a>Указание доверенных надстроек при использовании Exchange  
 При использовании Outlook с Exchange администраторы могут указать, что определенные надстройки VSTO могут выполняться без участия системы безопасности объектной модели. Надстройки VSTO Outlook, созданные с помощью решений Office в Visual Studio, не могут быть доверенными по отдельности; они могут быть доверенными только как группа.  
  
 Outlook доверяет надстройке VSTO на основе хэш-кода DLL точки входа этой надстройки VSTO. Все надстройки VSTO Outlook, указывающие [!INCLUDE[vsto_runtime](../vsto/includes/vsto-runtime-md.md)] , используют одну и ту же DLL точки входа (VSTOLoader.dll). Это означает, что если администратор доверяет какой-либо надстройке VSTO, указывающей [!INCLUDE[vsto_runtime](../vsto/includes/vsto-runtime-md.md)] , запускаться без системы безопасности объектной модели, то все другие надстройки VSTO, указывающие [!INCLUDE[vsto_runtime](../vsto/includes/vsto-runtime-md.md)] , также являются доверенными. Дополнительные сведения об указании конкретных доверенных надстроек VSTO, которым разрешается выполняться без системы безопасности объектной модели, см. в разделе [Выбор метода, используемого Outlook для управления функциями антивирусной защиты](http://go.microsoft.com/fwlink/?LinkId=128773).  
  
## <a name="permission-changes-do-not-take-effect-immediately"></a>Изменения разрешений не вступают в силу немедленно.  
 Если администратор настраивает разрешения для документа или сборки, пользователи должны закрыть и перезапустить все приложения Office, чтобы изменения вступили в силу.  
  
 Кроме того, применение новых разрешений могут запрещать другие приложения, размещающие приложения Microsoft Office. При изменении политик безопасности пользователи должны выйти из всех приложений, использующих Office, как размещенных, так и автономных.  
  
## <a name="trust-center-settings-in-the-microsoft-office-system-do-not-affect-add-ins-or-document-level-customizations"></a>Параметры центра управления безопасностью в системе Microsoft Office не влияют на надстройки и на настройки уровня документа  
 Пользователи могут запретить загрузку надстроек VSTO, установив соответствующий параметр в **центре управления безопасностью**. Тем не менее эти параметры доверия не влияют на надстройки VSTO и настройки уровня документа, созданные с помощью решений Office в Visual Studio.  
  
 Если пользователь запрещает загрузку настройки VSTO с помощью **центра управления безопасностью**, не будут загружаться следующие типы надстроек VSTO:  
  
-   управляемые и неуправляемые надстройки VSTO модели COM;  
  
-   управляемые и неуправляемые смарт-документы;  
  
-   управляемые и неуправляемые надстройки VSTO автоматизации;  
  
-   управляемые и неуправляемые компоненты данных в режиме реального времени.  
  
 Следующие процедуры показывают, каким образом пользователи могут использовать **центр управления безопасностью** для ограничения загрузки надстроек VSTO в Microsoft [!INCLUDE[Office_15_short](../vsto/includes/office-15-short-md.md)] и Microsoft Office 2010. Эти процедуры не влияют на надстройки VSTO и настройки, созданные с помощью средств разработки Office в Visual Studio.  
  
#### <a name="to-disable-vsto-add-ins-in-microsoft-office-2010-and-microsoft-includeoffice15shortvstoincludesoffice-15-short-mdmd-applications"></a>Отключение надстроек VSTO в приложениях Microsoft Office 2010 и Microsoft [!INCLUDE[Office_15_short](../vsto/includes/office-15-short-md.md)]  
  
1.  Перейдите на вкладку **Файл** .  
  
2.  Нажмите кнопку *Параметры* **имя_приложения** .  
  
3.  В области категорий нажмите **Центр управления безопасностью**.  
  
4.  В области сведений нажмите **Параметры центра управления безопасностью**.  
  
5.  В области категорий нажмите **Надстройки**.  
  
6.  В области сведений установите флажок **Все надстройки приложений должны быть подписаны надежными издателями** или **Отключить все надстройки приложений**.  
  
## <a name="see-also"></a>См. также  
 [Обеспечение безопасности решений Office](../vsto/securing-office-solutions.md)  
  
  