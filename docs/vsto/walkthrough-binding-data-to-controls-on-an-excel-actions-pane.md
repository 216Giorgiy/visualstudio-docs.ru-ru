---
title: "Пошаговое руководство. Привязка данных к элементам управления в панели действий Excel | Microsoft Docs"
ms.custom: ""
ms.date: "02/02/2017"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "office-development"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
helpviewer_keywords: 
  - "панели действий [разработка решений Office в Visual Studio], привязка элементов управления"
  - "панели действий [разработка решений Office в Visual Studio], привязка данных"
  - "элементы управления [разработка решений Office в Visual Studio], привязка данных"
  - "привязка данных [разработка решений Office в Visual Studio], панели действий"
  - "привязка данных [разработка решений Office в Visual Studio], смарт-документы"
  - "смарт-документы [разработка решений Office в Visual Studio], привязка данных"
ms.assetid: 106c07bd-e931-4dc5-94dc-ca43900fe09d
caps.latest.revision: 63
author: "kempb"
ms.author: "kempb"
manager: "ghogen"
caps.handback.revision: 62
---
# Пошаговое руководство. Привязка данных к элементам управления в панели действий Excel
  В этом пошаговом руководстве демонстрируется привязка данных к элементам управления в панели действий Microsoft Office Excel.  Эти элементы управления отражают отношение "общее\/подробное" между таблицами в базе данных SQL Server.  
  
 [!INCLUDE[appliesto_xlalldoc](../vsto/includes/appliesto-xlalldoc-md.md)]  
  
 В данном пошаговом руководстве рассмотрены следующие задачи:  
  
-   Добавление элементов управления на лист.  
  
-   Создание элемента управления панели действий.  
  
-   Добавление привязанных к данным элементов управления Windows Forms в элемент управления панели действий.  
  
-   Отображение панели действий при открытии приложения.  
  
> [!NOTE]  
>  Отображаемые на компьютере имена или расположения некоторых элементов пользовательского интерфейса Visual Studio могут отличаться от указанных в следующих инструкциях.  Эти элементы определяются используемым выпуском Visual Studio и его параметрами.  Дополнительные сведения см. в разделе [Customizing Development Settings in Visual Studio](http://msdn.microsoft.com/ru-ru/22c4debb-4e31-47a8-8f19-16f328d7dcd3).  
  
## Обязательные компоненты  
 Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.  
  
-   [!INCLUDE[vsto_vsprereq](../vsto/includes/vsto-vsprereq-md.md)]  
  
-   [!INCLUDE[Excel_15_short](../vsto/includes/excel-15-short-md.md)] или [!INCLUDE[Excel_14_short](../vsto/includes/excel-14-short-md.md)].  
  
-   Доступ к серверу с примером базы данных "Northwind" SQL Server.  
  
-   Разрешения на чтение из базы данных SQL Server и запись в нее.  
  
## Создание проекта  
 На первом этапе необходимо создать проект книги Excel.  
  
#### Создание нового проекта  
  
1.  Создайте проект книги Excel с именем Моя панель действий Excel.  Выберите в мастере **Создать новый документ**.  Дополнительные сведения см. в разделе [Практическое руководство. Создание проектов Office в Visual Studio](../vsto/how-to-create-office-projects-in-visual-studio.md).  
  
     Созданная книга Excel открывается в конструкторе Visual Studio. Проект **Моя панель действий Excel** добавляется в **Обозреватель решений**.  
  
## Добавление в проект нового источника данных  
  
#### Добавление в проект нового источника данных  
  
1.  Если окно **Источники данных** не отображается, его отображение в строке меню, выбирая **Вид**, **Другие окна**, **Источники данных**.  
  
2.  Выберите **Добавить новый источник данных**, чтобы запустить **Мастер настройки источника данных**.  
  
3.  Выберите **База данных** и нажмите **Далее**.  
  
4.  Выберите подключение к базе данных SQL Server "Northwind" или добавьте новое подключение с помощью кнопки **Новое подключение**.  
  
5.  Нажмите кнопку **Далее**.  
  
6.  Чтобы сохранить подключение, снимите флажок, если он установлен, и нажмите **Далее**.  
  
7.  В окне **Объекты базы данных** разверните узел **Таблицы**.  
  
8.  Установите флажок рядом с таблицей **Поставщики**.  
  
9. Раскройте таблицу **Продукты** и выберите **ProductName**, **SupplierID**, **QuantityPerUnit** и **UnitPrice**.  
  
10. Нажмите кнопку **Готово**.  
  
 Мастер добавит таблицы **Поставщики** и **Продукты** в окно **Источники данных**.  Также к проекту добавляется типизированный набор данных, который отображается в **Обозревателе решений**.  
  
## Добавление элементов управления на лист  
 Затем добавьте к первому листу элементы управления <xref:Microsoft.Office.Tools.Excel.NamedRange> и <xref:Microsoft.Office.Tools.Excel.ListObject>.  
  
#### Добавление на лист элемента управления NamedRange и ListObject  
  
1.  Убедитесь, что книга **Мои действия Pane.xlsx Excel** открыта в конструкторе Visual Studio, и `Sheet1`.  
  
2.  Разверните таблицу **Поставщики** в окне **Источники данных**.  
  
3.  Щелкните стрелку вниз на узле **Название компании** и выберите пункт **NamedRange**.  
  
4.  Перетащите узел **Имя компании** из окна **Источников данных** в ячейку **A2** на листе `Sheet1`.  
  
     Создается элемент управления <xref:Microsoft.Office.Tools.Excel.NamedRange> с именем `CompanyNameNamedRange` и в ячейке **A2** появляется текст \<CompanyName\>.  Одновременно в проект добавляются элемент управления <xref:System.Windows.Forms.BindingSource> с именем `suppliersBindingSource`, адаптер таблиц и экземпляр класса <xref:System.Data.DataSet>.  Элемент управления связан с объектом <xref:System.Windows.Forms.BindingSource>, который в свою очередь связан с экземпляром <xref:System.Data.DataSet>.  
  
5.  В окне **Источники данных** перейдите к столбцам под таблицей **Поставщики**.  В нижней части списка располагается таблица **Продукты**, которая является дочерней по отношению к таблице **Поставщики**.  Выберите дочернюю таблицу **Продукты** \(не расположенную на одном уровне с таблицей **Поставщики**\) и щелкните появившуюся стрелку раскрывающегося списка.  
  
6.  Выберите в раскрывающемся списке элемент управления **ListObject** и перетащите таблицу **Продукты** в ячейку **A6** листа `Sheet1`.  
  
     В ячейке **А6** будет создан элемент управления <xref:Microsoft.Office.Tools.Excel.ListObject> с именем `ProductNameListObject`.  Одновременно в проект добавляется элемент управления <xref:System.Windows.Forms.BindingSource> с именем `productsBindingSource` и адаптер таблиц.  Элемент управления связан с объектом <xref:System.Windows.Forms.BindingSource>, который в свою очередь связан с экземпляром <xref:System.Data.DataSet>.  
  
7.  Только для C\#. Выберите **suppliersBindingSource** в области компонентов и измените значение свойства **Modifiers** на Internal в окне **Свойства**.  
  
## Добавление элементов управления на панель действий  
 После этого требуется элемент управления панели действий, содержащий поле со списком.  
  
#### Добавление элемента управления панели действий  
  
1.  Выберите проект **Моя панель действий Excel** в **Обозревателе решений**.  
  
2.  В меню **Проект** выберите команду **Добавить новый элемент**.  
  
3.  В диалоговом окне **Добавление нового элемента** выберите **Элемент управления панели действий**, дайте файлу имя **ActionsControl** и нажмите кнопку **Добавить**.  
  
#### Добавление привязанных к данным элементов управления Windows Forms в элемент управления панели действий  
  
1.  Перетащите со вкладки **Стандартные элементы управления** в **панели элементов** элемент управления <xref:System.Windows.Forms.ComboBox> на элемент управления панели действий.  
  
2.  Измените значение свойства **Size** на 171, 21.  
  
3.  Измените размер пользовательского элемента управления в соответствии с размерами поля со списком.  
  
## Привязка элемента управления панели действий к данным  
 В этом разделе источник данных элемента управления <xref:System.Windows.Forms.ComboBox> задается таким же, как у элемента управления <xref:Microsoft.Office.Tools.Excel.NamedRange> на листе.  
  
#### Установка свойств привязки данных элемента управления  
  
1.  Щелкните файл правой кнопкой мыши элемент управления панели действий и выберите команду **Просмотреть код**.  
  
2.  Добавьте следующий код в событие <xref:System.Windows.Forms.UserControl.Load> элемента управления панели действий.  
  
     [!code-csharp[Trin_VstcoreActionsPaneExcel#1](../snippets/csharp/VS_Snippets_OfficeSP/Trin_VstcoreActionsPaneExcel/CS/ActionsControl.cs#1)]
     [!code-vb[Trin_VstcoreActionsPaneExcel#1](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_VstcoreActionsPaneExcel/VB/ActionsControl.vb#1)]  
  
3.  В C\# следует создать обработчик событий для события `ActionsControl`.  Можно заменить этот код в конструкторе `ActionsControl`.  Сведения о создании обработчиков событий см. в разделе [Практическое руководство. Создание обработчиков событий в проектах Office](../vsto/how-to-create-event-handlers-in-office-projects.md).  
  
     [!code-csharp[Trin_VstcoreActionsPaneExcel#2](../snippets/csharp/VS_Snippets_OfficeSP/Trin_VstcoreActionsPaneExcel/CS/ActionsControl.cs#2)]  
  
## Отображение панели действий  
 Панель действий не видима, пока элемент управления не будет добавлен во время выполнения.  
  
#### Отображение панели действий  
  
1.  В **Обозревателе решений** щелкните правой клавишей мыши файл ThisWorkbook.cs или ThisWorkbook.vb, а затем выберите команду **Просмотреть код**.  
  
2.  Создайте новый экземпляр пользовательского элемента управления в классе `ThisWorkbook`.  
  
     [!code-csharp[Trin_VstcoreActionsPaneExcel#3](../snippets/csharp/VS_Snippets_OfficeSP/Trin_VstcoreActionsPaneExcel/CS/ThisWorkbook.cs#3)]
     [!code-vb[Trin_VstcoreActionsPaneExcel#3](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_VstcoreActionsPaneExcel/VB/ThisWorkbook.vb#3)]  
  
3.  В обработчик <xref:Microsoft.Office.Tools.Excel.Workbook.Startup> событий `ThisWorkbook` добавьте элемент управления в панель действий.  
  
     [!code-csharp[Trin_VstcoreActionsPaneExcel#4](../snippets/csharp/VS_Snippets_OfficeSP/Trin_VstcoreActionsPaneExcel/CS/ThisWorkbook.cs#4)]
     [!code-vb[Trin_VstcoreActionsPaneExcel#4](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_VstcoreActionsPaneExcel/VB/ThisWorkbook.vb#4)]  
  
## Тестирование приложения  
 Теперь можно протестировать документ, чтобы проверить, что при его открытии открывается панель действий и что у элементов управления есть отношение "основной\/подробности".  
  
#### Проверка документа  
  
1.  Нажмите клавишу F5 для запуска проекта.  
  
2.  Убедитесь, что панель действий отображается.  
  
3.  Выберите компанию из списка.  Убедитесь, что сведения о компании перечислены в элементе управления <xref:Microsoft.Office.Tools.Excel.NamedRange> и что описание продукта перечислены в элементе управления <xref:Microsoft.Office.Tools.Excel.ListObject>.  
  
4.  Выберите разные компании, чтобы убедиться, что имя компании и описание продукта изменяются соответствующим образом.  
  
## Следующие действия  
 Далее будут рассмотрены следующие задачи:  
  
-   Привязка данных к элементам управления в Word.  Дополнительные сведения см. в разделе [Пошаговое руководство. Привязка данных к элементам управления в панели действий Word](../vsto/walkthrough-binding-data-to-controls-on-a-word-actions-pane.md).  
  
-   Развертывание проекта.  Дополнительные сведения см. в разделе [Развертывание решения Office с помощью ClickOnce](../vsto/deploying-an-office-solution-by-using-clickonce.md).  
  
## См. также  
 [Общие сведения о панели действий](../vsto/actions-pane-overview.md)   
 [Практическое руководство. Управление структурой элементов управления в панели действий](../vsto/how-to-manage-control-layout-on-actions-panes.md)   
 [Привязка данных к элементам управления в решениях Office](../vsto/binding-data-to-controls-in-office-solutions.md)  
  
  