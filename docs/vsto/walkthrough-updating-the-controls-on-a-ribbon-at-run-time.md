---
title: "Пошаговое руководство. Обновление элементов управления на ленте во время выполнения"
ms.custom: ""
ms.date: "02/02/2017"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "office-development"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
helpviewer_keywords: 
  - "элементы управления [разработка решений Office в Visual Studio], лента"
  - "динамические меню [разработка решений Office в Visual Studio]"
  - "лента [разработка решений Office в Visual Studio], элементы управления"
  - "лента [разработка решений Office в Visual Studio], динамическое меню"
  - "лента [разработка решений Office в Visual Studio], обновление"
  - "обновление элементов управления ленты"
ms.assetid: ed80790f-3f95-47e4-8a41-872588a8ca07
caps.latest.revision: 51
author: "kempb"
ms.author: "kempb"
manager: "ghogen"
caps.handback.revision: 50
---
# Пошаговое руководство. Обновление элементов управления на ленте во время выполнения
  В этом пошаговом руководстве показано, как использовать объектную модель ленты для обновления элементов управления на ленте после загрузки ленты в приложение Office.  
  
 [!INCLUDE[appliesto_ribbon](../vsto/includes/appliesto-ribbon-md.md)]  
  
 В данном примере данные извлекаются из примера базы данных Northwind \(Борей\) для заполнения поля со списком и меню в Microsoft Office Outlook.  Элементы, выбираемые в этих элементах управления, автоматически подставляются в поля, например **Кому** и **Тема**, в сообщении электронной почты.  
  
 В данном пошаговом руководстве рассмотрены следующие задачи:  
  
-   Создание нового проекта надстройки Outlook VSTO  
  
-   Разработка пользовательской группы ленты  
  
-   Добавление пользовательской группы на встроенную вкладку  
  
-   Обновление элементов управления на ленте во время выполнения  
  
> [!NOTE]  
>  Отображаемые на компьютере имена или расположения некоторых элементов пользовательского интерфейса Visual Studio могут отличаться от указанных в следующих инструкциях.  Это зависит от имеющегося выпуска Visual Studio и используемых параметров.  Дополнительные сведения см. в разделе [Customizing Development Settings in Visual Studio](http://msdn.microsoft.com/ru-ru/22c4debb-4e31-47a8-8f19-16f328d7dcd3).  
  
## Обязательные компоненты  
 Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.  
  
-   [!INCLUDE[vsto_vsprereq](../vsto/includes/vsto-vsprereq-md.md)]  
  
-   Microsoft Outlook  
  
## Создание нового проекта надстройки Outlook VSTO  
 Сначала создайте проект надстройки Outlook VSTO.  
  
#### Порядок создания нового проекта надстройки Outlook VSTO  
  
1.  В [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] создайте проект надстройки Outlook VSTO с именем Ribbon\_Update\_At\_Runtime.  
  
2.  В диалоговом окне **Создание проекта** выберите **Создать каталог для решения**.  
  
3.  Сохраните проект в каталоге проекта по умолчанию.  
  
     Дополнительные сведения см. в статье [Практическое руководство. Создание проектов Office в Visual Studio](../vsto/how-to-create-office-projects-in-visual-studio.md).  
  
## Разработка пользовательской группы ленты  
 Лента для этого примера будет отображаться при составлении пользователем нового сообщения электронной почты.  Чтобы создать пользовательскую группу для ленты, сначала добавьте элемент ленты в свой проект, а затем создайте группу в конструкторе лент.  Эта пользовательская группа позволит создавать последующие сообщения электронной почты для пользователей путем подстановки имен и журналов заказов из базы данных.  
  
#### Порядок создания пользовательской группы  
  
1.  В меню **Проект** выберите пункт **Добавить новый элемент**.  
  
2.  В диалоговом окне **Добавление нового элемента** выберите элемент **Лента \(визуальный конструктор\)**.  
  
3.  Измените имя новой ленты на **CustomerRibbon**, а затем нажмите кнопку **Добавить**.  
  
     В конструкторе лент открывается файл **CustomerRibbon.cs** или **CustomerRibbon.vb**, а также отображается вкладка и группа, используемые по умолчанию.  
  
4.  Щелкните конструктор лент, чтобы выбрать его.  
  
5.  В окне **Свойства** щелкните стрелку раскрывающегося списка рядом со свойством **RibbonType**, а затем щелкните **Microsoft.Outlook.Mail.Compose**.  
  
     Это обеспечивает отображение ленты, когда пользователь создает новое сообщение электронной почты в Outlook.  
  
6.  В конструкторе лент щелкните группу **Group1**, чтобы выбрать ее.  
  
7.  В окне **Свойства** в поле **Метка** установите значение «Покупки клиента».  
  
8.  На вкладке **Элементы управления ленты Office** в окне **Панель элементов** перетащите **ComboBox** в группу **Покупки клиента**.  
  
9. Щелкните элемент **ComboBox1**, чтобы выбрать его.  
  
10. В окне **Свойства** в поле **Метка** установите значение «Клиенты».  
  
11. На вкладке **Элементы управления ленты Office** в окне **Панель элементов** перетащите **Меню** в группу **Покупки клиента**.  
  
12. В окне **Свойства** в поле **Метка** установите значение «Приобретенный продукт».  
  
13. В поле **Динамический** установите значение **true**.  
  
     Это позволит добавлять и удалять элементы управления в меню во время выполнения после загрузки ленты в приложение Office.  
  
## Добавление пользовательской группы на встроенную вкладку  
 Встроенная вкладка — это вкладка, которая уже имеется на ленте проводника или инспектора Outlook.  В этой процедуре вы сможете добавить пользовательскую группу на встроенную вкладку, а затем указать положение этой группы на вкладке.  
  
#### Порядок добавления пользовательской группы на встроенную вкладку  
  
1.  Перейдите на вкладку **TabAddins \(встроенная\)**.  
  
2.  В окне **Свойства** разверните свойство **ControlId**, а затем установите для **OfficeId** значение TabNewMailMessage.  
  
     При этом группа **Покупки клиента** будет добавлена на вкладку **Сообщения** ленты, которая появляется в новом сообщении электронной почты.  
  
3.  Щелкните группу **Покупки клиента**, чтобы выбрать ее.  
  
4.  В окне **Свойства** разверните свойство **Положение**, щелкните стрелку раскрывающегося списка рядом со свойством **Меню**, а затем щелкните **BeforeOfficeId**.  
  
5.  Для свойства **OfficeId** установите значение GroupClipboard.  
  
     При этом группа **Покупки клиента** окажется перед группой **Буфер обмена** на вкладке **Сообщения**.  
  
## Создание источника данных  
 С помощью окна **Источники данных** добавьте типизированный набор данных в свой проект.  
  
#### Создание источника данных  
  
1.  В меню **Данные** выберите команду **Добавить новый источник данных**.  
  
     Запускается **Мастер настройки источника данных**.  
  
2.  Выберите **База данных**, а затем нажмите кнопку **Далее**.  
  
3.  Выберите **Набор данных**, а затем нажмите кнопку **Далее**.  
  
4.  Выберите подключение к базе данных Microsoft SQL Server Compact 4.0 \(пример Northwind\) или добавьте новое подключение с помощью кнопки **Новое подключение**.  
  
5.  После выбора или создания подключения нажмите кнопку **Далее**.  
  
6.  Нажмите кнопку **Далее**, чтобы сохранить строку подключения.  
  
7.  На странице **Выбор объектов базы данных** разверните узел **Таблицы**.  
  
8.  Установите флажок рядом с каждой из следующих таблиц.  
  
    1.  **Заказчики**  
  
    2.  **Сведения о заказе**  
  
    3.  **Заказы**  
  
    4.  **Продукты**  
  
9. Нажмите кнопку **Готово**.  
  
## Обновление элементов управления в пользовательской группе во время выполнения  
 Используйте объектную модель ленты для выполнения следующих задач.  
  
-   Добавление имен клиентов в поле со списком **Клиенты**.  
  
-   Добавление в меню **Приобретенные продукты** элементов управления меню и кнопок, которые представляют заказы на продажу и проданные продукты.  
  
-   Заполните поля To, Subject и Body новых почтовых сообщений с помощью данных из поля со списком **Клиенты** и меню **Приобретенные продукты**.  
  
#### Порядок обновления элементов управления в пользовательской группе с помощью объектной модели ленты  
  
1.  В меню **Проект** щелкните команду **Добавить ссылку**.  
  
2.  В диалоговом окне **Добавление ссылки** перейдите на вкладку **.NET**, выберите сборку **System.Data.Linq**, а затем нажмите кнопку **ОК**.  
  
     Эта сборка содержит классы для использования запросов LINQ \(Language\-Integrated Queries\).  Запросы LINQ будут использоваться для заполнения элементов управления в пользовательской группе данными из базы данных Northwind.  
  
3.  В **обозревателе решений** щелкните файл **CustomerRibbon.cs** или **CustomerRibbon.vb**, чтобы выбрать его.  
  
4.  В меню **Представление** выберите пункт **Код**.  
  
     Файл кода ленты открывается в редакторе кода.  
  
5.  Добавьте следующие операторы в начало файла кода ленты.  Эти операторы обеспечивают легкий доступ к пространствам имен LINQ и к пространству имен основной сборки взаимодействия Outlook.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#1](../snippets/csharp/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/CS/CustomerRibbon.cs#1)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#1](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/VB/CustomerRibbon.vb#1)]  
  
6.  Добавьте следующий код в класс CustomerRibbon.  Этот код объявляет таблицу данных и адаптеры таблиц, которые будут использоваться для хранения информации из таблиц «Заказчики», «Заказы», «Сведения о заказе» и «Продукт» базы данных Northwind.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#2](../snippets/csharp/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/CS/CustomerRibbon.cs#2)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#2](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/VB/CustomerRibbon.vb#2)]  
  
7.  Добавьте следующий блок кода в класс `CustomerRibbon`.  Этот код добавляет три вспомогательных метода, создающих элементы управления на ленте во время выполнения.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#3](../snippets/csharp/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/CS/CustomerRibbon.cs#3)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#3](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/VB/CustomerRibbon.vb#3)]  
  
8.  Замените обработчик событий `CustomerRibbon_Load` следующим кодом.  Этот код использует запрос LINQ для выполнения следующих задач.  
  
    -   Заполнение поля со списком **Заказчики** с помощью идентификатора и имени 20 заказчиков в базе данных Northwind.  
  
    -   Вызов вспомогательного метода `PopulateSalesOrderInfo`.  Этот метод обновляет меню **ProductsPurchased** номерами заказов на продажу, которые относятся к выбранному заказчику.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#4](../snippets/csharp/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/CS/CustomerRibbon.cs#4)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#4](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/VB/CustomerRibbon.vb#4)]  
  
9. Добавьте следующий код в класс `CustomerRibbon`.  Этот код использует запросы LINQ для выполнения следующих задач.  
  
    -   Добавление подменю в меню **ProductsPurchased** для каждого заказа на продажу, относящегося к выбранному заказчику.  
  
    -   Добавление кнопок в каждое подменю для продуктов, относящихся к заказу на продажу.  
  
    -   Добавление обработчиков событий для каждой кнопки.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#6](../snippets/csharp/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/CS/CustomerRibbon.cs#6)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#6](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/VB/CustomerRibbon.vb#6)]  
  
10. В **обозревателе решений** дважды щелкните файл кода ленты.  
  
     Открывается конструктор лент.  
  
11. В конструкторе лент дважды щелкните поле со списком **Заказчики**.  
  
     В редакторе кода открывается файл кода ленты и появляется обработчик событий `ComboBox1_TextChanged`.  
  
12. Замените обработчик событий `ComboBox1_TextChanged` следующим кодом.  Этот код выполняет следующие задачи:  
  
    -   Вызов вспомогательного метода `PopulateSalesOrderInfo`.  Этот метод обновляет меню **Приобретенные продукты** заказами на продажу, которые относятся к выбранному заказчику.  
  
    -   Вызов вспомогательного метода `PopulateMailItem` и передача текущего текста, представляющего собой имя выбранного заказчика.  Этот метод заполняет поля To, Subject и Body новых почтовых сообщений.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#5](../snippets/csharp/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/CS/CustomerRibbon.cs#5)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#5](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/VB/CustomerRibbon.vb#5)]  
  
13. Добавьте следующий обработчик событий нажатия кнопки Click в класс `CustomerRibbon`.  Этот код добавляет имя выбранных продуктов в поле Body новых почтовых сообщений.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#8](../snippets/csharp/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/CS/CustomerRibbon.cs#8)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#8](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/VB/CustomerRibbon.vb#8)]  
  
14. Добавьте следующий код в класс `CustomerRibbon`.  Этот код выполняет следующие задачи:  
  
    -   Заполнение строки To новых почтовых сообщений с помощью адреса электронной почты текущего выбранного заказчика.  
  
    -   Добавление текста в поля Subject и Body новых почтовых сообщений.  
  
     [!code-csharp[Trin_Ribbon_Update_At_Runtime#7](../snippets/csharp/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/CS/CustomerRibbon.cs#7)]
     [!code-vb[Trin_Ribbon_Update_At_Runtime#7](../snippets/visualbasic/VS_Snippets_OfficeSP/Trin_Ribbon_Update_At_Runtime/VB/CustomerRibbon.vb#7)]  
  
## Тестирование элементов управления в пользовательской группе  
 При открытии новой почтовой формы в Outlook на вкладке **Сообщения** ленты появляется пользовательская группа с именем **Покупки заказчика**.  
  
 Чтобы создать дальнейшее сообщение электронной почты для заказчика, выберите заказчика, а затем приобретенные им продукты.  Элементы управления в группе **Покупки заказчика** обновляются во время выполнения данными из базы данных Northwind.  
  
#### Порядок тестирования элементов управления в пользовательской группе  
  
1.  Нажмите клавишу F5 для запуска проекта.  
  
     Запускается Outlook.  
  
2.  В Outlook в меню **Файл** выберите **Создать** и щелкните **Почтовое сообщение**.  
  
     Будут выполнены следующие действия.  
  
    -   Откроется новое окно инспектора сообщений электронной почты.  
  
    -   На вкладке **Сообщение** ленты появится группа **Покупки заказчика** перед группой **Буфер обмена**.  
  
    -   Поле со списком **Заказчики** в группе обновится именами заказчиков в базе данных Northwind.  
  
3.  На вкладке **Сообщение** ленты в группе **Покупки заказчика** выберите заказчика в поле со списком **Заказчики**.  
  
     Будут выполнены следующие действия.  
  
    -   Меню **Приобретенные продукты** обновится и будет показывать все заказы для выбранного заказчика.  
  
    -   Каждое подменю заказов на продажу обновится и будет показывать продукты, приобретенные в рамках данного заказа.  
  
    -   Адрес электронной почты выбранного заказчика будет добавлен в строку **Кому** сообщения электронной почты, а в поле темы и тело сообщения электронной почты будет подставлен текст.  
  
4.  Щелкните меню **Покупки продуктов**, выберите любой заказ на продажу и щелкните в нем продукт.  
  
     Имя продукта добавляется в тело сообщения электронной почты.  
  
## Следующие действия  
 Дополнительные сведения о настройке пользовательского интерфейса Office см. в следующих разделах:  
  
-   Добавление пользовательского интерфейса на основе контекста к настройкам уровня документа.  Дополнительные сведения см. в разделе [Общие сведения о панели действий](../vsto/actions-pane-overview.md).  
  
-   Расширение стандартной или пользовательской формы Microsoft Office Outlook.  Дополнительные сведения см. в разделе [Пошаговое руководство. Разработка области формы Outlook](../vsto/walkthrough-designing-an-outlook-form-region.md).  
  
-   Добавление настраиваемой области задач в Outlook.  Дополнительные сведения см. в разделе [Настраиваемые области задач](../vsto/custom-task-panes.md).  
  
## См. также  
 [Доступ к ленте во время выполнения](../vsto/accessing-the-ribbon-at-run-time.md)   
 [Обзор ленты](../vsto/ribbon-overview.md)   
 [Интегрированные в язык запросы \(LINQ\)](http://msdn.microsoft.com/library/a73c4aec-5d15-4e98-b962-1274021ea93d)   
 [Практическое руководство. Работа с настройкой ленты](../vsto/how-to-get-started-customizing-the-ribbon.md)   
 [Конструктор лент](../vsto/ribbon-designer.md)   
 [Пошаговое руководство. Создание настраиваемой вкладки с помощью конструктора лент](../vsto/walkthrough-creating-a-custom-tab-by-using-the-ribbon-designer.md)   
 [Общие сведения об объектной модели ленты](../vsto/ribbon-object-model-overview.md)   
 [Настройка ленты для Outlook](../vsto/customizing-a-ribbon-for-outlook.md)   
 [Практическое руководство. Изменение положения вкладки на ленте](../vsto/how-to-change-the-position-of-a-tab-on-the-ribbon.md)   
 [Практическое руководство. Настройка встроенной вкладки](../vsto/how-to-customize-a-built-in-tab.md)   
 [Практическое руководство. Добавление элементов управления в представление Backstage](../vsto/how-to-add-controls-to-the-backstage-view.md)   
 [Практическое руководство. Экспорт лент из конструктора лент в XML-ленты](../vsto/how-to-export-a-ribbon-from-the-ribbon-designer-to-ribbon-xml.md)   
 [Практическое руководство. Просмотр ошибок пользовательского интерфейса надстройки](../vsto/how-to-show-add-in-user-interface-errors.md)  
  
  