---
title: Сохранить данные в базе данных
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- datasets [Visual Basic], validating data
- data validation, datasets
- data [Visual Studio], saving
- row version
- updating datasets, constraints
- datasets [Visual Basic], about datasets
- datasets [Visual Basic], merging
- updates, constraints in datasets
- saving data, about saving data
- datasets [Visual Basic], constraints
- TableAdapters
ms.assetid: afe6cb8a-dc6a-428b-b07b-903ac02c890b
author: gewarren
ms.author: gewarren
manager: douge
ms.technology: vs-data-tools
ms.workload:
- data-storage
ms.openlocfilehash: 4116a06ff57ae6793c7f80abea2464767b33c3bf
ms.sourcegitcommit: 42ea834b446ac65c679fa1043f853bea5f1c9c95
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/19/2018
---
# <a name="save-data-back-to-the-database"></a>Сохранить данные в базе данных
Набор данных — в памяти данных. При изменении данных, рекомендуется сохранить эти изменения в базе данных. Одним из трех способов это сделать.

-   Путем вызова одного из методов обновления адаптера таблицы

-   Путем вызова одного из методов DBDirect адаптера таблицы

-   Путем вызова метода UpdateAll на TableAdapterManager, Visual Studio создает для вас, если набор данных содержит таблицы, связанные с другими таблицами в наборе данных

Привязка данных таблицы набора данных к элементам управления на странице формы Windows Forms или XAML, архитектура привязки данных выполняет всю работу.

Если вы знакомы с адаптеры таблиц TableAdapter, можно перейти непосредственно на один из следующих разделов:

|Раздел|Описание|
|-----------|-----------------|
|[Вставка новых записей в базу данных](../data-tools/insert-new-records-into-a-database.md)|Как выполнять обновления и вставки с помощью адаптеров таблиц или команд объектов|
|[Обновление данных с помощью адаптера таблицы](../data-tools/update-data-by-using-a-tableadapter.md)|Выполнить обновление с адаптеры таблиц TableAdapter|
|[Иерархическое обновление](../data-tools/hierarchical-update.md)|Выполнить обновление из набора данных с помощью двух или более связанных таблиц|
|[Обработка исключения параллельности](../data-tools/handle-a-concurrency-exception.md)|Как обрабатывать исключения, когда два пользователя пытаются изменить те же данные в базе данных в то же время|
|[Как: сохранение данных с помощью транзакции](../data-tools/save-data-by-using-a-transaction.md)|Сохранение данных в транзакцию с помощью пространства имен System.Transactions и объект TransactionScope|
|[Пошаговое руководство. Сохранение данных в транзакции](../data-tools/save-data-in-a-transaction.md)|Пошаговое руководство, которое создает приложение Windows Forms, чтобы продемонстрировать сохранение данных в базу данных внутри транзакции|
|[Сохранение данных в базе данных (несколько таблиц)](../data-tools/save-data-to-a-database-multiple-tables.md)|Изменение записей и сохранение изменений в нескольких таблицах в базе данных|
|[Сохранение данных из объекта в базе данных](../data-tools/save-data-from-an-object-to-a-database.md)|Способ передачи данных из объекта, который не в наборе данных в базе данных с помощью метода DbDirect адаптера таблицы|
|[Сохранение данных с помощью методов DBDirect адаптера таблицы](../data-tools/save-data-with-the-tableadapter-dbdirect-methods.md)|Использование адаптера таблицы для отправки запросов SQL в базу данных|
|[Сохранение набора данных в формате XML](../data-tools/save-a-dataset-as-xml.md)|Как сохранить набор данных в XML-документ|

## <a name="two-stage-updates"></a>Обновление в два этапа
 Обновление источника данных осуществляется в два этапа. Первым шагом является обновление набора данных с помощью новых записей, измененных записей или удаленных записей. Если приложение никогда не отправляет эти изменения обратно в источник данных, вам не требуется обновление.

 Если отправить изменения обратно в базу данных, второй этап не требуется. Если вы не используете элементы управления с привязкой к данным, необходимо вручную вызовите метод Update один адаптер таблицы (или адаптер данных), который использовался для заполнения набора данных. Тем не менее можно также использовать других адаптеров, например, для перемещения данных из одного источника в другой или для обновления нескольких источников данных. Если не используется привязка данных и выполняется сохранение изменений в связанных таблицах, необходимо вручную создать экземпляр переменной автоматически сгенерированный класс TableAdapterManager, а затем вызвать его метод UdpateAll.

 ![Обновление наборов данных Visual Basic](../data-tools/media/vbdatasetupdates.gif "vbDatasetUpdates") обновление двухэтапного процесса и роль DataRowVersion в успешное обновление

 Набор данных содержит коллекции таблиц, которые содержат коллекции строк. Если вы собираетесь обновить позднее к источнику данных, должны использовать методы свойства DataTable.DataRowCollection при добавлении или удалении строк. Эти методы выполняют отслеживание изменений, которые необходимы для обновления источника данных. При вызове RemoveAt коллекции для свойства строки, удаление не будет передавать в базе данных.

## <a name="merge-datasets"></a>Слияние наборов данных
 Содержимое набора данных, можно обновлять *объединение* его с другим набором данных. Это включает в себя копирование содержимого *источника* набора данных в вызывающий набор данных (называют *целевой* набора данных). При слиянии наборов данных новые записи из исходного набора добавляются целевого набора данных. Кроме того дополнительные столбцы из исходного набора добавляются в конечный набор. Слияние наборов данных полезно в том случае, если вы используете локальный набор данных и получить второй набор данных из другого приложения. Также полезно при получении второй набор данных с компонентами, такими как веб-службы XML или при необходимости интегрировать данные из нескольких наборов данных.

 При слиянии наборов данных, можно передать логический аргумент (`preserveChanges`), которые означают <xref:System.Data.DataSet.Merge%2A> метода следует ли сохранять существующие изменения в конечном наборе данных. Так как наборы данных поддерживают несколько версий записей, важно помнить, объединить несколько версий записей. В следующей таблице показаны порядок слияния записи двух наборов данных:

|DataRowVersion|Целевого набора данных|Исходный набор данных|
|--------------------|--------------------|--------------------|
|До преобразования|Джеймс Wilson|Джеймс Wilson C.|
|Текущие|Джим Wilson|Джеймс Wilson C.|

 Вызов <xref:System.Data.DataSet.Merge%2A> метод в предыдущей таблице, с `preserveChanges=false targetDataset.Merge(sourceDataset)` результат будет следующим:

|DataRowVersion|Целевого набора данных|Исходный набор данных|
|--------------------|--------------------|--------------------|
|До преобразования|Джеймс Wilson C.|Джеймс Wilson C.|
|Текущие|Джеймс Wilson C.|Джеймс Wilson C.|

 Вызов <xref:System.Data.DataSet.Merge%2A> метод с `preserveChanges = true targetDataset.Merge(sourceDataset, true)` результат будет следующим:

|DataRowVersion|Целевого набора данных|Исходный набор данных|
|--------------------|--------------------|--------------------|
|До преобразования|Джеймс Wilson C.|Джеймс Wilson C.|
|Текущие|Джим Wilson|Джеймс Wilson C.|

> [!CAUTION]
>  В `preserveChanges = true` сценарии, если <xref:System.Data.DataSet.RejectChanges%2A> метод вызывается для записи в конечном наборе данных, то он возвращается к исходным данным из *источника* набора данных. Это означает, что при попытке обновить исходный источник данных с помощью конечного набора данных, может оказаться возможность найти исходная строка для обновления. Можно предотвратить нарушение параллелизма, заполнив другой набор данных обновленные записи из источника данных и последующее слияние, чтобы предотвратить нарушение параллелизма. (Нарушение параллелизма происходит, когда другой пользователь изменяет запись в источнике данных после заполнения набора данных).

## <a name="update-constraints"></a>Ограничения обновления
 Чтобы внести изменения в существующую строку данных, добавить или обновить данные в отдельных столбцах. Если набор данных содержит ограничения (например, внешние ключи или ненулевые ограничения), возможно, что запись может временно находиться в состоянии ошибки при его обновлении. То есть он может быть в состоянии ошибки, после завершения обновления одного столбца и до перехода к следующему.

 Чтобы предотвратить нарушение ограничения преждевременное можно временно приостановить ограничения на обновление. Это служит двум целям.

-   Он предотвращает ошибки исключение после завершения обновления одного столбца, но еще не запущен другой обновление.

-   Это предотвращает некоторые обновления события из процесса (события, которые часто используются для проверки).

> [!NOTE]
>  В Windows Forms архитектура привязки данных, который встроен в datagrid приостанавливает проверку, пока фокус перемещается за пределы строки, а также необходимо явным образом вызвать ограничений <xref:System.Data.DataRow.BeginEdit%2A>, <xref:System.Data.DataRow.EndEdit%2A>, или <xref:System.Data.DataRow.CancelEdit%2A> методы.

 Ограничения, автоматически отключена при <xref:System.Data.DataSet.Merge%2A> вызове метода для набора данных. По завершении слияния, если все ограничения в наборе данных, которые невозможно разрешить, <xref:System.Data.ConstraintException> возникает исключение. В этом случае <xref:System.Data.DataSet.EnforceConstraints%2A> свойству `false,` и все нарушения ограничений должны быть разрешены перед сбросом <xref:System.Data.DataSet.EnforceConstraints%2A> свойства `true`.

 После завершения обновления можно повторно включить проверку ограничений, что также разрешает события обновления и инициирует их.

 Дополнительные сведения о делегатах см. в разделе [отключения ограничений при заполнении набора данных](../data-tools/turn-off-constraints-while-filling-a-dataset.md).

## <a name="dataset-update-errors"></a>Ошибки обновления набора данных
 При обновлении записи в наборе данных имеется возможность возникновения ошибки. Например можно случайно записать данные неверного типа в столбец или данных, слишком длинный или имеет другие проблемы целостности данных. Либо у вас есть конкретного приложения проверки допустимости, которые могут вызвать настраиваемые ошибки на любом этапе выполнения события обновления. Дополнительные сведения см. в разделе [проверка данных в наборах данных](../data-tools/validate-data-in-datasets.md).

## <a name="maintaining-information-about-changes"></a>Ведение записей об изменениях
 Сведения об изменениях в наборе данных поддерживается двумя способами: путем пометки строк, которые указывают, что они были изменены (<xref:System.Data.DataRow.RowState%2A>) и за счет нескольких копий записи (<xref:System.Data.DataRowVersion>). Используя эти сведения, процессы, можно определить, что изменилось в наборе данных и отправлять соответствующие обновления в источник данных.

### <a name="rowstate-property"></a>Свойство RowState
 <xref:System.Data.DataRow.RowState%2A> Свойство <xref:System.Data.DataRow> объекта имеет значение, которое предоставляет сведения о состоянии конкретной строки данных.

 В следующей таблице приведены возможные значения <xref:System.Data.DataRowState> перечисления:

|Значение DataRowState|Описание|
|------------------------|-----------------|
|<xref:System.Data.DataRowState.Added>|Строка была добавлена как элемент в <xref:System.Data.DataRowCollection>. (Строки в этом состоянии не имеет соответствующей исходной версии, так как она не существовала при последней <xref:System.Data.DataRow.AcceptChanges%2A> был вызван метод).|
|<xref:System.Data.DataRowState.Deleted>|Строка была удалена с помощью <xref:System.Data.DataRow.Delete%2A> из <xref:System.Data.DataRow> объекта.|
|<xref:System.Data.DataRowState.Detached>|Строка будет создана, но не является частью какой-либо <xref:System.Data.DataRowCollection>. Объект <xref:System.Data.DataRow> объект находится в этом состоянии сразу же после его создания, перед ее добавления в коллекцию, а после его удаления из коллекции.|
|<xref:System.Data.DataRowState.Modified>|Значение столбца в строке был изменен каким-либо образом.|
|<xref:System.Data.DataRowState.Unchanged>|Строка не была изменена с момента <xref:System.Data.DataRow.AcceptChanges%2A> последнего вызова метода.|

### <a name="datarowversion-enumeration"></a>DataRowVersion - перечисление
Наборы данных поддерживают несколько версий записей. <xref:System.Data.DataRowVersion> Полей можно использовать при возвращении значения, найденного в <xref:System.Data.DataRow> с помощью <xref:System.Data.DataRow.Item%2A> свойство или <xref:System.Data.DataRow.GetChildRows%2A> метод <xref:System.Data.DataRow> объекта.

В следующей таблице приведены возможные значения <xref:System.Data.DataRowVersion> перечисления:

|Значение DataRowVersion|Описание|
|--------------------------|-----------------|
|<xref:System.Data.DataRowVersion.Current>|Текущая версия записи содержит все изменения, которые были выполнены для записи с момента последнего <xref:System.Data.DataRow.AcceptChanges%2A> был вызван. Если строка была удалена, нет текущей версии нет.|
|<xref:System.Data.DataRowVersion.Default>|Значение по умолчанию записи, в соответствии с определением набора данных схема или источник данных.|
|<xref:System.Data.DataRowVersion.Original>|Исходная версия записи является копией записи, сделанной в последнее время изменения были зафиксированы в наборе данных. На практике обычно это версия записи для чтения из источника данных.|
|<xref:System.Data.DataRowVersion.Proposed>|Предлагаемая версия записи доступна временно, пока не завершено обновление, то есть в промежутке между именем <xref:System.Data.DataRow.BeginEdit%2A> метод и <xref:System.Data.DataRow.EndEdit%2A> метод. Обычно к предлагаемой версии записи в обработчике для события, такие как <xref:System.Data.DataTable.RowChanging>. Вызов <xref:System.Data.DataRow.CancelEdit%2A> метод возвращает изменения и удаляет предлагаемую версию строки данных.|

 Исходные и текущие версии полезны при передаче обновленных сведений к источнику данных. Как правило при отправке обновления в источник данных, новые сведения для базы данных — в текущей версии записи. Информация из исходной версии используется для поиска записи для обновления.

 Например в случае, когда изменяется первичный ключ записи, требуется способ найти запись в источнике данных, чтобы внести изменения. Если исходной версии нет, то запись, скорее всего добавится в источник данных, полученный не только к появлению нежелательной записи, но в одну запись, которая является неточным и нуждается в обновлении. Две версии также используются в управлении параллелизмом. Можно сравнить исходную версию для записи в источнике данных, чтобы определить, изменилась ли запись после его загрузки в набор данных.

 Предложенная полезно в тех случаях, когда требуется выполнить проверку до внесения изменений в набор данных.

 Даже если записи были изменены, не всегда исходная или текущая версия этой строки. При вставке новой строки в таблице нет исходной версии нет текущей версии. Аналогично Если удалить строку путем вызова в таблице `Delete` метод, есть только исходная версия, но нет текущей версии.

 Можно проверить наличие определенной версии записи, запрашивая строку данных <xref:System.Data.DataRow.HasVersion%2A> метод. Доступ к любой версии записи путем передачи <xref:System.Data.DataRowVersion> значение перечисления в качестве дополнительного аргумента при запросе значения столбца.

## <a name="getting-changed-records"></a>Получение измененных записей
 Он часто используется не для обновления всех записей в наборе данных. Например, пользователь может работать с Windows Forms <xref:System.Windows.Forms.DataGridView> элемент управления, отображающий много записей. Тем не менее пользователь может обновить только несколько записей, удалить одну и вставить новую. Наборы данных и таблицы данных предоставляют метод (`GetChanges`) для возвращения строк, которые были изменены.

 Можно создавать подмножества измененных записей с помощью `GetChanges` метод таблицы данных (<xref:System.Data.DataTable.GetChanges%2A>) или набора данных (<xref:System.Data.DataSet.GetChanges%2A>) сам. При вызове метода для таблицы данных, он возвращает копию таблицы, содержащий только измененные записи. Аналогично при вызове метода для набора данных, получить новый набор данных, содержащий только измененные записи в нем.

 `GetChanges` сам по себе возвращает все измененные записи. Напротив, передав нужного <xref:System.Data.DataRowState> как параметр `GetChanges` метод, можно указать какое подмножество измененных записей требуется: добавленные записи, которые помечены для удаления, отсоединенные записи или измененные записи.

 Получение подмножества измененных записей полезно в том случае, если вы хотите отправить другому компоненту для обработки записей. Вместо отправки всего набора данных, можно уменьшить дополнительные издержки на подключение к другому компоненту путем получения только записи, необходимые для компонента.

## <a name="committing-changes-in-the-dataset"></a>Фиксация изменений в наборе данных
 При внесении изменений в наборе данных, <xref:System.Data.DataRow.RowState%2A> свойству измененных строк. Исходные и текущие версии записей установлено, поддерживаются и становятся доступными при использовании с <xref:System.Data.DataRowView.RowVersion%2A> свойство. Метаданные, которые хранятся в свойствах эти измененные строки не требуется для отправки правильные обновления в источник данных.

 Если изменения отражают текущее состояние источника данных, необходимо больше не сохранять эти сведения. Как правило существует два раза при набора данных и его источником находятся в синхронизированном состоянии.

-   Сразу после загрузки сведений в набор данных, например при считывании данных из источника.

-   После отправки изменений из набора данных к источнику данных (но не раньше, так как можно потерять сведения об изменениях, необходимые для отправки изменений в базу данных).

Можно зафиксировать ожидающие изменения в набор данных, вызвав <xref:System.Data.DataSet.AcceptChanges%2A> метод. Как правило <xref:System.Data.DataSet.AcceptChanges%2A> вызывается в следующих случаях:

-   По окончании загрузки набора данных. При загрузке набора данных путем вызова адаптера `Fill` метод, то адаптер автоматически выполняет изменения. Однако при загрузке набора данных путем его слияния с другим набором данных, необходимо вручную внести изменения.

    > [!NOTE]
    >  Адаптер может предотвратить автоматическое применение изменений при вызове `Fill` метод, задав `AcceptChangesDuringFill` свойства адаптера, который `false`. Если задано значение `false`, то <xref:System.Data.DataRow.RowState%2A> каждой строки, вставляемой при заполнении равно <xref:System.Data.DataRowState.Added>.

-   После отправки изменений набора данных к другому, например веб-служб XML.

    > [!CAUTION]
    >  Применение изменений таким образом, будут удалены все сведения об изменениях. Не фиксации изменений, пока вы после завершения выполнения операций, которые требуется знать, какие изменения были внесены в наборе данных приложения.

Этот метод выполняет следующее:

-   Записывает <xref:System.Data.DataRowVersion.Current> версии записи в его <xref:System.Data.DataRowVersion.Original> версии и перезаписывает исходную версию.

-   Удаляет любую строку где <xref:System.Data.DataRow.RowState%2A> свойству <xref:System.Data.DataRowState.Deleted>.

-   Наборы <xref:System.Data.DataRow.RowState%2A> записи для <xref:System.Data.DataRowState.Unchanged>.

<xref:System.Data.DataSet.AcceptChanges%2A> Метод доступен на трех уровнях. Можно вызвать для <xref:System.Data.DataRow> объект для фиксации изменения только для этой строки. Также можно вызвать для <xref:System.Data.DataTable> объекта, чтобы выполнить все строки в таблице. Наконец, его можно вызвать для <xref:System.Data.DataSet> объекта, чтобы выполнить все ожидающие изменения для всех записей всех таблиц набора данных.

Следующая таблица описывает изменения, выполняемые в зависимости от метода называется на.

|Метод|Результат|
|------------|------------|
|<xref:System.Data.DataRow.AcceptChanges%2A?displayProperty=fullName>|Изменения вносятся только в определенной строке.|
|<xref:System.Data.DataTable.AcceptChanges%2A?displayProperty=fullName>|Изменения вносятся во все строки данной таблицы.|
|<xref:System.Data.DataSet.AcceptChanges%2A?displayProperty=fullName>|Изменения вносятся во все строки всех таблиц набора данных.|

> [!NOTE]
>  При загрузке набора данных путем вызова адаптера `Fill` метод, не нужно явно принять изменения. По умолчанию `Fill` вызовы метода `AcceptChanges` метод после завершения операции заполнения таблицы данных.

 Связанный метод <xref:System.Data.DataSet.RejectChanges%2A>, отменяет влияние изменений путем копирования <xref:System.Data.DataRowVersion.Original> версии обратно в <xref:System.Data.DataRowVersion.Current> версии записи. Кроме того, задается <xref:System.Data.DataRow.RowState%2A> каждой записи обратно на <xref:System.Data.DataRowState.Unchanged>.

## <a name="data-validation"></a>Проверка данных
 Чтобы проверить соответствие требованиям процессов, которые его передачи данных в приложении, обычно требуется добавить проверку. Это может включать в себя проверку ввод пользователя в форме правильность, проверка данных, который отправляется в приложение другим приложением, или даже проверки, что сведения, вычисленные в пользовательском компоненте подпадает под ограничения источника данных и требованиям приложения.

 Вы можете проверять данные несколькими способами:

-   Бизнес-уровне, добавив код в приложение для проверки данных. Набор данных является централизованно, это можно сделать. Набор данных предоставляет некоторые преимущества внутренней проверке, такие как возможность проверять изменения при изменении значений столбцов и строк. Дополнительные сведения см. в разделе [проверка данных в наборах данных](../data-tools/validate-data-in-datasets.md).

-   На уровне представления данных, путем добавления проверки формы. Дополнительные сведения см. в разделе [проверка ввода пользователем данных в Windows Forms](/dotnet/framework/winforms/user-input-validation-in-windows-forms).

-   В данных серверной части, отправляя данные в источник данных — например, база данных и разрешения ему принимать или отклонять данные. При работе с базой данных с расширенными возможностями проверки данных и предоставления сведений об ошибках, это может быть очень удобным, так как вы можете проверять данные, независимо от того, откуда они пришли. Тем не менее этот подход не может вместить требования проверки для конкретного приложения. Кроме того проверка данных источника данных можно привести многочисленных циклов приема-передачи с источником данных, в зависимости от того, как приложение способствует разрешение ошибок проверки, вызванные в серверной части.

    > [!IMPORTANT]
    >  При использовании команды обработки данных с <xref:System.Data.SqlClient.SqlCommand.CommandType%2A> свойство, которое имеет значение <xref:System.Data.CommandType.Text>, тщательно проверьте сведения, которые отправляются от клиента до его передачи в базу данных. Пользователи-злоумышленники могут попытаться отправить (Вставить) измененные или Дополнительные инструкции SQL с целью получения несанкционированного доступа или повреждения базы данных. Прежде чем передавать входные данные пользователя в базе данных, всегда проверяйте, что информация верна. Рекомендуется всегда использовать параметризованные запросы или хранимые процедуры, если это возможно.

## <a name="transmitting-updates-to-the-data-source"></a>Передачи обновлений в источнике данных
После внесения изменений в наборе данных, можно передать изменения с источником данных. Чаще всего это сделать, вызвав `Update` метод адаптера таблицы (или адаптер данных). Этот метод обрабатывает в цикле каждая запись в таблице данных, определяет, какой тип обновления (update, insert или delete), если таковые имеются, а затем запускает соответствующую команду.

 Показано, каким образом производятся изменения Предположим, что приложение использует набор данных, который содержит одну таблицу данных. Приложение извлекает две строки из базы данных. После извлечения данных в памяти таблица выглядит следующим образом:

```
(RowState)     CustomerID   Name             Status
(Unchanged)    c200         Robert Lyon      Good
(Unchanged)    c400         Nancy Buchanan    Pending
```

 Приложение Юлия Иванов состояние изменится на «Основной». В результате этого изменения значение <xref:System.Data.DataRow.RowState%2A> свойства для этой строки изменяется с <xref:System.Data.DataRowState.Unchanged> для <xref:System.Data.DataRowState.Modified>. Значение <xref:System.Data.DataRow.RowState%2A> свойства для первой строки остается <xref:System.Data.DataRowState.Unchanged>. Таблицы данных теперь выглядит следующим образом:

```
(RowState)     CustomerID   Name             Status
(Unchanged)    c200         Robert Lyon      Good
(Modified)     c400         Nancy Buchanan    Preferred
```

 Теперь приложение вызывает `Update` метод для передачи набора данных в базу данных. Метод проверяет каждую строку в свою очередь. Для первой строки метод передает без инструкции SQL в базу данных из-за этого строка не была изменена с момента ее извлечения из базы данных.

 Во второй строке, однако `Update` метод автоматически вызывается команда правильные данные и передает их в базу данных. Особый синтаксис инструкции SQL зависят от диалекта SQL, который поддерживается в базовом хранилище данных. Но общие черты передаваемая инструкция SQL, заслуживающие внимания:

-   Передаваемая инструкция SQL является инструкцией UPDATE. Адаптер знает, как использовать инструкции UPDATE, так как значение <xref:System.Data.DataRow.RowState%2A> свойство <xref:System.Data.DataRowState.Modified>.

-   Передаваемая инструкция SQL включает в себя предложение WHERE, указывающее, что целью инструкции UPDATE является строка где `CustomerID = 'c400'`. Эта часть инструкции SELECT выбирает нужную строку от всех остальных так как `CustomerID` является первичным ключом целевой таблицы. Сведения о предложении WHERE является производным от первоначальной версии записи (`DataRowVersion.Original`), если значения, необходимые для идентификации строки были изменены.

-   Передаваемая инструкция SQL включает в себя предложение SET для установки новых значений измененных столбцов.

    > [!NOTE]
    > Если TableAdapter `UpdateCommand` свойство было задано имя хранимой процедуры, адаптер не создает инструкцию SQL. Вместо этого он вызывает хранимую процедуру с соответствующими переданными параметрами.

## <a name="passing-parameters"></a>Передача параметров
 Обычно параметры используются для передачи значений для записей, которые будут обновлены в базе данных.  При его `Update` метод выполняет инструкцию UPDATE, ему необходимо заполнить значения параметра. Он получает эти значения из `Parameters` сбор данных для соответствующей команды данных — в этом случае `UpdateCommand` объекта в TableAdapter.

 При использовании средств Visual Studio для создания адаптера данных, `UpdateCommand` объект содержит коллекцию параметров, соответствующих каждому шаблону параметра в инструкции.

 <xref:System.Data.SqlClient.SqlParameter.SourceColumn%2A?displayProperty=fullName> Свойства каждого параметра указывает на столбец в таблице данных. Например `SourceColumn` свойство `au_id` и `Original_au_id` устанавливается на любой столбец в таблице содержит идентификатор автора. При адаптера `Update` выполняется метод, он считывает автору столбец id из записи, которая обновляется и заполняет значения параметров в инструкции.

 В инструкции UPDATE необходимо указать и новые значения (те, которые будут записаны на запись), а также, старые значения (при этом записи могут быть расположены в базе данных). Таким образом, есть два параметра для каждого значения: один для предложения SET, а другой для предложения WHERE. Оба параметра читают данные из записи, которая обновляется, но получают разные версии значений столбца, на основе параметра <xref:System.Data.SqlClient.SqlParameter.SourceVersion> свойство. Параметр для предложения SET получает текущую версию, и параметр в предложении WHERE Получает исходную версию.

> [!NOTE]
> Можно также задать значения `Parameters` коллекции самостоятельно в коде, который обычно работает в обработчике событий для адаптера данных <xref:System.Data.DataTable.RowChanging> событий.

## <a name="see-also"></a>См. также

- [Инструменты для работы с наборами данных в Visual Studio](../data-tools/dataset-tools-in-visual-studio.md)
- [Создайте и настройте адаптеры таблиц TableAdapter](create-and-configure-tableadapters.md)
- [Обновление данных с помощью адаптера таблицы](../data-tools/update-data-by-using-a-tableadapter.md)
- [Привязка элементов управления к данным в Visual Studio](../data-tools/bind-controls-to-data-in-visual-studio.md)
- [Проверка данных](validate-data-in-datasets.md)
- [Сохранение данных](../data-tools/saving-data.md)