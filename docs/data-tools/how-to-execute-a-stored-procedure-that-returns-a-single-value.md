---
title: "Практическое руководство. Выполнение хранимой процедуры, возвращающей одиночное значение | Microsoft Docs"
ms.custom: ""
ms.date: "12/15/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "CommandType.StoredProcedure"
dev_langs: 
  - "VB"
  - "CSharp"
  - "C++"
  - "aspx"
helpviewer_keywords: 
  - "ExecuteReader - пример метода [Visual Basic]"
  - "хранимые процедуры, примеры"
  - "хранимые процедуры, выполнение"
ms.assetid: ecf8c262-58ca-4a69-a82c-916c0c061422
caps.latest.revision: 21
caps.handback.revision: 21
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
robots: noindex,nofollow
---
# Практическое руководство. Выполнение хранимой процедуры, возвращающей одиночное значение
Для выполнения сохраненной процедуры, возвращающей одиночное значение, запускается запрос объекта TableAdapter, настроенный для запуска сохраненной процедуры \(например `CustomersTableAdapter.CustomerCount()`\).  
  
 Если приложение не использует адаптеры таблиц, вызовите метод `ExecuteScalar` объекта команды, присвоив его свойству `CommandType` значение <xref:System.Data.CommandType>.  \("Объектом команды" называется определенная команда для [поставщика данных платформы .NET Framework](../Topic/.NET%20Framework%20Data%20Providers.md), используемого приложением.  Например, если приложение использует поставщик данных платформы .NET Framework для SQL Server, объектом команды будет <xref:System.Data.SqlClient.SqlCommand>\).  
  
 В следующих примерах показано выполнение сохраненной процедуры, возвращающей одиночное значение из базы данных, с помощью адаптеров таблиц или командных объектов.  Дополнительные сведения о запросах с использованием адаптеров таблиц и команд содержатся в разделе [Заполнение набора данных](../data-tools/fill-datasets-by-using-tableadapters.md).  
  
 [!INCLUDE[note_settings_general](../data-tools/includes/note_settings_general_md.md)]  
  
## Выполнение сохраненных процедур, возвращающих одиночное значение, при помощью адаптера таблиц  
 В этом примере показано создание запроса адаптера таблицы с помощью [мастер настройки запроса TableAdapter](../data-tools/editing-tableadapters.md), а также приводятся сведения об объявлении экземпляра адаптера таблицы и выполнении запроса.  
  
#### Для выполнения сохраненной процедуры, возвращающей одиночное значение, с помощью адаптера таблиц:  
  
1.  Откройте набор данных в **Конструкторе наборов данных**.  Дополнительные сведения см. в разделе [Практическое руководство. Открытие набора данных в конструкторе наборов данных](../Topic/How%20to:%20Open%20a%20Dataset%20in%20the%20Dataset%20Designer.md).  
  
2.  Создайте адаптер таблицы, если не сделали этого ранее.  Дополнительные сведения о создании адаптеров таблиц см. в разделе [Практическое руководство. Создание адаптера таблицы](../data-tools/create-and-configure-tableadapters.md).  
  
3.  Если для адаптера таблиц уже имеется запрос, использующий сохраненную процедуру, которая возвращает одиночное значение, переходите к процедуре "Объявление экземпляра адаптера таблицы и выполнение запроса". В противном случае необходимо продолжить выполнение шага 4, чтобы создать новый запрос, возвращающий одиночное значение.  
  
4.  Щелкните требуемый адаптер таблиц правой кнопкой мыши и используйте контекстное меню для добавления запроса.  
  
     Откроется **Мастер настройки запроса адаптера таблицы**.  
  
5.  Выберите **Использовать существующую сохраненную процедуру** и нажмите кнопку **Далее**.  
  
6.  Выберите сохраненную процедуру из раскрывающегося списка, и затем нажмите **Далее**.  
  
7.  Выберите параметр **Одиночное значение** и нажмите кнопку **Далее**.  
  
8.  Введите имя для запроса.  
  
9. Нажмите кнопку **Далее** или **Готово**, чтобы завершить работу мастера; запрос добавляется в адаптер таблиц.  
  
10. Построить проект.  
  
#### Чтобы объявить экземпляр адаптера таблиц и выполнить запрос:  
  
1.  Объявите экземпляр адаптера таблиц, содержащий запрос, который требуется выполнить.  
  
    -   Для создания экземпляра с помощью средств времени проектирования, перетащите нужный адаптер таблицы TableAdapter с **Панели элементов**.  \(Компонент в проекте теперь отображается в **Панели элементов** под заголовком, совпадающим с именем проекта.\) Если адаптер таблиц не отображается в **Панели элементов**, может потребоваться скомпилировать проект.  
  
         \-или\-  
  
    -   Чтобы создать экземпляр в коде, подставьте в следующий код имена <xref:System.Data.DataSet> и адаптера таблиц.  
  
         `Dim tableAdapter As New DataSetTableAdapters.TableAdapter`  
  
        > [!NOTE]
        >  Адаптеры таблиц на самом деле не располагаются внутри связанных с ними классов наборов данных.  Каждый набор данных имеет соответствующую коллекцию адаптеров таблиц в своих собственных пространствах имен.  Например, если у вас есть набор данных с именем `SalesDataSet`, то будет существовать пространство имен `SalesDataSetTableAdapters`, содержащее его адаптеры таблиц.  
  
2.  Вызовите запрос, как вызвали бы любой другой метод в коде.  Запрос представляет собой метод адаптера таблиц.  Подставьте в следующий код имя адаптера таблиц и имя запроса.  Кроме того, необходимо передать любые параметры, необходимые запросу.  Если вы не уверены в том, что запросу необходимы параметры, и какие именно параметры требуются, то проверьте в IntelliSense требуемую сигнатуру запроса.  В зависимости то того, принимает ли запрос параметры или нет, код будет выглядеть аналогично одному из следующих примеров:  
  
     `TableAdapter.Query()`  
  
     `TableAdapter.Query(Parameters)`  
  
     Полный код объявления экземпляра адаптера таблицы и выполнения запроса должен выглядеть примерно следующим образом:  
  
     [!code-cs[VbRaddataFillingAndExecuting#9](../data-tools/codesnippet/CSharp/how-to-execute-a-stored-procedure-that-returns-a-single-value_1.cs)]
     [!code-vb[VbRaddataFillingAndExecuting#9](../data-tools/codesnippet/VisualBasic/how-to-execute-a-stored-procedure-that-returns-a-single-value_1.vb)]  
  
## Выполнение сохраненных процедур, возвращающих одиночное значение, с помощью командного объекта  
 В следующем примере демонстрируется создание команды и выполнение сохраненной процедуры, возвращающей одиночное значение.  Сведения об установке и получении значений параметров для команды см. в разделе [Практическое руководство. Установка и получение параметров командных объектов](../Topic/How%20to:%20Set%20and%20Get%20Parameters%20for%20Command%20Objects.md).  
  
 Этот пример использует объект <xref:System.Data.SqlClient.SqlCommand> и требует:  
  
-   Ссылки на пространства имен <xref:System>, <xref:System.Data> и <xref:System.Xml>.  
  
-   Подключение к данным с именем `SqlConnection1`.  
  
-   Таблицу с именем `Customers` в источнике данных, к которому подключается `SqlConnection1`.  \(В противном случае необходима допустимая инструкция SQL для источника данных\).  
  
#### Для выполнения сохраненной процедуры, возвращающей одиночное значение, с помощью DataCommand:  
  
-   Добавьте следующий код к методу, из которого он должен выполняться.  Одиночное значение возвращается путем вызова метода `ExecuteScalar` команды \(например <xref:System.Data.SqlClient.SqlCommand.ExecuteScalar%2A>\).  Данные возвращаются в `object`.  
  
     [!code-cs[VbRaddataFillingAndExecuting#14](../data-tools/codesnippet/CSharp/how-to-execute-a-stored-procedure-that-returns-a-single-value_2.cs)]
     [!code-vb[VbRaddataFillingAndExecuting#14](../data-tools/codesnippet/VisualBasic/how-to-execute-a-stored-procedure-that-returns-a-single-value_2.vb)]  
  
## См. также  
 <xref:System.Data.SqlClient.SqlCommand.ExecuteScalar%2A?displayProperty=fullName>   
 <xref:System.Data.OleDb.OleDbCommand.ExecuteScalar%2A?displayProperty=fullName>   
 <xref:System.Data.Odbc.OdbcCommand.ExecuteScalar%2A?displayProperty=fullName>   
 <xref:System.Data.OracleClient.OracleCommand.ExecuteScalar%2A?displayProperty=fullName>   
 [Практическое руководство. Создание запросов TableAdapter](../data-tools/how-to-create-tableadapter-queries.md)   
 [Практическое руководство. Изменение запросов TableAdapter](../data-tools/how-to-edit-tableadapter-queries.md)   
 [Практическое руководство. Заполнение данными набора данных](../data-tools/how-to-fill-a-dataset-with-data.md)   
 [Заполнение набора данных](../data-tools/fill-datasets-by-using-tableadapters.md)   
 [Практическое руководство. Установка и получение параметров командных объектов](../Topic/How%20to:%20Set%20and%20Get%20Parameters%20for%20Command%20Objects.md)