---
title: 'Пошаговое руководство: Настройка инструкции insert, update и delete поведение классов сущностей | Документы Microsoft'
ms.custom: ''
ms.date: 11/04/2016
ms.topic: conceptual
dev_langs:
- VB
- CSharp
ms.assetid: 03ff1146-706e-4780-91cb-56a83df63eea
author: gewarren
ms.author: gewarren
manager: douge
ms.technology: vs-data-tools
ms.workload:
- data-storage
ms.openlocfilehash: 38dc02e4c1cd7a0d6bead05a585b878f242209ba
ms.sourcegitcommit: 6a9d5bd75e50947659fd6c837111a6a547884e2a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
---
# <a name="walkthrough-customizing-the-insert-update-and-delete-behavior-of-entity-classes"></a>Пошаговое руководство: Настройка инструкции insert, update и delete поведение классов сущностей

[Средства LINQ to SQL в Visual Studio](../data-tools/linq-to-sql-tools-in-visual-studio2.md) предоставляет визуальную поверхность проектирования для создания и редактирования [!INCLUDE[vbtecdlinq](../data-tools/includes/vbtecdlinq_md.md)] классов (классов сущностей), основанных на объектах в базе данных. С помощью [LINQ to SQL](/dotnet/framework/data/adonet/sql/linq/index), можно использовать технологию LINQ для доступа к базам данных SQL. Дополнительные сведения см. в разделе [Встроенный язык запросов LINQ](/dotnet/csharp/linq/).  
  
По умолчанию логику для выполнения обновлений обеспечивает среда выполнения [!INCLUDE[vbtecdlinq](../data-tools/includes/vbtecdlinq_md.md)]. Среда выполнения по умолчанию создает инструкции Вставить, Обновить и Удалить, основываясь на схеме таблицы (определения столбцов и информация о первичных ключах). Если вы не хотите использовать поведение по умолчанию, то можно конфигурировать поведение обновления и назначить конкретные сохраненные процедуры для выполнения команд Вставить, Обновить и Удалить, необходимых для работы с данными в базе данных. Можно также сделать это, когда поведение по умолчанию не сгенерировано, например, когда ваши классы сущностей сопоставляются с представлениями. Кроме того, можно отменить поведение обновления по умолчанию, когда база данных требует доступа к таблице через сохраненные процедуры. Дополнительные сведения см. в разделе [Настройка операций за счет хранимых процедур](/dotnet/framework/data/adonet/sql/linq/customizing-operations-by-using-stored-procedures).  
  
> [!NOTE]
> В этом пошаговом руководстве требуется доступность **InsertCustomer**, **UpdateCustomer**, и **DeleteCustomer** хранимых процедур в базе данных Northwind.  
  
Это пошаговое руководство обеспечивает действия, которые необходимо выполнить, чтобы отменить поведение по умолчанию среды выполнения LINQ to SQL для сохранения данных обратно в базе данных, используя сохраненные процедуры.  
  
В рамках данного пошагового руководства вы узнаете, как выполнять следующие задачи.  
  
-   Создание нового приложения Windows Forms и добавление в него файла [!INCLUDE[vbtecdlinq](../data-tools/includes/vbtecdlinq_md.md)].  
  
-   Создание класса сущностей, который сопоставляется с таблицей Northwind Customers.  
  
-   Создание источника данных об объекте, который ссылается на класс LINQ to SQL Customer.  
  
-   Создание приложения Windows Form, содержащего <xref:System.Windows.Forms.DataGridView>, которое связано с классом Customer  
  
-   Реализуйте для формы функциональные возможности сохранения.  
  
-   Создайте методы <xref:System.Data.Linq.DataContext> путем добавления сохраненных процедур в [!INCLUDE[vs_ordesigner_short](../data-tools/includes/vs_ordesigner_short_md.md)].  
  
-   Сконфигурируйте класс Configure так, чтобы он использовал сохраненные процедуры Вставить, Обновить и Удалить.  
  
## <a name="prerequisites"></a>Предварительные требования

В этом пошаговом руководстве используется SQL Server Express LocalDB и базе данных Northwind.  
  
1.  Если у вас нет SQL Server Express LocalDB, установите его из [страницы загрузки SQL Server Express](https://www.microsoft.com/sql-server/sql-server-editions-express), либо с помощью **установщик Visual Studio**. Установщик Visual Studio можно установить SQL Server Express LocalDB в рамках **хранения и обработки данных** рабочей нагрузки, или в отдельных компонентов.  
  
2.  Установка образца базы данных Northwind, выполните следующие действия:  

    1. В Visual Studio откройте **обозреватель объектов SQL Server** окна. (Обозреватель объектов SQL Server устанавливается как часть **хранения и обработки данных** рабочей нагрузки в установщик Visual Studio.) Разверните **SQL Server** узла. Щелкните правой кнопкой мыши на экземпляре LocalDB и выберите **нового запроса...** .  

       Откроется окно редактора запросов.  

    2. Копировать [сценарий Northwind Transact-SQL](https://github.com/MicrosoftDocs/visualstudio-docs/blob/master/docs/data-tools/samples/northwind.sql?raw=true) в буфер обмена. Этот скрипт T-SQL создает базу данных Northwind с нуля и заполняет ее данными.  

    3. Вставьте скрипт T-SQL в редакторе запросов, а затем выберите **Execute** кнопки.  

       Через некоторое время завершения выполнения запроса и создания базы данных "Борей".  
  
## <a name="creating-an-application-and-adding-linq-to-sql-classes"></a>Создание приложения и добавление классов LINQ to SQL

Поскольку вы будете работать с классами [!INCLUDE[vbtecdlinq](../data-tools/includes/vbtecdlinq_md.md)] и отображать данные на Windows Form, создайте новой приложение Windows Forms и добавьте файл классов LINQ to SQL.  
  
[!INCLUDE[note_settings_general](../data-tools/includes/note_settings_general_md.md)]  
  
### <a name="to-create-a-new-windows-forms-application-project-that-contains-linq-to-sql-classes"></a>Создайте новый проект приложения Windows Forms, который содержит LINQ для классов SQL
  
1. В Visual Studio на **файл** последовательно выберите пункты **New**, **проекта...** .  
  
2. Разверните **Visual C#** или **Visual Basic** на левой панели, затем выберите **классического Windows**.  

3. В средней области выберите **приложение Windows Forms** тип проекта.  

4. Назовите проект **UpdatingWithSProcsWalkthrough**, а затем выберите **ОК**. 
  
     **UpdatingWithSProcsWalkthrough** создается проект и добавить **обозревателе решений**.  
  
4.  В меню **Проект** выберите пункт **Добавить новый элемент**.  
  
5.  Нажмите кнопку **LINQ to SQL Classes** шаблона и тип **Northwind.dbml** в **имя** поле.  
  
6.  Нажмите кнопку **Добавить**.  
  
     Пустой файл классов LINQ to SQL Classes (Northwind.dbml) добавляется в проект, и открывается [!INCLUDE[vs_ordesigner_short](../data-tools/includes/vs_ordesigner_short_md.md)].  
  
## <a name="creating-the-customer-entity-class-and-object-data-source"></a>Создание класса сущностей Customer и источника данных об объекте

Создание [!INCLUDE[vbtecdlinq](../data-tools/includes/vbtecdlinq_md.md)] классы, которые сопоставляются с таблицами базы данных путем перетаскивания таблиц из **обозревателя серверов**/**обозреватель баз данных** на [!INCLUDE[vs_ordesigner_short](../data-tools/includes/vs_ordesigner_short_md.md)]. В результате получите классы сущностей LINQ to SQL, которые сопоставляются с таблицами базы данных. После создания классов сущностей, их можно использовать в качестве источников данных об объекте точно так же как другие классы, которые имеют общие свойства  
  
### <a name="to-create-a-customer-entity-class-and-configure-a-data-source-with-it"></a>Для создания класса сущностей Customer и настройки с ним источника данных
  
1.  В **обозревателя серверов**/**обозревателя базы данных**, найдите таблицу Customer в SQL Server версии образца базы данных Northwind. 
  
2.  Перетащите **клиентов** узел из **обозревателя серверов**/**обозреватель баз данных** на [!INCLUDE[vs_ordesigner_short](../data-tools/includes/vs_ordesigner_short_md.md)] поверхности.  
  
     Класс сущностей с именем **клиента** создается. Он имеет свойства, соответствующие столбцам в таблице Customers. Класс сущностей имеет имя **клиента** (не **клиентов**), так как он представляет одного клиента из таблицы Customers.  
  
    > [!NOTE]
    >  Этот режим переименования называется *преобразование во множественную форму*. Его можно включить или отключить [диалоговое окно «Параметры»](../ide/reference/options-dialog-box-visual-studio.md). Дополнительные сведения см. в разделе [как: Включение и выключение (конструктор O/R) плюрализации](../data-tools/how-to-turn-pluralization-on-and-off-o-r-designer.md).  
  
3.  На **построения** меню, нажмите кнопку **Build UpdatingwithSProcsWalkthrough** для сборки проекта.  
  
4.  В меню **Данные** выберите команду **Показать источники данных**.  
  
5.  В окне **Источники данных** выберите **Добавить новый источник данных**.  
  
6.  Нажмите кнопку **объекта** на **Выбор типа источника данных** и нажмите кнопку **Далее**.  
  
7.  Разверните **UpdatingwithSProcsWalkthrough** узла найдите и выделите **клиента** класса.  
  
    > [!NOTE]
    >  Если **клиента** класс недоступен, отмените работу мастера, постройте проект и снова запустите мастер.  
8.  Нажмите кнопку **Готово** для создания источника данных и добавления **клиента** класса сущности, который **источники данных** окна.  
  
## <a name="creating-a-datagridview-to-display-the-customer-data-on-a-windows-form"></a>Создание представления DataGridView для отображения данных класса Customer на Windows Form

Создание элементов управления, привязанных к классам сущностей, перетащив [!INCLUDE[vbtecdlinq](../data-tools/includes/vbtecdlinq_md.md)] элементов из источника данных **источники данных** окна в форму Windows.  
  
### <a name="to-add-controls-that-are-bound-to-the-entity-classes"></a>Для добавления элементов управления, привязанных к классам сущностей
  
1.  Откройте форму Form1 в конструкторе.  
  
2.  Из **источники данных** перетащите **клиента** узел на форму Form1.  
  
    > [!NOTE]
    > Для отображения **источники данных** окно, нажмите кнопку **Показать источники данных** на **данные** меню.  
  
3.  Откройте форму Form1 в редакторе кода.  
  
4.  Добавьте следующий код в форму, которая является глобальной по отношению к форме, находящейся за пределами любого конкретного метода, но внутри класса Form1:  
  
    ```vb  
    Private NorthwindDataContext1 As New NorthwindDataContext  
    ```  
  
    ```csharp  
    private NorthwindDataContext northwindDataContext1  
        = new NorthwindDataContext();    
    ```  
  
5.  Создайте обработчик события для события `Form_Load` и добавьте в обработчик следующий код:  
  
    ```vb  
    CustomerBindingSource.DataSource = NorthwindDataContext1.Customers  
    ```  
  
    ```csharp  
    customerBindingSource.DataSource  
        = northwindDataContext1.Customers;    
    ```  
  
## <a name="implementing-save-functionality"></a>Реализация кнопки Save Functionality (Сохранить функциональные возможности)

По умолчанию опция создания кнопки Сохранить не активизирована и реализовать сохранение функциональных возможностей невозможно. Итак, код для сохранения измененных данных в базе данных, когда создаются привязанные к данным элементы управления для источников данных об объекте, не будет автоматически добавляться. В этом разделе объясняется как включить опцию создания кнопки Сохранить и включить кнопку Сохранить функциональные возможности для объектов [!INCLUDE[vbtecdlinq](../data-tools/includes/vbtecdlinq_md.md)].  
  
### <a name="to-implement-save-functionality"></a>Для реализации кнопки Save Functionality (Сохранить функциональные возможности)
  
1.  Откройте форму Form1 в конструкторе.  
  
2.  Выберите сохранение кнопу **CustomerBindingNavigator** (кнопка со значком гибкого диска).  
  
3.  В **свойства** задайте **включено** свойства **True**.  
  
4.  Дважды щелкните кнопку сохранить, чтобы создать обработчик события и переключиться в редактор кода.  
  
5.  Добавьте в обработчик события для кнопки Сохранить следующий код:  
  
    ```vb  
    NorthwindDataContext1.SubmitChanges()  
    ```  
  
    ```csharp  
    northwindDataContext1.SubmitChanges();  
    ```  
  
## <a name="overriding-the-default-behavior-for-performing-updates-inserts-updates-and-deletes"></a>Переопределение поведения по умолчанию для выполнения обновлений (Inserts, Updates и Deletes)
  
### <a name="to-override-the-default-update-behavior"></a>Для переопределения поведения по умолчанию при обновлении
  
1.  Откройте файл LINQ to SQL в [!INCLUDE[vs_ordesigner_short](../data-tools/includes/vs_ordesigner_short_md.md)]. (Дважды щелкните **Northwind.dbml** файла в **обозревателе решений**.)  
  
2.  В **обозревателя серверов**/**обозреватель баз данных**, разверните узел баз данных Northwind **хранимых процедур** узла и найдите  **InsertCustomers**, **UpdateCustomers**, и **DeleteCustomers** хранимых процедур.  
  
3.  Перетащите все три сохраненные процедуры на [!INCLUDE[vs_ordesigner_short](../data-tools/includes/vs_ordesigner_short_md.md)].  
  
     Сохраненные процедуры добавляются в дерево методов как методы <xref:System.Data.Linq.DataContext>. Дополнительные сведения см. в разделе [методы DataContext (O/R-конструктор)](../data-tools/datacontext-methods-o-r-designer.md).  
  
4.  Выберите **клиента** класс сущностей в [!INCLUDE[vs_ordesigner_short](../data-tools/includes/vs_ordesigner_short_md.md)].  
  
5.  В **свойства** выберите **вставить** свойство.  
  
6.  Нажмите кнопку с многоточием (...) рядом с **использовать среду выполнения** Открытие **Конфигурирование поведения** диалоговое окно.  
  
7.  Выберите **настройки**.  
  
8.  Выберите **InsertCustomers** метод в **Настройка** списка.  
  
9. Нажмите кнопку **применить** для сохранения конфигурации для выбранного класса и поведения.  
  
    > [!NOTE]
    >  Можно продолжить настройку режима для каждого сочетания класса и режима при условии, что нажатия **применить** после каждого изменения. Если вы изменяете класс или поведения до нажатия **применить**, диалоговое окно предупреждения, предоставляя, предлагающее применить выполненные изменения.  
  
10. Выберите **обновление** в **поведение** списка.  
  
11. Выберите **настройки**.  
  
12. Выберите **UpdateCustomers** метод в **Настройка** списка.  
  
     Проверьте список **аргументы метода** и **свойства класса** и обратите внимание, что имеются два **аргументы метода** и два **свойства класса**для некоторых столбцов в таблице. Это облегчает возможность прослеживать изменения и создавать инструкции, которые проверяют нарушения параллелизма.  
  
13. Карта **Original_CustomerID** аргумент метода для **CustomerID (Original)** свойству класса.  
  
    > [!NOTE]
    >  По умолчанию аргументы метода будут сопоставлены со свойствами класса, если их имена совпадают. Если имена свойств были изменены и больше не совпадают в таблице и в классе сущностей, то может потребоваться выбор эквивалентного свойства класса для сопоставления, если реляционный конструктор объектов не может определить правильное сопоставление. Кроме того, если аргументы метода имеют допустимые свойства класса для сопоставления, можно установить **свойства класса** значение **(нет)**.  
  
14. Нажмите кнопку **применить** для сохранения конфигурации для выбранного класса и поведения.  
  
15. Выберите **удаление** в **поведение** списка.  
  
16. Выберите **настройки**.  
  
17. Выберите **DeleteCustomers** метод в **Настройка** списка.  
  
18. Карта **Original_CustomerID** аргумент метода для **CustomerID (Original)** свойству класса.  
  
19. Нажмите кнопку **ОК**.  
  
> [!NOTE]
> Хотя это не повлияет на работу данного пошагового руководства, следует заметить, что [!INCLUDE[vbtecdlinq](../data-tools/includes/vbtecdlinq_md.md)] автоматически обрабатывает значения, создаваемые в базе данных, для столбцов идентификаторов (с автоматическим приращением), столбцов rowguidcol (идентификатор GUID, создаваемый базой данных) и столбцов timestamp в ходе операций вставки и обновления. Генерируемые базой данных значения в других типах столбцов будут неожиданно давать нулевое значение. Для возврата генерируемых базой данных значений нужно вручную задать <xref:System.Data.Linq.Mapping.ColumnAttribute.IsDbGenerated%2A> в `true` и <xref:System.Data.Linq.Mapping.ColumnAttribute.AutoSync%2A> в одно из следующих: <xref:System.Data.Linq.Mapping.AutoSync>, <xref:System.Data.Linq.Mapping.AutoSync> или <xref:System.Data.Linq.Mapping.AutoSync>.  
  
## <a name="testing-the-application"></a>Тестирование приложения

Запустите приложение снова, чтобы убедиться, что **UpdateCustomers** хранимой процедуры правильно обновляет запись клиента в базе данных.

### <a name="to-test-the-application"></a>Тестирование приложения

1.  Нажмите клавишу F5.  
  
2.  Измените запись в таблице, чтобы проверить поведение Обновления.  
  
3.  Добавьте новую запись, чтобы проверить поведение Вставки.  
  
4.  Нажмите кнопку Сохранить, чтобы сохранить изменения в базе данных.  
  
5.  Закройте форму.  
  
6.  Нажмите клавишу F5 и убедитесь, что обновленная запись и недавно вставленная запись сохранились.  
  
7.  Удалите новую запись, чтобы проверить поведение Удаления.  
  
8.  Нажмите кнопку Сохранить, чтобы представить изменения и стереть удаленную запись из базы данных  
  
9. Закройте форму.  
  
10. Нажмите клавишу F5 и убедитесь, что удаленная запись была стерта из базы данных.  
  
    > [!NOTE]
    > Если приложение использует SQL Server Express Edition, в зависимости от значения **Копировать в выходной каталог** свойство файла базы данных, изменения могут не отображаться при нажатии клавиши F5 на шаге 10.

## <a name="next-steps"></a>Следующие шаги

В зависимости от требований приложения есть несколько шагов, которые возможно потребуется выполнить после создания классов сущностей [!INCLUDE[vbtecdlinq](../data-tools/includes/vbtecdlinq_md.md)]. Ниже приводится перечень рекомендаций, позволяющих улучшить данное приложение.

- Реализуйте конкурентную проверку во время обновлений. Сведения см. в разделе [оптимистичного параллелизма: Обзор](/dotnet/framework/data/adonet/sql/linq/optimistic-concurrency-overview).

- Добавьте запросы LINQ в данные фильтра Сведения см. в разделе [введение в запросы LINQ (C#)](/dotnet/csharp/programming-guide/concepts/linq/introduction-to-linq-queries).

## <a name="see-also"></a>См. также

[Средства LINQ to SQL в Visual Studio](../data-tools/linq-to-sql-tools-in-visual-studio2.md)  
[Методы DataContext](../data-tools/datacontext-methods-o-r-designer.md)  
[Как: назначение хранимых процедур для выполнения обновления, вставки и удаления](../data-tools/how-to-assign-stored-procedures-to-perform-updates-inserts-and-deletes-o-r-designer.md)  
[LINQ to SQL](/dotnet/framework/data/adonet/sql/linq/index)  
[Запросы LINQ to SQL](/dotnet/framework/data/adonet/sql/linq/linq-to-sql-queries)