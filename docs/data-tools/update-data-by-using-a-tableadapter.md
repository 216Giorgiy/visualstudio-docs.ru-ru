---
title: "Практическое руководство. Обновление данных с помощью адаптера таблицы | Microsoft Docs"
ms.custom: ""
ms.date: "12/14/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
  - "C++"
  - "aspx"
helpviewer_keywords: 
  - "данные [Visual Studio], сохранение"
  - "данные [Visual Studio], адаптеры таблиц TableAdapter"
  - "данные [Visual Studio], обновление"
  - "сохранение данных"
  - "адаптеры таблиц TableAdapter, обновление данных"
  - "обновление данных, адаптеры таблиц TableAdapter"
ms.assetid: 5e32e10e-9bac-4969-9bdd-b8f6919d3516
caps.latest.revision: 15
caps.handback.revision: 11
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
---
# Практическое руководство. Обновление данных с помощью адаптера таблицы
После того, как данные в наборе данных были изменены и проверены, возможно, потребуется отправить обновленные данные обратно в базу данных.  Для отправки измененных данных в базу данных вызовите метод `Update` объекта [TableAdapter](../data-tools/tableadapter-overview.md).  Метод `Update` адаптера обновит одну таблицу с данными и выполнит корректную команду \(INSERT, UPDATE или DELETE\) в зависимости от свойства <xref:System.Data.DataRow.RowState%2A> каждой строки данных в таблице.  При сохранении данных в связанных таблицах Visual Studio предоставляет новый компонент TableAdapterManager, который помогает выполнять сохранение в правильном порядке в зависимости от ограничений внешнего ключа, определенных в базе данных.  Дополнительные сведения см. в разделе [Общие сведения об иерархическом обновлении](../Topic/Hierarchical%20Update%20Overview.md).  
  
> [!NOTE]
>  Так как попытка обновления источника данных содержимым набора данных может вызвать ошибки, следует вставлять код, который вызывает метод `Update` адаптера внутри блока `try`\/`catch`.  
  
 Сама процедура обновления источника данных может варьироваться в зависимости от поставленных задач, но в любом случае приложение должно включать следующие этапы.  
  
1.  Вызовите метод `Update` адаптера внутри блока `try`\/`catch`.  
  
2.  При возникновении исключения найдите строку данных, которая его вызвала.  Дополнительные сведения см. в разделе [Практическое руководство. Поиск строк с ошибками](../Topic/How%20to:%20Locate%20Rows%20that%20Have%20Errors.md).  
  
3.  Устраните ошибку в строке данных \(по возможности программно, или путем предложения пользователю отредактировать ошибочную строку\), затем повторите попытку обновления \(<xref:System.Data.DataRow.HasErrors%2A>, <xref:System.Data.DataTable.GetErrors%2A>\).  
  
## Сохранение данных в базе данных  
 Вызовите метод `Update` объекта TableAdapter, передав имя таблицы, которая содержит значения для записи в базу данных.  
  
#### Чтобы обновить базу данных, которая содержит набор данных, с помощью TableAdapter  
  
-   Заключите метод `Update` адаптера в блок `try`\/`catch`.  В следующем примере демонстрируется попытка обновления внутри блока `try`\/`catch` содержимым таблицы `Customers` в `NorthwindDataSet`.  
  
     [!code-cs[VbRaddataSaving#9](../data-tools/codesnippet/CSharp/update-data-by-using-a-tableadapter_1.cs)]
     [!code-vb[VbRaddataSaving#9](../data-tools/codesnippet/VisualBasic/update-data-by-using-a-tableadapter_1.vb)]  
  
## Обновление двух связанных таблиц в наборе данных с помощью TableAdapter  
 При обновлении связанных таблиц в наборе данных необходимо обновлять их в правильной последовательности, чтобы уменьшить вероятность нарушения ограничений целостности данных.  Порядок выполнения команды будет также зависеть от индексов <xref:System.Data.DataRowCollection> в наборе данных.  Чтобы предотвратить возникновение ошибок, связанных с целостностью данных, рекомендуется обновлять базу данных в следующей последовательности:  
  
1.  Дочерняя таблица: удаление записей.  
  
2.  Родительская таблица: вставка, обновление и удаление записей.  
  
3.  Дочерняя таблица: вставка и обновление записей.  
  
    > [!NOTE]
    >  При обновлении двух или более связанных таблиц следует включить всю логику обновления в транзакцию.  Транзакция — это процесс, гарантирующий, что все взаимосвязанные изменения в базе данных будут успешными вплоть до фиксации изменений.  Дополнительные сведения см. в разделе [Транзакции и параллелизм](../Topic/Transactions%20and%20Concurrency.md).  
  
#### Для обновления двух связанных таблиц с помощью TableAdapter:  
  
1.  Создайте три временных таблицы данных для хранения различных записей.  
  
2.  Вызовите метод `Update` для каждого подмножества строк из блока `try`\/`catch`.  При возникновении ошибок обновления следует остановиться и устранить их.  
  
3.  Зафиксируйте изменения в базе данных.  
  
4.  Удалите временные таблицы данных для освобождения системных ресурсов.  
  
     Следующий пример показывает, как обновить источник данных с помощью набора данных, содержащего связанные таблицы.  
  
     [!code-vb[VbRaddataSaving#27](../data-tools/codesnippet/VisualBasic/update-data-by-using-a-tableadapter_2.vb)]
     [!code-cs[VbRaddataSaving#27](../data-tools/codesnippet/CSharp/update-data-by-using-a-tableadapter_2.cs)]  
  
## См. также  
 [Общие сведения об адаптере таблиц](../data-tools/tableadapter-overview.md)   
 [Пошаговые руководства работы с данными](../Topic/Data%20Walkthroughs.md)   
 [Привязка элементов управления Windows Forms к данным в Visual Studio](../data-tools/bind-windows-forms-controls-to-data-in-visual-studio.md)   
 [Подключение к данным в Visual Studio](../data-tools/connecting-to-data-in-visual-studio.md)   
 [Подготовка приложения к получению данных](../Topic/Preparing%20Your%20Application%20to%20Receive%20Data.md)   
 [Выборка данных в приложение](../data-tools/fetching-data-into-your-application.md)   
 [Привязка элементов управления к данным в Visual Studio](../data-tools/bind-controls-to-data-in-visual-studio.md)   
 [Редактирование данных в приложении](../data-tools/editing-data-in-your-application.md)   
 [Проверка данных](../Topic/Validating%20Data.md)   
 [Сохранение данных](../data-tools/saving-data.md)