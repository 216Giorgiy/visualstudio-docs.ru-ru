---
title: Привязка элементов управления WPF к набору данных
ms.date: 11/04/2016
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- WPF, data binding in Visual Studio
- WPF data binding [Visual Studio], walkthroughs
- WPF Designer, data binding
ms.assetid: 177420b9-568b-4dad-9d16-1b0e98a24d71
author: gewarren
ms.author: gewarren
manager: douge
ms.prod: visual-studio-dev15
ms.technology: vs-data-tools
ms.workload:
- data-storage
ms.openlocfilehash: 3450671c32cb7cfa03ade49bffcbecea728ddacf
ms.sourcegitcommit: 240c8b34e80952d00e90c52dcb1a077b9aff47f6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/23/2018
ms.locfileid: "49917531"
---
# <a name="bind-wpf-controls-to-a-dataset"></a>Привязка элементов управления WPF к набору данных

В этом пошаговом руководстве создается приложение WPF, который содержит элементы управления с привязкой данных. Эти элементы управления привязаны к записям продуктов, инкапсулированным в набор данных. Вы также добавите кнопки для просмотра продуктов и сохранения изменений в записях продуктов.

В данном пошаговом руководстве рассмотрены следующие задачи:

- Создание приложения WPF и набора данных, сформированного из данных в учебной базе данных AdventureWorksLT.

- Создание набора элементов управления с привязкой к данным путем перетаскивания таблицы данных из **источников данных** окна в окно в конструкторе WPF.

- Создание кнопок для перехода вперед и назад по записям продуктов.

- Создание кнопки для сохранения изменений, вносимых пользователем в записи продуктов, в таблице данных и базовом источнике данных.

[!INCLUDE[note_settings_general](../data-tools/includes/note_settings_general_md.md)]

## <a name="prerequisites"></a>Предварительные требования

Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.

- Visual Studio

- Доступ к запущенному экземпляру SQL Server или SQL Server Express с образца базы данных AdventureWorks Light (AdventureWorksLT), подключенные к ней. Можно загрузить базу данных AdventureWorksLT с [CodePlex архив](https://archive.codeplex.com/?p=awlt2008dbscript).

Перед изучением приведенных ниже концепций будет полезно, хотя и не обязательно, ознакомиться со следующим пошаговым руководством.

- Наборы данных и адаптеры таблицы. Дополнительные сведения см. в разделе [средства набора данных в Visual Studio](../data-tools/dataset-tools-in-visual-studio.md) и [TableAdapters](../data-tools/create-and-configure-tableadapters.md).

- Привязка данных WPF. Более подробную информацию см. в разделе [Общие сведения о связывании данных](/dotnet/framework/wpf/data/data-binding-overview).

## <a name="create-the-project"></a>Создание проекта

Создайте новый проект WPF, чтобы отображать записи продуктов.

1. Запустите Visual Studio.

2. В меню **Файл** выберите пункт **Создать** > **Проект**.

3. Разверните **Visual Basic** или **Visual C#**, а затем выберите **Windows**.

4. Выберите **приложение WPF** шаблона проекта.

5. В **имя** введите **AdventureWorksProductsEditor** , а затем выберите **ОК**.

   Visual Studio создаст проект AdventureWorksProductsEditor.

## <a name="create-a-dataset-for-the-application"></a>Создание набора данных для приложения

Перед созданием элементов управления с привязкой к данным, необходимо определить модель данных для вашего приложения и добавьте его в **источников данных** окна. В данном пошаговом руководстве вы создадите набор данных для использования в качестве модели данных.

1.  В меню **Данные** выберите команду **Показать источники данных**.

     **Источников данных** откроется окно.

2.  В окне **Источники данных** выберите **Добавить новый источник данных**.

     **Конфигурации источника данных** откроется мастер.

3.  На **Выбор типа источника данных** выберите **базы данных**, а затем нажмите кнопку **Далее**.

4.  На **Выбор модели базы данных** выберите **набора данных**, а затем нажмите кнопку **Далее**.

5.  На **Выбор подключения к данным** странице, выберите один из следующих вариантов:

    - Если подключение данных к базе данных AdventureWorksLT доступно в раскрывающемся списке, выберите его и нажмите кнопку **Далее**.

    - Нажмите кнопку **новое подключение**и создайте подключение к базе данных AdventureWorksLT.

6.  На **сохранение подключения в файле конфигурации приложения** выберите **Да, сохранить подключение как** флажок и нажмите кнопку **Далее**.

7.  На **Выбор объектов базы данных** странице, разверните узел **таблиц**, а затем выберите **продукт (SalesLT)** таблицы.

8.  Нажмите кнопку **Готово**.

     Visual Studio добавляет новый `AdventureWorksLTDataSet.xsd` добавляет файл в проект, а соответствующий **AdventureWorksLTDataSet** элемент **источников данных** окна. `AdventureWorksLTDataSet.xsd` Файл определяет типизированный набор данных с именем `AdventureWorksLTDataSet` и адаптера таблицы с именем `ProductTableAdapter`. Позднее в рамках данного пошагового руководства вы воспользуетесь `ProductTableAdapter` для заполнения набора данных данными и сохранения изменений в базу данных.

9. Выполните построение проекта.

## <a name="edit-the-default-fill-method-of-the-tableadapter"></a>Изменение метода заполнения по умолчанию адаптера таблицы

Чтобы заполнить набор данных данными, используйте метод `Fill` объекта `ProductTableAdapter`. По умолчанию метод `Fill` заполняет `ProductDataTable` в `AdventureWorksLTDataSet` со всеми строками данных из таблицы продукта. Вы можете изменить этот метод, чтобы он возвращал только подмножество строк. В рамках данного руководства измените метод `Fill` для возврата только строк для продуктов с фотографиями.

1.  В **обозревателе решений**, дважды щелкните *AdventureWorksLTDataSet.xsd* файла.

     Открывается Конструктор наборов данных.

2.  В конструкторе щелкните правой кнопкой мыши **заполнения**, **GetData()** запроса и выберите **Настройка**.

     **Настройки адаптера таблицы** откроется мастер.

3.  В **введите инструкцию SQL** странице, добавьте следующее предложение WHERE после `SELECT` инструкции в текстовом поле.

    ```sql
    WHERE ThumbnailPhotoFileName <> 'no_image_available_small.gif'
    ```

4.  Нажмите кнопку **Готово**.

## <a name="define-the-user-interface"></a>Определение пользовательского интерфейса

Добавьте несколько кнопок в окно, изменив в XAML в Конструкторе WPF. Позднее в рамках данного пошагового руководства вы добавите код, позволяющий пользователям выполнять прокрутку и сохранять изменения записей продуктов с помощью этих кнопок.

1. В **обозревателе решений**, дважды щелкните *MainWindow.xaml*.

    Открывается окно в **конструктор WPF**.

2. В представлении [!INCLUDE[TLA#tla_titlexaml](../data-tools/includes/tlasharptla_titlexaml_md.md)] конструктора добавьте следующий код между тегами `<Grid>`:

   ```xaml
   <Grid.RowDefinitions>
       <RowDefinition Height="75" />
       <RowDefinition Height="625" />
   </Grid.RowDefinitions>
   <Button HorizontalAlignment="Left" Margin="22,20,0,24" Name="backButton" Width="75"><</Button>
   <Button HorizontalAlignment="Left" Margin="116,20,0,24" Name="nextButton" Width="75">></Button>
   <Button HorizontalAlignment="Right" Margin="0,21,46,24" Name="saveButton" Width="110">Save changes</Button>
   ```

3. Выполните построение проекта.

## <a name="create-data-bound-controls"></a>Создание элементов управления с привязкой данных

Создание элементов управления, отображающие записи клиентов, перетащив `Product` таблицу **источников данных** окно в конструктор WPF.

1.  В **источников данных** окно, щелкните стрелку раскрывающегося меню **продукта** узел и выберите **сведения**.

2.  Разверните **продукта** узла.

3.  В этом примере некоторые поля не будут отображаться, поэтому щелкните раскрывающееся меню рядом со следующих узлов и выберите **None**:

    - ProductCategoryID

    - ProductModelID

    - ThumbnailPhotoFileName

    - rowguid

    - ModifiedDate

4.  Щелкните стрелку раскрывающегося меню рядом с **ThumbNailPhoto** узел и выберите **изображение**.

    > [!NOTE]
    > По умолчанию элементы в **источников данных** окна, представляющих изображения имеют элементы управления по умолчанию, равным **None**. Это вызвано тем, что изображения хранятся в базах данных в виде байтовых массивов, которые могут содержать все — от простого массива байтов до исполняемого файла или большого приложения.

5.  Из **источников данных** окно, перетащите **продукта** узел на строку сетки под строкой с кнопками.

     Visual Studio создает XAML, который определяет набор элементов управления, привязанных к данным в **продуктов** таблицы. Также создается код, который загружает эти данные. Дополнительные сведения о созданных XAML и кода, см. в разделе [элементы управления WPF, привязка к данным в Visual Studio](../data-tools/bind-wpf-controls-to-data-in-visual-studio.md).

6.  В конструкторе щелкните текстовое поле рядом с полем **идентификатор продукта** метки.

7.  В **свойства** окно, выберите флажок рядом с полем **IsReadOnly** свойство.

## <a name="navigate-product-records"></a>Навигации по записям продуктов

Добавьте код, позволяющий пользователям выполнять прокрутку записей продуктов с помощью **\<** и **>** кнопки.

1.  В конструкторе, дважды щелкните **<** кнопки на поверхности окна.

     Visual Studio открывает файл кода и создает новую `backButton_Click` обработчик событий для <xref:System.Windows.Controls.Primitives.ButtonBase.Click> событий.

2.  Изменить `Window_Loaded` обработчик событий, поэтому `ProductViewSource`, `AdventureWorksLTDataSet`, и `AdventureWorksLTDataSetProductTableAdapter` вне пределов метода, и доступны всей форме. Объявите только их глобальным в форму и назначьте их в `Window_Loaded` обработчик событий, аналогичную следующей:

     [!code-csharp[Data_WPFDATASET#1](../data-tools/codesnippet/CSharp/bind-wpf-controls-to-a-dataset_1.cs)]
     [!code-vb[Data_WPFDATASET#1](../data-tools/codesnippet/VisualBasic/bind-wpf-controls-to-a-dataset_1.vb)]

3.  Добавьте следующий код в обработчик событий `backButton_Click` .

     [!code-csharp[Data_WPFDATASET#2](../data-tools/codesnippet/CSharp/bind-wpf-controls-to-a-dataset_2.cs)]
     [!code-vb[Data_WPFDATASET#2](../data-tools/codesnippet/VisualBasic/bind-wpf-controls-to-a-dataset_2.vb)]

4.  Вернитесь в конструктор и дважды щелкните **>** кнопки.

5.  Добавьте следующий код в обработчик событий `nextButton_Click` .

     [!code-csharp[Data_WPFDATASET#3](../data-tools/codesnippet/CSharp/bind-wpf-controls-to-a-dataset_3.cs)]
     [!code-vb[Data_WPFDATASET#3](../data-tools/codesnippet/VisualBasic/bind-wpf-controls-to-a-dataset_3.vb)]

## <a name="save-changes-to-product-records"></a>Сохранить изменения в записях продуктов

Добавьте код, позволяющий пользователям сохранять изменения в записях продуктов с помощью **сохранить изменения** кнопки.

1.  В конструкторе, дважды щелкните **сохранить изменения** кнопки.

     Visual Studio открывает файл кода и создает новую `saveButton_Click` обработчик событий для <xref:System.Windows.Controls.Primitives.ButtonBase.Click> событий.

2.  Добавьте следующий код в обработчик событий `saveButton_Click` .

     [!code-csharp[Data_WPFDATASET#4](../data-tools/codesnippet/CSharp/bind-wpf-controls-to-a-dataset_4.cs)]
     [!code-vb[Data_WPFDATASET#4](../data-tools/codesnippet/VisualBasic/bind-wpf-controls-to-a-dataset_4.vb)]

    > [!NOTE]
    > В этом примере для сохранения изменений используется метод `Save` объекта `TableAdapter`. В данном пошаговом руководстве это целесообразно, так как изменяется только одна таблица данных. Если необходимо сохранить изменения нескольких таблиц, можно воспользоваться методом `UpdateAll` объекта `TableAdapterManager`, который Visual Studio создает вместе с вашим набором данных. Дополнительные сведения см. в разделе [TableAdapters](../data-tools/create-and-configure-tableadapters.md).

## <a name="test-the-application"></a>Тестирование приложения

Выполните сборку и запуск приложения. Убедитесь, что вы можете просмотреть и обновить записи продуктов.

1.  Нажмите клавишу **F5**.

     Выполняется сборка и запуск приложения. Проверьте следующее.

    - Текстовые поля отображают данные из первой записи продукта с фотографией. Этот продукт имеет идентификатор 713 и имя **Long-Sleeve Logo Jersey, S**.

    - Можно щелкнуть **>** или **<** для перехода по другим записям продуктов.

2.  В одной из записей продуктов измените **размер** значение, а затем нажмите кнопку **сохранить изменения**.

3.  Закройте приложение, а затем перезапустите приложение, нажав клавишу **F5** в Visual Studio.

4.  Перейдите к измененной записи продукта и убедитесь, что изменения сохранены.

5.  Закройте приложение.

## <a name="next-steps"></a>Следующие шаги

После выполнения данного пошагового руководства, можно попробовать следующие задачи:

- Сведения об использовании **источников данных** окно в Visual Studio для привязки WPF элементы управления в другие типы источников данных. Дополнительные сведения см. в разделе [элементы управления WPF, привязка к службе данных WCF](../data-tools/bind-wpf-controls-to-a-wcf-data-service.md).

- Сведения об использовании **источников данных** окно в Visual Studio для отображения связанных данных (т. е. данные в родительско дочернее отношение) в элементах управления WPF. Дополнительные сведения см. в разделе [Пошаговое руководство: отображение связанных данных в приложении WPF](../data-tools/display-related-data-in-wpf-applications.md).

## <a name="see-also"></a>См. также

- [Привязка элементов управления WPF к данным в Visual Studio](../data-tools/bind-wpf-controls-to-data-in-visual-studio.md)
- [Инструменты для работы с наборами данных в Visual Studio](../data-tools/dataset-tools-in-visual-studio.md)
- [Общие сведения о привязке данных](/dotnet/framework/wpf/data/data-binding-overview)
