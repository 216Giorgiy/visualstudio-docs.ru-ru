---
title: 'Пошаговое руководство: Настройка вставки, обновления и удаления в классах сущностей | Документация Майкрософт'
ms.custom: ''
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 03ff1146-706e-4780-91cb-56a83df63eea
caps.latest.revision: 6
author: gewarren
ms.author: gewarren
manager: ghogen
ms.openlocfilehash: 4d8ef69258d9c672bb5deb01b9c2e0972d4e8303
ms.sourcegitcommit: 9ceaf69568d61023868ced59108ae4dd46f720ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/12/2018
ms.locfileid: "49193548"
---
# <a name="walkthrough-customizing-the-insert-update-and-delete-behavior-of-entity-classes"></a>Пошаговое руководство: Настройка вставки, обновления и удаления в классах сущностей
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

  
[Средства LINQ to SQL в Visual Studio](../data-tools/linq-to-sql-tools-in-visual-studio2.md) предоставляет визуальную область конструктора для создания и редактирования [!INCLUDE[vbtecdlinq](../includes/vbtecdlinq-md.md)] классов (классов сущностей), основанных на объектах в базе данных. С помощью [LINQ to SQL](http://msdn.microsoft.com/library/73d13345-eece-471a-af40-4cc7a2f11655), вы можете использовать технологию LINQ для доступа к базам данных SQL. Дополнительные сведения см. в разделе [Встроенный язык запросов LINQ](http://msdn.microsoft.com/library/a73c4aec-5d15-4e98-b962-1274021ea93d).  
  
 По умолчанию логику для выполнения обновлений обеспечивает среда выполнения [!INCLUDE[vbtecdlinq](../includes/vbtecdlinq-md.md)]. Среда выполнения по умолчанию создает инструкции Вставить, Обновить и Удалить, основываясь на схеме таблицы (определения столбцов и информация о первичных ключах). Если вы не хотите использовать поведение по умолчанию, то можно конфигурировать поведение обновления и назначить конкретные сохраненные процедуры для выполнения команд Вставить, Обновить и Удалить, необходимых для работы с данными в базе данных. Можно также сделать это, когда поведение по умолчанию не сгенерировано, например, когда ваши классы сущностей сопоставляются с представлениями. Кроме того, можно отменить поведение обновления по умолчанию, когда база данных требует доступа к таблице через сохраненные процедуры. Дополнительные сведения см. в разделе [Настройка операций за счет хранимых процедур](http://msdn.microsoft.com/library/aedbecc1-c33c-4fb4-8861-fdf7e1dc6b8a).  
  
> [!NOTE]
>  В этом пошаговом руководстве требуется доступность **InsertCustomer**, **UpdateCustomer**, и **DeleteCustomer** хранимых процедур для базы данных "Борей". Дополнительные сведения о создании этих хранимых процедурах см. в разделе [Пошаговое руководство: Создание обновление хранимых процедур для таблицы Northwind Customers](../data-tools/walkthrough-creating-update-stored-procedures-for-the-northwind-customers-table.md).  
  
 Это пошаговое руководство обеспечивает действия, которые необходимо выполнить, чтобы отменить поведение по умолчанию среды выполнения LINQ to SQL для сохранения данных обратно в базе данных, используя сохраненные процедуры.  
  
 В рамках данного пошагового руководства вы узнаете, как выполнять следующие задачи.  
  
-   Создание нового приложения Windows Forms и добавление в него файла [!INCLUDE[vbtecdlinq](../includes/vbtecdlinq-md.md)].  
  
-   Создание класса сущностей, который сопоставляется с таблицей Northwind Customers.  
  
-   Создание источника данных об объекте, который ссылается на класс LINQ to SQL Customer.  
  
-   Создание приложения Windows Form, содержащего <xref:System.Windows.Forms.DataGridView>, которое связано с классом Customer  
  
-   Реализуйте для формы функциональные возможности сохранения.  
  
-   Создайте методы <xref:System.Data.Linq.DataContext> путем добавления сохраненных процедур в [!INCLUDE[vs_ordesigner_short](../includes/vs-ordesigner-short-md.md)].  
  
-   Сконфигурируйте класс Configure так, чтобы он использовал сохраненные процедуры Вставить, Обновить и Удалить.  
  
## <a name="prerequisites"></a>Предварительные требования  
 Для выполнения данного пошагового руководства необходимо следующее:  
  
-   Доступ к версии SQL Server учебной базы данных "Борей". Дополнительные сведения см. в разделе [как: установить образцы баз данных](../data-tools/how-to-install-sample-databases.md).  
  
-   **InsertCustomer**, **UpdateCustomer**, и **DeleteCustomer** хранимых процедур для базы данных "Борей". Дополнительные сведения см. в разделе [Пошаговое руководство: Создание обновление хранимых процедур для таблицы Northwind Customers](../data-tools/walkthrough-creating-update-stored-procedures-for-the-northwind-customers-table.md).  
  
## <a name="creating-an-application-and-adding-linq-to-sql-classes"></a>Создание приложения и добавление классов LINQ to SQL  
 Поскольку вы будете работать с классами [!INCLUDE[vbtecdlinq](../includes/vbtecdlinq-md.md)] и отображать данные на Windows Form, создайте новой приложение Windows Forms и добавьте файл классов LINQ to SQL.  
  
 [!INCLUDE[note_settings_general](../includes/note-settings-general-md.md)]  
  
#### <a name="to-create-a-new-windows-application-project-that-contains-linq-to-sql-classes"></a>Для создания нового проекта Приложение Windows, которое содержит класса LINQ to SQL  
  
1.  Из **файл** меню, создайте новый проект.  
  
2.  Назовите проект **UpdatingwithSProcsWalkthrough**.  
  
    > [!NOTE]
    >  [!INCLUDE[vs_ordesigner_short](../includes/vs-ordesigner-short-md.md)] поддерживается в проектах [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] и C#. Поэтому создайте новый проект на одном из этих языков.  
  
3.  Нажмите кнопку **приложение Windows Forms** шаблона и нажмите кнопку **ОК**. Дополнительные сведения см. в разделе [клиентских приложений](http://msdn.microsoft.com/library/2dfb50b7-5af2-4e12-9bbb-c5ade0e39a68).  
  
     Создается и добавляется в проект UpdatingwithSProcsWalkthrough **обозревателе решений**.  
  
4.  В меню **Проект** выберите пункт **Добавить новый элемент**.  
  
5.  Нажмите кнопку **LINQ to SQL Classes** шаблона и типа **Northwind.dbml** в **имя** поле.  
  
6.  Нажмите кнопку **Добавить**.  
  
     Пустой файл классов LINQ to SQL Classes (Northwind.dbml) добавляется в проект, и открывается [!INCLUDE[vs_ordesigner_short](../includes/vs-ordesigner-short-md.md)].  
  
## <a name="creating-the-customer-entity-class-and-object-data-source"></a>Создание класса сущностей Customer и источника данных об объекте  
 Создание [!INCLUDE[vbtecdlinq](../includes/vbtecdlinq-md.md)] классы, которые сопоставляются с таблицами базы данных путем перетаскивания таблиц из **обозревателя серверов**/**обозреватель баз данных** на [!INCLUDE[vs_ordesigner_short](../includes/vs-ordesigner-short-md.md)]. В результате получите классы сущностей LINQ to SQL, которые сопоставляются с таблицами базы данных. После создания классов сущностей, их можно использовать в качестве источников данных об объекте точно так же как другие классы, которые имеют общие свойства  
  
#### <a name="to-create-a-customer-entity-class-and-configure-a-data-source-with-it"></a>Для создания класса сущностей Customer и настройки с ним источника данных  
  
1.  В **обозревателя серверов**/**обозреватель баз данных**, найдите таблицу Customer в SQL Server версии образца базы данных "Борей". Дополнительные сведения см. в разделе [как: подключение к базе данных "Борей"](../data-tools/how-to-connect-to-the-northwind-database.md).  
  
2.  Перетащите **клиентов** узел из **обозревателя серверов**/**обозреватель баз данных** на [!INCLUDE[vs_ordesigner_short](../includes/vs-ordesigner-short-md.md)] поверхности.  
  
     Класс сущностей с именем **клиента** создается. Он имеет свойства, соответствующие столбцам в таблице Customers. Класс сущности имеет имя **клиента** (не **клиентов**), так как он представляет одного клиента из таблицы Customers.  
  
    > [!NOTE]
    >  Такой режим переименования называется *преобразование во множественную форму*. Его можно включить или отключить [параметры](../ide/reference/options-dialog-box-visual-studio.md). Дополнительные сведения см. в разделе [как: Включение и отключение (реляционный конструктор объектов) плюрализации](../data-tools/how-to-turn-pluralization-on-and-off-o-r-designer.md).  
  
3.  На **построения** меню, щелкните **Build UpdatingwithSProcsWalkthrough** для сборки проекта.  
  
4.  В меню **Данные** выберите команду **Показать источники данных**.  
  
5.  В окне **Источники данных** выберите **Добавить новый источник данных**.  
  
6.  Нажмите кнопку **объект** на **Выбор типа источника данных** странице и нажмите кнопку **Далее**.  
  
7.  Разверните **UpdatingwithSProcsWalkthrough** узла и найдите и выберите **клиента** класса.  
  
    > [!NOTE]
    >  Если **клиента** класс недоступен, отмените работу мастера, постройте проект и снова запустите мастер.  
  
8.  Нажмите кнопку **Готово** для создания источника данных и добавления **клиента** класса сущности **источников данных** окна.  
  
## <a name="creating-a-datagridview-to-display-the-customer-data-on-a-windows-form"></a>Создание представления DataGridView для отображения данных класса Customer на Windows Form  
 Создание элементов управления, привязанных к классам сущностей, перетаскивая [!INCLUDE[vbtecdlinq](../includes/vbtecdlinq-md.md)] пунктов из источника данных **источников данных** окна в форму Windows.  
  
#### <a name="to-add-controls-that-are-bound-to-the-entity-classes"></a>Для добавления элементов управления, привязанных к классам сущностей  
  
1.  Откройте форму Form1 в конструкторе.  
  
2.  Из **источников данных** окно, перетащите **клиента** узел на форму Form1.  
  
    > [!NOTE]
    >  Для отображения **источников данных** окно, нажмите кнопку **Показать источники данных** на **данных** меню.  
  
3.  Откройте форму Form1 в редакторе кода.  
  
4.  Добавьте следующий код в форму, которая является глобальной по отношению к форме, находящейся за пределами любого конкретного метода, но внутри класса Form1:  
  
    ```vb  
    Private NorthwindDataContext1 As New NorthwindDataContext  
    ```  
  
    ```csharp  
    private NorthwindDataContext northwindDataContext1  
        = new NorthwindDataContext();  
  
    ```  
  
5.  Создайте обработчик события для события `Form_Load` и добавьте в обработчик следующий код:  
  
    ```vb  
    CustomerBindingSource.DataSource = NorthwindDataContext1.Customers  
    ```  
  
    ```csharp  
    customerBindingSource.DataSource  
        = northwindDataContext1.Customers;  
  
    ```  
  
## <a name="implementing-save-functionality"></a>Реализация кнопки Save Functionality (Сохранить функциональные возможности)  
 По умолчанию опция создания кнопки Сохранить не активизирована и реализовать сохранение функциональных возможностей невозможно. Итак, код для сохранения измененных данных в базе данных, когда создаются привязанные к данным элементы управления для источников данных об объекте, не будет автоматически добавляться. В этом разделе объясняется как включить опцию создания кнопки Сохранить и включить кнопку Сохранить функциональные возможности для объектов [!INCLUDE[vbtecdlinq](../includes/vbtecdlinq-md.md)].  
  
#### <a name="to-implement-save-functionality"></a>Для реализации кнопки Save Functionality (Сохранить функциональные возможности)  
  
1.  Откройте форму Form1 в конструкторе.  
  
2.  Установите сохранить, нажмите кнопку **CustomerBindingNavigator** (кнопка со значком гибкого диска).  
  
3.  В **свойства** окне **включено** свойства **True**.  
  
4.  Дважды щелкните кнопку сохранить, чтобы создать обработчик события и переключиться в редактор кода.  
  
5.  Добавьте в обработчик события для кнопки Сохранить следующий код:  
  
    ```vb  
    NorthwindDataContext1.SubmitChanges()  
    ```  
  
    ```csharp  
    northwindDataContext1.SubmitChanges();  
    ```  
  
## <a name="overriding-the-default-behavior-for-performing-updates-inserts-updates-and-deletes"></a>Переопределение поведения по умолчанию для выполнения обновлений (Inserts, Updates и Deletes)  
  
#### <a name="to-override-the-default-update-behavior"></a>Для переопределения поведения по умолчанию при обновлении  
  
1.  Откройте файл LINQ to SQL в [!INCLUDE[vs_ordesigner_short](../includes/vs-ordesigner-short-md.md)]. (Дважды щелкните **Northwind.dbml** файл **обозревателе решений**.)  
  
2.  В **обозревателя серверов**/**обозреватель баз данных**, разверните базы данных "Борей" **хранимые процедуры** узла и найдите  **InsertCustomers**, **UpdateCustomers**, и **DeleteCustomers** хранимых процедур.  
  
3.  Перетащите все три сохраненные процедуры на [!INCLUDE[vs_ordesigner_short](../includes/vs-ordesigner-short-md.md)].  
  
     Сохраненные процедуры добавляются в дерево методов как методы <xref:System.Data.Linq.DataContext>. Дополнительные сведения см. в разделе [методы DataContext (реляционный конструктор объектов)](../data-tools/datacontext-methods-o-r-designer.md).  
  
4.  Выберите **клиента** класс сущностей в [!INCLUDE[vs_ordesigner_short](../includes/vs-ordesigner-short-md.md)].  
  
5.  В **свойства** выберите **вставить** свойство.  
  
6.  Нажмите кнопку с многоточием (...) рядом с полем **использовать среду выполнения** открыть **Конфигурирование поведения** диалоговое окно.  
  
7.  Выберите **настроить**.  
  
8.  Выберите **InsertCustomers** метод в **Настройка** списка.  
  
9. Нажмите кнопку **применить** сохранить конфигурацию для выбранного класса и поведения.  
  
    > [!NOTE]
    >  Можно продолжить настройку режима для каждого сочетания класса и режима, как вы нажмете кнопку **применить** после каждого изменения. Если изменить класс или поведения, прежде чем нажимать кнопку **применить**, предоставляя возможность применить все изменения, появится диалоговое окно предупреждения.  
  
10. Выберите **обновление** в **поведение** списка.  
  
11. Выберите **настроить**.  
  
12. Выберите **UpdateCustomers** метод в **Настройка** списка.  
  
     Проверьте список **аргументы метода** и **свойства класса** и обратите внимание, что существует два **аргументы метода** и два **свойства класса**для некоторых столбцов в таблице. Это облегчает возможность прослеживать изменения и создавать инструкции, которые проверяют нарушения параллелизма.  
  
13. Карта **Original_CustomerID** аргумент метода для **CustomerID (Original)** свойства класса.  
  
    > [!NOTE]
    >  По умолчанию аргументы метода будут сопоставлены со свойствами класса, если их имена совпадают. Если имена свойств были изменены и больше не совпадают в таблице и в классе сущностей, то может потребоваться выбор эквивалентного свойства класса для сопоставления, если реляционный конструктор объектов не может определить правильное сопоставление. Кроме того, если аргументы метода не имеют допустимые свойства класса для сопоставления, можно задать **свойства класса** значение **(нет)**.  
  
14. Нажмите кнопку **применить** сохранить конфигурацию для выбранного класса и поведения.  
  
15. Выберите **удалить** в **поведение** списка.  
  
16. Выберите **настроить**.  
  
17. Выберите **DeleteCustomers** метод в **Настройка** списка.  
  
18. Карта **Original_CustomerID** аргумент метода для **CustomerID (Original)** свойства класса.  
  
19. Нажмите кнопку **ОК**.  
  
> [!NOTE]
>  Хотя это не повлияет на работу данного пошагового руководства, следует заметить, что [!INCLUDE[vbtecdlinq](../includes/vbtecdlinq-md.md)] автоматически обрабатывает значения, создаваемые в базе данных, для столбцов идентификаторов (с автоматическим приращением), столбцов rowguidcol (идентификатор GUID, создаваемый базой данных) и столбцов timestamp в ходе операций вставки и обновления. Генерируемые базой данных значения в других типах столбцов будут неожиданно давать нулевое значение. Для возврата генерируемых базой данных значений нужно вручную задать <xref:System.Data.Linq.Mapping.ColumnAttribute.IsDbGenerated%2A> в `true` и <xref:System.Data.Linq.Mapping.ColumnAttribute.AutoSync%2A> в одно из следующих: <xref:System.Data.Linq.Mapping.AutoSync>, <xref:System.Data.Linq.Mapping.AutoSync> или <xref:System.Data.Linq.Mapping.AutoSync>.  
  
## <a name="testing-the-application"></a>Тестирование приложения  
 Запустите приложение снова, чтобы убедиться, что **UpdateCustomers** хранимой процедуры правильно обновляет запись клиента в базе данных.  
  
#### <a name="to-test-the-application"></a>Тестирование приложения  
  
1.  Нажмите клавишу F5.  
  
2.  Измените запись в таблице, чтобы проверить поведение Обновления.  
  
3.  Добавьте новую запись, чтобы проверить поведение Вставки.  
  
4.  Нажмите кнопку Сохранить, чтобы сохранить изменения в базе данных.  
  
5.  Закройте форму.  
  
6.  Нажмите клавишу F5 и убедитесь, что обновленная запись и недавно вставленная запись сохранились.  
  
7.  Удалите новую запись, чтобы проверить поведение Удаления.  
  
8.  Нажмите кнопку Сохранить, чтобы представить изменения и стереть удаленную запись из базы данных  
  
9. Закройте форму.  
  
10. Нажмите клавишу F5 и убедитесь, что удаленная запись была стерта из базы данных.  
  
    > [!NOTE]
    >  Если приложение использует SQL Server Express Edition, в зависимости от значения **Копировать в выходной каталог** свойство файла базы данных, изменения могут не отображаться при нажатии клавиши F5 на шаге 10. Дополнительные сведения см. в разделе [как: управление локальные файлы данных, в проект](../data-tools/how-to-manage-local-data-files-in-your-project.md).  
  
## <a name="next-steps"></a>Следующие шаги  
 В зависимости от требований приложения есть несколько шагов, которые возможно потребуется выполнить после создания классов сущностей [!INCLUDE[vbtecdlinq](../includes/vbtecdlinq-md.md)]. Ниже приводится перечень рекомендаций, позволяющих улучшить данное приложение.  
  
-   Реализуйте конкурентную проверку во время обновлений. Сведения см. в разделе [оптимистичный параллелизм: Обзор](http://msdn.microsoft.com/library/c2e38512-d0c8-4807-b30a-cb7e30338694).  
  
-   Добавьте запросы LINQ в данные фильтра Сведения см. в разделе [введение в запросы LINQ (C#)](http://msdn.microsoft.com/library/37895c02-268c-41d5-be39-f7d936fa88a8).  
  
## <a name="see-also"></a>См. также  
 [Средства LINQ to SQL в Visual Studio](../data-tools/linq-to-sql-tools-in-visual-studio2.md)   
 [LINQ to SQL](http://msdn.microsoft.com/library/73d13345-eece-471a-af40-4cc7a2f11655)   
 [Запросы LINQ to SQL](http://msdn.microsoft.com/library/f4897aaa-7f44-4c20-a471-b948c2971aae)   
 [Методы DataContext (реляционный конструктор объектов)](../data-tools/datacontext-methods-o-r-designer.md)   
 [Практическое: назначение хранимых процедур для выполнения обновлений, вставок и удалений (реляционный конструктор объектов)](../data-tools/how-to-assign-stored-procedures-to-perform-updates-inserts-and-deletes-o-r-designer.md)   
 [PAVE новые возможности для разработки данных приложений в Visual Studio 2012](http://msdn.microsoft.com/en-us/3d50d68f-5f44-4915-842f-6d42fce793f1)

