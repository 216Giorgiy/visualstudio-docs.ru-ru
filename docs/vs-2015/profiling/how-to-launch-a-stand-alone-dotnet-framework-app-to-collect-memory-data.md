---
title: Практическое руководство. Запуск автономного приложения .NET Framework с профилировщиком для сбора данных об использовании памяти с помощью командной строки | Документы Майкрософт
ms.custom: ''
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.reviewer: ''
ms.suite: ''
ms.technology:
- vs-ide-debug
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 3bc53041-91b7-4ad0-8413-f8bf2c4b3f5e
caps.latest.revision: 33
author: mikejo5000
ms.author: mikejo
manager: ghogen
ms.openlocfilehash: fe93aee18146aeeebbef01095f929b1ade38871e
ms.sourcegitcommit: 9ceaf69568d61023868ced59108ae4dd46f720ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/12/2018
ms.locfileid: "49208511"
---
# <a name="how-to-launch-a-stand-alone-net-framework-application-with-the-profiler-to-collect-memory-data-by-using-the-command-line"></a>Практическое руководство. Запуск автономного приложения .NET Framework с профилировщиком для сбора данных об использовании памяти с помощью командной строки
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

В этом разделе описывается использование программ командной строки средств профилирования [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] для запуска автономного (клиентского) приложения .NET Framework и сбора данных о памяти.  
  
 Сеанс профилирования состоит из трех этапов:  
  
-   Запуск приложения с помощью профилировщика  
  
-   Сбор данных профилирования  
  
-   Завершение сеанса профилирования  
  
> [!NOTE]
>  Программы командной строки средств профилирования расположены в подкаталоге \Team Tools\Performance Tools каталога установки [!INCLUDE[vs_current_short](../includes/vs-current-short-md.md)]. На 64-разрядных компьютерах доступны 64- и 32-разрядные версии этих программ. Для использования программ командной строки профилировщика необходимо добавить путь к программам в переменную среды PATH окна командной строки или в саму команду. Дополнительные сведения см. в статье [Указание пути к средствам командной строки](../profiling/specifying-the-path-to-profiling-tools-command-line-tools.md).  
  
## <a name="starting-the-application-with-the-profiler"></a>Запуск приложения с помощью профилировщика  
 Чтобы запустить целевое приложение с помощью профилировщика, воспользуйтесь параметрами **VSPerfCmd.exe /start** и **/launch** для инициализации профилировщика и запуска приложения. Параметры **/start** и **/launch** с соответствующими параметрами можно указать в одной командной строке.  
  
 Можно также добавить параметры **/globaloff** для приостановки сбора данных при запуске целевого приложения. Затем используйте параметр **/globalon** для запуска сбора данных.  
  
#### <a name="to-start-an-application-by-using-the-profiler"></a>Запуск приложения с помощью профилировщика  
  
1.  Откройте окно командной строки.  
  
2.  Запуск профилировщика. Тип:  
  
     **VSPerfCmd /start:sample /output:** `OutputFile` [`Options`]  
  
    -   Параметр [/start](../profiling/start.md)**:sample** инициализирует профилировщик.  
  
    -   Параметр [/output](../profiling/output.md)**:**`OutputFile` является обязательным для параметра **/start**. `OutputFile` указывает имя и расположение файла данных профилирования (VSP-файла).  
  
     С параметром **/start:sample** можно использовать любой из следующих параметров.  
  
    |Параметр|Описание|  
    |------------|-----------------|  
    |[/wincounter](../profiling/wincounter.md) **:** `WinCounterPath`|Задает счетчик производительности Windows, данные которого будут собираться во время профилирования.|  
    |[/automark](../profiling/automark.md) **:** `Interval`|Используется с только с параметром **/wincounter**. Указывает время (в миллисекундах) между событиями сбора счетчика производительности Windows. Значение по умолчанию — 500 мс.|  
  
3.  Запустите целевое приложение. Тип:  
  
     **VSPerfCmd**  [/launch](../profiling/launch.md) **:** `appName` **/gc:**{**allocation**&#124;**lifetime**}[`Options`]  
  
    -   Параметр [/gc](../profiling/gc-vsperfcmd.md)**:**`Keyword` требуется для сбора данных памяти .NET Framework. Параметр ключевого слова указывает, требуется ли собирать данные о выделении памяти или данные о времени существования объекта и выделении памяти.  
  
        |Ключевое слово|Описание|  
        |-------------|-----------------|  
        |**allocation**|Сбор только данных о выделении памяти.|  
        |**lifetime**|Сбор данных о выделении памяти и времени существования объекта.|  
  
     С параметром **/launch** можно использовать любой из следующих параметров.  
  
    |Параметр|Описание|  
    |------------|-----------------|  
    |[/args](../profiling/args.md) **:** `Arguments`|Указывает строку, которая содержит аргументы командной строки для передачи в целевое приложение.|  
    |[/console](../profiling/console.md)|Запускает целевое приложение командной строки в отдельном окне.|  
    |[/events](../profiling/events-vsperfcmd.md) **:** `Config`|Задает события трассировки событий для Windows (ETW), собираемые во время профилирования. События трассировки событий Windows собираются в отдельный ETL-файл.|  
    |[/targetclr](../profiling/targetclr.md) **:** `Version`|Указывает версию профилируемой среды CLR, если в приложении загружено несколько версий среды выполнения.|  
  
## <a name="controlling-data-collection"></a>Управление сбором данных  
 Пока целевое приложение выполняется, вы можете управлять сбором данных путем запуска и остановки записи данных в файл, используя параметры **VSPerfCmd.exe**. Управление сбором данных позволяет собирать данные на конкретных этапах выполнения программы, например при запуске или завершении работы приложения.  
  
#### <a name="to-start-and-stop-data-collection"></a>Запуск и остановка сбора данных  
  
-   Следующие пары параметров запускают и останавливают сбор данных. Каждый параметр необходимо указывать в отдельной командной строке. Сбор данных можно включать и отключать несколько раз.  
  
    |Параметр|Описание|  
    |------------|-----------------|  
    |[/globalon /globaloff](../profiling/globalon-and-globaloff.md)|Запускает (**/globalon**) или останавливает (**/globaloff**) сбор данных для всех процессов.|  
    |[/processon](../profiling/processon-and-processoff.md) **:** `PID` [processoff](../profiling/processon-and-processoff.md) **:** `PID`|Запускает (**/processon**) или останавливает (**/processoff**) сбор данных для процесса с указанным идентификатором процесса (`PID`).|  
    |[/attach](../profiling/attach.md) **:** `PID` [/detach](../profiling/detach.md)|**/attach** запускает сбор данных для процесса с указанным идентификатором (`PID`). **/detach** останавливает сбор данных для всех процессов.|  
  
-   Можно также использовать параметр **VSPerfCmd.exe**[/mark](../profiling/mark.md) для добавления метки профилирования в файл данных. Команда **/mark** добавляет идентификатор, отметку времени и необязательную определяемую пользователем текстовую строку. Метки можно использовать для фильтрации данных.  
  
## <a name="ending-the-profiling-session"></a>Завершение сеанса профилирования  
 Для завершения сеанса профилирования профилировщик необходимо отключить от всех профилируемых процессов, кроме того, необходимо явным образом завершить его работу. Вы можете отключить профилировщик от приложения, профилируемого с помощью метода выборки, закрыв приложение или вызвав параметр **VSPerfCmd /detach**. Затем можно вызвать параметр **VSPerfCmd /shutdown**, чтобы завершить работу профилировщика и закрыть файл данных профилирования. Команда **VSPerfClrEnv /off** сбрасывает переменные среды профилирования.  
  
#### <a name="to-end-a-profiling-session"></a>Завершение сеанса профилирования  
  
1.  Выполните одно из следующих действий, чтобы отключить профилировщик от целевого приложения.  
  
    -   Закройте целевое приложение.  
  
         - или -  
  
    -   Введите команду **VSPerfCmd /detach**.  
  
2.  Завершите работу профилировщика. Тип:  
  
     **VSPerfCmd**  [/shutdown](../profiling/shutdown.md)  
  
## <a name="see-also"></a>См. также  
 [Профилирование автономных приложений](../profiling/command-line-profiling-of-stand-alone-applications.md)   
 [Представления данных в памяти .NET](../profiling/dotnet-memory-data-views.md)



