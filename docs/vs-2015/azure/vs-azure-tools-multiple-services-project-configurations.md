---
title: Настройка проекта Azure с помощью нескольких конфигураций службы | Документация Майкрософт
description: Сведения о настройке проекта облачной службы путем изменения файлов ServiceDefinition.csdef, ServiceConfiguration.Local.cscfg и ServiceConfiguration.Cloud.cscfg.
author: ghogen
manager: douge
assetId: a4fb79ed-384f-4183-9f74-5cac257206b9
ms.prod: visual-studio-dev14
ms.technology: vs-azure
ms.custom: vs-azure
ms.workload: azure-vs
ms.topic: conceptual
ms.date: 11/11/2017
ms.author: ghogen
ms.openlocfilehash: f309c2a960d011601a9fdd41e29d767c667de838
ms.sourcegitcommit: e481d0055c0724d20003509000fd5f72fe9d1340
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2018
ms.locfileid: "51002934"
---
# <a name="configuring-your-azure-project-in-visual-studio-to-use-multiple-service-configurations"></a>Настройка проекта Azure в Visual Studio для использования нескольких конфигураций службы

В проект Azure облачной службы в Visual Studio включает три файла конфигурации: `ServiceDefinition.csdef`, `ServiceConfiguration.Local.cscfg`, и `ServiceConfiguration.Cloud.cscfg`:

- `ServiceDefinition.csdef` развертывается в Azure для описания требований облачной службы и его ролей, а также для предоставления параметров, которые применяются ко всем экземплярам. Параметры могут считываться в среде выполнения с помощью API размещения среды выполнения Azure службы. Этот файл можно обновить в Azure, только в том случае, если облачная служба остановлена.
- `ServiceConfiguration.Local.cscfg` и `ServiceConfiguration.Cloud.cscfg` предоставляют значения для параметров в определении файла и укажите число экземпляров для запуска для каждой роли. Файл «Local» содержит значения, используемые в локальной отладки; Этот файл «Облако» будет развернут в Azure как `ServiceConfiguration.cscfg` и предоставляет настройки для среды сервера. Этот файл можно обновить во время работы облачной службы в Azure.

Параметры конфигурации управляемых и изменяются в Visual Studio, с помощью страниц свойств применимой роли (щелкните правой кнопкой мыши роль и выберите **свойства**, или дважды щелкните роль). Изменения могут быть распространены на любую конфигурацию, выбранную в **конфигурации службы** раскрывающегося списка. Свойства для рабочих и веб-ролей схожи, за исключением там, где описано в следующих разделах.

![VS_Solution_Explorer_Roles_Properties](./media/vs-azure-tools-multiple-services-project-configurations/IC784076.png)

Сведения о базовых схемах для определения службы и файлы конфигурации службы, см. в разделе [csdef-файл схемы XML](/azure/cloud-services/schema-csdef-file.md) и [cscfg-файл схемы XML](/azure/cloud-services/schema-cscfg-file.md) статей. Дополнительные сведения о конфигурации службы, см. в разделе [Настройка облачных служб](/azure/cloud-services/cloud-services-how-to-configure-portal).


## <a name="configuration-page"></a>Страница «Конфигурация»

### <a name="service-configuration"></a>Конфигурация службы

SELECT, которые `ServiceConfiguration.*.cscfg` файла зависит от изменения. По умолчанию являются Local и Cloud, а также можно использовать **управление...**  команды для копирования, переименования и удаления файлов конфигурации. Эти файлы добавляются в проект облачной службы и появляются в **обозревателе решений**. Тем не менее переименовать или удалить конфигурации можно только из этого элемента управления.

### <a name="instances"></a>Экземпляры

Задайте **экземпляр** подсчитать количество экземпляров, для этой роли должна запускаться служба.

Задайте **размер виртуальной Машины** свойства **очень мелкий**, **небольшой**, **Средний**, **крупный**, или **Очень крупный**.  Дополнительные сведения см. в разделе [размеры для облачных служб](/azure/cloud-services/cloud-services-sizes-specs).

### <a name="startup-action-web-role-only"></a>Действие при запуске (только для веб-роли)

Установите это свойство, чтобы указать, что при запуске отладки, Visual Studio должна запускать веб-браузер для конечных точек HTTP или HTTPS конечные точки или оба.

**Конечную точку HTTPS** параметр доступен только в том случае, если конечная точка HTTPS уже определена для вашей роли. Вы можете определить конечную точку HTTPS на **конечные точки** страницу свойств.

Если вы уже добавили конечную точку HTTPS, параметр конечной точки HTTPS включен по умолчанию, и Visual Studio запустит браузер для этой конечной точки, при запуске отладки, браузер для конечной точки HTTP, при условии, что включены оба параметра запуска.

### <a name="diagnostics"></a>Диагностика

По умолчанию для веб-роли включены диагностические сообщения. Учетная запись хранилища и проекта службы облако Azure устанавливаются для использования эмулятора локального хранилища. Когда будете готовы к развертыванию в Azure, можно выбрать кнопку конструктора (**...** ) чтобы использовать хранилище Azure. Можно перенести данные диагностики в учетную запись хранения по требованию или по автоматически заданному расписанию. Дополнительные сведения о системе диагностики Azure см. в разделе [включение диагностики в облачных службах Azure и виртуальные машины](/azure/cloud-services/cloud-services-dotnet-diagnostics).

## <a name="settings-page"></a>Странице "Параметры"

На **параметры** страницы, можно добавить параметры конфигурации как пары "имя значение". Код, выполняемый в роли можно считывать значения параметров конфигурации во время выполнения с помощью классов, предоставляемых [управляемая библиотека Azure](http://go.microsoft.com/fwlink?LinkID=171026), в частности, [GetConfigurationSettingValue](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.getconfigurationsettingvalue.aspx) метод.

### <a name="configuring-a-connection-string-for-a-storage-account"></a>Настройка строки подключения для учетной записи хранения

Строка подключения — это параметр, который предоставляет сведения о подключении и проверке подлинности для эмулятора хранения или учетная запись хранилища Azure. Каждый раз, когда код в роли получает хранилища Azure (большие двоичные объекты, очереди или таблицы), ему строку подключения.

> [!Note]
> Строку подключения для учетной записи хранения Azure необходимо использовать определенный формат (см. в разделе [Настройка строк подключения хранилища Azure](/azure/storage/common/storage-configure-connection-string)).

Можно задать строку подключения для использования локального хранилища, при необходимости задайте учетную запись хранилища Azure при развертывании приложения в облачную службу. Не удалось правильно установить строку подключения может привести к вашей роли не сможет запуститься, или чтобы переключаться между состояниями инициализации, занятости и остановки.

Чтобы создать строку подключения, выберите **добавить параметр** и задайте **тип** «Строка подключения».

Для новой или имеющейся строки подключения, выберите **...** * в правой части **значение** поля, чтобы открыть **Создание строки подключения хранилища** диалоговое окно:

1. В разделе **подключиться с помощью**, выберите **подписке** параметр, чтобы выбрать учетную запись хранения из подписки. Visual Studio, затем получает учетные данные учетной записи хранения автоматически из `.publishsettings` файла.
1. Выбрав **ручной ввод учетных данных** позволяет указать имя учетной записи и ключа, с использованием информации из портала Azure. Чтобы скопировать ключ учетной записи:
    1. Перейдите к учетной записи хранения на портале Azure и выберите **управление ключами**.
    1. Чтобы скопировать ключ учетной записи, перейдите к учетной записи хранения на портале Azure выберите **параметры > ключи доступа**, затем скопируйте первичный ключ доступа в буфер обмена с помощью кнопки копирования.
1. Выберите один из вариантов подключения. **Укажите настраиваемые конечные точки** просит указать определенные URL-адреса для BLOB-объектов, таблиц и помещает в очередь. Пользовательские конечные точки позволяют использовать [пользовательских доменов](/azure/storage/blobs/storage-custom-domain-name.md) и для более точного управления доступом. См. в разделе [Настройка строк подключения службы хранилища Azure](/azure/storage/common/storage-configure-connection-string).
1. Выберите **ОК**, затем **файл > Сохранить** для обновления конфигурации с новую строку подключения.

Опять же при публикации приложения в Azure, выберите конфигурацию службы, которая содержит учетную запись хранения Azure для строки подключения. После публикации приложения убедитесь, что приложение работает как ожидалось в отношении служб хранилища Azure.

Дополнительные сведения об обновлении конфигураций служб см. в разделе [управление строками подключения для учетных записей хранения](vs-azure-tools-configure-roles-for-cloud-service.md#manage-connection-strings-for-storage-accounts).

## <a name="endpoints-page"></a>Страница конечных точек

Веб-роль обычно имеет одну конечную точку HTTP на порт 80. С другой стороны, рабочей роли, может иметь любое количество конечных точек HTTP, HTTPS или TCP. Конечные точки могут быть входными конечными точками, которые доступны для внешних клиентов, или внутренние конечные точки, которые доступны для других ролей, запущенных в службе.

- Для предоставления конечной точки HTTP внешним клиентам и веб-браузерам, измените тип конечной точки для ввода и укажите имя и номер общего порта.
- Для предоставления конечной точки HTTPS внешним клиентам и веб-браузерам, измените тип конечной точки на **ввода**и укажите имя, номер общего порта и имя сертификата управления. Также необходимо определить сертификат на **сертификаты** страницу свойств, прежде чем указывать сертификат управления. 
- Чтобы предоставить другим ролям в облачной службе внутренний доступ к конечной точке, измените тип конечной точки для внутренней и укажите имя и возможные частные порты для этой конечной точки.

## <a name="local-storage-page"></a>Страница локального хранилища

Можно использовать **локальное хранилище** страницу свойств для резервирования одного или нескольких ресурсов локального хранилища для роли. Локальный ресурс хранилища — это зарезервированный каталог в файловой системе виртуальной машины Azure, в котором выполняется экземпляр роли.

## <a name="certificates-page"></a>Страница «сертификаты»

**Сертификаты** свойство добавляет сведения о сертификатах в конфигурацию службы. Обратите внимание на то, что сертификаты не поставляются вместе со службы; Вам необходимо отдельно передавать в Azure с помощью [портала Azure](http://portal.azure.com).

Добавление сертификата на этой странице добавляет сведения о сертификатах в конфигурацию службы. Сертификаты не поставляются со службой; Вам необходимо передавать отдельно с помощью портала Azure.

Чтобы связать сертификат с вашей роли, укажите имя для сертификата. Это имя используется для ссылки на сертификат при настройке конечной точки HTTPS на **конечные точки** страницы. Затем укажите, является ли хранилище сертификатов **локального компьютера** или **текущего пользователя** и имя хранилища. Наконец введите отпечаток сертификата. Если сертификат находится в хранилище текущего пользователя или хранилище, можно ввести отпечаток сертификата, выбрав сертификат из заполненного списка. Если он находится в любом другом месте, введите значение отпечатка вручную.

Когда вы добавляете сертификат из хранилища сертификатов, любые промежуточные сертификаты автоматически добавляются к параметрам конфигурации для вас. Кроме того эти промежуточные сертификаты необходимо передать в Azure, чтобы правильно настроить службу для использования протокола SSL.

Все сертификаты управления, связанные со службой применяются к службе только в том случае, если он выполняется в облаке. Если служба запущена в локальной среде разработки, используется стандартный сертификат, который управляется с помощью эмулятора вычислений.
