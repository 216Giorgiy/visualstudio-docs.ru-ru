---
title: Отладка облачной службы Azure или виртуальной машины в Visual Studio | Документация Майкрософт
description: Отладка облачной службы или виртуальной машины в Visual Studio
author: mikejo5000
manager: douge
ms.assetid: 945e06e0-2100-41af-b218-72347367ddab
ms.topic: conceptual
ms.custom: vs-azure
ms.workload: azure-vs
ms.date: 11/11/2016
ms.author: mikejo
ms.prod: visual-studio-dev14
ms.technology: vs-ide-debug
ms.openlocfilehash: b2c67ce81a42df4a17761fcee2dcd2f8a67c4941
ms.sourcegitcommit: e481d0055c0724d20003509000fd5f72fe9d1340
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2018
ms.locfileid: "51002944"
---
# <a name="debugging-an-azure-cloud-service-or-virtual-machine-in-visual-studio"></a>Отладка облачной службы Azure или виртуальной машины в Visual Studio

Visual Studio предоставляет разнообразные варианты отладки облачных служб Azure и виртуальных машин.

## <a name="debug-your-cloud-service-on-your-local-computer"></a>Отладка облачной службы на локальном компьютере

Вы можете сэкономить время и деньги с помощью Azure эмулятора для отладки облачной службы на локальном компьютере. С локальной отладки службы перед ее развертыванием можно улучшить надежность и производительность без необходимости платить за вычислительное время. Тем не менее, некоторые ошибки могут возникнуть только при запуске облачной службы в Azure сам. Эти ошибки можно устранить, если включить удаленную отладку при публикации службы, а затем подключить отладчик к экземпляру роли.

Эмулятор имитирует службу вычислений Azure и запускается в локальной среде, можно протестировать и отладить облачную службу перед ее развертыванием. Эмулятор обрабатывает жизненный цикл экземпляров ролей и предоставляет доступ к имитируемым ресурсам, таким как локальное хранилище. При отладке или запуске службы из Visual Studio, он автоматически запускает эмулятор в качестве фонового приложения и затем выполняет развертывание службы в эмуляторе. Эмулятор можно использовать для просмотра службы, когда оно работает в локальной среде. Можно запустить полную версию или экспресс-версию эмулятора. (Начиная с Azure 2.3 экспресс-версию эмулятора — это значение по умолчанию.) См. в разделе [использование Emulator Express для запуска и отладки облачной службы локально](vs-azure-tools-emulator-express-debug-run.md).

### <a name="to-debug-your-cloud-service-on-your-local-computer"></a>Отладка облачной службы на локальном компьютере

1. В строке меню выберите **Отладка**, **начать отладку** для запуска вашего проекта облачной службы Azure. Кроме того можно нажать клавишу F5. Вы увидите сообщение, которое запускается эмулятор вычислений. При запуске эмулятора, значок на панели задач подтверждает полученную информацию.

    ![Эмулятор Azure в области уведомлений](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC783828.png)

2. Отобразить пользовательский интерфейс эмулятора вычислений, открыв контекстное меню для значка Azure в области уведомлений, а затем выберите **Показать пользовательский Интерфейс эмулятора вычислений**.

    В левой области пользовательского интерфейса показаны службы, которые сейчас развернуты в эмуляторе вычислений и экземпляры ролей, которые запущены все службы. Можно выбрать службу или роль для отображения жизненного цикла, ведение журнала и диагностической информации в области справа. При установке фокуса на верхнее поле окна, оно развернется на правой панели.

3. Пошагово выполняйте приложение, выбрав команды на **Отладка** меню и задание точек останова в коде. При пошаговом выполнении приложения в отладчике, на панелях отображаются обновленные с текущим состоянием приложения. При остановке отладки развертывание приложения удаляется. Если приложение включает веб-роли, и вы задали свойство Startup action для запуска веб-браузера, Visual Studio запускает веб-приложения в браузере. Если изменить количество экземпляров роли в конфигурации службы, необходимо остановить облачную службу и затем перезапустить отладку, чтобы можно было отлаживать эти новые экземпляры роли.

    **Примечание:** при остановке выполнения или отладки службы локальный эмулятор вычислений и эмулятор хранения не останавливаются. Необходимо остановить их явным образом в области уведомлений.

## <a name="debug-a-cloud-service-in-azure"></a>Отладка облачной службы в Azure

Чтобы выполнить отладку облачной службы с удаленного компьютера, необходимо включить эту функциональность явным образом при развертывании облачной службы, чтобы необходимые службы (например, msvsmon.exe) установлены на виртуальных машинах, которые выполняются ваши экземпляры ролей. Если вы не включили удаленную отладку при публикации службы, необходимо повторно опубликовать службу с включенной удаленной отладкой.

Если включить удаленную отладку для облачной службы, он не приводит к снижению производительности или взиматься дополнительная плата. Не используйте удаленную отладку для рабочей службы, так как клиенты, использующие службы может быть нарушена.

> [!NOTE]
> При публикации облачной службы из Visual Studio, вы можете включить **IntelliTrace** для ролей в службе, предназначенных для .NET Framework 4 или .NET Framework 4.5. С помощью **IntelliTrace**, можно изучить события, произошедшие в экземпляре роли в прошлом и воспроизвести контекст за это время. См. в разделе [отладка опубликованной облачной службы с помощью IntelliTrace и Visual Studio](http://go.microsoft.com/fwlink/?LinkID=623016) и [с помощью IntelliTrace](https://msdn.microsoft.com/library/dd264915.aspx).

### <a name="to-enable-remote-debugging-for-a-cloud-service"></a>Чтобы включить удаленную отладку для облачной службы

1. Откройте контекстное меню проекта Azure, а затем выберите **публикации**.

2. Выберите **промежуточной** среды и **Отладка** конфигурации.

    Это только рекомендации. Вы можете запустить тестовую среду в рабочей среде. Тем не менее это может оказать на пользователей, если вы включили удаленную отладку в рабочей среде. Можно выбрать конфигурацию выпуска, но конфигурация отладки облегчает процесс отладки.

    ![Выберите конфигурацию отладки](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746717.gif)

3. Выполните обычные действия, но выберите **включить удаленный отладчик для всех ролей** флажок на **Дополнительные параметры** вкладки.

    ![Конфигурация отладки](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746718.gif)

### <a name="to-attach-the-debugger-to-a-cloud-service-in-azure"></a>Чтобы подключить отладчик к облачной службы в Azure

1. В обозревателе сервера разверните узел для облачной службы.

2. Откройте контекстное меню для роли или экземпляра роли, к которому требуется присоединить, а затем выберите **подключить отладчик**.

    При отладке роли отладчик Visual Studio подключается к каждый экземпляр этой роли. Отладчик остановит в точке останова для первого экземпляра роли, который запускает эту строку кода и удовлетворяет условиям этой точки останова. При отладке экземпляра отладчик подключается только данному экземпляру и останавливается в точке останова только в том случае, если данный конкретный экземпляр запускает эту строку кода и удовлетворяет условиям точки останова.

    ![Присоединить отладчик](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746719.gif)

3. После подключения отладчика к экземпляру, отладку обычным образом. Отладчик автоматически подключается к соответствующему хост-процессу для вашей роли. В зависимости от того, какова роль отладчик подключается к w3wp.exe, WaWorkerHost.exe или WaIISHost.exe. Чтобы проверить процесс, к которому подключен отладчик, разверните узел экземпляра в обозревателе серверов. См. в разделе [архитектура ролей Azure](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx) Дополнительные сведения о процессах Azure.

    ![Выберите тип кода-диалоговое окно](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718346.png)

4. Чтобы определить процессы, к которым присоединен отладчик, откройте диалоговое окно процессов, в строке меню выберите отладки "," Windows "," процессы. (Клавиатура: Ctrl + Alt + Z) Чтобы отключить определенный процесс, откройте его контекстное меню и выберите **отсоединить процесс**. Или, перейдите к узлу экземпляра в обозревателе серверов, найдите процесс, откройте его контекстное меню и выберите **отсоединить процесс**.

    ![Процессы отладки](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC690787.gif)

> [!WARNING]
> Избегайте длинных остановок на точках останова при удаленной отладке. Azure обрабатывает процесс, остановленный дольше, чем на несколько минут, как неработоспособный и перестает отправлять трафик к этому экземпляру. Если вы останавливаете слишком долго, msvsmon.exe отключается от процесса.

Чтобы отсоединить отладчик от всех процессов в экземпляре или роли, откройте контекстное меню для роли или экземпляра, отладки, а затем выберите **отсоединить отладчик**.

## <a name="limitations-of-remote-debugging-in-azure"></a>Ограничения удаленной отладки в Azure

Из пакета Azure SDK 2.3 удаленная отладка имеет следующие ограничения:

* С включенной удаленной отладке нельзя опубликовать облачную службу, в которой любая роль содержит более 25 экземпляров.
* Отладчик использует порты 30400 – 30424, 31400 – 31424 и 32400 – 32424. Если вы попытаетесь использовать любой из этих портов, вы не сможете опубликовать службу, и появится одно из следующих сообщений об ошибке в журнале действий для Azure:

  * Ошибка проверки cscfg-файл файла на основе csdef-файле.
    Зарезервированный диапазон портов «диапазон» для конечной точки Microsoft.WindowsAzure.Plugins.RemoteDebugger.Connector роли «роль» перекрывается с уже заданным портом или диапазоном.
  * Allocation failed. Повторите попытку позже, попробуйте уменьшить размер виртуальной Машины или число экземпляров роли или попробуйте выполнить развертывание в другом регионе.

## <a name="debugging-azure-virtual-machines"></a>Отладка виртуальных машин Azure

Можно выполнять отладку программ, выполняемых на виртуальных машинах Azure с помощью обозревателя сервера в Visual Studio. Если включить удаленную отладку на виртуальной машине Azure, Azure устанавливает расширение удаленной отладки на виртуальной машине. Затем можно подключиться к процессам на виртуальной машине и отладку как обычно.

> [!NOTE]
> Виртуальные машины, созданные через стек диспетчера ресурсов Azure, можно отлаживать удаленно с помощью Cloud Explorer в Visual Studio 2015. Дополнительные сведения см. в разделе [управление ресурсами Azure с помощью Cloud Explorer](http://go.microsoft.com/fwlink/?LinkId=623031).

### <a name="to-debug-an-azure-virtual-machine"></a>Для отладки виртуальной машины Azure

1. В обозревателе сервера разверните узел виртуальных машин и выберите узел той виртуальной машины, который требуется отладить.

2. Откройте контекстное меню и выберите **включить отладку**. При запросе, если вы уверены в том случае, если вы хотите включить отладку на виртуальной машине, выберите **Да**.

    Azure устанавливает расширение удаленной отладки на виртуальной машине для включения отладки.

    ![Виртуальной машины команда включения отладки](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746720.png)

    ![Журнал действий Azure](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746721.png)

3. По окончании установки расширение удаленной отладки откройте контекстное меню виртуальной машины и выберите **присоединить отладчик...**

    Azure получит список процессов на виртуальной машине и отображает их на присоединение к процессу-диалоговое окно.

    ![Команда подключения отладчика](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746722.png)

4. В **присоединение к процессу** выберите **выберите** чтобы ограничить список результатов для отображения только те типы кода для отладки. Можно выполнять отладку управляемого кода, 32-разрядная или 64-разрядной и машинного кода.

    ![Выберите тип кода-диалоговое окно](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718346.png)

5. Выберите процессы для отладки на виртуальной машине, а затем выберите **Attach**. Например можно выбрать процесс w3wp.exe, если требуется выполнить отладку веб-приложения на виртуальной машине. См. в разделе [отладка одного или нескольких процессов в Visual Studio](https://msdn.microsoft.com/library/jj919165.aspx) и [архитектура ролей Azure](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx) Дополнительные сведения.

## <a name="create-a-web-project-and-a-virtual-machine-for-debugging"></a>Создание веб-проекта и виртуальной машины для отладки

Перед публикацией проекта Azure, может оказаться удобным протестировать его в автономной среде, поддерживающий сценарии отладки и тестирования, а где можно установить тестирования и наблюдения. Один из способов запуска таких тестов является удаленная отладка приложения на виртуальной машине.

Проекты Visual Studio ASP.NET позволяют создать удобную виртуальную машину, можно использовать для тестирования приложений. Виртуальная машина включает в себя часто используемые конечные точки, такие как PowerShell, удаленный рабочий стол и WebDeploy.

### <a name="to-create-a-web-project-and-a-virtual-machine-for-debugging"></a>Для создания веб-проекта и виртуальной машины для отладки

1. В Visual Studio создайте новое веб-приложение ASP.NET.

2. В диалоговом окне "новый проект ASP.NET" в разделе Azure выберите **виртуальной машины** в раскрывающемся списке. Оставьте **создать удаленные ресурсы** флажок установленным. Выберите **ОК** для продолжения.

    **Создание виртуальной машины в Azure** откроется диалоговое окно.

    ![Создание диалогового окна проекта web ASP.NET](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746723.png)

    **Примечание:** вам будет предложено войти учетную запись Azure, если вы еще не вошли.

3. Выберите различные параметры для виртуальной машины, а затем выберите **ОК**. См. в разделе [виртуальных машин](http://go.microsoft.com/fwlink/?LinkId=623033) Дополнительные сведения.

    Имя, введенное для DNS-имени будет использоваться имя виртуальной машины.

    ![Создание виртуальной машины в Azure диалоговое окно](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746724.png)

    Azure создает виртуальную машину, а также подготавливает и настраивает конечные точки, такие как удаленный рабочий стол и веб-развертывания

4. После полной настройки виртуальной машины выберите узел виртуальной машины в обозревателе серверов.

5. Откройте контекстное меню и выберите **включить отладку**. При запросе, если вы уверены в том случае, если вы хотите включить отладку на виртуальной машине, выберите **Да**.

    Azure устанавливает расширение удаленной отладки для виртуальной машины для включения отладки.

    ![Виртуальной машины команда включения отладки](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746720.png)

    ![Журнал действий Azure](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746721.png)

6. Опубликуйте проект, как описано в [как: развертывание, публикация веб-проекта с помощью одним щелчком в Visual Studio](https://msdn.microsoft.com/library/dd465337.aspx). Так как вы хотите отладить на виртуальной машине, на **параметры** странице **веб-публикации** мастера выберите **Отладка** качестве конфигурации. Это гарантирует, что доступны символы кода во время отладки.

    ![Параметры публикации](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718349.png)

7. В **параметры публикации файлов**выберите **удалять дополнительные файлы в месте назначения** Если проект уже был развернут ранее.

8. После публикации проекта, в контекстном меню виртуальной машины в обозревателе сервера выберите **присоединить отладчик...**

    Azure получит список процессов на виртуальной машине и отображает их на присоединение к процессу-диалоговое окно.

    ![Команда подключения отладчика](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746722.png)

9. В **присоединение к процессу** выберите **выберите** чтобы ограничить список результатов для отображения только те типы кода для отладки. Можно выполнять отладку управляемого кода, 32-разрядная или 64-разрядной и машинного кода.

    ![Выберите тип кода-диалоговое окно](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718346.png)

10. Выберите процессы для отладки на виртуальной машине, а затем выберите **Attach**. Например можно выбрать процесс w3wp.exe, если требуется выполнить отладку веб-приложения на виртуальной машине. См. в разделе [отладка одного или нескольких процессов в Visual Studio](https://msdn.microsoft.com/library/jj919165.aspx) Дополнительные сведения.

## <a name="next-steps"></a>Следующие шаги

* Используйте **Intellitrace** для сбора данных журнала вызовов и событий с сервера выпуска. См. в разделе [отладка опубликованной облачной службы с помощью IntelliTrace и Visual Studio](http://go.microsoft.com/fwlink/?LinkID=623016).

* Используйте **системы диагностики Azure** для регистрации подробных сведений из кода, выполняющегося в ролях, независимо от роли, используется в среде разработки или в Azure. См. в разделе [сбор данных журналов с помощью системы диагностики Azure](http://go.microsoft.com/fwlink/p/?LinkId=400450).
