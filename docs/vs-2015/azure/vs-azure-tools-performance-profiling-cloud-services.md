---
title: Тестирование производительности облачной службы | Документация Майкрософт
description: Тестирование производительности облачной службы с помощью профилировщика Visual Studio
author: mikejo5000
manager: douge
ms.assetid: 7a5501aa-f92c-457c-af9b-92ea50914e24
ms.topic: conceptual
ms.tgt_pltfrm: multiple
ms.workload: na
ms.date: 11/11/2016
ms.author: mikejo
ms.prod: visual-studio-dev14
ms.technology: vs-azure
ms.openlocfilehash: 25b60e5e4072a0523d17082a5c5646e5bb1ade6a
ms.sourcegitcommit: e481d0055c0724d20003509000fd5f72fe9d1340
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2018
ms.locfileid: "51002407"
---
# <a name="testing-the-performance-of-a-cloud-service"></a>Тестирование производительности облачной службы
## <a name="overview"></a>Обзор
Можно протестировать производительность облачной службы, одним из следующих способов:

* Используйте системы диагностики Azure для сбора сведений о запросах и подключениях и просмотра статистики сайта, которые показывают, как работает служба с точки зрения клиента. Чтобы начать работу с, см. в разделе [настройки диагностики для облачных служб Azure и виртуальных машин](http://go.microsoft.com/fwlink/p/?LinkId=623009).
* Используйте профилировщик Visual Studio, чтобы получить глубокий анализ вычислительных аспектов работы службы. Как описано в этом разделе, можно использовать профилировщик для измерения производительности во время работы службы в Azure. Сведения о том, как использовать профилировщик для измерения производительности во время локальной работы службы в эмуляторе вычислений, см. в разделе [тестирование производительности облачной службы Azure локально в эмуляторе вычислений с помощью Visual Studio Profiler](http://go.microsoft.com/fwlink/p/?LinkId=262845).

## <a name="choosing-a-performance-testing-method"></a>Выбор метода тестирования производительности
### <a name="use-azure-diagnostics-to-collect"></a>Использование диагностики Azure для сбора:
* Статистика по веб-страниц или служб, таких как запросы и соединения.
* Статистика по ролям, например частоты перезапуска роли.
* В целом набора сведения об использовании памяти, таких как процент времени, занимаемого сборщиком мусора и памяти запущенной роли.

### <a name="use-the-visual-studio-profiler-to"></a>Используйте профилировщик Visual Studio для:
* Определите, какие функции принимают больше всего времени.
* Измерения количества времени, занимает каждая часть программы с большим объемом вычислений.
* Сравнения подробных отчетов о производительности для двух версий службы.
* Анализа выделения памяти более подробно, чем уровень отдельных выделений памяти.
* Анализа проблем параллелизма в многопоточном коде.

При использовании профилировщика можно собирать данные при запуске облачной службы локально или в Azure.

### <a name="collect-profiling-data-locally-to"></a>Сбор данных профилирования локально позволит:
* Протестируйте производительность части облачной службы, например, выполнение определенной рабочей роли, которая не требует реалистичного моделирования нагрузки.
* Проверьте производительность облачной службы изолированно в контролируемых условиях.
* Проверьте производительность облачной службы перед его развертыванием в Azure.
* Проверьте производительность облачной службы в частном порядке, без нарушения работы существующих развертываний.
* Проверьте производительность службы без расходов для запуска в Azure.

### <a name="collect-profiling-data-in-azure-to"></a>Сбор данных профилирования в Azure, чтобы:
* Протестируйте производительность облачной службы с моделируемой или реальной нагрузкой.
* Используйте метод инструментирования для сбора данных профилирования, как описано далее в этом разделе.
* Протестируйте производительность службы в той же среде, что для запуска службы в рабочей среде.

Обычно моделируется для нагрузочного тестирования облачных служб обычной или нештатной ситуации.

## <a name="profiling-a-cloud-service-in-azure"></a>Профилирование облачной службы в Azure
При публикации облачной службы из Visual Studio, можно профилировать службу и задать параметры профилирования, которые предоставляют сведения, которые вы хотите. Сеанс профилирования запускается для каждого экземпляра роли. Дополнительные сведения о публикации службы из Visual Studio, см. в разделе [публикация в облачной службе Azure из Visual Studio](https://msdn.microsoft.com/library/azure/ee460772.aspx).

Чтобы узнать больше о профилировании производительности в Visual Studio, см. в разделе [руководство по профилированию производительности для](https://msdn.microsoft.com/library/azure/ms182372.aspx) и [анализ производительности приложения с помощью средств профилирования](https://msdn.microsoft.com/library/azure/z9z62c29.aspx).

> [!NOTE]
> Вы можете включить IntelliTrace или профилирование при публикации облачной службы. Невозможно включить оба.
> 
> 

### <a name="profiler-collection-methods"></a>Методы сбора Profiler
Можно использовать различные методы сбора для профилирования в зависимости от проблемы с производительностью:

* **Выборка циклов ЦП** -этот метод осуществляет сбор статистики приложения, которые удобно использовать для первоначального анализа проблем использования ЦП. Выборка циклов ЦП рекомендуется для большинства операций анализа производительности. Нет минимальным влиянием на приложение, которое при сборе данных выборки ЦП при профилировании.
* **Инструментирование** -этот метод осуществляет сбор подробных данных, который удобен для целенаправленного анализа и анализа проблем производительности ввода/вывода. Метод инструментирования регистрирует каждой записи, выхода и вызова функции из функций в модуле во время профилирования. Этот метод целесообразно использовать с целью сбора подробных сведений о разделе кода для понимания влияния операций ввода-вывода на производительность приложения. Этот метод недоступен для компьютера под управлением 32-разрядной ОС. Этот параметр доступен только при запуске облачной службы в Azure, не локально в эмуляторе вычислений.
* **Выделение памяти .NET** -этот метод осуществляет сбор данных о выделении памяти .NET Framework с помощью метода профилирования с выборкой. Собранные данные включают количество и размер выделенных объектов.
* **Параллелизм** -этот метод осуществляет сбор данных о конфликтах ресурсов и процессов и потоков данных выполнения, которые полезны для анализа многопоточных и многопроцессных приложений. Метод параллелизма предполагает сбор данных для каждого события, которое блокирует выполнение кода, например, когда поток ожидает открытия доступа к заблокированному ресурсу приложения. Этот метод целесообразно использовать при анализе многопоточных приложений.
* Можно также включить **профилирование уровневого взаимодействия**, которое предоставляет дополнительные сведения о времени выполнения синхронных ADO.NET вызовов в функциях многоуровневых приложений, взаимодействующих с одной или нескольких баз данных. Вы можете собирать данные об уровневом взаимодействии с любым из методов профилирования. Дополнительные сведения о профилировании взаимодействия уровней см. в разделе [уровня в представлении](https://msdn.microsoft.com/library/azure/dd557764.aspx).

## <a name="configuring-profiling-settings"></a>Настройка параметров профилирования
Ниже показано, как настроить параметры профилирования из диалогового окна публикации приложений Azure.

![Настройка параметров профилирования](./media/vs-azure-tools-performance-profiling-cloud-services/IC526984.png)

> [!NOTE]
> Чтобы включить **включить профилирование** флажок, вы профилировщик должен быть установлен на локальном компьютере, который используется для публикации облачной службы. По умолчанию профилировщик устанавливается при установке Visual Studio.
> 
> 

### <a name="to-configure-profiling-settings"></a>Для настройки параметров профилирования
1. В обозревателе решений откройте контекстное меню для проекта Azure и выберите **публикации**. Подробные инструкции о том, как опубликовать облачную службу, см. в разделе [публикация облачной службы с помощью инструментов Azure](http://go.microsoft.com/fwlink/p?LinkId=623012).
2. В **опубликовать приложение Azure** диалоговом окне выберите **Дополнительные параметры** вкладки.
3. Чтобы включить профилирование, установите **включить профилирование** "флажок".
4. Чтобы настроить параметры профилирования, выберите **параметры** гиперссылки. Будет открыто диалоговое окно Параметры профилирования.
5. Из **какой способ профилирования вы хотите использовать** переключатели, выберите нужный тип профилирования.
6. Чтобы собирать данные профилирования уровневого взаимодействия, установите **включить профилирование уровневого взаимодействия** "флажок".
7. Чтобы сохранить параметры, выберите **ОК** кнопки.
   
    При публикации этого приложения, эти параметры используются для создания сеанса профилирования для каждой роли.

## <a name="viewing-profiling-reports"></a>Просмотр отчетов профилирования
Сеанс профилирования создается для каждого экземпляра роли в облачной службе. Для просмотра отчетов профилирования каждой сессии из Visual Studio, можно просмотреть окно обозревателя сервера и затем выберите узел вычислений Azure, чтобы выбрать экземпляр роли. Затем можно просмотреть отчет о профилировании, как показано на следующем рисунке.

![Просмотр отчета профилирования Azure](./media/vs-azure-tools-performance-profiling-cloud-services/IC748914.png)

### <a name="to-view-profiling-reports"></a>Для просмотра отчетов профилирования
1. Чтобы просмотреть окно обозревателя сервера в Visual Studio, в строке меню выберите вид, обозреватель серверов.
2. Выберите вычислительный узел Azure и выберите узел развертывания Azure для облачной службы, которую вы выбрали для профилирования при публикации из Visual Studio.
3. Для просмотра отчетов профилирования для экземпляра, выберите роль в службе, откройте контекстное меню для конкретного экземпляра и выберите **Просмотр отчета о профилировании**.
   
    Отчет, VSP-файл будет загружен из Azure, а состояние загрузки отображается в журнале действий Azure. После завершения загрузки, отчет о профилировании появится на вкладке в редакторе Visual Studio с именем <Role name> *<Instance Number>* <identifier>.vsp. Отображается сводка данных для отчета.
4. Для отображения различных представлений отчета, в списке текущего представления, выберите тип нужного представления. Дополнительные сведения см. в разделе [представлений отчетов средств профилирования](https://msdn.microsoft.com/library/azure/bb385755.aspx).

## <a name="next-steps"></a>Следующие шаги
[Отладка облачных служб](https://msdn.microsoft.com/library/azure/ee405479.aspx)

[Публикация облачной службы Azure из Visual Studio](https://msdn.microsoft.com/library/azure/ee460772.aspx)

