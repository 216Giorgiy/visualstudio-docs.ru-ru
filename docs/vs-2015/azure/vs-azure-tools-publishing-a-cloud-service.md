---
title: Публикация облачной службы с помощью инструментов Azure | Документация Майкрософт
description: Узнайте о том, как публиковать проекты облачных служб Azure с помощью Visual Studio.
author: ghogen
manager: douge
assetId: 1a07b6e4-3678-4cbf-b37e-4520b402a3d9
ms.prod: visual-studio-dev14
ms.technology: vs-azure
ms.custom: vs-azure
ms.workload: azure-vs
ms.topic: conceptual
ms.date: 11/11/2017
ms.author: ghogen
ms.openlocfilehash: cf29e1cdde71d2e8ef7caa9bc91bc31c30c7bc41
ms.sourcegitcommit: e481d0055c0724d20003509000fd5f72fe9d1340
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2018
ms.locfileid: "51002857"
---
# <a name="publishing-a-cloud-service-using-visual-studio"></a>Публикация облачной службы из Visual Studio

Visual Studio можно опубликовать приложение напрямую в Azure, поддержка промежуточной и рабочей средах облачной службы. При публикации, выберите среду развертывания и учетную запись хранения, временно используемые для пакета развертывания.

При разработке и тестировании приложения Azure, можно использовать веб-развертывание постепенно публиковать изменения веб-ролей. После публикации приложения в среде развертывания, веб-развертывания позволяет развертывать изменения непосредственно к виртуальной машине, на котором выполняется веб-роли. У вас нет для упаковки и публикации все приложение Azure каждый раз, необходимо обновить веб-роли, чтобы проверить изменения. При таком подходе может иметь доступные изменения веб-роли в облаке для тестирования без ожидания, пока приложение будет публиковаться в среде развертывания.

Используйте следующие процедуры для публикации приложения Azure и обновления веб-роли с помощью веб-развертывания:

- Опубликуйте и упакуйте приложение Azure из Visual Studio
- Обновление веб-роли как часть цикла разработки и тестирования

## <a name="publish-or-package-an-azure-application-from-visual-studio"></a>Опубликуйте и упакуйте приложение Azure из Visual Studio

При публикации приложения Azure, необходимо выполнить одно из следующих задач:

- Создать пакет службы: этот пакет и файл конфигурации службы можно использовать для публикации приложения в среде развертывания из [портала Azure](https://portal.azure.com).

- Публикация проекта Azure из Visual Studio: чтобы опубликовать приложение напрямую в Azure, используйте мастер публикации. Сведения см. в разделе [мастер публикации приложений Azure](vs-azure-tools-publish-azure-application-wizard.md).

### <a name="to-create-a-service-package-from-visual-studio"></a>Чтобы создать пакет службы из Visual Studio

1. Когда будете готовы опубликовать приложение, откройте обозреватель решений, откройте контекстное меню для проекта Azure, который содержит роли и выберите "Опубликовать".

1. Чтобы создать пакет службы, выполните следующие действия.

   1. В контекстном меню проекта Azure, выберите **пакета**.

   2. В **пакета приложения Azure** диалоговом окне выберите конфигурацию службы, для которого требуется создать пакет и затем выберите конфигурацию построения.

   В. (Необязательно) Чтобы включить удаленный рабочий стол для облачной службы после ее публикации, выберите **включить удаленный рабочий стол для всех ролей**, а затем выберите **параметры** настроить учетные данные удаленного рабочего стола. Дополнительные сведения см. в разделе [включить удаленный рабочий стол для роли в облачных службах Azure с помощью Visual Studio](/azure/cloud-services/cloud-services-role-enable-remote-desktop-visual-studio).

      Если вы хотите отладить облачную службу после ее публикации, включите удаленную отладку, выбрав **включить удаленный отладчик для всех ролей**.

   Г. Чтобы создать пакет, выберите **пакета** ссылку.

      Проводник показывает расположение файла созданного пакета. Таким образом, чтобы его можно использовать на портале Azure можно скопировать это расположение.

   Д. Чтобы опубликовать этот пакет в среде развертывания, необходимо использовать это расположение в качестве расположения пакета при создании облачной службы и развертывания этого пакета в среде с помощью портала Azure.

1. (Необязательно) Чтобы отменить процесс развертывания, в контекстном меню для элемента строки в журнале действий выберите **отменить и удалить**. Эта команда останавливает процесс развертывания и удалить среду развертывания из Azure. Чтобы удалить среду после развертывания, используйте портал Azure.

1. (Необязательно) После запуска экземпляров ролей Visual Studio автоматически отображает среду развертывания в **облачных служб** узла в обозревателе сервера. На этой странице отобразится состояние отдельных экземпляров ролей. См. в разделе [управление ресурсами Azure с помощью Cloud Explorer](vs-azure-tools-resources-managing-with-cloud-explorer.md). На рисунке показаны экземпляры роли, пока они находятся в состоянии Initializing:

    ![VST_DeployComputeNode](./media/vs-azure-tools-publishing-a-cloud-service/IC744134.png)

## <a name="update-a-web-role-as-part-of-the-development-and-testing-cycle"></a>Обновление веб-роли как часть цикла разработки и тестирования

Если ваше приложение серверная инфраструктура стабильна, но веб-ролей требуется более частое обновление, чтобы обновлять только веб-роли в проекте можно использовать веб-развертывания. Это удобно, если вы не хотите повторно создавать и развертывать серверные рабочие роли или если у вас есть несколько веб-ролей и вы хотите обновлять только одну из веб-ролей.

### <a name="requirements-for-using-web-deploy"></a>Требования для использования веб-развертывания

- **Для разработки и тестирования только в целях**: изменения выполняются непосредственно к виртуальной машине, где выполняется веб-роли. Если эта виртуальная машина будет перезапущен, изменения будут потеряны, поскольку опубликованный исходный пакет используется для повторного создания виртуальной машины для роли. Повторно опубликуйте приложение, чтобы получить последние изменения в веб-роли.

- **Только веб-роли могут обновляться**: невозможно обновить рабочие роли. Кроме того, не удается обновить `RoleEntryPoint` в `web role.cs`.

- **Поддерживает только один экземпляр веб-роли**: не может иметь несколько экземпляров любой веб-роли в среде развертывания. Однако поддерживаются несколько веб-ролей каждого только с одним экземпляром.

- **Включение подключения удаленного рабочего стола**: это требование позволяет веб-развертывания использовать имя пользователя и пароль для подключения к виртуальной машине и развернуть изменения на сервере, на котором выполняется Internet Information Services (IIS). Кроме того необходимо подключиться к виртуальной машине, чтобы добавить доверенный сертификат в службах IIS на этой виртуальной машине. (Этот сертификат гарантирует, что удаленное подключение для служб IIS, который используется веб-развертывания защищена).

В следующей процедуре предполагается, что вы используете **опубликовать приложение Azure** мастера.

### <a name="enable-web-deploy-when-you-publish-your-application"></a>Включить веб-развертывания при публикации приложения

1. Чтобы включить **разрешить веб-развертывание для всех веб-ролей** параметр, необходимо сначала настроить подключения удаленного рабочего стола. Выберите **включить удаленный рабочий стол** для всех ролей и предоставьте учетные данные, которые используются для подключения удаленно в **конфигурация удаленного рабочего стола** поле, которое появляется. См. в разделе [включить удаленный рабочий стол для роли в облачных службах Azure с помощью Visual Studio](/azure/cloud-services/cloud-services-role-enable-remote-desktop-visual-studio).

1. Чтобы включить веб-развертывание для всех веб-ролей в приложении, выберите **разрешить веб-развертывание для всех веб-ролей**.

    Появится желтый предупредительный треугольник. Веб-развертывание использует недоверенный, самозаверяющий сертификат по умолчанию, что не рекомендуется для передачи конфиденциальных данных. Если вам нужно обеспечить этот процесс для конфиденциальных данных, можно добавить сертификат SSL, используемый для подключений веб-развертывания. Этот сертификат должен быть доверенный сертификат. Дополнительные сведения см. в разделе [безопасное веб-развертывание](#make-web-deploy-secure).

1. Выберите **Далее** Показать **Сводка** экрана, а затем выберите **публикации** развертывание облачной службы.

    Облачная служба публикуется. Виртуальная машина, созданный имеет включенные удаленные соединения для IIS, чтобы веб-развертывания можно использовать для обновления веб-ролей без повторной публикации.

   > [!NOTE]
   > При наличии более одного экземпляра, настроенного для веб-роли, появится предупреждающее сообщение о том, что каждая веб-роль ограничена одним экземпляром в пакете, созданном для публикации приложения. Выберите **ОК** для продолжения. Как уже говорилось в разделе о требованиях, может иметь более одного веб-роли, но только один экземпляр каждой роли.

### <a name="update-your-web-role-by-using-web-deploy"></a>Обновление веб-роли с помощью веб-развертывания

1. Чтобы использовать веб-развертывания, внести изменения в код проекта для любой веб-роли в Visual Studio, который требуется опубликовать, а затем щелкните правой кнопкой мыши узел этого проекта в решении и пункты **публикации**. **Веб-публикации** откроется диалоговое окно.

1. (Необязательно) Если добавлен доверенный SSL-сертификат для удаленных подключений служб IIS, можно снять **Разрешить ненадежный сертификат** "флажок". Сведения о том, как добавить сертификат для обеспечения безопасности веб-развертывания, см. в разделе **безопасное веб-развертывание** далее в этой статье.

1. Чтобы использовать веб-развертывание, механизму публикации необходимо имя пользователя и пароль, который настроен для подключения к удаленному рабочему столу при первой публикации пакета.

   1. В **имя пользователя**, введите имя пользователя.

   2. В **пароль**, введите пароль.

   В. (Необязательно) Если вы хотите сохранить пароль в этом профиле, выберите **сохранить пароль**.

1. Чтобы опубликовать изменения в веб-роли, выберите **публикации**.

    В строке состояния отображается **публикация начата**. По завершении публикации **Публикация успешно завершена** отображается. Теперь изменения развернутых веб-роли на виртуальной машине. Теперь можно запустить приложение Azure в среде Azure, чтобы проверить изменения.

### <a name="make-web-deploy-secure"></a>Безопасное веб-развертывание

1. Веб-развертывание использует недоверенный, самозаверяющий сертификат по умолчанию, что не рекомендуется для передачи конфиденциальных данных. Если вам нужно обеспечить этот процесс для конфиденциальных данных, можно добавить сертификат SSL, используемый для подключений веб-развертывания. Этот сертификат должен быть доверенный сертификат, который можно получить из центра сертификации (ЦС).

    Чтобы защитить веб-развертывания для каждой виртуальной машины для каждого веб-роли, необходимо загрузить доверенный сертификат, который вы хотите использовать для веб-развертывание на портале Azure. Этот сертификат позволяет гарантировать, что сертификат добавляется к виртуальной машине, которая создается для веб-роли при публикации приложения.

1. Чтобы добавить доверенный SSL-сертификат служб IIS для использования для удаленных подключений, выполните следующие действия.

   1. Для подключения к виртуальной машине, на котором выполняется веб-роли, выберите экземпляр веб-роли в **Cloud Explorer** или **обозревателя серверов**, а затем выберите **подключиться с помощью удаленного рабочего стола**  команды. Подробные инструкции о том, как подключиться к виртуальной машине см. в разделе [включить удаленный рабочий стол для роли в облачных службах Azure с помощью Visual Studio](/azure/cloud-services/cloud-services-role-enable-remote-desktop-visual-studio). Браузер предложит загрузить `.rdp` файл.

   2. Чтобы добавить сертификат SSL, откройте службу управления в диспетчере служб IIS. В диспетчере IIS включите использование SSL, щелкнув **привязки** ссылку в **действие** области. **Добавление привязки сайта** откроется диалоговое окно. Выберите **добавить**, а затем выберите HTTPS в **тип** стрелку раскрывающегося списка. В **SSL-сертификат** выберите SSL-сертификат, подписанный центром сертификации и переданный на портал Azure. Дополнительные сведения см. в разделе [настроить параметры подключения для службы управления](http://go.microsoft.com/fwlink/?LinkId=215824).

      > [!NOTE]
      > При добавлении доверенного SSL-сертификата желтый треугольник предупреждения больше не отображается в **мастера публикации**.

## <a name="include-files-in-the-service-package"></a>Включение файлов в пакет службы

Может потребоваться включить в пакет службы определенные файлы, таким образом, чтобы они были доступны на виртуальной машине, созданной для роли. Например, может потребоваться добавить `.exe` или `.msi` файл, который используется скриптом запуска пакет службы. Или может потребоваться добавить сборку, которая требуется проект веб-роли или рабочей роли. Чтобы включить файлы, они должны быть добавлены в решение для приложения Azure.

1. Чтобы добавить сборку в пакет службы, следуйте инструкциям ниже:

   1. В **обозревателе решений**, откройте узел проекта, для которого отсутствует ссылка.
   2. Чтобы добавить сборку в проект, откройте контекстное меню для **ссылки** папку и выберите **добавить ссылку**. Открывается диалоговое окно Добавить ссылку.
   В. Выберите ссылку, которую вы хотите добавить, а затем выберите **ОК**. Ссылка добавляется в список под заголовком **ссылки** папки.
   Г. Откройте контекстное меню добавленной сборки и выберите **свойства**. **Свойства** появится окно.

      Чтобы включить эту сборку в пакет службы, в **Копировать локально списка** выберите **True**.
1. В **обозревателе решений** откройте узел проекта, для которого отсутствует ссылка.

1. Чтобы добавить сборку в проект, откройте контекстное меню для **ссылки** папку и выберите **добавить ссылку**. **Добавить ссылку** откроется диалоговое окно.

1. Выберите ссылку, которую вы хотите добавить, а затем выберите **ОК** кнопки.

    Ссылка добавляется в список под заголовком **ссылки** папки.

1. Откройте контекстное меню добавленной сборки и выберите **свойства**. Откроется окно «Свойства».

1. Чтобы включить эту сборку в пакет службы, в **Копировать локально** выберите **True**.

1. Чтобы включить файлы в пакет службы, добавленные в проект веб-роли, откройте контекстное меню для файла и выберите **свойства**. Из **свойства** окно, выберите **содержимого** из **действие при построении** поле со списком.

1. Чтобы включить файлы в пакет службы, добавленные в проект рабочей роли, откройте контекстное меню для файла и выберите **свойства**. Из **свойства** окно, выберите **копировать, если новее** из **Копировать в выходной каталог** поле со списком.

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения о публикации в Azure из Visual Studio, см. в разделе [мастер публикации приложений Azure](vs-azure-tools-publish-azure-application-wizard.md).
