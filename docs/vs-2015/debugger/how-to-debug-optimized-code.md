---
title: 'Практическое: отладка оптимизированного кода | Документация Майкрософт'
ms.custom: ''
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.reviewer: ''
ms.suite: ''
ms.technology:
- vs-ide-debug
ms.tgt_pltfrm: ''
ms.topic: article
f1_keywords:
- vs.debug
dev_langs:
- FSharp
- VB
- CSharp
- C++
- C++
helpviewer_keywords:
- breakpoints, in optimized code
- debugging [C++], optimized code
- optimization, debug builds
- debug builds, optimizing
- optimized code, debugging
ms.assetid: fc8eeeb8-6629-4c9b-99f7-2016aee81dff
caps.latest.revision: 28
author: MikeJo5000
ms.author: mikejo
manager: ghogen
ms.openlocfilehash: e3d0e6c86c800e2ba35fdac78d6659fa2ecd7e94
ms.sourcegitcommit: af428c7ccd007e668ec0dd8697c88fc5d8bca1e2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/16/2018
ms.locfileid: "51734053"
---
# <a name="how-to-debug-optimized-code"></a>Практическое руководство. Отладка оптимизированного кода
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

ПРИМЕЧАНИЕ.]
>  Отображаемые диалоговые окна и команды меню могут отличаться от описанных в справке в зависимости от текущих параметров или выпуска. Чтобы изменить параметры, в меню "Сервис" выберите команду "Импорт и экспорт параметров". Дополнительные сведения см. в статье [Настройка параметров разработки в Visual Studio](http://msdn.microsoft.com/en-us/22c4debb-4e31-47a8-8f19-16f328d7dcd3).  
  
> [!NOTE]
>  [/Zo (Enhance Optimized Debugging)](http://msdn.microsoft.com/library/eea8d89a-7fe0-4fe1-86b2-7689bbebbd7f)параметр компилятора (впервые представлено в Visual Studio с обновлением 3) генерирует расширенные сведения по отладке для оптимизированного кода (проекты, которые не были собраны с **/Od** параметр компилятора. См. в разделе [параметры /O (оптимизация кода)](http://msdn.microsoft.com/library/77997af9-5555-4b3d-aa57-6615b27d4d5d)). Это обеспечивает улучшенную поддержку отладки локальных переменных и встроенных функций.  
>   
>  [Изменить и продолжить](../debugger/edit-and-continue-visual-csharp.md) отключается **/Zo** используется параметр компилятора.  
  
 Когда компилятор оптимизирует код, он перераспределяет и реорганизует инструкции. Это приводит к повышению эффективности скомпилированного кода. В связи с этим перераспределением отладчик не всегда может идентифицировать исходный код, соответствующий набору инструкций.  
  
 Оптимизация может повлиять на:  
  
- Локальные переменные (могут быть удалены оптимизатором или перемещены в места, недоступные для отладки).  
  
- Код внутри функций (изменяется расположение при слиянии оптимизатором блоков кода).  
  
- Имена функций в фреймах стека вызовов (могут оказаться некорректными при слиянии оптимизатором двух функций).  
  
  Фреймы в стеке вызовов почти всегда верные, но при условии наличия символов для всех фреймов. Фреймы в стеке вызовов могут оказаться некорректными при повреждении стека, при наличии функций на ассемблере, или в фреймах операционной системы при отсутствии соответствующих символов в стеке вызовов.  
  
  Глобальные и статические переменные всегда отображаются правильно. Это же относится к структурным типам. Если существует указатель на структуру и его значение правильно, каждая переменная-элемент структуры имеет правильное значение.  
  
  В связи с этими ограничениями следует по возможности отлаживать неоптимизированные версии программы. По умолчанию оптимизация выключена в конфигурации отладки программы Visual C++ и включена в конфигурации выпуска.  
  
  Тем не менее, ошибка может появиться только в оптимизированной версии программы. В этом случае отлаживать нужно как раз оптимизированный код.  
  
### <a name="to-turn-on-optimization-in-a-debug-build-configuration"></a>Включение оптимизации в конфигурации построения отладки  
  
1. При создании нового проекта выберите в качестве конечного продукта `Win32 Debug`. Используйте `Win32``Debug` целевой, пока программа не будет полностью отлажена и готова к построению `Win32 Release` целевой объект. Компилятор не оптимизирует `Win32 Debug`.  
  
2. Выберите проект в обозревателе решений.  
  
3. На **представление** меню, щелкните **страницы свойств**.  
  
4. В **страницы свойств** диалогового окна поле, убедитесь, что `Debug` выбран в **конфигурации** стрелку раскрывающегося списка.  
  
5. В окне папок слева выберите **C/C++** папки.  
  
6. В разделе **C++** папку, выберите `Optimization`.  
  
7. В списке свойств справа найдите `Optimization`. Параметр этого свойства скорее всего будет `Disabled (` [/Od](http://msdn.microsoft.com/library/b1ac31b7-e086-4eeb-be5e-488f7513f5f5)`)`. Выберите один из других параметров (`Minimum Size``(`[/O1](http://msdn.microsoft.com/library/2d1423f5-53d9-44da-8908-b33a351656c2)`)`, `Maximum Speed``(` [/O2](http://msdn.microsoft.com/library/2d1423f5-53d9-44da-8908-b33a351656c2)`)`, `Full Optimization``(` [/Ox](http://msdn.microsoft.com/library/3ad7c30b-c615-428c-b1d0-2e024f81c760) `)`, или `Custom`).  
  
8. Если для свойства `Custom` выбран параметр `Optimization`, это означает, что можно устанавливать параметры для любого из остальных свойств, показанных в списке.  
  
9. Выберите "Свойства конфигурации", C/C++, узел командной строки, страницы свойств проекта и добавьте `(` [/Zo](http://msdn.microsoft.com/library/eea8d89a-7fe0-4fe1-86b2-7689bbebbd7f) `)` для **Дополнительные параметры** текстовое поле.  
  
    > [!WARNING]
    >  Для использования `/Zo` требуется Visual Studio 2013 с обновлением 3 или более поздняя версия.  
    >   
    >  Добавление `/Zo` приведет к отключению [изменить и продолжить](../debugger/edit-and-continue-visual-csharp.md).  
  
   При отладке оптимизированного кода, использовать **Дизассемблированный код** окно, чтобы просмотреть, какие инструкции в действительности создаются и выполнения. При задании точек останова следует знать, что они могут двигаться вместе с инструкцией. Рассмотрим следующий пример кода:  
  
```  
for (x=0; x<10; x++)  
```  
  
 Допустим, точка останова установлена на этой строке. Можно ожидать, что точка останова будет пройдена 10 раз. Но если код оптимизирован, она будет пройдена всего один раз. Это связано с тем, что первая инструкция задает для `x` значение 0. Компилятор распознает, что конкретная инструкция должна быть выполнена один раз, и убирает ее из цикла. Точка останова перемещается вместе с ней. Инструкции, которые сравнивают и увеличивают `x`, остаются внутри цикла. При просмотре **Дизассемблированный код** окне [единицу шага](http://msdn.microsoft.com/en-us/8791dac9-64d1-4bb9-b59e-8d59af1833f9) автоматически равен одной инструкции для большего контроля, что бывает полезно при пошаговом прохождении оптимизированного кода.  
  
## <a name="see-also"></a>См. также  
 [Безопасность отладчика](../debugger/debugger-security.md)   
 [Отладка машинного кода](../debugger/debugging-native-code.md)



