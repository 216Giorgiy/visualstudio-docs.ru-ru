---
title: Настройка хранилища файлов и XML-сериализации
ms.date: 11/04/2016
ms.topic: conceptual
f1_keywords:
- vs.dsltools.dsldesigner.xmlbehavior
helpviewer_keywords:
- Domain-Specific Language, serialization
author: gewarren
ms.author: gewarren
manager: douge
ms.workload:
- multiple
ms.prod: visual-studio-dev15
ms.technology: vs-ide-modeling
ms.openlocfilehash: d9722bed4bcf20fbdba322bea7cd3aab4328fa7e
ms.sourcegitcommit: e13e61ddea6032a8282abe16131d9e136a927984
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/26/2018
---
# <a name="customize-file-storage-and-xml-serialization"></a>Настройка хранилища файлов и XML-сериализация

Когда пользователь сохраняет экземпляр, или *модель*, доменного языка (DSL) в [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)], создается или обновляется в XML-файл. Файл можно загрузить в память для повторного создания модели в хранилище.

Схема сериализации можно настроить, перемещая параметров в группе **поведением при сериализации Xml** в обозреватель DSL. Узел в разделе **поведением при сериализации Xml** для каждого доменного класса, свойства и отношения. Связи находятся в папке классов их источника. Также существуют узлы, которые соответствуют фигуры, соединитель и схемы классов.

Также можно написать код программы для более сложных настройки.

> [!NOTE]
> Если вы хотите сохранить модель в определенном формате, но необходимо перезагрузить его из этой формы, рассмотрите возможность использования текстовых шаблонов для создания выходных данных из модели, а не пользовательскую схему сериализации. Дополнительные сведения см. в разделе [формирование кода из доменного языка](../modeling/generating-code-from-a-domain-specific-language.md).

## <a name="model-and-diagram-files"></a>Файлы схемы и модели

Обычно каждая модель сохраняется в двух файлах:

-   Файл модели имеет имя, например **Model1.mydsl**. Он сохраняет с элементами модели и отношения и их свойств. Расширение файла, например **.mydsl** определяется **FileExtension** свойство **редактор** узел в определения DSL.

-   Файл схемы имеет имя, например **Model1.mydsl.diagram**. Он сохраняет фигуры, соединителей и их позиций, цвета, толщины линии и другие сведения о внешний вид схемы. Если пользователь удаляет **.diagram** файл, необходимые сведения в модели не будет потеряно. Макет диаграммы будут утеряны. При открытии файла модели, значение по умолчанию набора фигуры и соединители будет создан.

### <a name="to-change-the-file-extension-of-a-dsl"></a>Чтобы изменить расширение файла DSL

1.  Откройте Определение DSL. В обозревателе DSL щелкните узел редактор.

2.  В окне «Свойства» измените **FileExtension** свойство. Не включайте первоначального «.» расширения имени файла.

3.  В обозревателе решений измените имя файлы шаблонов двух элементов в **DslPackage\ProjectItemTemplates**. Эти файлы имеют имена, которые соответствует этому формату.

     `myDsl.diagram`

     `myDsl.myDsl`

## <a name="the-default-serialization-scheme"></a>Схема сериализации по умолчанию

Чтобы создать пример в этом разделе, использовался следующее определение DSL.

![Схема определения DSL &#45; модель семейного дерева](../modeling/media/familyt_person.png)

Это DSL был использован для создания модели, которая имеет следующий вид на экране.

![Обозреватель, панель элементов и схема семейного дерева](../modeling/media/familyt_instance.png)

Эта модель сохранен и повторно открыть в текстовом редакторе XML:

```xml
<?xml version="1.0" encoding="utf-8"?>
<familyTreeModel xmlns:dm0="http://schemas.microsoft.com/VisualStudio/2008/DslTools/Core" dslVersion="1.0.0.0" Id="f817b728-e920-458e-bb99-98edc469d78f" xmlns="http://schemas.microsoft.com/dsltools/FamilyTree">
  <people>
    <person name="Henry VIII" birthYear="1491" deathYear="1547" age="519">
      <children>
        <personMoniker name="/f817b728-e920-458e-bb99-98edc469d78f/Elizabeth I" />
        <personMoniker name="/f817b728-e920-458e-bb99-98edc469d78f/Mary" />
      </children>
    </person>
    <person name="Elizabeth I" birthYear="1533" deathYear="1603" age="477" />
    <person name="Mary" birthYear="1515" deathYear="1558" age="495" />
  </people>
</familyTreeModel>
```

Обратите внимание на следующие аспекты сериализованной модели:

-   Каждый узел XML имеет имя, которое совпадает со значением имени класса домена, за исключением того, что является строчной начальной буквой. Например `familyTreeModel` и `person`.

-   Свойства домена, такие как имя и BirthYear сериализуются как атрибуты в XML-узлов. Опять же исходного символа в имени свойства преобразуется в нижний регистр.

-   Каждая связь сериализуется как XML-узел, вложенный в исходном элементе связи. Узел имеет то же имя, как свойство роль источника, но с исходного символа нижнего регистра.

     Например, в определении DSL роль, которая называется **людей** в качестве источника **FamilyTree** класса.  В XML, он представлен узла с именем `people` вложен в `familyTreeModel` узла.

-   Целевой конец каждой связи внедренные сериализуется как узел, вложенных в связь. Например `people` узел содержит несколько `person` узлов.

-   Конечного типа каждого ссылочная связь сериализуется как *моникер*, которая кодирует ссылку на целевой элемент.

     Например, в разделе `person` узел, может быть `children` связи. Этот узел содержит моникеры:

    ```xml
    <personMoniker name="/f817b728-e920-458e-bb99-98edc469d78f/Elizabeth I" />
    ```

## <a name="understand-monikers"></a>Понимать моникеров

Моникеры используются для представления перекрестные ссылки между разными частями файлы моделей и схем. Они также используются в `.diagram` файл для ссылки на узлы в файле модели. Существует два вида моникера.

-   *Идентификатор моникеров* заключения в кавычки идентификатор GUID целевого элемента. Пример:

    ```xml
    <personShapeMoniker Id="f79734c0-3da1-4d72-9514-848fa9e75157" />
    ```

-   *Полное ключа моникеров* идентифицировать целевой элемент по значению свойства указанного домена называется ключом моникера. Специальным именем своего родительского элемента в дереве внедрения связи указывается моникер целевой элемент.

     Следующие примеры взяты из DSL в которой существует — это класс домена альбома, имеющая внедрения отношение к домену класса именованного песню.

    ```xml
    <albumMoniker title="/My Favorites/Jazz after Teatime" />
    <songMoniker title="/My Favorites/Jazz after Teatime/Hot tea" />
    ```

     Полное моникеров ключа будет использоваться, если целевой класс имеет свойство домена, для которого параметр **является ключом моникер** равно `true` в **поведением при сериализации Xml**. В примере этот параметр имеет значение для свойства домена с именем «Title» в классах домена «Альбом» и «Песни».

Полное ключа моникеров удобнее для чтения, чем моникеров идентификатор. Если XML-файлами модели для чтения пользователями, рассмотрите возможность использования полное моникеров ключа. Тем не менее пользователь может задать более одного элемента имеют один и тот же ключ моникера. Повторяющиеся ключи может сделать файл не перезагрузить правильно. Таким образом при определении класса домена, который связан с помощью полного ключа моникеров, следует подумать о способах позволяют пользователю сохранить файл, содержащий повторяющиеся моникеров.

### <a name="to-set-a-domain-class-to-be-referenced-by-id-monikers"></a>Чтобы задать класс домена, на которые ссылается моникеров идентификатор

1.  Убедитесь, что **является ключом моникер** — `false` для каждого домена свойства в классе и его базовых классов.

    1.  В обозревателе DSL разверните **Behavior\Class сериализации XML-данные\\\<класса домена > \Element данных**.

    2.  Убедитесь, что **является ключом моникер** — `false` для каждого свойства домена.

    3.  Если базовый класс для класса домена, повторите процедуры в этом классе.

2.  Задать **сериализации идентификатора**  =  `true` для класса домена.

     Это свойство можно найти в разделе **поведением при сериализации Xml**.

### <a name="to-set-a-domain-class-to-be-referenced-by-qualified-key-monikers"></a>Чтобы задать класс домена, на которые ссылается полное моникеров ключа

-   Задать **является ключом моникер** для домена свойства существующего класса домена. Тип свойства должен быть `string`.

    1.  В обозревателе DSL разверните **Behavior\Class сериализации XML-данные\\\<класса домена > \Element данных**и выберите свойства домена.

    2.  В окне свойств задайте **является ключом моникер** для `true`.

-   \- или -

     Создайте новый класс домена с использованием **класс с именем домена** средства.

     Это средство создает новый класс, имеющий свойство домена с именем Name. **Является имя элемента** и **является ключом моникер** инициализируются значением свойства этого свойства домена `true`.

-   \- или -

     Создайте связь наследования от класса домена к другому классу, имеется ключевое свойство специальным именем.

### <a name="avoid-duplicate-monikers"></a>Избежать повторяющихся моникеров

При использовании полного ключа моникеров возможна, два элемента в модели пользователя может иметь то же значение в свойстве ключа. Например если DSL класс, имеющий свойство, имя пользователя, пользователь задать имена двух элементов должны совпадать. Несмотря на то, что модель может быть сохранен файл, он будет перегружает правильно.

Существует несколько способов, которые помогут избежать возникновения такой ситуации:

-   Задать **является имя элемента**  =  `true` для свойства ключа домена. Выберите свойство домена на схема определения DSL и выберите значение в окне «Свойства».

     Когда пользователь создает новый экземпляр класса, это значение указывает свойство домена для автоматического назначения другое значение. Поведение по умолчанию добавляет номер к имени класса. Это не запрещает изменение на повторяющееся имя пользователя, но помогает в случае, если пользователь не задает значение перед сохранением модели.

-   Включите проверку для DSL. В обозреватель DSL выберите Editor\Validation и задайте **использует...**  свойства `true`.

     Нет проверки автоматически создается метод, который проверяет для неоднозначности. Метод находится в `Load` категорию проверки. Это гарантирует, что пользователь будет предупреждение о том, что может оказаться невозможно повторно открыть файл.

     Дополнительные сведения см. в разделе [проверка доменного языка](../modeling/validation-in-a-domain-specific-language.md).

### <a name="moniker-paths-and-qualifiers"></a>Моникер пути и квалификаторы

Полное специальное имя ключа заканчивается специальное имя ключа и указывается моникер родительским элементом в дереве внедрения. Например, если моникер альбом является:

```xml
<albumMoniker title="/My Favorites/Jazz after Teatime" />
```

Затем может быть одной из песен в этом альбоме.

```xml
<songMoniker title="/My Favorites/Jazz after Teatime/Hot tea" />
```

Тем не менее альбомы вместо ссылки по Идентификатору, то моникеры будет следующим:

```xml
<albumMoniker Id="77472c3a-9bf9-4085-976a-d97a4745237c" />
<songMoniker title="/77472c3a-9bf9-4085-976a-d97a4745237c/Hot tea" />
```

Обратите внимание, что поскольку уникальный идентификатор GUID, он является никогда не специальным именем родительского элемента.

Если вы знаете, что свойство определенного домена имеет уникальное значение внутри модели, можно задать **— квалификатора моникера** для `true` для данного свойства. Это приведет к его использовать в качестве квалификатора, без использования специального имени родительского элемента. Например, если заданы оба **— квалификатора моникера** и **является ключом моникер** для свойства Title домена класса альбома, имя или идентификатор модели не используется в моникеров для альбома, а его embedded дочерние элементы:

```xml
<albumMoniker name="Jazz after Teatime" />
<songMoniker title="/Jazz after Teatime/Hot tea" />
```

## <a name="customize-the-structure-of-the-xml"></a>Для настройки структуры XML

Чтобы выполнить следующие настройки, разверните **поведением при сериализации Xml** узел в обозревателе DSL. Класс домена последовательно разверните узел элемента данных, чтобы просмотреть список свойств и связей, которые предоставляются в этот класс. Выберите связь и изменить его параметры в окне «Свойства».

-   Задать **опустить элемент** в значение true, чтобы опустить исходный узел роли, оставляя только список целевых элементов. Не задавать этот параметр, если имеется более одной связи между исходной и целевой классы.

    ```xml
    <familyTreeModel ...>
      <!-- The following node is omitted by using Omit Element: -->
      <!-- <people> -->
        <person name="Henry VIII" .../>
        <person name="Elizabeth I" .../>
      <!-- </people> -->
    </familyTreeModel>
    ```

-   Задать **используйте полную форму** для внедрения в узлов, представляющих экземпляры отношения к целевым узлам. Этот параметр устанавливается автоматически при добавлении свойства домена доменной связи.

    ```xml
    <familyTreeModel ...>
      <people>
        <!-- The following node is inserted by using Use Full Form: -->
        <familyTreeModelHasPeople myRelationshipProperty="x1">
          <person name="Henry VIII" .../>
        </familyTreeModelHasPeople>
        <familyTreeModelHasPeople myRelationshipProperty="x2">
          <person name="Elizabeth I" .../>
        </familyTreeModelHasPeople>
      </people>
    </familyTreeModel>
    ```

-   Задать **представление** = **элемент** должен иметь свойство домена, сохраняется как элемента, а не как значение атрибута.

    ```xml
    <person name="Elizabeth I" birthYear="1533">
      <deathYear>1603</deathYear>
    </person>
    ```

-   Чтобы изменить порядок сериализации атрибуты и связи, щелкните правой кнопкой мыши элемент в области данных элемента и использовать **вверх** или **вниз** команды меню.

## <a name="major-customization-using-program-code"></a>Основные настройки с помощью программного кода

Можно заменить часть или все алгоритмы сериализации.

Рекомендуется изучить код в **Dsl\Generated Code\Serializer.cs** и **SerializationHelper.cs**.

### <a name="to-customize-the-serialization-of-a-particular-class"></a>Для настройки сериализации определенного класса

1.  Задать **— настраиваемый** в узле для этого класса в группе **поведением при сериализации Xml**.

2.  Преобразовать все шаблоны, выполните сборку решения и исследовать связанные ошибки компиляции. Комментарии, рядом с каждой ошибки объясните, какой код, вы должны предоставить.

### <a name="to-provide-your-own-serialization-for-the-whole-model"></a>Чтобы обеспечить собственную сериализацию всю модель

1.  Переопределите методы в Dsl\GeneratedCode\SerializationHelper.cs

## <a name="options-in-xml-serialization-behavior"></a>Параметры поведения сериализации Xml

В обозревателе DSL узел поведением при сериализации Xml содержит дочерний узел для каждого класса домена, связи, фигуры, соединитель и схемы классов. В каждом из этих узлов приведен список свойств и связей, являющийся источником этого элемента. Связи, представлены как в сами по себе, так и в группе классов их источника.

В следующей таблице перечислены параметры, которые можно задать в этом разделе определения DSL. В каждом случае выберите элемент в обозревателе DSL и задать параметры в окне «Свойства».

### <a name="xml-class-data"></a>Класс XML-данных

Эти элементы найдены в обозревателе DSL в **Behavior\Class сериализации XML-данных**.

|||
|-|-|
|Свойство.|Описание|
|Схема настраиваемый элемент|При значении True означает, что класс домена схемы пользовательский элемент|
|Пользовательский|Задайте значение **True** необходимо написать собственный код сериализации и десериализации для этого класса домена.<br /><br /> Постройте решение, а в ошибках для обнаружения подробные инструкции.|
|Класс домена|Класс домена, к которому применяется этот узел класса данных. Только для чтения.|
|Имя элемента|Имя узла XML для элементов этого класса. Значение по умолчанию — в нижнем регистре версии доменного имени класса.|
|Имя атрибута специального имени|Имя атрибута, используемого в моникер элементов содержит ссылку. Если не указано, используется имя ключевого свойства или идентификатор.<br /><br /> В этом примере это «name»:  `<personMoniker name="/Mike Nash"/>`|
|Имя элемента моникера|Имя элемента xml, используемого для моникеров, ссылающимися на элементы этого класса.<br /><br /> Значение по умолчанию является строчной версией имя класса, добавляется суффикс «Moniker». Например, `personMoniker`.|
|Имя типа моникера|Имя типа xsd, созданного для специальных имен для элементов этого класса. XSD-СХЕМЫ находится в **кода Dsl\Generated\\\*Schema.xsd**|
|Код сериализации|Если значение равно True, идентификатора GUID элемента включается в файл. Это должно быть значение true, если нет свойства, помеченного **является ключом моникер** и DSL определяет ссылочные связи к этому классу.|
|Имя типа|Имя типа xml, создаваемого в xsd из класса указанного домена.|
|Примечания|Неформальные заметки, связанные с этим элементом|

### <a name="xml-property-data"></a>Свойство XML-данных

Свойство XML-узлов находятся в узлах класса.

|||
|-|-|
|Свойство.|Описание|
|Свойства домена|Свойство, к которому применяется XML-данные конфигурации сериализации. Только для чтения.|
|Моникер ключ|Значение True, если свойство используется в качестве ключа для создания специальных имен, которые ссылаются на экземпляры этого класса домена.|
|— Специальное имя квалификатора|Значение True, если свойство используется для создания в моникеров квалификатор. Если значение равно false и SerializeId не относится к этому классу домена, моникеров квалифицируются специальным именем родительского элемента в дереве внедрения.|
|Представление|Если атрибут, свойство сериализуется как атрибут xml; Если элемент, он будет сериализован как элемент; Если пропустить, он не сериализовано.|
|Имя XML|Имя, используемое для XML-атрибут или элемент, представляющий свойство. По умолчанию это версия нижнего регистра в имени свойства домена.|
|Примечания|Неформальные заметки, связанные с этим элементом|

### <a name="xml-role-data"></a>Роль XML-данных

Роль узлы данных будут расположены в исходных узлов класса.

|Свойство.|Описание|
|--------------|-----------------|
|Содержит пользовательские моникера|Задайте значение true, если вы хотите указать собственный код для создания и разрешение моникеров, проходящие через эту связь.<br /><br /> Подробные инструкции выполните сборку решения и дважды щелкните сообщения об ошибках.|
|Доменная связь|Задает связь, к которому применяются эти параметры. Только для чтения.|
|Опустить элемент|Значение true, если узел XML, который соответствует исходной роли указана схема.<br /><br /> Если имеется более одной связи между исходной и целевой классы, этот узел роли различать ссылки, которые принадлежат две связи. Поэтому рекомендуется не установить этот параметр в этом случае.|
|Имя элемента роли|Задает имя элемента XML, который является производным от исходной роли. Значение по умолчанию — имя свойства роли.|
|Используйте полную форму|Значение true, если каждый конечный элемент или специальное имя заключено в XML-узел, представляющий связь. Это свойство должно быть значение true, если связь имеет собственные свойства домена.|

## <a name="see-also"></a>См. также

- [Перемещение по модели и обновление модели в коде программы](../modeling/navigating-and-updating-a-model-in-program-code.md)
- [Создание кода из доменного языка](../modeling/generating-code-from-a-domain-specific-language.md)