---
title: "Настройка хранилища файлов и XML-сериализации | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "vs.dsltools.dsldesigner.xmlbehavior"
helpviewer_keywords: 
  - "Доменный язык, сериализация"
ms.assetid: 76c53ef1-e3b9-45da-b425-1bddb3c01395
caps.latest.revision: 17
author: "alancameronwills"
ms.author: "awills"
manager: "douge"
caps.handback.revision: 17
---
# Настройка хранилища файлов и XML-сериализации
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

Когда пользователь сохраняет экземпляр, или *модели*, доменного языка (DSL) в [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)], создания или обновления файла XML. Файл может быть перезагружен для повторного создания модели в хранилище.  
  
 Схема сериализации можно настроить путем настройки параметров в разделе **поведение XML-сериализации** в обозревателе DSL. Узел под **поведение XML-сериализации** для каждого класса домена, свойства и отношения. Связи находятся в их классов источника. Также существуют узлы, соответствующие фигуры, соединителя и схемы классов.  
  
 Можно также написать программный код для более широких возможностей настройки.  
  
> [!NOTE]
>  Если вы хотите сохранить модель в определенном формате, но необходимо перезагрузить его из этой формы, рассмотрите возможность использования текстовых шаблонов для создания выходных данных из модели, а не пользовательскую схему сериализации. Дополнительные сведения см. в разделе [Создание кода из доменного языка](../modeling/generating-code-from-a-domain-specific-language.md).  
  
## <a name="model-and-diagram-files"></a>Файлы схемы и модели  
 Каждая модель обычно сохраняется в двух файлах:  
  
-   Файл модели имеет имя, например **Model1.mydsl**. Он сохраняет элементы модели и связях и их свойств. Расширение файла, например **.mydsl** определяется **добавляемое** Свойства **редактор** узла в определении DSL.  
  
-   Файл схемы имеет имя, например **Model1.mydsl.diagram**. Он сохраняет фигуры, соединители и их позиций, цвета, толщины линии и другие сведения о внешний вид схемы. Если пользователь удаляет **.diagram** файл, необходимые сведения в модели не потеряны. Макет диаграммы будут утеряны. При открытии файла модели по умолчанию набор фигур и соединителей будут создаваться.  
  
#### <a name="to-change-the-file-extension-of-a-dsl"></a>Чтобы изменить расширение доменного языка  
  
1.  Откройте определения DSL. В обозревателе DSL щелкните узел редактор.  
  
2.  В окне «Свойства» измените **добавляемое** свойство. Не включайте первоначального «.» расширения имени файла.  
  
3.  В обозревателе решений измените имя файлов шаблонов два элемента в **DslPackage\ProjectItemTemplates**. Эти файлы имеют имена, выполните следующий формат:  
  
     `myDsl.diagram`  
  
     `myDsl.myDsl`  
  
## <a name="the-default-serialization-scheme"></a>Схема сериализации по умолчанию  
 Чтобы создать пример в этом разделе, использовался следующие определения DSL.  
  
 ![Схема определения DSL &#45; Модель семейного дерева](~/docs/modeling/media/familyt_person.png "FamilyT_Person")  
  
 Этот DSL был использован для создания модели, которая имеет следующий вид на экране.  
  
 ![Обозреватель, панель элементов и схема семейного дерева](~/docs/modeling/media/familyt_instance.png "FamilyT_Instance")  
  
 Эта модель сохранен и затем снова открыть в текстовом редакторе XML:  
  
```  
<?xml version="1.0" encoding="utf-8"?>  
<familyTreeModel xmlns:dm0="http://schemas.microsoft.com/VisualStudio/2008/DslTools/Core" dslVersion="1.0.0.0" Id="f817b728-e920-458e-bb99-98edc469d78f" xmlns="http://schemas.microsoft.com/dsltools/FamilyTree">  
  <people>  
    <person name="Henry VIII" birthYear="1491" deathYear="1547" age="519">  
      <children>  
        <personMoniker name="/f817b728-e920-458e-bb99-98edc469d78f/Elizabeth I" />  
        <personMoniker name="/f817b728-e920-458e-bb99-98edc469d78f/Mary" />  
      </children>  
    </person>  
    <person name="Elizabeth I" birthYear="1533" deathYear="1603" age="477" />  
    <person name="Mary" birthYear="1515" deathYear="1558" age="495" />  
  </people>  
</familyTreeModel>  
  
```  
  
 Обратите внимание на следующие аспекты сериализованной модели:  
  
-   Каждый узел XML имеет имя, которое совпадает с доменным именем класса, за исключением того, что начинается со строчной начальной буквой. Например `familyTreeModel` и `person`.  
  
-   Свойства домена, такие как имя и Год_рождения сериализуются как атрибуты в XML-узлов. Опять же начальный символ в имени свойства преобразуется в нижний регистр.  
  
-   Каждое отношение сериализуется как XML-узла, вложенный в исходном элементе связи. Узел имеет то же имя, как свойство роль источника, но с начальный символ нижнего регистра.  
  
     Например, в определении DSL, роли, которая называется **людей** в качестве источника **FamilyTree** класса.  В XML, он представлен узла с именем `people` вложен в `familyTreeModel` узла.  
  
-   Целевой конец каждого отношения внедрения сериализуется как узел, вложенных в связь. Например `people` узел содержит несколько `person` узлов.  
  
-   Целевой конец связи каждого ссылочного сериализуется как *моникер*, которая кодирует ссылку на целевой элемент.  
  
     Например, в разделе `person` узел, может быть `children` связи. Этот узел содержит специальные имена, например:  
  
    ```  
    <personMoniker name="/f817b728-e920-458e-bb99-98edc469d78f/Elizabeth I" />  
    ```  
  
## <a name="understanding-monikers"></a>Общие сведения о специальных имен  
 Моникеры используются для представления перекрестные ссылки между разными частями файлы модели и схемы. Они также используются в `.diagram` файл, чтобы обращаться к узлам в файле модели. Существует два вида моникера.  
  
-   *Идентификатор моникеров* Квота GUID целевого элемента. Например:  
  
    ```  
    <personShapeMoniker Id="f79734c0-3da1-4d72-9514-848fa9e75157" />  
  
    ```  
  
-   *Полное ключа моникеров* идентификации целевого элемента по значению свойства назначенным доменом называется ключом моникера. Моникер целевой элемент предваряется специальным именем родительского элемента в дереве отношений внедрения.  
  
     Следующие примеры взяты из DSL в котором существует — это класс домена альбома, имеющая отношение внедрения в домен класс Song именованных:  
  
    ```  
    <albumMoniker title="/My Favorites/Jazz after Teatime" />  
    <songMoniker title="/My Favorites/Jazz after Teatime/Hot tea" />  
  
    ```  
  
     Полное моникеров ключа будет использоваться, если целевой класс имеет свойство домена, для которой параметр **является ключом моникера** задано значение `true` в **поведение XML-сериализации**. В примере этот параметр устанавливается для свойства домена с именем «Title» в классах домена «Альбом» и «Песня».  
  
 Полное ключа моникеров удобнее для чтения, чем моникеров идентификатор. Если вы намерены XML-файлами модели для чтения людьми, рассмотрите возможность использования полное моникеров ключа. Тем не менее пользователь может задать более одного элемента имеют один и тот же ключ моникера. Повторяющиеся ключи может вызвать не перезагрузки файла неправильно. Таким образом при определении класса домена, который связан с помощью имени ключа моникеров, следует подумать о способах позволяют пользователю сохранить файл, содержащий повторяющиеся моникеры.  
  
#### <a name="to-set-a-domain-class-to-be-referenced-by-id-monikers"></a>Чтобы задать класс домена, на которые ссылается код моникеров  
  
1.  Убедитесь, что **является ключом моникера** — `false` для каждого свойства домена в классе и его базовых классов.  
  
    1.  В обозревателе DSL разверните **Behavior\Class сериализации XML-данные\\***\< класс домена>***\Element данные**.  
  
    2.  Убедитесь, что **является ключом моникера** — `false` для каждого свойства домена.  
  
    3.  Если класс домена имеет базовый класс, повторите процедуры в этом классе.  
  
2.  Задайте **идентификатор сериализации** = `true` для класса домена.  
  
     Это свойство можно найти в разделе **поведение XML-сериализации**.  
  
#### <a name="to-set-a-domain-class-to-be-referenced-by-qualified-key-monikers"></a>Чтобы задать класс домена, на которые ссылается полное моникеров ключа  
  
-   Значение **является ключом моникера** для свойства домена существующего класса домена. Тип свойства должен быть `string`.  
  
    1.  В обозревателе DSL разверните **Behavior\Class сериализации XML-данных\\***\< класс домена>***\Element данных**, а затем выберите свойство домена.  
  
    2.  В окне «Свойства» задайте **является ключом моникера** для `true`.  
  
-   \- или -  
  
     Создайте новый класс домена с использованием **именованный класс домена** средство.  
  
     Это средство создает новый класс, имеющий свойство домена с именем Name.  **Имя элемента** и **является ключом моникера** инициализируются значением данного свойства домена `true`.  
  
-   \- или -  
  
     Создайте отношение наследования от класса домена в другой класс, имеющий свойство ключа моникера.  
  
### <a name="avoiding-duplicate-monikers"></a>Чтобы избежать повторяющихся моникеров  
 При использовании полного ключа моникеров, два элемента в модели пользователя может иметь то же значение в свойство ключа. Например если DSL класс Person, имеющий свойство Name, пользователь может задать имена двух элементов должны совпадать. Несмотря на то, что модель может быть сохранен файл, он будет перегружает правильно.  
  
 Существует несколько методов, которые помогут избежать возникновения такой ситуации:  
  
-   Задайте **имя элемента** = `true` для свойства ключа домена. Выберите свойство домена в схеме определения DSL, а затем установите значение в окне «Свойства».  
  
     Когда пользователь создает новый экземпляр класса, это значение указывает свойство домена для автоматического назначения другое значение. Поведение по умолчанию добавляет номер к имени класса. Это не запрещает изменение на повторяющееся имя пользователя, но она помогает в случае, когда пользователь не задано значение перед сохранением модели.  
  
-   Включите проверку для DSL. В обозревателе DSL выберите Editor\Validation и задайте **использует...** Свойства `true`.  
  
     Нет проверки автоматически создается метод, который проверяет для неоднозначности. Метод находится в `Load` категории проверки. Это гарантирует, что пользователь будет отображено предупреждение, его невозможно повторно открыть его.  
  
     Дополнительные сведения см. в разделе [проверки в доменном языке](../modeling/validation-in-a-domain-specific-language.md).  
  
### <a name="moniker-paths-and-qualifiers"></a>Моникер пути и квалификаторы  
 Полное ключа моникер заканчивается на ключ моникера и префиксом со специальным родительским элементом в дереве внедрения. Например, если моникер альбома:  
  
```  
<albumMoniker title="/My Favorites/Jazz after Teatime" />  
  
```  
  
 Затем может быть одной из песен в этом альбоме.  
  
```  
<songMoniker title="/My Favorites/Jazz after Teatime/Hot tea" />  
```  
  
 Тем не менее если альбомов ссылается на идентификатор вместо, то моникеры будет следующим:  
  
```  
<albumMoniker Id="77472c3a-9bf9-4085-976a-d97a4745237c" />  
<songMoniker title="/77472c3a-9bf9-4085-976a-d97a4745237c/Hot tea" />  
```  
  
 Обратите внимание, что поскольку уникальный идентификатор GUID, он является никогда не специальным именем родительского элемента.  
  
 Если вы знаете, что свойства определенного домена имеет уникальное значение внутри модели, можно задать **квалификатором моникера является** для `true` для этого свойства. Это вызовет его для использования в качестве квалификатора, без использования специального имени родительского элемента. Например, если заданы оба **квалификатором моникера является** и **является ключом моникера** для свойства домена название альбома класса, имя или идентификатор модели не используется в моникеров альбома и его внедренных дочерних элементов:  
  
```  
<albumMoniker name="Jazz after Teatime" />  
<songMoniker title="/Jazz after Teatime/Hot tea" />  
  
```  
  
## <a name="customizing-the-structure-of-the-xml"></a>Настройка структуры XML-данных  
 Чтобы выполнить следующие настройки, разверните **поведение XML-сериализации** узел в обозревателе DSL. Класс домена последовательно разверните узел элемента данных, чтобы просмотреть список свойств и связей, которые получают данные в этот класс. Выберите связь и изменить его параметры в окне «Свойства».  
  
-   Значение **не указан элемент** в значение true, чтобы исключить узел роли источника, оставляя только список целевых элементов. Не следует устанавливать этот параметр, если имеется более одной связи между исходной и целевой классы.  
  
    ```  
  
    <familyTreeModel ...>  
      <!-- The following node is omitted by using Omit Element: -->  
      <!-- <people> -->  
        <person name="Henry VIII" .../>  
        <person name="Elizabeth I" .../>  
      <!-- </people> -->  
    </familyTreeModel>  
  
    ```  
  
-   Задайте **использовать полную форму** для внедрения целевые узлы в узлы, представляющие экземпляров связи. Этот параметр устанавливается автоматически при добавлении свойства домена в доменной связи.  
  
    ```  
  
    <familyTreeModel ...>  
      <people>  
        <!-- The following node is inserted by using Use Full Form: -->  
        <familyTreeModelHasPeople myRelationshipProperty="x1">  
          <person name="Henry VIII" .../>  
        </familyTreeModelHasPeople>  
        <familyTreeModelHasPeople myRelationshipProperty="x2">  
          <person name="Elizabeth I" .../>  
        </familyTreeModelHasPeople>  
      </people>  
    </familyTreeModel>  
  
    ```  
  
-   Задайте **представление** = **элемент** должен иметь свойство домена, сохранить в виде элемента, а не как значение атрибута.  
  
    ```  
    <person name="Elizabeth I" birthYear="1533">  
      <deathYear>1603</deathYear>  
    </person>  
    ```  
  
-   Чтобы изменить порядок сериализации атрибутов и связей, щелкните правой кнопкой мыши элемент в области данных элемента и использовать **Вверх** или **вниз** команды меню.  
  
## <a name="major-customization-using-program-code"></a>Основные настройки, с помощью программного кода  
 Можно заменить часть или все алгоритмы сериализации.  
  
 Рекомендуется изучить код в **Dsl\Generated Code\Serializer.cs** и **SerializationHelper.cs**.  
  
#### <a name="to-customize-the-serialization-of-a-particular-class"></a>Для настройки сериализации определенного класса  
  
1.  Значение **является настраиваемым** узла для этого класса в группе **поведение XML-сериализации**.  
  
2.  Преобразовать все шаблоны, выполните сборку решения и исследовать возникшие ошибки компиляции. Комментарии, рядом с каждой ошибки объясняется, какой код необходимо предоставить.  
  
#### <a name="to-provide-your-own-serialization-for-the-whole-model"></a>Чтобы предоставить собственную сериализацию для всей модели  
  
1.  Переопределите методы в Dsl\GeneratedCode\SerializationHelper.cs  
  
## <a name="options-in-xml-serialization-behavior"></a>Параметры в поведение XML-сериализации  
 В обозревателе DSL узел поведение сериализации Xml содержит дочерний узел для каждого класса домена, отношения, фигуры, соединителя и класса схемы. Под каждым из этих узлов имеет список свойств и связей, для этого элемента. Связи представлены в своих правах и в группе классов их источника.  
  
 В следующей таблице перечислены параметры, которые можно задать в этом разделе определения DSL. В каждом случае выберите элемент в обозревателе DSL и задать параметры в окне «Свойства».  
  
### <a name="xml-class-data"></a>Класс XML-данных  
 Эти элементы найдены в обозревателе DSL под **Behavior\Class сериализации XML-данных**.  
  
|||  
|-|-|  
|Свойство|Описание|  
|Схема пользовательского элемента|Если значение равно True, означает, что класс домена схемы пользовательский элемент|  
|— Настройка|Задайте значение **True** Если вы хотите написать собственный код сериализации и десериализации для данного класса домена.<br /><br /> Постройте решение и проанализируйте записи об ошибках для обнаружения подробные инструкции.|  
|Класс домена|Класс домена, к которому применяется этот узел класса данных. Только для чтения.|  
|Имя элемента|Имя узла XML для элементов этого класса. Значение по умолчанию — строчные версия имени класса домена.|  
|Моникер имя атрибута|Имя атрибута, используемого в элементах моникер содержать ссылку. Если не указано, используется имя ключевого свойства или идентификатор.<br /><br /> В этом примере это «name»:  `<personMoniker name="/Mike Nash"/>`|  
|Имя моникера элемента|Имя элемента xml, используемый для моникеров, ссылающимися на элементы этого класса.<br /><br /> Значение по умолчанию — нижнерегистровая версия имени класса, добавляется суффикс «Моникер». Например, `personMoniker`.|  
|Имя типа моникера|Имя типа xsd, созданного для специальных имен для элементов этого класса. Возможности XSD **кода Dsl\Generated\\\*Schema.xsd**|  
|Код сериализации|Значение True, если идентификатор GUID элемент включен в файл. Это должно быть значение true, если нет свойства, помеченного **является ключом моникера** и DSL определяет ссылочные отношения к этому классу.|  
|Имя типа|Имя типа xml, создаваемого в xsd из класса назначенным доменом.|  
|Примечания|Неофициальные примечания, связанные с данным элементом|  
  
### <a name="xml-property-data"></a>Свойство XML-данных  
 Свойство XML узлы найдены в узлах класса.  
  
|||  
|-|-|  
|Свойство|Описание|  
|Свойства домена|Свойство, к которому применяется XML-данные конфигурации сериализации. Только для чтения.|  
|Является ключом моникера|Значение True, если свойство используется как ключ для создания специальных имен, которые ссылаются на экземпляры этого класса домена.|  
|Является квалификатором моникера|Значение True, если свойство используется для создания квалификатор в специальные имена. Если значение равно false и SerializeId неверно для данного класса домена, моникеры определяются специального имени родительского элемента в дереве внедрения.|  
|Представление|Если атрибут, свойство сериализуется как атрибут xml; Если элемент, он будет сериализовано как элемент; Если пропустить, не сериализуются.|  
|Имя XML|Имя, используемое для XML-атрибут или элемент, представляющий свойство. По умолчанию это версия строчными буквами в имени свойства домена.|  
|Примечания|Неофициальные примечания, связанные с данным элементом|  
  
### <a name="xml-role-data"></a>Роль XML-данных  
 Роль данных узлы найдены в узлах исходного класса.  
  
|Свойство|Описание|  
|--------------|-----------------|  
|Содержит пользовательские моникера|Задайте значение true, если необходимо предоставить собственный код для создания и разрешения специальные имена, которые проходят через эту связь.<br /><br /> Подробные инструкции постройте решение и дважды щелкните сообщения об ошибках.|  
|Доменная связь|Указывает связь, к которому применяются эти параметры. Только для чтения.|  
|Опустить элемент|Значение true, если узел XML, который соответствует исходной роли исключается из схемы.<br /><br /> Если имеется более одной связи между исходной и целевой классы, этот узел роли различаются ссылок, которые принадлежат две связи. Поэтому рекомендуется не установить этот параметр в этом случае.|  
|Имя элемента роли|Задает имя элемента XML, который является производным от исходной роли. Значение по умолчанию — имя свойства роли.|  
|Использовать полную форму|Значение true, если каждый конечный элемент или специальное имя заключено в узел XML, представляющий отношение. Это должно быть присвоено значение true, если связь имеет собственные свойства домена.|  
  
## <a name="see-also"></a>См. также  
 [Перемещение и обновление модели в программном коде](../modeling/navigating-and-updating-a-model-in-program-code.md)   
 [Создание кода из доменного языка](../modeling/generating-code-from-a-domain-specific-language.md)