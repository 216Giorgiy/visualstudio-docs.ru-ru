---
title: "Создание процессорами директив текстового шаблона T4 пользовательских | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords: text templates, custom directive processors
ms.assetid: 422b47af-5441-4b02-b5ad-1b8b328457e3
caps.latest.revision: "29"
author: alancameronwills
ms.author: awills
manager: douge
ms.openlocfilehash: e288ccfd0e59f95c521d605c34e04240c94a1848
ms.sourcegitcommit: aadb9588877418b8b55a5612c1d3842d4520ca4c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/27/2017
---
# <a name="creating-custom-t4-text-template-directive-processors"></a>Создание пользовательских обработчиков директив для текстовых шаблонов T4
*Процесс преобразования текстового шаблона* принимает *текстового шаблона* файл в качестве входных данных и создает текстовый файл на выходе. *Преобразования текстовых шаблонов* процесс и обработчик взаимодействует с основное приложение преобразования текстовых шаблонов и один или несколько текстового шаблона элементов управления *процессоров директив* для завершения процесса. Дополнительные сведения см. в разделе [процесс преобразования текстового шаблона](../modeling/the-text-template-transformation-process.md).  
  
 Для создания пользовательского процессора директив создается класс, наследующий <xref:Microsoft.VisualStudio.TextTemplating.DirectiveProcessor> либо <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor>.  
  
 Это различие между этими двумя <xref:Microsoft.VisualStudio.TextTemplating.DirectiveProcessor> реализует минимальный интерфейс, необходимый для получения параметров от пользователя и создание кода, который создает выходной файл шаблона. <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor>реализует требует или предоставляет шаблон проектирования. <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor>обрабатывает два специальных параметра `requires` и `provides`.  Например, пользовательский процессор директив может принять имя файла от пользователя, откройте и чтение файла и затем сохранить текстового файла в переменной с именем `fileText`. Подкласс <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor> может принимать имя файла от пользователя в качестве значения `requires` и имя переменной, в которой для хранения текста в качестве значения параметра `provides` параметр. Этот процессор будет открыть и прочитать файл и сохраните текстовый файл в указанной переменной.  
  
 Перед вызовом пользовательского процессора директив из текстового шаблона в [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)], необходимо зарегистрировать его.  
  
 Дополнительные сведения о том, как добавить раздел реестра в разделе [развертывание пользовательского процессора директив](../modeling/deploying-a-custom-directive-processor.md).  
  
## <a name="custom-directives"></a>Пользовательские директивы  
 Пользовательской директивы выглядит следующим образом:  
  
 `<#@ MyDirective Processor="MyDirectiveProcessor" parameter1="value1" ... #>`  
  
 Пользовательский процессор директив можно использовать для доступа к внешним данным или ресурсам из текстового шаблона.  
  
 Различных текстовых шаблонов могут совместно использовать функциональные возможности, предоставляет один процессор директив, поэтому процессоров директив предоставляют способ коэффициент код для повторного использования. Встроенная `include` директивы выполняется аналогично, поскольку его можно использовать для факторизуйте код и использовать их совместно в разных текстовых шаблонах. Разница заключается в, функциональные возможности, `include` директива предоставляет фиксируется и не принимает параметры. Если вы хотите получать общие функциональные возможности для текстового шаблона и шаблон для передачи параметров, необходимо создать пользовательский процессор директив.  
  
 Может быть несколько примеров пользовательские процессоры директив.  
  
-   Процессор директив для возврата данных из базы данных, которая принимает в качестве параметров имя пользователя и пароль.  
  
-   Процессор директив, чтобы открыть и прочитать файл, который принимает имя файла в качестве параметра.  
  
### <a name="principal-parts-of-a-custom-directive-processor"></a>Обязательные части пользовательского процессора директив  
 Для создания пользовательского процессора директив, необходимо создать класс, наследующий <xref:Microsoft.VisualStudio.TextTemplating.DirectiveProcessor> или <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor>.  
  
 Наиболее важным `DirectiveProcessor` используются следующие методы, которые необходимо реализовать.  
  
-   `bool IsDirectiveSupported(string directiveName)`-Возврата `true` Если процессор директив может обрабатывать именованные директивы.  
  
-   `void ProcessDirective (string directiveName, IDictionary<string, string> arguments)`– Процессор шаблонов вызывает этот метод для каждого вхождения директивы в шаблоне. Ваш процессор должен сохранять результаты.  
  
 После последнего вызова ProcessDirective() будет вызывать эти методы:  
  
-   `string[] GetReferencesForProcessingRun()`– Должен возвращать имена сборок, которые требуется код шаблона.  
  
-   `string[] GetImportsForProcessingRun()`– Должен возвращать пространства имен, который можно использовать в коде шаблона.  
  
-   `string GetClassCodeForProcessingRun()`– Должен возвращать код методов, свойств и другие определения, которые можно использовать код шаблона. Для этого проще всего построить строку, содержащую код C# или Visual Basic. Чтобы сделать процессор директив можно было вызывать из шаблона, который использует любой язык среды CLR, можно составлять операторы в виде дерева CodeDom и затем возвращать результат сериализации этого дерева на языке, используемом в шаблоне.  
  
-   Дополнительные сведения см. в разделе [Пошаговое руководство: Создание пользовательского процессора директив](../modeling/walkthrough-creating-a-custom-directive-processor.md).  
  
## <a name="in-this-section"></a>Содержание  
 [Развертывание пользовательского обработчика директив](../modeling/deploying-a-custom-directive-processor.md)  
 Объясняется, как зарегистрировать пользовательский процессор директив.  
  
 [Пошаговое руководство. Создание пользовательского обработчика директив](../modeling/walkthrough-creating-a-custom-directive-processor.md)  
 Описание способов создания пользовательского процессора директив, регистрация и тестирование процессора директив и отформатировать выходной файл в формате HTML.