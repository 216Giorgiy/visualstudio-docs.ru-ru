---
title: "Проверка кода по схемам зависимостей | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- dependency diagrams, validating
- validation, dependency diagrams
- validation, code
- code exploration, validating
- architecture, validating
- Visual Studio Ultimate, validating code
- validation, architecture
- validation, dependencies
- MSBuild, tasks
- MSBuild, dependency diagrams
- MSBuild, validating code
author: gewarren
ms.author: gewarren
manager: ghogen
ms.workload: multiple
ms.openlocfilehash: c3f457e46c1f9f0d7b3ed2f862a411245caf72e7
ms.sourcegitcommit: bd16e764134c436d2d2f46490f51234d5246ee50
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/22/2018
---
# <a name="validate-code-with-dependency-diagrams"></a>Проверка кода по схемам зависимостей

**Последние новости**: в разделе [этой записи блога](https://blogs.msdn.microsoft.com/visualstudioalm/2016/11/30/live-dependency-validation-in-visual-studio-2017/).

[Видео: Проверка архитектуры зависимостей в режиме реального времени](https://sec.ch9.ms/sessions/69613110-c334-4f25-bb36-08e5a93456b5/170ValidateArchitectureDependenciesWithVisualStudio.mp4) 

## <a name="why-use-dependency-diagrams"></a>Зачем использовать схемы зависимостей?

Чтобы убедиться в том, что код не конфликтует со структурой, проверьте его с помощью схемы зависимостей в Visual Studio. Это может помочь:  
  
-   Поиск конфликтов между зависимостями в коде и зависимостями на схеме зависимостей.  
  
-   Найти зависимости, на которые могут повлиять предложенные изменения.  
  
     Например можно изменить диаграмму зависимостей для отображения потенциальных изменений архитектуры, а затем проверить код, чтобы увидеть зависимости, затронутых.  
  
-   Выполнить рефакторинг или миграцию кода в другую структуру.  
  
     Найти код или зависимости, с которыми потребуется выполнить определенные действия даже после перемещения кода в другую архитектуру.  
  
 **Требования**  
  
-   Visual Studio  
  
-   Visual Studio на сервере Team Foundation Build для проверки кода автоматически с помощью Team Foundation Build  
  
-   Решение, которое содержит проект моделирования со схемой зависимостей. Это зависимостей схема должна быть связана с артефактами в проектах Visual C# .NET или Visual Basic .NET, который нужно проверить. В разделе [создавать диаграммы зависимостей в коде](../modeling/create-layer-diagrams-from-your-code.md).  
  
 Чтобы узнать, какие версии Visual Studio поддерживают эту функцию, см. раздел [Version support for architecture and modeling tools](../modeling/what-s-new-for-design-in-visual-studio.md#VersionSupport).  
  
 Можно проверить код вручную из схемы зависимостей, откройте в Visual Studio или из командной строки. Также код можно проверить автоматически при выполнении локальных сборок или Team Foundation Build. В разделе [видео Channel 9: проектирования и проверки архитектуры с использованием схем зависимостей](http://go.microsoft.com/fwlink/?LinkID=252073).  
  
> [!IMPORTANT]
>  Если необходимо выполнить проверку слоев в Team Foundation Build, следует также установить ту же версию Visual Studio на сервере сборки.  
  
-   [Поддерживает ли элемент проверку](#SupportsValidation)  
  
-   [Включение других сборок .NET и проекты для проверки](#IncludeReferences)  
  
-   [Проверка кода вручную](#ValidateManually)  
  
-   [Автоматическая проверка кода](#ValidateAuto)  
  
-   [Устранение неполадок проверки слоев](#TroubleshootingValidation)  
  
-   [Понимание и устранение ошибок проверки слоев](#UnderstandingValidationErrors)  

## <a name="live-dependency-validation"></a>Проверка динамической зависимостей

В этом выпуске Visual Studio проверка зависимостей, происходит в режиме реального времени и ошибки сразу же отображаются в окне списка ошибок в Visual Studio.

* Динамическая проверка поддерживается для C# и Visual Basic.NET. 

* Чтобы включить полный анализ решения, при использовании динамических зависимостей проверки, откройте параметры с золотой панели, которая отображается в списке ошибок. 
 - Эта панель gold без возможности восстановления можно пропустить, если вы не хотите увидеть все архитектуры в решении проблемы.
 - Если не включить полный анализ решения, анализ выполняется только для файлов редактируется.<p /> 

* При обновлении проектов, чтобы включить динамическую проверку, диалоговое окно показывает ход выполнения преобразования.

* При обновлении проекта для проверки зависимостей в режиме реального времени, версию пакета NuGet обновляется должны совпадать для всех проектов и имеет самую новую версию используется. 

* Добавление нового триггеры проект проверки зависимостей обновление проекта. 
  
##  <a name="SupportsValidation"></a>Поддерживает ли элемент проверку  
 Можно связать слои с веб-сайтами, документами Office, обычными текстовыми файлами и файлами в проектах, которые являются общими для нескольких приложений, но они не войдут в процесс проверки. Ошибки проверки для ссылок на проекты или сборки, связанные с отдельными слоями, отображаются только в том случае, если между этими слоями отображаются зависимости. Эти ссылки считаются зависимостями, только если используются в коде.  
  
1.  На диаграмме зависимостей, выберите один или несколько слоев, щелкните правой кнопкой мыши выбранные параметры и нажмите кнопку **Просмотр ссылок**.  
  
2.  В **обозреватель слоев**, посмотрите на **поддержка проверки** столбца. Если значение равно false, элемент не поддерживает проверку.  
  
##  <a name="IncludeReferences"></a>Включение других сборок .NET и проекты для проверки  
 При перетаскивании элементов на диаграмме зависимостей ссылки на соответствующие сборки или проекты .NET автоматически добавляются в **ссылки слоя** папки в проекте моделирования. Эта папка содержит ссылки на сборки и проекты, которые анализируются во время проверки. Также можно добавить другие сборок и проектов .NET для проверки не перетаскивая их на диаграмму зависимостей вручную.  
  
1.  В **обозревателе решений**, щелкните правой кнопкой мыши проект моделирования или **ссылки слоя** папки, а затем щелкните **добавить ссылку**.  
  
2.  В **добавить ссылку** диалоговое окно, выберите сборки или проекты и нажмите кнопку **ОК**.  
  
##  <a name="ValidateManually"></a>Проверка кода вручную  
 Если у вас есть диаграмма откройте зависимостей, связанных с элементами решения, можно запустить **проверки** команда контекстного меню диаграммы. Можно также использовать командной строки для запуска **msbuild** с **/p:ValidateArchitecture** значение пользовательского свойства **True**. Например, при внесении изменений в код регулярно выполняйте проверку слоев, чтобы заранее обнаруживать конфликты зависимостей.  
  
#### <a name="to-validate-code-from-an-open-dependency-diagram"></a>Проверка кода из схемы откройте зависимостей   
  
1.  Щелкните правой кнопкой мыши поверхность схемы и нажмите кнопку **проверить архитектуру**.  
  
    > [!NOTE]
    >  По умолчанию **действие при построении** присваивается свойству зависимостей схемы (LAYERDIAGRAM) файл **проверки** , чтобы схема включена в процесс проверки.  
  
     **Список ошибок** окне выводятся все возникающие ошибки. Дополнительные сведения об ошибках проверки см. в разделе [понимание и устранение ошибок проверки слоев](#UnderstandingValidationErrors).  
  
2.  Чтобы просмотреть источник каждой ошибки, дважды щелкните ошибку в **список ошибок** окна.  
  
    > [!NOTE]
    >  [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] может вместо источника ошибки показывать карту кода. Это происходит, если код имеет зависимость в сборке, не заданной схемой зависимостей, либо в коде отсутствует зависимость, заданная схемой зависимостей. Просмотрите карту кода или код, чтобы определить, должна ли существовать зависимость. Дополнительные сведения о картах кода читайте в разделе [сопоставление зависимостей в решениях](../modeling/map-dependencies-across-your-solutions.md).  
  
3.  Способы устранения ошибок см. в разделе [Управление ошибками проверки](#ManageErrors).  
  
#### <a name="to-validate-code-at-the-command-prompt"></a>Проверка кода в командной строке  
  
1.  Откройте командную строку [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)].  
  
2.  Выберите один из следующих вариантов.  
  
    -   Чтобы проверить код на соответствие конкретному проекту моделирования в решении, запустите [!INCLUDE[vstecmsbuild](../extensibility/internals/includes/vstecmsbuild_md.md)] со следующим пользовательским свойством.  
  
        ```  
        msbuild <FilePath+ModelProjectFileName>.modelproj /p:ValidateArchitecture=true  
        ```  
  
         - или  
  
         Перейдите к папке, содержащей моделирования (MODELPROJ-файл) и Диаграмма зависимостей проекта, а затем запустите [!INCLUDE[vstecmsbuild](../extensibility/internals/includes/vstecmsbuild_md.md)] со следующим пользовательским свойством:  
  
        ```  
        msbuild /p:ValidateArchitecture=true   
        ```  
  
    -   Чтобы проверить код на соответствие всем проектам моделирования в решении, запустите [!INCLUDE[vstecmsbuild](../extensibility/internals/includes/vstecmsbuild_md.md)] со следующим пользовательским свойством.  
  
        ```  
        msbuild <FilePath+SolutionName>.sln /p:ValidateArchitecture=true   
        ```  
  
         - или  
  
         Перейдите в папку решения, в которой должен находиться проект моделирования со схемой зависимостей и запустите [!INCLUDE[vstecmsbuild](../extensibility/internals/includes/vstecmsbuild_md.md)] со следующим пользовательским свойством:  
  
        ```  
        msbuild /p:ValidateArchitecture=true  
        ```  
  
     Отобразятся любые возникающие ошибки. Дополнительные сведения о [!INCLUDE[vstecmsbuild](../extensibility/internals/includes/vstecmsbuild_md.md)], в разделе [MSBuild](../msbuild/msbuild.md) и [задача MSBuild](../msbuild/msbuild-task.md).  
  
 Дополнительные сведения об ошибках проверки см. в разделе [понимание и устранение ошибок проверки слоев](#UnderstandingValidationErrors).  
  
###  <a name="ManageErrors"></a>Управление ошибками проверки  
 В процессе разработки может понадобиться подавить некоторые конфликты, выявленные в ходе проверки. Например, можно подавлять ошибки, над которыми уже ведется работа, а также ошибки, не имеющие отношения к конкретному сценарию. При подавлении ошибки рекомендуется фиксировать рабочий элемент в журнале в [!INCLUDE[esprfound](../code-quality/includes/esprfound_md.md)].  
  
> [!WARNING]
>  Вы должны быть уже подключены к управлению исходным кодом (SCC) TFS для создания рабочего элемента или связи с ним. При попытке открыть соединение с другим SCC TFS Visual Studio автоматически закрывает текущее решение. Убедитесь, что вы уже подключены соответствующему SCC, перед попыткой создания рабочего элемента или связи с ним. В последних выпусках Visual Studio команды меню недоступны, если вы не подключены к SCC.  
  
##### <a name="to-create-a-work-item-for-a-validation-error"></a>Создание рабочего элемента для ошибки проверки  
  
-   В **список ошибок** , щелкните правой кнопкой мыши ошибку, подведите указатель к **создать рабочий элемент**, а затем выберите тип рабочего элемента, который требуется создать.  
  
 Воспользуйтесь следующими процедурами для управления ошибками проверки в **список ошибок** окна:  
  
|**Задача**|**Выполните следующие действия**|  
|------------|----------------------------|  
|Подавить выбранные ошибки во время проверки|Щелкните один или несколько выбранных ошибок правой кнопкой мыши **Управление ошибками проверки**, а затем нажмите кнопку **подавление ошибок**.<br /><br /> Отобразятся подавленные ошибки с форматированием в виде зачеркивания. При выполнении проверки в следующий раз эти ошибки отображаться не будут.<br /><br /> Подавленные ошибки отслеживаются в suppressions-файле с соответствующим файлом схемы зависимостей.|  
|Остановить подавление выбранных ошибок|Щелкните выбранную подавленную ошибку или ошибки правой кнопкой мыши **Управление ошибками проверки**, а затем нажмите кнопку **Отменить подавление ошибок**.<br /><br /> При выполнении проверки в следующий раз выбранные подавленные ошибки будут отображаться.|  
|Восстановить все подавленные ошибки в **список ошибок** окна|Щелкните правой кнопкой мыши **список ошибок** окна **Управление ошибками проверки**, а затем нажмите кнопку **Показать все подавленные ошибки**.|  
|Скрыть все подавленные ошибки в **список ошибок** окна|Щелкните правой кнопкой мыши **список ошибок** окна **Управление ошибками проверки**, а затем нажмите кнопку **скрыть все подавленные ошибки**.|  
  
##  <a name="ValidateAuto"></a>Автоматическая проверка кода  
 Проверку слоев можно выполнять при каждом выполнении локальной сборки. Если команда использует Team Foundation Build, можно выполнить проверку слоев с проверкой изменений, которые можно задать путем создания пользовательской задачи MSBuild, и использовать отчеты по сборке для сбора ошибок проверки. Для создания сборки с условным возвратом см. [использование процесса сборки с условным возвратом для проверки изменений](http://msdn.microsoft.com/Library/9cfc8b9c-1023-40fd-8ab5-1b1bd9c172ec).  
  
#### <a name="to-validate-code-automatically-during-a-local-build"></a>Автоматическая проверка кода во время локальной сборки  
  
-   Откройте файл проекта моделирования (.modelproj) в текстовом редакторе и включите следующее свойство.  
  
```  
<ValidateArchitecture>true</ValidateArchitecture>  
```  
  
 \- или -  
  
1.  В **обозревателе решений**, щелкните правой кнопкой мыши проект моделирования, который содержит диаграмму зависимостей или схемы и нажмите кнопку **свойства**.  
  
2.  В **свойства** задайте проект моделирования **проверить архитектуру** свойства **True**.  
  
     Это позволяет включить проект моделирования в процесс проверки.  
  
3.  В **обозревателе решений**, нажмите кнопку зависимостей схемы (LAYERDIAGRAM) файл, необходимо использовать для проверки.  
  
4.  В **свойства** окна, убедитесь, что схема **действие при построении** свойству **проверки**.  
  
     Сюда относятся диаграммы зависимостей в процесс проверки.  
  
 Способы устранения ошибок в окне списка ошибок см. в разделе [Управление ошибками проверки](#ManageErrors).  
  
#### <a name="to-validate-code-automatically-during-a-team-foundation-build"></a>Автоматическая проверка кода во время выполнения Team Foundation Build  
  
1.  В **Team Explorer**, дважды щелкните определение построения и выберите команду **процесс**.  
  
2.  В разделе **параметры процесса построения**, разверните **компиляции**и введите следующую команду в **Аргументы MSBuild** параметр:  
  
     `/p:ValidateArchitecture=true`  
  
 Дополнительные сведения об ошибках проверки см. в разделе [понимание и устранение ошибок проверки слоев](#UnderstandingValidationErrors). Дополнительные сведения о [!INCLUDE[esprbuild](../misc/includes/esprbuild_md.md)] см. в разделах:  
  
-   [Сборка и выпуск](/vsts/build-release/index)  
  
-   [Использование шаблона по умолчанию для процесса построения](http://msdn.microsoft.com/Library/43930b12-c21b-4599-a980-2995e3d16e31)  
  
-   [Изменение прежних версий сборки, который основан на UpgradeTemplate.xaml](http://msdn.microsoft.com/Library/ee1a8259-1dd1-4a10-9563-66c5446ef41c)  
  
-   [Настройка шаблона процесса сборки](http://msdn.microsoft.com/Library/b94c58f2-ae6f-4245-bedb-82cd114f6039)  
  
-   [Отслеживание хода выполнения запуска построения](http://msdn.microsoft.com/Library/e51e3bad-2d1d-4b7b-bfcc-c43439c6c8ef)  
  
##  <a name="TroubleshootingValidation"></a>Устранение неполадок проверки слоев  
 Следующая таблица описывает проблемы проверки слоев и способы их устранения. Эти проблемы отличаются от ошибок, возникающих из-за несоответствия между кодом и структурой. Дополнительные сведения об этих ошибках см. в разделе [понимание и устранение ошибок проверки слоев](#UnderstandingValidationErrors).  
  
|**Проблема**|**Возможная причина**|**Решение**|  
|---------------|------------------------|--------------------|  
|Ошибки проверки не возникают так, как это ожидается.|Проверка не работает на схемах зависимостей, которые скопированы из других схем зависимостей в обозревателе решений и находятся в том же проекте моделирования. схемы зависимостей, которые копируются в этом случае содержат те же ссылки, что и исходная схема зависимостей.|Добавьте новую диаграмму зависимостей в проект моделирования.<br /><br /> Скопируйте элементы из исходной схемы зависимостей в новую схему.|  
  
##  <a name="UnderstandingValidationErrors"></a>Понимание и разрешение ошибок проверки слоев  
 При проверке кода с помощью схемы зависимостей, если код конфликтует со структурой происходить ошибки проверки. Например, ошибки проверки могут происходить по следующим причинам:  
  
-   Артефакт назначен неправильному слою. В этом случае следует переместить артефакт.  
  
-   Способ использования артефактом (например, классом) другого класса конфликтует с имеющейся архитектурой. В этом случае необходимо выполнить рефакторинг кода, чтобы устранить зависимость.  
  
 Для устранения этих ошибок следует обновлять код до тех пор, пока в процессе проверки не перестанут происходить ошибки. Эту процедуру можно выполнить методом итераций.  
  
 В следующем разделе описывается синтаксис, используемый в этих ошибках, объясняется значение этих ошибок и предлагаются пути решения или управления ими.  
  
|**Синтаксис**|**Описание**|  
|----------------|---------------------|  
|*ArtifactN*(*ArtifactTypeN*)|*ArtifactN* — это артефакт, связанный со слоем на схеме зависимостей.<br /><br /> *ArtifactTypeN* тип *ArtifactN*, такие как **класса** или **метод**, например:<br /><br /> MySolution.MyProject.MyClass.MyMethod(Method)|  
|*NamespaceNameN*|Имя пространства имен.|  
|*LayerNameN*|Название слоя на диаграмме зависимостей.|  
|*Тип_зависимости*|Тип отношения зависимости между *Artifact1* и *Artifact2*. Например *Artifact1* имеет **вызовы** связь с *Artifact2*.|  
  
|**Синтаксическая ошибка**|**Описание ошибки**|  
|----------------------|---------------------------|  
|DV0001: **Недопустимая зависимость**|Эта проблема появляется в том случае, когда элемент кода (пространство имен, тип, член) сопоставлен ссылки слоя элемент кода, который сопоставлен с другим слоем, но есть нет стрелки зависимости между этими слоями в схеме проверки зависимостей, содержащей это слои. Это является нарушением ограничения зависимостей.|  
|DV1001: **неверное имя пространства имен**|Эта проблема отмечается на элемент кода, связанный со слоем, в котором свойство «Имена допустимое пространство имен» не содержит пространство имен, в котором определен этот элемент кода. Это является нарушением ограничения именования. Обратите внимание, что синтаксис «Допускается имен пространства имен» требуется точками с запятой список пространств имен, в какой код элементов, связанных с, слой могут быть определены.|  
|DV1002: **зависимость от unreferenceable пространства имен**|Эта проблема отмечается на элемент кода, связанный со слоем, ссылаясь на другой элемент кода, определенных в пространстве имен, который определен в свойстве «Unreferenceable пространства имен» слоя. Это является нарушением ограничения именования. Обратите внимание, что свойство «Unreferenceable пространства имен» определен как разделенных точкой с запятой список пространств имен, которые не должны ссылаться в элементах кода, связанные с этим слоем.|  
|DV1003: **имя пространства имен не разрешено**|Эта проблема отмечается на элемент кода, связанный со слоем, в котором свойство «Имена пространств имен не разрешено» содержит пространство имен, в котором определен этот элемент кода. Это является нарушением ограничения именования. Обратите внимание, что свойство «Имя пространства имен не разрешено» определен как разделенных точкой с запятой список пространств имен, в какой код не следует определять элементы, связанные с этим слоем.|  
|DV3001: **отсутствует ссылка**|Слой "*LayerName*«ссылается на»*артефакта*" которого не удается найти. Отсутствует ссылка на сборку?|*LayerName* связан с артефактом, который не удается найти. Например, связь с классом может отсутствовать из-за отсутствия в проекте моделирования ссылки на сборку, содержащую этот класс.|  
|DV9001: **при анализе архитектуры обнаружены внутренние ошибки**|Результат может быть неполным. Для получения дополнительных сведений см. подробный журнал событий построения или окно вывода.|Для получения дополнительных сведений см. журнал событий сборки или окно вывода.|  

 
## <a name="see-also"></a>См. также  
 [Проверка системы во время разработки](../modeling/validate-your-system-during-development.md)   
 [Видео: Проверка архитектуры зависимостей в режиме реального времени](https://sec.ch9.ms/sessions/69613110-c334-4f25-bb36-08e5a93456b5/170ValidateArchitectureDependenciesWithVisualStudio.mp4)   
