---
title: "Проверка кода по схемам зависимостей | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- dependency diagrams, validating
- validation, dependency diagrams
- validation, code
- code exploration, validating
- architecture, validating
- Visual Studio Ultimate, validating code
- validation, architecture
- validation, dependencies
- MSBuild, tasks
- MSBuild, dependency diagrams
- MSBuild, validating code
ms.assetid: 70cbe55d-4b33-4355-b0a7-88c770a6f75c
caps.latest.revision: 82
author: alexhomer1
ms.author: ahomer
manager: douge
translation.priority.ht:
- cs-cz
- de-de
- es-es
- fr-fr
- it-it
- ja-jp
- ko-kr
- pl-pl
- pt-br
- ru-ru
- tr-tr
- zh-cn
- zh-tw
translationtype: Machine Translation
ms.sourcegitcommit: 831452f0c06a42550f64c84e88395ca7a1d3c85e
ms.openlocfilehash: 0c4368d0f88f6f5c508b9945abd89c5e94a53d8a
ms.lasthandoff: 02/22/2017

---
# <a name="validate-code-with-dependency-diagrams"></a>Проверка кода по схемам зависимостей

**Последние новости**: в разделе [в этой записи блога](https://blogs.msdn.microsoft.com/visualstudioalm/2016/11/30/live-dependency-validation-in-visual-studio-2017/).

[Видео: Проверка зависимостей архитектуры в режиме реального времени](https://sec.ch9.ms/sessions/69613110-c334-4f25-bb36-08e5a93456b5/170ValidateArchitectureDependenciesWithVisualStudio.mp4) 

## <a name="why-use-dependency-diagrams"></a>Зачем использовать схемы зависимостей?

Чтобы убедиться в том, что код не конфликтует со структурой, проверьте код с помощью схем зависимостей в Visual Studio. Это может помочь:  
  
-   Найти конфликты между зависимостями в коде и зависимостями на схеме зависимостей.  
  
-   Найти зависимости, на которые могут повлиять предложенные изменения.  
  
     Например можно изменить диаграмму зависимостей для отображения потенциальных изменений архитектуры, а затем проверить код, чтобы увидеть зависимости, затронутых.  
  
-   Выполнить рефакторинг или миграцию кода в другую структуру.  
  
     Найти код или зависимости, с которыми потребуется выполнить определенные действия даже после перемещения кода в другую архитектуру.  
  
 **Requirements**  
  
-   Visual Studio  
  
-   Visual Studio на сервере Team Foundation Build для проверки кода автоматически с помощью Team Foundation Build  
  
-   Решение, которое содержит проект моделирования со схемой зависимостей. Это схема зависимостей должна быть связана с артефактами в проектах Visual C# .NET или Visual Basic .NET, которые требуется проверить. В разделе [создавать диаграммы зависимостей в коде](../modeling/create-layer-diagrams-from-your-code.md).  
  
 Чтобы узнать, какие версии Visual Studio поддерживают эту функцию, см. раздел [поддержка версий для инструментов моделирования и архитектуры](../modeling/what-s-new-for-design-in-visual-studio.md#VersionSupport).  
  
 Можно проверить код вручную из схемы откройте зависимостей в Visual Studio или из командной строки. Также код можно проверить автоматически при выполнении локальных сборок или Team Foundation Build. В разделе [видео Channel 9: проектирования и проверки архитектуры с помощью схем зависимостей](http://go.microsoft.com/fwlink/?LinkID=252073).  
  
> [!IMPORTANT]
>  Если необходимо выполнить проверку слоев в Team Foundation Build, следует также установить ту же версию Visual Studio на сервере сборки.  
  
-   [Поддерживает ли элемент проверку](#SupportsValidation)  
  
-   [Включение других сборок .NET и проекты для проверки](#IncludeReferences)  
  
-   [Проверка кода вручную](#ValidateManually)  
  
-   [Автоматическая проверка кода](#ValidateAuto)  
  
-   [Устранение неполадок проверки слоев](#TroubleshootingValidation)  
  
-   [Понимание и устранение ошибок проверки слоев](#UnderstandingValidationErrors)  

## <a name="live-dependency-validation"></a>Проверка зависимостей в режиме реального времени

В этом выпуске Visual Studio проверка зависимостей происходит в режиме реального времени и ошибки немедленно отображаются в окне списка ошибок в Visual Studio.

* Динамическая проверка поддерживается для C# и Visual Basic.NET. 

* Включить анализ полное решение с помощью проверки зависимостей live, откройте параметры с золотым панели, которая отображается в списке ошибок. 
 - Полосы gold окончательно можно игнорировать, если вы не интересуют все архитектуры в решении проблемы.
 - Если не включить полное решение анализ, анализ выполняется только для файлов, редактируется.<p /> 

* При обновлении проектов, чтобы включить динамическую проверку, диалоговое окно показывает ход выполнения преобразования.

* При обновлении проекта для проверки зависимостей в режиме реального времени, версия пакета NuGet обновления должны совпадать для всех проектов и самую новую версию используется. 

* Добавление новых триггеров проекта проверки зависимостей обновление проекта. 
  
##  <a name="a-namesupportsvalidationa-see-if-an-item-supports-validation"></a><a name="SupportsValidation"></a>Поддерживает ли элемент проверку  
 Можно связать слои с веб-сайтами, документами Office, обычными текстовыми файлами и файлами в проектах, которые являются общими для нескольких приложений, но они не войдут в процесс проверки. Ошибки проверки для ссылок на проекты или сборки, связанные с отдельными слоями, отображаются только в том случае, если между этими слоями отображаются зависимости. Эти ссылки считаются зависимостями, только если используются в коде.  
  
1.  Выберите один или несколько слоев на схеме зависимостей, щелкните правой кнопкой мыши выбранные параметры и нажмите кнопку **Просмотр ссылок**.  
  
2.  В **обозреватель слоев**, посмотрите на **поддержка проверки** столбца. Если значение равно false, элемент не поддерживает проверку.  
  
##  <a name="a-nameincludereferencesa-include-other-net-assemblies-and-projects-for-validation"></a><a name="IncludeReferences"></a>Включение других сборок .NET и проекты для проверки  
 При перетаскивании элементов на диаграмму зависимостей ссылки на соответствующие сборки или проекты .NET автоматически добавляются в **ссылки слоя** папки в проекте моделирования. Эта папка содержит ссылки на сборки и проекты, которые анализируются во время проверки. Можно включить другие сборки .NET и проекты для проверки не вручную, перетаскивая их на диаграмму зависимостей.  
  
1.  В **обозревателе решений**, щелкните правой кнопкой мыши проект моделирования или **ссылки слоя** папку и выберите пункт **добавить ссылку**.  
  
2.  В **добавить ссылку** диалоговом выберите сборки или проекты и нажмите кнопку **ОК**.  
  
##  <a name="a-namevalidatemanuallya-validate-code-manually"></a><a name="ValidateManually"></a>Проверка кода вручную  
 Если открыть зависимостей схемы, связанной с элементами решения, можно запустить **проверки** ярлыком из схемы. Командной строке можно также использовать для запуска **msbuild** с **/p:ValidateArchitecture** значение пользовательского свойства **True**. Например, при внесении изменений в код регулярно выполняйте проверку слоев, чтобы заранее обнаруживать конфликты зависимостей.  
  
#### <a name="to-validate-code-from-an-open-dependency-diagram"></a>Проверка кода из схемы откройте зависимостей   
  
1.  Щелкните правой кнопкой мыши поверхность схемы и нажмите кнопку **Проверка архитектуры**.  
  
    > [!NOTE]
    >  По умолчанию **действие при построении** значение свойства зависимостей схемы (LAYERDIAGRAM) файл **проверки** , чтобы схема включена в процесс проверки.  
  
     **Список ошибок** окне выводятся все возникающие ошибки. Дополнительные сведения об ошибках проверки см. в разделе [понимание и устранение ошибок проверки слоев](#UnderstandingValidationErrors).  
  
2.  Чтобы просмотреть источник каждой ошибки, дважды щелкните ошибку в **список ошибок** окна.  
  
    > [!NOTE]
    >  [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] может вместо источника ошибки показывать карту кода. Это происходит, если код имеет зависимость в сборке, не заданной схемой зависимостей, либо в коде отсутствует зависимость, заданная схемой зависимостей. Просмотрите карту кода или код, чтобы определить, должна ли существовать зависимость. Дополнительные сведения о картах кода см. в разделе [сопоставление зависимостей в решениях](../modeling/map-dependencies-across-your-solutions.md).  
  
3.  Способы устранения ошибок в разделе [Управление ошибками проверки](#ManageErrors).  
  
#### <a name="to-validate-code-at-the-command-prompt"></a>Проверка кода в командной строке  
  
1.  Откройте командную строку [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)].  
  
2.  Выберите один из следующих вариантов.  
  
    -   Чтобы проверить код на соответствие конкретному проекту моделирования в решении, запустите [!INCLUDE[vstecmsbuild](../extensibility/internals/includes/vstecmsbuild_md.md)] со следующим пользовательским свойством.  
  
        ```  
        msbuild <FilePath+ModelProjectFileName>.modelproj /p:ValidateArchitecture=true  
        ```  
  
         - или  
  
         Перейдите в папку, содержащую моделирования (MODELPROJ-файл) и схема зависимостей проекта, а затем запустите [!INCLUDE[vstecmsbuild](../extensibility/internals/includes/vstecmsbuild_md.md)] со следующим пользовательским свойством:  
  
        ```  
        msbuild /p:ValidateArchitecture=true   
        ```  
  
    -   Чтобы проверить код на соответствие всем проектам моделирования в решении, запустите [!INCLUDE[vstecmsbuild](../extensibility/internals/includes/vstecmsbuild_md.md)] со следующим пользовательским свойством.  
  
        ```  
        msbuild <FilePath+SolutionName>.sln /p:ValidateArchitecture=true   
        ```  
  
         - или  
  
         Перейдите в папку решения, в которой должен находиться проект моделирования со схемой зависимостей и запустите [!INCLUDE[vstecmsbuild](../extensibility/internals/includes/vstecmsbuild_md.md)] со следующим пользовательским свойством:  
  
        ```  
        msbuild /p:ValidateArchitecture=true  
        ```  
  
     Отобразятся любые возникающие ошибки. Дополнительные сведения о [!INCLUDE[vstecmsbuild](../extensibility/internals/includes/vstecmsbuild_md.md)], в разделе [MSBuild](../msbuild/msbuild1.md) и [задачи MSBuild](../msbuild/msbuild-task.md).  
  
 Дополнительные сведения об ошибках проверки см. в разделе [понимание и устранение ошибок проверки слоев](#UnderstandingValidationErrors).  
  
###  <a name="a-namemanageerrorsa-manage-validation-errors"></a><a name="ManageErrors"></a>Управление ошибками проверки  
 В процессе разработки может понадобиться подавить некоторые конфликты, выявленные в ходе проверки. Например, можно подавлять ошибки, над которыми уже ведется работа, а также ошибки, не имеющие отношения к конкретному сценарию. При подавлении ошибки рекомендуется фиксировать рабочий элемент в журнале в [!INCLUDE[esprfound](../code-quality/includes/esprfound_md.md)].  
  
> [!WARNING]
>  Вы должны быть уже подключены к управлению исходным кодом (SCC) TFS для создания рабочего элемента или связи с ним. При попытке открыть соединение с другим SCC TFS Visual Studio автоматически закрывает текущее решение. Убедитесь, что вы уже подключены соответствующему SCC, перед попыткой создания рабочего элемента или связи с ним. В последних выпусках Visual Studio команды меню недоступны, если вы не подключены к SCC.  
  
##### <a name="to-create-a-work-item-for-a-validation-error"></a>Создание рабочего элемента для ошибки проверки  
  
-   В **список ошибок** , щелкните правой кнопкой мыши ошибку, подведите указатель к **создать рабочий элемент**, а затем выберите тип рабочего элемента, который требуется создать.  
  
 Воспользуйтесь следующими процедурами для управления ошибками проверки в **список ошибок** окна:  
  
|**Задача**|**Выполните следующие действия**|  
|------------|----------------------------|  
|Подавить выбранные ошибки во время проверки|Щелкните один или несколько выбранных ошибок правой кнопкой мыши **Управление ошибками проверки**, а затем нажмите кнопку **подавление ошибок**.<br /><br /> Отобразятся подавленные ошибки с форматированием в виде зачеркивания. При выполнении проверки в следующий раз эти ошибки отображаться не будут.<br /><br /> Подавленные ошибки отслеживаются в suppressions-файле, соответствующий файлу схемы зависимостей.|  
|Остановить подавление выбранных ошибок|Щелкните выбранную подавленную ошибку или ошибки правой кнопкой мыши **Управление ошибками проверки**, а затем нажмите кнопку **Отменить подавление ошибок**.<br /><br /> При выполнении проверки в следующий раз выбранные подавленные ошибки будут отображаться.|  
|Восстановить все подавленные ошибки в **список ошибок** окна|Щелкните правой кнопкой мыши **список ошибок** окна **Управление ошибками проверки**, а затем нажмите кнопку **Показать все подавленные ошибки**.|  
|Скрыть все подавленные ошибки в **список ошибок** окна|Щелкните правой кнопкой мыши **список ошибок** окна **Управление ошибками проверки**, а затем нажмите кнопку **скрыть все подавленные ошибки**.|  
  
##  <a name="a-namevalidateautoa-validate-code-automatically"></a><a name="ValidateAuto"></a>Автоматическая проверка кода  
 Проверку слоев можно выполнять при каждом выполнении локальной сборки. Если команда использует Team Foundation Build, можно выполнить проверку слоев с проверкой изменений, которые можно задать путем создания пользовательской задачи MSBuild, и использовать отчеты по сборке для сбора ошибок проверки. Для создания построения с условным возвратом см [использовать процесс построения с условным возвратом для проверки изменений](http://msdn.microsoft.com/Library/9cfc8b9c-1023-40fd-8ab5-1b1bd9c172ec).  
  
#### <a name="to-validate-code-automatically-during-a-local-build"></a>Автоматическая проверка кода во время локальной сборки  
  
-   Откройте файл проекта моделирования (.modelproj) в текстовом редакторе и включите следующее свойство.  
  
```  
<ValidateArchitecture>true</ValidateArchitecture>  
```  
  
 \- или -  
  
1.  В **обозревателе решений**, щелкните правой кнопкой мыши проект моделирования, который содержит схему или схемы зависимостей и нажмите кнопку **свойства**.  
  
2.  В **свойства** проекта моделирования необходимо задать **Проверка архитектуры** свойства **True**.  
  
     Это позволяет включить проект моделирования в процесс проверки.  
  
3.  В **обозревателе**, щелкните зависимостей схемы (LAYERDIAGRAM) файл, необходимо использовать для проверки.  
  
4.  В **свойства** окна, убедитесь, что схема **действие при построении** свойству **проверки**.  
  
     Это включает диаграмму зависимостей в процесс проверки.  
  
 Способы устранения ошибок в окне «Список ошибок» в разделе [Управление ошибками проверки](#ManageErrors).  
  
#### <a name="to-validate-code-automatically-during-a-team-foundation-build"></a>Автоматическая проверка кода во время выполнения Team Foundation Build  
  
1.  В **Team Explorer**, дважды щелкните определение построения и нажмите кнопку **процесс**.  
  
2.  В разделе **параметры процесса построения**, разверните **компиляции**и введите следующую команду в **Аргументы MSBuild** параметр:  
  
     `/p:ValidateArchitecture=true`  
  
 Дополнительные сведения об ошибках проверки см. в разделе [понимание и устранение ошибок проверки слоев](#UnderstandingValidationErrors). Дополнительные сведения о [!INCLUDE[esprbuild](../misc/includes/esprbuild_md.md)] см. в разделах:  
  
-   [Сборка приложения](http://msdn.microsoft.com/Library/a971b0f9-7c28-479d-a37b-8fd7e27ef692)  
  
-   [Использование шаблона по умолчанию для процесса построения](http://msdn.microsoft.com/Library/43930b12-c21b-4599-a980-2995e3d16e31)  
  
-   [Изменение прежних версий сборки, которая основана на UpgradeTemplate.xaml](http://msdn.microsoft.com/Library/ee1a8259-1dd1-4a10-9563-66c5446ef41c)  
  
-   [Настройка шаблона процесса построения](http://msdn.microsoft.com/Library/b94c58f2-ae6f-4245-bedb-82cd114f6039)  
  
-   [Отслеживание хода выполнения запуска построения](http://msdn.microsoft.com/Library/e51e3bad-2d1d-4b7b-bfcc-c43439c6c8ef)  
  
##  <a name="a-nametroubleshootingvalidationa-troubleshoot-layer-validation-issues"></a><a name="TroubleshootingValidation"></a>Устранение неполадок проверки слоев  
 Следующая таблица описывает проблемы проверки слоев и способы их устранения. Эти проблемы отличаются от ошибок, возникающих из-за несоответствия между кодом и структурой. Дополнительные сведения об этих ошибках см. в разделе [понимание и устранение ошибок проверки слоев](#UnderstandingValidationErrors).  
  
|**Проблема**|**Возможная причина**|**Разрешение**|  
|---------------|------------------------|--------------------|  
|Ошибки проверки не возникают так, как это ожидается.|Проверка не работает на схемах зависимостей, которые скопированы из других схем зависимостей в обозревателе решений и находятся в том же проекте моделирования. скопированные таким образом схемы зависимостей содержат те же ссылки, что и исходная схема зависимостей.|Добавьте новую диаграмму зависимостей в проект моделирования.<br /><br /> Скопируйте элементы из исходной схемы зависимостей в новую схему.|  
  
##  <a name="a-nameunderstandingvalidationerrorsa-understanding-and-resolving-layer-validation-errors"></a><a name="UnderstandingValidationErrors"></a>Понимание и устранение ошибок проверки слоя  
 При проверке кода в схеме зависимостей, ошибки проверки возникают, если код конфликтует со структурой. Например, ошибки проверки могут происходить по следующим причинам:  
  
-   Артефакт назначен неправильному слою. В этом случае следует переместить артефакт.  
  
-   Способ использования артефактом (например, классом) другого класса конфликтует с имеющейся архитектурой. В этом случае необходимо выполнить рефакторинг кода, чтобы устранить зависимость.  
  
 Для устранения этих ошибок следует обновлять код до тех пор, пока в процессе проверки не перестанут происходить ошибки. Эту процедуру можно выполнить методом итераций.  
  
 В следующем разделе описывается синтаксис, используемый в этих ошибках, объясняется значение этих ошибок и предлагаются пути решения или управления ими.  
  
|**Синтаксис**|**Описание**|  
|----------------|---------------------|  
|*ArtifactN*(*ArtifactTypeN*)|*ArtifactN* — это артефакт, связанный со слоем на диаграмме зависимостей.<br /><br /> *ArtifactTypeN* тип *ArtifactN*, такие как **класса** или **метод**, например:<br /><br /> MySolution.MyProject.MyClass.MyMethod(Method)|  
|*NamespaceNameN*|Имя пространства имен.|  
|*LayerNameN*|Название слоя на диаграмме зависимостей.|  
|*Тип_зависимости*|Тип отношения зависимости между *Artifact1* и *Artifact2*. Например *Artifact1* имеет **вызовов** связь с *Artifact2*.|  
  
|**Ошибка синтаксиса**|**Описание ошибки**|  
|----------------------|---------------------------|  
|DV0001: **Недопустимая зависимость**|Эта проблема появляется в том случае, когда элемент кода (пространство имен, типов, членов) сопоставлено ссылки слоя элемент кода сопоставления в другой слой, но нет нет стрелки зависимости между этими уровнями в схеме проверки зависимостей, содержащей этот слои. Это нарушение ограничения зависимостей.|  
|DV1001: **неверное имя пространства имен**|Эта проблема сообщается на элемент кода, связанный со слоем, что свойство «Допускается имен» не содержит пространство имен, в котором определен этот элемент кода. Это нарушение ограничения именования. Обратите внимание, что синтаксис «Допускается имен» должна быть точкой с запятой список пространств имен, в какой код элементы, связанные с являются слоя могут быть определены.|  
|DV1002: **зависимость от unreferenceable пространства имен**|Элемент кода, связанный со слоем, ссылаясь на другой элемент кода, определенных в пространстве имен, который определен в свойстве «Unreferenceable пространство имен» слоя передаются этой проблемы. Это нарушение ограничения именования. Обратите внимание, что свойство «Unreferenceable пространства имен» определяется как разделенных точкой с запятой список пространств имен, не должен ссылаться на элементы кода, связанные с этим слоем.|  
|DV1003: **имя пространства имен не разрешено**|Эта проблема сообщается на элемент кода, связанный со слоем, содержащий пространство имен, в котором определен этот элемент кода свойства «Имена пространств имен не разрешено». Это нарушение ограничения именования. Обратите внимание, что свойство «Имя пространства имен не разрешено» определено как разделенных точкой с запятой список пространств имен, в какой код элементы, связанные с этим слоем не должно быть определено.|  
|DV3001: **отсутствует ссылка**|Слой "*Имя_слоя*«ссылки»*артефакта*" которого не удается найти. Отсутствует ссылка на сборку?|*Имя_слоя* связан с артефактом, который не удается найти. Например, связь с классом может отсутствовать из-за отсутствия в проекте моделирования ссылки на сборку, содержащую этот класс.|  
|DV9001: **архитектуры обнаружены внутренние ошибки**|Результат может быть неполным. Для получения дополнительных сведений см. подробный журнал событий построения или окно вывода.|Для получения дополнительных сведений см. журнал событий сборки или окно вывода.|  

 
## <a name="see-also"></a>См. также  
 [Проверка системы во время разработки](../modeling/validate-your-system-during-development.md)   
 [Видео: Проверка зависимостей архитектуры в режиме реального времени](https://sec.ch9.ms/sessions/69613110-c334-4f25-bb36-08e5a93456b5/170ValidateArchitectureDependenciesWithVisualStudio.mp4)   

