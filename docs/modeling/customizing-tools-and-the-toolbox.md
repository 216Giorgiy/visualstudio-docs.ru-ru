---
title: "Настройка элементов и панели элементов | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.topic: article
f1_keywords:
- vs.dsltools.dsldesigner.selectiondialog
- vs.dsltools.dsldesigner.selecticondialog
- vs.dsltools.dsldesigner.selectcursordialog
helpviewer_keywords:
- Domain-Specific Language, toolbox
author: gewarren
ms.author: gewarren
manager: ghogen
ms.workload:
- multiple
ms.technology: vs-ide-modeling
ms.openlocfilehash: 160c1c27ab9d01dc76d6a5c76feb07179f7966b9
ms.sourcegitcommit: 205d15f4558315e585c67f33d5335d5b41d0fcea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/09/2018
---
# <a name="customizing-tools-and-the-toolbox"></a>Настройка элементов и панели элементов
Для тех элементов, которые пользователи смогут добавлять в свои модели, необходимо определить содержание панели элементов. Панель элементов может содержать два вида средств: средства элемента и средства подключения. В созданном конструкторе пользователь может выбрать средство элемента, чтобы перетащить фигуры на схему, и средство подключения, чтобы протянуть связи между фигурами. В целом средства элемента позволяют пользователям добавлять в модели экземпляры классов доменов, а средства подключения — экземпляры доменных связей.  
  
 В этом разделе.  
  
-   [Определение области элементов](#ToolboxDef)  
  
-   [Настройка средств элемента](#customizing)  
  
-   [Создание группы элементов с помощью средства](#groups)  
  
-   [Настройка средств подключения](#connections)  
  
##  <a name="ToolboxDef"></a>Определение области элементов  
 В Обозревателе DSL разверните узел "Редактор" и узлы под ним. Обычно при этом отрывается иерархия следующего вида:  
  
```  
  
Editor  
     Toobox Tabs  
        MyDsl          //a tab  
           Tools  
               ExampleElement      // an element tool  
               ExampleRelationship // a connection tool  
  
```  
  
 В этой части Обозревателя DSL можно выполнять следующие действия.  
  
-   Создавать новые таблицы. Вкладки определяют заголовки разделов в панели элементов.  
  
-   Создавать новые средства.  
  
-   Копировать и вставлять средства.  
  
-   Перемещать средства вверх или вниз по списку.  
  
-   Удалять вкладки и средства.  
  
> [!IMPORTANT]
>  Чтобы добавить или вставить элементы в Обозреватель DSL, щелкните прародителя нового узла правой кнопкой мыши. Например, чтобы добавить средство, щелкните правой кнопкой мыши вкладку, а не **средства** узла. Чтобы добавить вкладку, щелкните правой кнопкой мыши **редактор** узла.  
  
 **Значок панели элементов** свойства каждого средства ссылается на файл точечного рисунка 16 x 16. Обычно эти файлы хранятся в **Dsl\Resources** папки.  
  
 **Класс** свойства средства элемент относится к классу конкретного домена. По умолчанию средство будет создавать экземпляры данного класса. Тем не менее можно написать код, заставляющий средство создавать элементы или группы элементов другого типа.  
  
 **Построитель подключения** свойство инструмента подключения ссылается на построителя соединения, который определяет, какие типы элементов, которые могут подключаться средство, и какие связи, который создает, между ними. Построители подключений определяются в виде узлов в Обозревателе DSL. Построители подключений создаются автоматически при определении доменных связей, но могут также настраиваться с помощью кода.  
  
#### <a name="to-add-a-tool-to-the-toolbox"></a>Добавление средства в панель элементов  
  
1.  Средство элемента обычно создают после создания класса фигуры и его сопоставления с классом домена.  
  
     Средство подключения обычно создают после создания класса соединителя и его сопоставления со ссылочным отношением.  
  
2.  В обозревателе DSL разверните **редактор** узла и **вкладки области элементов** узла.  
  
     Щелкните правой кнопкой мыши узел вкладку области элементов и нажмите кнопку **добавить новое средство элемент** или **добавить новое средство подключения**.  
  
3.  Задать **значок панели элементов** свойство для обращения к растровому изображению 16 x 16.  
  
     Если вы хотите определить новый значок, создайте файл точечного рисунка в обозревателе решений в **Dsl\Resources** папки. Файл должен иметь следующие значения: **действие при построении** = **содержимого**; **Копировать в выходной каталог** = **не Копировать**.  
  
4.  **Элемент инструмента:** задать **класса** свойство инструмента для ссылки на класс конкретный домен, который сопоставляется с формой.  
  
     **Для средства соединителя:** задать **построитель подключения** свойства программы для одного из элементов, которые доступны в раскрывающемся списке. Построители подключений автоматически создаются при сопоставлении соединителя с доменной связью. Сразу после создания соединителя, как правило, выбирается соответствующий построитель подключений.  
  
5.  Чтобы проверить DSL, нажмите клавишу F5 или сочетание клавиш CTRL + F5 и откройте в экспериментальном экземпляре [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] пример файла модели. На панели элементов должно появиться новое средство. Перетащите его на схему, чтобы проверить, создает ли оно новый элемент.  
  
     Если средство не появляется, остановите экспериментальный экземпляр [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)]. В Windows **запустить** меню, запустите **Сбросить экспериментальный экземпляр Microsoft Visual Studio 2010**. На [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] **построения** меню, нажмите кнопку **Перестроить решение**. Затем проверьте DSL еще раз.  
  
##  <a name="customizing"></a>Настройка средств элемент  
 По умолчанию средство создает один экземпляр указанного класса, но это можно изменять двумя описанными ниже способами.  
  
-   Определить директивы слияния элемента с другими классами, позволив им принимать новые экземпляры этого класса и создавать дополнительные ссылки при создании нового элемента. Например, можно разрешить пользователю оставить комментарий на другой элемент и тем самым создать между ними справочную ссылку.  
  
     Эти настройки также влияют на процесс вставки и перетаскивания элемента.  
  
     Дополнительные сведения см. в разделе [Настройка создания и перемещения элементов](../modeling/customizing-element-creation-and-movement.md).  
  
-   Написать код, чтобы настроить средство на возможность создания групп элементов. Средство запускается методами из файла ToolboxHelper.cs, которые можно переопределить. Дополнительные сведения см. в разделе [Создание групп для элементов с помощью средства](#groups).  
  
##  <a name="groups"></a>Создание группы элементов с помощью средства  
 Каждое средство элемента содержит прототип элементов, которые оно должно создавать. По умолчанию, каждое средство элемента создает один элемент, но может также создавать группу объектов, связанных с одним средством. Для этого запустите средство с помощью класса <xref:Microsoft.VisualStudio.Modeling.ElementGroupPrototype>, который содержит связанные элементы.  
  
 Следующий пример взят из DSL, в котором есть тип "Транзистор". Каждый транзистор имеет три именованных контакта. Средство элемента для транзисторов хранит прототип, содержащий четыре элемента модели и три ссылки отношения. Когда пользователь перетаскивает средство на схему, создается экземпляр прототипа, который связывается с корнем модели.  
  
 Этот код переопределяет метод, который определен в **Dsl\GeneratedCode\ToolboxHelper.cs**.  
  
 Дополнительные сведения о настройке модели с помощью программного кода. в разделе [перехода и обновления модели в программном коде](../modeling/navigating-and-updating-a-model-in-program-code.md).  
  
```  
using Microsoft.VisualStudio.Modeling;  
using Microsoft.VisualStudio.Modeling.Diagrams;  
  
  public partial class CircuitsToolboxHelper  
  {  
    /// <summary>  
    /// Toolbox initialization, called for each element tool on the toolbox.  
    /// This version deals with each Component subtype separately.  
    /// </summary>  
    /// <param name="store"></param>  
    /// <param name="domainClassId">Identifies the domain class this tool should instantiate.</param>  
    /// <returns>prototype of the object or group of objects to be created by tool</returns>  
    protected override ElementGroupPrototype CreateElementToolPrototype(Store store, Guid domainClassId)  
    {  
        if (domainClassId == Transistor.DomainClassId)  
        {  
            Transistor transistor = new Transistor(store);  
  
            transistor.Base = new ComponentTerminal(store);  
            transistor.Collector = new ComponentTerminal(store);  
            transistor.Emitter = new ComponentTerminal(store);  
  
            transistor.Base.Name = "base";  
            transistor.Collector.Name = "collector";  
            transistor.Emitter.Name = "emitter";  
  
            // Create an ElementGroup for the Toolbox.  
            ElementGroup elementGroup = new ElementGroup(store.DefaultPartition);  
            elementGroup.AddGraph(transistor, true);  
            // AddGraph includes the embedded parts  
  
            return elementGroup.CreatePrototype();  
        }  
        else  
        {  
            return base.CreateElementToolPrototype(store, domainClassId);  
}  }    }  
  
```  
  
##  <a name="connections"></a>Настройка средств подключения  
 Как правило, средство элемента создается при создании нового класса соединителя. Кроме того, можно переопределить одно средство, разрешив типам и обеих сторон определять тип отношения. Например, можно определить одно средство подключения, которое может создавать как отношения типа "человек — человек", так и отношения типа "человек — город".  
  
 Средства подключения вызывают построители подключения. Используйте построители подключения, чтобы указать, каким образом пользователи могут связывать элементы в сгенерированном конструкторе. Построители подключений указывают элементы, которые могут быть связаны, а также создаваемый между ними тип связи.  
  
 При создании ссылочного отношения между доменными классами автоматически создается построитель подключения, который можно использовать при сопоставлении средства подключения. Дополнительные сведения о создании соединения средств см. в разделе [Настройка панели элементов](../modeling/customizing-tools-and-the-toolbox.md).  
  
 Построитель подключения по умолчанию можно изменить так, чтобы он мог справляться с другим диапазоном исходных и целевых типов, а также создавать различные типы отношений.  
  
 Также, для построителей подключения можно написать пользовательский код, чтобы указать исходные и целевые классы для подключения, определить тип создаваемого подключения, и выполнить другие действия, связанные с созданием подключения.  
  
### <a name="the-structure-of-connection-builders"></a>Структура построителей подключения  
 Построители подключений содержат одну или несколько директив подключения связей, которые определяют доменные связи, а также исходные и целевые элементы. Например, в шаблоне решения задач потока видно **CommentReferencesSubjectsBuilder** в **обозреватель DSL**. Этот построитель подключения содержит одну ссылку подключения директивы с именем **CommentReferencesSubjects**, который сопоставлен с доменной связи **CommentReferencesSubjects**. Эта директива подключения связи содержит директиву исходной роли, указывающую на класс домена `Comment`, и директиву целевой роли, указывающую на класс домена `FlowElement`.  
  
### <a name="using-connection-builders-to-restrict-source-and-target-roles"></a>Использование построителей подключений для ограничения ограниченным исходных и целевых ролей  
 Построители подключений можно использовать для ограничения вхождения некоторых классов в исходную или в целевую роль определенной доменной связи. Например, у вас есть базовый класс домена, имеющий доменную связь с другим классом домена, но вы не хотите, чтобы все производные этого базового класса получали в этой связи те же самые роли. В решении задач потока, существует четыре класса конкретного домена (**StartPoint**, **конечной точки**, **MergeBranch**, и **синхронизации**), наследуют непосредственно от класса домена абстрактный **FlowElement**, и два конкретными классами домена (**задачи** и **ObjectInState**), косвенно наследовать от него. Имеется также **потока** ссылаться на связь, которая принимает **FlowElement** доменные классы в роли источника и целевой роли. Тем не менее экземпляр **конечной точки** класса домена не должен быть источником экземпляра **потока** связь, и не должен экземпляр **StartPoint** класс целевой экземпляр **потока** связи. **FlowBuilder** построитель подключения имеет ссылку подключения директивы с именем **потока** , указывающий, какие классы домена может играть роль источника (**задачи**,  **MergeBranch**, **StartPoint**, и **синхронизации**) и который может играть роль целевого (**MergeBranch**,  **Конечная точка**, и **синхронизации**).  
  
### <a name="connection-builders-with-multiple-link-connect-directives"></a>Построители подключений с несколькими директивами подключения связи  
 К построителю подключений можно добавить несколько директив подключения связи. Это может помочь скрыть некоторые сложности модели домена у пользователей и сохранить **элементов** слишком переполнения. К одному построителю подключений можно добавить директивы подключения связи для нескольких различных отношений домена. При этом доменные связи следует объединять в том случае, если они выполняют примерно одинаковую функцию.  
  
 В решении задач потока **потока** инструмент подключения, используемую для рисования экземплярами **потока** и **ObjectFlow** отношений между доменами. **FlowBuilder** построитель подключения имеет, в дополнение к **потока** ссылку подключения директивы, описанных ранее, две ссылки подключения директивы с именем **ObjectFlow**. Эти директивы указать, что экземпляр **ObjectFlow** можно нарисовать отношение между экземплярами **ObjectInState** класса домена или из экземпляра **ObjectInState**  к экземпляру **задачи**, но не между двумя экземплярами **задачи**, или из экземпляра **задачи** к экземпляру **ObjectInState**. Однако экземпляр **потока** можно нарисовать связь между двумя экземплярами **задачи**. Если скомпилировать и запустить решение задач потока, видно, что Рисование **потока** из экземпляра **ObjectInState** к экземпляру **задачи** создает экземпляр **ObjectFlow**, но рисования **потока** между двумя экземплярами **задачи** создает экземпляр **потока**.  
  
### <a name="custom-code-for-connection-builders"></a>Пользовательский код для построителей подключения  
 В пользовательском интерфейсе имеются четыре флажка, определяющие различные типы настройки построителей подключений:  
  
-   **принимают пользовательский** флажок в директиве роль источника или целевого объекта  
  
-   **настраиваемом** флажок в директиве роль источника или целевого объекта  
  
-   **использует пользовательские connect** флажок в директиве connect  
  
-   **— настраиваемый** свойство построитель подключения  
  
 Чтобы указать эти настройки, необходимо предоставить определенный программный код. Чтобы узнать, какой код необходимо предоставить, установите один их этих флажков, нажмите кнопку "Преобразовать все шаблоны" и постройте собственное решение. В результате будет получено сообщение об ошибке. Дважды щелкните сообщение об ошибке, чтобы увидеть комментарий с описанием кода, который необходимо добавить.  
  
> [!NOTE]
>  Чтобы добавить пользовательский код, создайте определение разделяемого класса в файле кода отдельно от файлов кода, находящихся в папках GeneratedCode. Чтобы не потерять свою работу, не изменяйте созданные файлы кода. Дополнительные сведения см. в разделе [переопределение и расширение созданных классов](../modeling/overriding-and-extending-the-generated-classes.md).  
  
#### <a name="creating-custom-connection-code"></a>Создание пользовательского кода подключения  
 В каждой связи подключения директивы, **источника директивы роли** определяет вкладку из новые типы можно перетаскивать. Аналогичным образом **целевой роли директивы** определяет вкладки можно перетаскивать новые типы. Для каждого типа, можно уточнить, следует ли разрешить соединения (для этой связи подключиться директивы), установив **принимают пользовательский** флаг, а затем укажите дополнительный код.  
  
 Также можно настроить действия, происходящие после выполнения подключения. Например, можно настроить только случай перетаскивания в определенный класс, все случаи, когда приоритетное значение имеет одна директива подключения связи, или весь построитель подключения FlowBuilder. Для каждого из этих вариантов можно установить пользовательские флажки на соответствующем уровне. При преобразовании всех шаблонов и попытке построить решение вы получите сообщения об ошибках с комментариями к созданному коду. В этих комментариях указывается, что необходимо предоставить.  
  
 В примере "Схема компонентов" построитель подключения для доменной связи "Подключение" ограничивает подключения, которые могут быть установлены между портами. На следующей иллюстрации показано, что подключения можно установить только от элементов `OutPort` к элементам `InPort`, но компоненты можно вкладывать друг в друга.  
  
 **Соединения, поступающих в OutPort вложенных компонентов**  
  
 ![Построитель подключения](../modeling/media/connectionbuilder_3.png "ConnectionBuilder_3")  
  
 В связи с этим необходимо указать, что подключение может идти от вложенного компонента к типу OutPort. Чтобы указать такое подключение, необходимо задать **использует настраиваемый принять** на **InPort** тип как роль источника и **OutPort** типа, что и целевой роли в **сведений DSL**  окна, как показано на следующем рисунке:  
  
 **Ссылка указывать директиву в обозреватель DSL**  
  
 ![Изображение мастера подключения](../modeling/media/connectionbuilder_4a.png "ConnectionBuilder_4a")  
  
 **Ссылка указывать директиву в окно сведений DSL**  
  
 ![](../modeling/media/connectionbuilder_4b.png "ConnectionBuilder_4b")  
  
 После этого в класс ConnectionBuilder необходимо предоставить методы:  
  
```  
  public partial class ConnectionBuilder  
  {  
    /// <summary>  
    /// OK if this component has children  
    /// </summary>  
    private static bool CanAcceptInPortAsSource(InPort candidate)  
    {  
       return candidate.Component.Children.Count > 0;  
    }  
  
    /// <summary>  
    /// Only if source is on parent of target.  
    /// </summary>  
    private static bool CanAcceptInPortAndInPortAsSourceAndTarget                (InPort sourceInPort, InPort targetInPort)  
    {  
      return sourceInPort.Component == targetInPort.Component.Parent;  
    }  
// And similar for OutPorts...  
```  
  
 Дополнительные сведения о настройке модели с помощью программного кода. в разделе [перехода и обновления модели в программном коде](../modeling/navigating-and-updating-a-model-in-program-code.md).  
  
 Подобный код можно использовать, например, для того, чтобы запретить пользователям создавать циклы со связями между родительскими и дочерними объектами. Эти ограничения рассматриваются ограничения «жесткий», поскольку пользователи не может нарушать их в любое время. Можно также создать «мягкое» проверки допустимости, которые пользователи могут временно обойти путем создания недопустимые конфигурации, которые не могут сохранять.  
  
### <a name="good-practice-in-defining-connection-builders"></a>Рекомендации по определению построителей подключений  
 Чтобы создаваемые типы отношений были концептуально связаны, настраивайте только один построитель подключений. В примере с задачей потока (Task Flow) для создания потоков между задачами, а также между задачами и объектами используется один и тот же построитель. В то же время использование одного и того же построителя для создания отношений между комментариями и задачами может создавать путаницу.  
  
 Определяя построитель подключений для нескольких типов отношений, обязательно убедитесь, что он не может сопоставить больше одного типа из одной той же пары исходных и целевых объектов. В противном случае результаты будут непредсказуемы.  
  
 Использовать пользовательский код для применения ограничений «жесткий», но рекомендуется, следует ли пользователи могут временно установить Недопустимая связь. Если такую возможность необходимо предоставить, ограничения можно изменить таким образом, чтобы эти подключения не проверялись до тех пор, пока пользователи не попытаются сохранить изменения.  
  
## <a name="see-also"></a>См. также  
 [Настройка создания и перемещения элементов](../modeling/customizing-element-creation-and-movement.md)   
 [Настройка функции копирования](../modeling/customizing-copy-behavior.md)   
 [Способ: добавить обработчик перетаскивания и вставки](../modeling/how-to-add-a-drag-and-drop-handler.md)   
 [Навигация по модели и обновление модели в программном коде](../modeling/navigating-and-updating-a-model-in-program-code.md)   
 [Образец схемы цепи DSL](http://code.msdn.microsoft.com/Visualization-Modeling-SDK-763778e8)