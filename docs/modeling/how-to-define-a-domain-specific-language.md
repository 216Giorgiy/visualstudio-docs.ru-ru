---
title: Определение доменного языка
ms.date: 11/04/2016
ms.topic: conceptual
f1_keywords:
- vs.dsltools.dsldesigner.domainrelationship
- vs.dsltools.dsldesigner.domainclass
- vs.dsltools.dsldesigner.domaintype
helpviewer_keywords:
- Domain-Specific Language, domain class
- Domain-Specific Language, external types
- Domain-Specific Language, relationships
- Domain-Specific Language, domain properties
author: gewarren
ms.author: gewarren
manager: douge
ms.workload:
- multiple
ms.technology: vs-ide-modeling
ms.openlocfilehash: a5dffe99929d8904054e635375f4bf26c3e88cf6
ms.sourcegitcommit: 4c0bc21d2ce2d8e6c9d3b149a7d95f0b4d5b3f85
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/20/2018
---
# <a name="how-to-define-a-domain-specific-language"></a>Определение доменного языка
Для определения доменного языка (DSL), на основе шаблона создается решение Visual Studio. Ключевой частью решения является схема определения DSL, которая хранится в файле DslDefinition.dsl. Определение DSL определяет классы и фигуры DSL. После внесения изменений и добавления элементов можно добавить программный код для более детальной настройки DSL.

Если вы не знакомы с доменного языка, рекомендуется работать через **лаборатории инструменты DSL**, который можно найти на этом сайте: [Visualizaton и пакет SDK моделирования](http://go.microsoft.com/fwlink/?LinkID=186128)

##  <a name="templates"></a> Выбор шаблона решения
 Для определения доменного языка необходимо установить следующие компоненты.

|||
|-|-|
|Visual Studio|[http://go.microsoft.com/fwlink/?LinkId=185579](http://go.microsoft.com/fwlink/?LinkId=185579)|
|[!INCLUDE[vssdk_current_short](../modeling/includes/vssdk_current_short_md.md)]|[http://go.microsoft.com/fwlink/?LinkId=185580](http://go.microsoft.com/fwlink/?LinkId=185580)|
|Пакет SDK для визуализации и моделирования в Visual Studio||


[!INCLUDE[modeling_sdk_info](includes/modeling_sdk_info.md)]


 Чтобы создать новый доменный язык, создайте новое решение Visual Studio с помощью шаблона проекта доменного языка.

#### <a name="to-create-a-dsl-solution"></a>Создание решения DSL

1.  Создайте решение с **доменный язык** шаблона, который можно найти в разделе **другие расширения типов проектов и** в **новый проект** диалоговое окно.

     ![Создание диалогового окна DSL](../modeling/media/create_dsldialog.png "Create_DSLDialog")

     При нажатии кнопки **ОК**, **доменный язык мастер** открывает и отображает список DSL и шаблонов.

2.  Нажмите на каждый шаблон, чтобы увидеть его описание. Выберите решение, максимально соответствующее тому, что вы хотите создать.

     Каждый шаблон DSL определяет основной рабочий DSL. Этот DSL можно отредактировать в соответствии с вашими требованиями.

     Нажмите на каждый образец, чтобы получить дополнительную информацию.

    -   Выберите **потока задач** Чтобы создать доменный язык DSL, имеющий дорожки. Дорожки — это вертикальные или горизонтальные разделы схемы.

    -   Выберите **компонент модели** Чтобы создать доменный язык DSL, имеющего порты. Порты — это небольшие фигуры на краю более крупной фигуры.

    -   Выберите **схемы классов** для определения DSL с фигуры секции. Фрагменты фигур содержат списки элементов.

    -   Выберите **минимальной языка** в других случаях или если вы не уверены.

    -   Выберите **минимальной WinForm конструктор** или **минимальной конструктор WPF** Создание DSL, который отображается в рабочей области Windows Forms или WPF. Вам нужно будет написать код для определения редактора. Дополнительные сведения см. в следующих разделах:

         [Создание доменного языка на основе Windows Forms](../modeling/creating-a-windows-forms-based-domain-specific-language.md)

         [Создание доменного языка на основе WPF](../modeling/creating-a-wpf-based-domain-specific-language.md)

3.  Введите расширение имени файла для DSL на соответствующей странице мастера. Это расширение будут использовать файлы, содержащие экземпляры DSL.

    -   Выберите расширение имени файла, не связанное ни с одним другим приложением на вашем или другом компьютере, где планируется устанавливать DSL. Например **docx** и **htm** будет неприемлемо файла расширения.

    -   Мастер предупредит, если расширение уже используется в качестве DSL. В этом случае выберите другое расширение имени файла. Можно также сбросить экземпляр экспериментального пакета SDK для Visual Studio, чтобы удалить старые экспериментальные конструкторы. Нажмите кнопку **запустить**, нажмите кнопку **все программы**, **Microsoft Visual Studio 2010 SDK**, **средства**, а затем **сбросить (Майкрософт) Visual Studio 2010 экспериментальный экземпляр**.

4.  Также можно изменить настройки на других страницах или оставить значения по умолчанию.

5.  Нажмите кнопку **Готово**.

     Мастер создаст решение, содержащее два или три проекта, и сгенерирует код из определения DSL.

 После этого пользовательский интерфейс примет следующий вид:

 ![Конструктор DSL](../modeling/media/dsl_designer.png "dsl_designer")

 Данное решение определяет доменный язык. Дополнительные сведения см. в разделе [Общие сведения о пользовательском интерфейсе доменный язык средства](../modeling/overview-of-the-domain-specific-language-tools-user-interface.md).

### <a name="test-the-solution"></a>Тестирование решения
 Шаблон решения предоставляет рабочий DSL, который можно изменить или использовать как есть.

 Чтобы протестировать решение нажмите клавишу F5 или комбинацию клавиш CTRL + F5. Новый экземпляр Visual Studio откроется в экспериментальном режиме.

 В новом экземпляре Visual Studio в обозревателе решений откройте файл образца. Он откроется в виде схемы с панелью элементов.

 При запуске решения, созданные на **минимальной языка** шаблона, в экспериментальном экземпляре Visual Studio будет выглядеть примерно так:

 ![](../modeling/media/dsl_min.png "DSL_min")

 Работа с инструментами Создайте элементы и соедините их.

 Закройте экспериментальный экземпляр Visual Studio.

> [!NOTE]
>  После изменения DSL фигуры больше не будут отображаться в тестовом файле Sample. При этом возможность создавать новые элементы сохранится.

### <a name="modifying-the-template-dsl"></a>Изменение шаблона DSL
 Переименуйте и оставьте некоторые или все классы доменов и фигур в шаблоне определения DSL. Новые имена классов должны быть действительными CLR-именами без пробелов и знаков препинания.

 Рекомендуем сохранить следующие классы:

-   Корневой класс отображается в левом верхнем углу схема определения DSL, в разделе **классы и отношения**. Присвойте ему другое имя, которое будет отличаться от имени DSL. Например, с именем DSL **MusicLibrary** может иметь корневой класс с именем **Музыка**.

-   Класс схемы отображается в правом нижнем углу схема определения DSL, в **элементам схемы** столбца. Возможно, чтобы его увидеть, экран придется прокрутить вправо. Обычно называется * YourDsl ***схема**.

-   Если вы использовали **потока задач** шаблона и требуется для создания схем с дорожки, поддержания и переименуйте класс домена субъекта и ActorSwimlane фигуры.

 Удалите или переименуйте другие классы в соответствии со своими потребностями.

##  <a name="patterns"></a> Шаблоны для определения DSL
 Рекомендуем разрабатывать DSL путем добавления или настройки одного или двух функций за один раз. Добавьте функцию, запустите DSL и протестируйте его работу, затем добавьте еще одну или несколько функций. В число типовых функций DSL входят следующие.

-   Класс домена, отношение внедрения, соединяющее элемент с моделью, фигура, предназначенная для отображения элементов класса на схеме, и средство элемента, позволяющее пользователям создавать элементы.

-   Свойства домена того или иного класса и декораторы, отображающие их на схеме.

-   Ссылочное отношение и соединитель, который отображает его на схеме, а также инструмент соединителя, который позволяет пользователям создавать связи.

-   Настройка, требующая программного кода, например проверка ограничений или команда меню.

 В следующих разделах описывается, как построить наиболее полезные виды функций DSL. Существуют много других шаблонов, с помощью которых может быть создан DSL, но эти используются наиболее часто.

> [!NOTE]
>  После добавления функции, не забудьте щелкните **преобразовать все шаблоны** в панели инструментов обозревателя решений, прежде чем создание и запуск доменного языка.

 На следующем рисунке показаны классы и отношения, которые являются частью DSL и используются в качестве примера в данном разделе.

 ![Внедрение и ссылочных связей](../modeling/media/music_classes.png "Music_Classes")

 Следующий рисунок является примером модели данного DSL:

 ![Модель экземпляра созданного DSL](../modeling/media/music_instance.png "Music_Instance")

> [!NOTE]
>  "Модель" означает экземпляр DSL, который создается пользователем и обычно отображается в виде схемы. В данном разделе рассматривается как схема определения DSL, так и схемы модели, которые отображаются при использовании DSL.

##  <a name="classes"></a> Определение классов домена
 Классы доменов представляют собой концепции DSL. Экземпляры *элементы модели*. В примере **MusicLibrary** DSL может содержать классы домена, с именем **альбом** и **песню**.

 Чтобы создать класс домена, можно перетащить из **класс с именем домена** инструмент на схему, а затем переименуйте класс.

 Дополнительные сведения см. в разделе [классы свойства домена](../modeling/properties-of-domain-classes.md).

### <a name="create-an-embedding-relationship-for-each-domain-class"></a>Создание отношения внедрения для каждого класса домена
 Каждый класс домена, кроме корневого, должен быть целевым объектом хотя бы одного отношения внедрения или наследоваться от класса, который является таким целевым объектом.

 В модели каждый элемент является узлом в едином дереве отношений внедрения. Источник и целевой объект отношения внедрения часто называют родительским и дочерним элементами.

 Выбор родительского элемента для класса домена зависит от того, как зависит время жизни этих элементов от других элементов. Если узел дерева удаляется, его поддерево обычно удаляется вместе с ним. Классы элемента, существующего независимо, встроены напрямую в корневой класс.

 Обычно если вы отображаете элемент внутри другого элемента, то показываете и его отношение к владельцу. В данном случае наиболее соответствующий родительский класс — это класс контейнера. Исключение имеет место, когда элемент внутри контейнера на самом деле является ссылкой на независимый элемент. В этом случае при удалении контейнера удаляется ссылка, но не объект, на который она указывает.

 В шаблонах определения DSL, описанных в данном разделе, будем предполагать, что элементы, отображаемые внутри контейнера, при удалении контейнера также будут удалены. Возможны и более сложные схемы, которые создаются путем определения ролей.

|Отображение элемента|Родительский класс (класс внедрения)|Пример в шаблоне решения DSL|
|------------------------------|--------------------------------|--------------------------------------|
|Фигура на схеме<br /><br /> Дорожка|Корневой класс DSL|Минимальный язык<br /><br /> Задача потока: Класс субъекта.|
|Фигура в дорожке|Класс домена элементов, который отображаются в качестве дорожек.|Задача потока: Класс задачи.|
|Элемент в списке в фигуре, удаляемый при удалении контейнера<br /><br /> Порт на краю фигуры|Класс домена, сопоставленный с фигурой контейнера|Схема классов: класс атрибута.<br /><br /> Схема компонентов: порт класса.|
|Элемент в списке, не удаляемый при удалении контейнера|Корневой класс DSL<br /><br /> Список с указанием связей и отношений||
|Не отображается напрямую|Класс, часть которого он формирует||

 В примере Music Library, альбомы (Album) отображаются как прямоугольники, в которых перечислены названия песен (Song). Следовательно, родителем элемента Album является корневой класс Music (Музыка), а родителем элемента Song (Песня) — класс Album (Альбом).

 Чтобы создать класс домена и внедрение одновременно, щелкните **отношения внедрения** средства, а затем щелкните родительский класс и выберите на пустую область схемы.

 Как правило, изменять имя отношения внедрения и его ролей не обязательно, так как они будут отслеживать имена классов автоматически.

 Дополнительные сведения см. в разделе [свойств отношений домена](../modeling/properties-of-domain-relationships.md) и [свойства роли домена](../modeling/properties-of-domain-roles.md).

> [!NOTE]
>  Внедрение не является наследованием. Дочерние элементы в отношении внедрения не наследуют свойства родительских элементов.

### <a name="add-domain-properties-to-each-domain-class"></a>Добавление свойств домена в каждый класс домена
 Свойства доменов хранят значения. Примеры: имя, должность, дата публикации.

 Нажмите кнопку **свойства домена** в классе, нажмите клавишу ВВОД и введите имя свойства. Тип свойства домена по умолчанию — строка. Если вы хотите изменить тип, выберите свойства домена и задайте **тип** в **свойства** окна. Если тип, который не входит в раскрывающемся списке, [Добавление типы свойств](#addTypes).

 **Задайте для свойства имени элемента.** Выберите свойство домена, которое может использоваться для определения элементов в Обозревателе языка. Например, в классе домена Song (Песня) можно выбрать свойство домена "Название". В **свойства** задайте **является имя элемента** для `true`.

### <a name="create-derived-domain-classes"></a>Создание производных классов доменов
 Если у классов доменов должны быть экземпляры, которые наследуют его свойства и отношения, можно создать классы, которые являются производными от него. Например, класс Album (Альбом) может иметь производные классы WMA и MP3.

 Создайте производный класс с помощью **класса домена** средства.

 Нажмите кнопку **наследования** , щелкните производного класса, а затем базовый класс.

 Рассмотрите возможность задания параметра **модификатор наследования** базового класса для **абстрактный**. Если вам могут понадобиться экземпляры базового класса, создайте для них отдельные производные классы.

 Производные классы наследуют свойства и роли базовых классов.

### <a name="tidy-the-dsl-definition-diagram"></a>Чистка схемы определения DSL
 При добавлении отношений некоторые из классов появятся сразу в нескольких местах. Чтобы уменьшить число вхождений и сделать расширить схему, щелкните правой кнопкой мыши целевой класс отношения и нажмите кнопку **перевести дерево здесь**. Обратный эффект, щелкните правой кнопкой мыши целевой класс связи и выберите **разбиения дерева**. Если эти команды меню отсутствуют, убедитесь, что выбран только класс домена.

 Для перемещения классов доменов и фигур используйте сочетания клавиш CTRL + стрелка вверх и CTRL + стрелка вниз.

### <a name="test-the-domain-classes"></a>Проверка классов доменов

##### <a name="to-test-the-new-domain-classes"></a>Чтобы проверить новые классы доменов, сделайте следующее.

1.  **Щелкните преобразовать все шаблоны** на панели инструментов обозревателя решений, чтобы создать код DSL конструктора. Этот шаг можно автоматизировать. Дополнительные сведения см. в разделе [как автоматизировать преобразовать все шаблоны](http://msdn.microsoft.com/b63cfe20-fe5e-47cc-9506-59b29bca768a).

2.  **Построение и выполнение доменный язык.** Нажмите клавишу F5 или CTRL + F5, чтобы запустить новый экземпляр Visual Studio в экспериментальном режиме. В экспериментальном экземпляре Visual Studio откройте или создайте файл с расширением доменного языка.

3.  **Откройте обозреватель.** AT части диаграммы является окне обозревателя языка, который обычно называется *YourLanguage* обозревателя. Если вы не видите это окно, оно может быть на вкладке под Обозревателем решений. Если не удается найти ее, на **представление** последовательно выберите пункты **другие окна**, а затем нажмите кнопку *YourLanguage* **Explorer**.

     В обозревателе представлен вид модели в качестве дерева.

4.  **Создайте новые элементы.** Щелкните правой кнопкой мыши корневой узел в верхней и нажмите кнопку **добавить новое *** YourClass*.

     Новый экземпляр класса появится в Обозревателе языка.

5.  При создании новых экземпляров следите за тем, чтобы все экземпляры получали разные имена. Это происходит только в том случае, если вы задали **является имя элемента** флаг свойством домена.

6.  **Просмотрите свойства домена. С помощью экземпляра класса выбран** проверить в окне «Свойства». Оно должно показывать свойства домена, которые вы определили для данного класса домена.

7.  **Сохраните файл, закройте его и снова откройте**. Все созданные экземпляры должны отобразиться в обозревателе, когда вы развернете узлы.

##  <a name="shapes"></a> Определение фигуры на диаграмме
 Вы можете определить классы элементов, которые отображаются на схеме в виде прямоугольников, эллипсов или ярлыков.

#### <a name="to-define-a-class-of-elements-that-appear-as-shapes-on-a-diagram"></a>Определение класса элементов, которые отображаются на схеме в виде фигур

1.  **Определить и проверить класс домена, как описано в**[определение классов домена](#classes) **.** 

    -   Родителем класса должен быть корневой класс. Это значит, что между корневым классом и новым классом домена должно существовать отношение внедрения.

    -   Если в схеме есть дорожки, то родителем может быть класс домена, сопоставленный с дорожкой. Прежде чем продолжить эту процедуру, в разделе [Определение DSL с дорожки](#swimlanes).

2.  **Добавить класс shape** для представления элементов на схеме модели. Перетащите один из следующих инструментов на схему определения DSL.

    -   **Геометрическая фигура** содержит прямоугольник или эллипс.

    -   **Изображение фигуры** отображает изображение, указываемые.

    -   **Фигура секции** представляет собой прямоугольник, содержащий один или несколько списков элементов.

     Переименуйте класс фигуры, который отображается в правой части схемы определения DSL под фигурами и соединителями.

3.  **Определение изображения, при создании образа фигуры**.

    1.  Создайте файл изображения любого размера. Поддерживаются форматы BMP, JPEG, GIF и EMF.

    2.  В Обозревателе решений добавьте файл в каталог решения Dsl\Resources.

    3.  Вернитесь в схему определения DSL и выберите новый класс фигуры изображения.

    4.  В окне «Свойства» щелкните **изображения** свойство.

    5.  В **Выбор изображения** диалогового окна щелкните раскрывающееся меню в разделе **имя файла**и выберите изображение.

4.  **Добавление текста декораторов в форму, чтобы отобразить свойства домена.**

     Чтобы отобразить имя или название элемента модели, потребуется хотя бы один декоратор.

     Щелкните правой кнопкой мыши заголовок фигуру класса, выберите пункт **добавить**, а затем нажмите кнопку **Decorator текст**. Задайте имя декоратор, а в наборе свойств окна его **позиции**.

5.  **Подключение каждой фигуры с картой элемент схемы для класса домена, которые должны отображаться**.

     Нажмите кнопку **схема элемента** средства, а затем класс домена выберите класс shape.

6.  **Сопоставления свойств для декораторов текста.**

    1.  Выберите серую линию между классом домена и классом фигуры, которая представляет карту элементов схемы.

    2.  В **сведений DSL** окно, нажмите кнопку **Decorator Maps** вкладки. Если вы не видите **сведений DSL** окна на **представление** последовательно выберите пункты **другие окна** и нажмите кнопку **сведений DSL**. Часто нужно поднять верхнюю часть окна, чтобы увидеть все его содержимое.

    3.  Выберите имя декоратора. В разделе **отобразить свойство**, выберите имя свойства класса домена. Повторите эти шаги для каждого декоратора.

         Если вы хотите отобразить свойство связанный элемент, нажмите кнопку Навигатор дерева раскрывающийся список в разделе **путь для отображения свойства**.

    4.  Возле имени каждого декоратора должен быть установлен флажок.

     ![Сопоставление фигур и окно сведений DSL](../modeling/media/dsldetailswindow.png "DslDetailsWindow")

7.  **Сделать элемент панели инструментов для создания элементов класса домена.**

    1.  В **обозреватель DSL**, разверните **редактор** узел и все его дочерние узлы.

    2.  Щелкните правой кнопкой мыши на узел в **вкладки области элементов** , имеет имя, совпадающее с именем доменного языка, например MusicLibrary. Нажмите кнопку **необходимо добавить элемент**.

        > [!NOTE]
        >  Если щелкнуть правой кнопкой мыши **средства** узел, вы не увидите **добавить средство элемент**. Вместо этого необходимо щелкнуть узел на уровень выше.

    3.  В окне «Свойства» с помощью нового инструмента элемент выбран набор **класса** классу домена, который вы недавно добавили.

    4.  Задать **заголовок** и **подсказка**.

    5.  Задать **значок панели элементов** значка, который будет отображаться на панели инструментов. Можно выбрать новый значок или значок, который уже используется для другого инструмента.

         Чтобы создать новый значок, откройте Dsl\Resources в **обозревателе решений**. Скопируйте и вставьте один из существующих BMP-файлов средства элемента. Переименуйте вставленную копию, а затем откройте ее двойным щелчком кнопки мыши для редактирования.

         Вернуться к схема определения DSL, выберите средство и в окне свойств щелкните **[...]**  в **значок панели элементов**. В **растрового изображения, выберите** диалоговое окно, выберите ваш. BMP-файл в раскрывающемся меню.

 Дополнительные сведения см. в разделе [свойства геометрических фигур](../modeling/properties-of-geometry-shapes.md) и [свойства фигур изображений](../modeling/properties-of-image-shapes.md).

#### <a name="to-test-shapes"></a>Тестирование Фигур

1.  **Щелкните преобразовать все шаблоны** на панели инструментов обозревателя решений, чтобы создать код DSL конструктора.

2.  **Построение и выполнение доменный язык.** Нажмите клавишу F5 или CTRL + F5, чтобы запустить новый экземпляр Visual Studio в экспериментальном режиме. В экспериментальном экземпляре Visual Studio откройте или создайте файл с расширением доменного языка.

3.  **Убедитесь, что элемент средства отображаются на панели инструментов.**

4.  **Создание фигур** путем перетаскивания из средства на схему модели.

5.  **Убедитесь, что каждый decorator текста,** и что:

    1.  Его можно изменить, если не было выбрано **— только для чтения пользовательского интерфейса** флаг свойства домена.

    2.  в случае изменения свойства в окне"Свойства" или в декораторе другой вид обновляется.

 После первого тестирования фигуры можно откорректировать некоторые свойства и добавить расширенные свойства. Дополнительные сведения см. в разделе [настройку и расширение доменного языка](../modeling/customizing-and-extending-a-domain-specific-language.md).

##  <a name="references"></a> Определение связей ссылка
 Между любым классом домена источника и классом домена целевого объекта можно определить ссылочное отношение. Ссылочные отношения обычно отображаются на схеме в виде соединителей — линий между фигурами.

 Например, если музыкальные альбомы (Album) и исполнители (Artist) отображаются в схеме в виде фигур, можно определить отношение с именем ArtistsAppearedOnAlbums, связывающее исполнителей и альбомы, в которых они участвуют. См. пример на рисунке.

 ![Модель экземпляра созданного DSL](../modeling/media/music_instance.png "Music_Instance")

 Ссылочные отношения могут также связывать элементы одного типа. Например, в DSL, представляющем собой генеалогическое древо, взаимосвязь между родительскими и дочерними элементами является ссылочным отношением между персонами.

### <a name="define-a-reference-relationship"></a>Определение ссылочного отношения
 Щелкните инструмент ссылочного отношения, затем класс домена источника отношения и, наконец, целевой класс домена. Целевой класс может быть таким же как и класс источника.

 Каждое отношение имеет две роли, представленные линией с каждой стороны окна отношений. Можно выбрать каждую роль и настроить ее свойства в окне "Свойства".

 **Рассмотрите возможность переименования роли**. Например, в отношении между персонами можно изменить имена по умолчанию на "Родители" и "Дети", "Руководитель" и "Подчиненные", "Преподаватель" и "Студент" и т. д.

 **Настройте параметры кратности каждой роли**, если это необходимо. Если у каждой персоны должно быть не больше одного Руководителя, укажите для параметра кратности под ярлыком "Руководитель" в схеме значение "0..1".

 **Добавьте связь свойства домена.** На рисунке отношение между исполнителем и альбомом имеет свойство роли.

 **Задайте для свойства позволяет дублирует связи,** Если более одной связи того же класса может существовать между одной паре элементов модели. Например, можно разрешить Преподавателю обучать одного и того же Студента нескольким Дисциплинам.

 ![Формирование карты для соединителей](../modeling/media/music_connector.png "Music_Connector")

 Дополнительные сведения см. в разделе [свойств отношений домена](../modeling/properties-of-domain-relationships.md) и [свойства роли домена](../modeling/properties-of-domain-roles.md).

### <a name="define-a-connector-to-display-the-relationship"></a>Определение соединителя для отображения отношения
 Соединитель отображает линию между двумя фигурами в схеме модели.

 Перетащите **соединитель** средства на схема определения DSL.

 Добавьте текстовые декораторы если необходимо отобразить ярлыки на соединителе. Установите их расположение. Чтобы позволить пользователю перемещать декоратор текста, задайте его **— Moveable** свойство.

 Используйте **схема элемента** средство для связывания соединитель отношение ссылки.

 Выбрана карта элемент схемы откройте **сведений DSL** окна и открыть **Decorator Maps** вкладки.

 Установите флажок для каждого **Decorator** и задайте **отобразить свойство** свойству в правильный домен.

 Убедитесь, что флажок отображается рядом с каждым элементом в **декораторов** списка.

### <a name="define-a-connection-builder-tool"></a>Определение средства построителя подключений
 В **обозреватель DSL** окна, разверните **редактор** узла и всех его подразделов.

 Щелкните правой кнопкой мыши узел, имя которого совпадает с именем DSL и нажмите кнопку **добавить новое средство подключения**.

 Выбрав новый инструмент, в окне "Свойства":

-   Задать **заголовок** и **подсказка**.

-   Нажмите кнопку **построитель подключения** и выберите соответствующий конструктор для новой связи.

-   Задать **значок панели элементов** значка, который будет отображаться на панели инструментов. Можно выбрать новый значок или значок, который уже используется для другого инструмента.

     Чтобы создать новый значок, откройте Dsl\Resources в **обозревателе решений**. Скопируйте и вставьте один из существующих BMP-файлов средства элемента. Переименуйте вставленную копию, а затем откройте ее двойным щелчком кнопки мыши для редактирования.

     Вернуться к схема определения DSL, выберите средство и в окне свойств щелкните **[...]**  в **значок панели элементов**. В **растрового изображения, выберите** диалоговое окно, выберите ваш. BMP-файл в раскрывающемся меню.

##### <a name="to-test-a-reference-relationship-and-connector"></a>Тестирование ссылочного отношения и соединителя

1.  **Щелкните преобразовать все шаблоны** на панели инструментов обозревателя решений, чтобы создать код DSL конструктора.

2.  **Построение и выполнение доменный язык.** Нажмите клавишу F5 или CTRL + F5, чтобы запустить новый экземпляр Visual Studio в экспериментальном режиме. В экспериментальном экземпляре Visual Studio откройте или создайте файл с расширением доменного языка.

3.  **Убедитесь, что средства подключения отображается на панели инструментов.**

4.  **Создание фигур** путем перетаскивания из средства на схему модели.

5.  **Создание подключений** между фигурами. Выберите соединитель, щелкните фигуру, а затем выберите другую фигуру.

6.  **Убедитесь, что нельзя создавать подключения между неуместные классы.** Например, если установлено отношение между Альбомами и Исполнителями, убедитесь, что нельзя связать Исполнителей с Исполнителями.

7.  **Проверьте правильность количества элементов на схемах. Например убедитесь, что не удается подключиться человека более чем одному менеджеру.**

8.  **Убедитесь, что каждый decorator текста,** и что:

    1.  Его можно изменить, если не было выбрано **— только для чтения пользовательского интерфейса** флаг свойства домена.

    2.  в случае изменения свойства в окне"Свойства" или в декораторе другой вид обновляется.

 После первого тестирования соединителя можно откорректировать некоторые свойства и добавить расширенные свойства. Дополнительные сведения см. в разделе [настройку и расширение доменного языка](../modeling/customizing-and-extending-a-domain-specific-language.md).

##  <a name="compartments"></a> Определение фигуры, которые содержат списки: секции фигуры
 Фигура секции содержит один или несколько списков элементов. Например, в DSL Music Library можно использовать фигуру секции для представления музыкальных Альбомов. В каждом Альбоме есть список Песен.

 ![Фигура секции](../modeling/media/compartmentshape.png "CompartmentShape")

 Самый простой способ добиться этого эффекта в определении DSL — это определить один класс домена для контейнера и один класс домена для каждого списка. Класс контейнера сопоставлен с фигурой секции.

 ![Карта фигур](../modeling/media/music_mapcomp.png "Music_MapComp")

 Дополнительные сведения см. в разделе [свойства секции фигуры](../modeling/properties-of-compartment-shapes.md).

#### <a name="to-define-a-compartment-shape"></a>Определение фигуры секции

1.  **Создание класса контейнера домена**. Нажмите кнопку **отношения внедрения** средства корневой класс модели и затем щелкните пустую часть схема определения DSL. Это создаст класс домена, который на рисунке примера называется Album.

     В качестве альтернативы вместо встраивания в корневой класс можно встроить контейнер в класс домена, сопоставленный с дорожкой.

     Добавьте в класс свойства домена, такие как имя и задайте его **является имя элемента** флага в окне «Свойства».

2.  **Создание класса домена элемента списка**. Нажмите кнопку **отношения внедрения** , щелкните класс контейнера (альбом) и затем щелкните пустую область схемы. Это создаст класс домена, который на рисунке примера называется Song (Песня).

     Добавьте свойства домена, таких как заголовок к классу и задайте его **является имя элемента** флаг.

     Добавьте другие свойства домена.

     Добавьте по классу домена для каждого списка элементов, который необходимо отобразить.

3.  **Создайте несколько типов элемента в списке**, создавать классы, производные от класса list. Сделать абстрактного класса list, назначая его **модификатор наследования**.

     Например, если вы хотите, чтобы классическая музыка сортировалась по композитору, а не по исполнителю, можно создать в классе Song (Песня) два подкласса: ClassicalSong (Классические) и NonClassicalSong (Не классические).

4.  **Создание секции фигуры**. Перетащите из **фигура секции** средства на схема определения DSL.

     Добавьте текстовый декоратор и укажите для него имя.

     Добавьте секцию и укажите для нее имя.

5.  Чтобы позволить пользователю скрытие список секций, щелкните правой кнопкой мыши фигуру класса секции, наведите указатель на **добавить**, а затем нажмите кнопку **Decorator развернуть или свернуть**. В окне "Свойства" задайте расположение декоратора.

6.  Нажмите кнопку **схема элемента** средства класс контейнера домена и нажмите кнопку фигура секции.

7.  Выберите связь карты элемента схемы между классом домена и фигурой. В **сведений DSL** окна:

    1.  Нажмите кнопку **декораторов** вкладки. Щелкните имя декоратор, а затем выберите соответствующий элемент в списке **отображаемое свойство**. Убедитесь, что возле имени каждого декоратора установлен флажок.

    2.  Нажмите кнопку **Maps секции** вкладки.

         Выберите имя секции.

         В разделе **отображаемые элементы коллекции путь**, найдите класс элемента списка (песню). Щелкните стрелку раскрывающегося меню, чтобы воспользоваться инструментом навигации.

         В разделе **отображаемое свойство**, выберите свойство, которое должно отображаться в списке. В этом примере это свойство — Название.

> [!NOTE]
>  Используя поля "Путь" в карте декораторов и полях в карте секций, установите более сложные отношения между классами доменов и фигурой секции.

#### <a name="to-define-a-tool-for-creating-the-shape"></a>Определение инструмента для создания фигуры

1.  **Сделать элемент панели инструментов для создания элементов класса домена.**

2.  В **обозреватель DSL**, разверните **редактор** узел и все его дочерние узлы.

3.  Щелкните правой кнопкой мыши на узел в **вкладки области элементов** , имеет имя, совпадающее с именем доменного языка, например MusicLibrary. Нажмите кнопку **необходимо добавить элемент**.

    > [!NOTE]
    >  Если щелкнуть правой кнопкой мыши **средства** узел, вы не увидите **добавить средство элемент**. Вместо этого необходимо щелкнуть узел на уровень выше.

4.  В окне «Свойства» с помощью нового инструмента элемент выбран набор **класса** классу домена, который вы недавно добавили.

5.  Задать **заголовок** и **подсказка**.

6.  Задать **значок панели элементов** значка, который будет отображаться на панели инструментов. Можно выбрать новый значок или значок, который уже используется для другого инструмента.

     Чтобы создать новый значок, откройте Dsl\Resources в **обозревателе решений**. Скопируйте и вставьте один из существующих BMP-файлов средства элемента. Переименуйте вставленную копию, а затем откройте ее двойным щелчком кнопки мыши для редактирования.

     Вернуться к схема определения DSL, выберите средство и в окне свойств щелкните **[...]**  в **значок панели элементов**. В **растрового изображения, выберите** диалоговом окне выберите файл BMP в раскрывающемся меню.

#### <a name="to-test-a-compartment-shape"></a>Тестирование фигуры сегмента

1.  **Щелкните преобразовать все шаблоны** на панели инструментов обозревателя решений, чтобы создать код DSL конструктора.

2.  **Построение и выполнение доменный язык.** Нажмите клавишу F5 или CTRL + F5, чтобы запустить новый экземпляр Visual Studio в экспериментальном режиме. В экспериментальном экземпляре Visual Studio откройте или создайте файл с расширением доменного языка.

3.  **Убедитесь, что средство отображается на панели инструментов.**

4.  Перетащите инструмент в схему модели. Будет создана новая фигура.

     Убедитесь, что имя элемента отображается и автоматически получает значение по умолчанию.

5.  Щелкните правой кнопкой мыши заголовок новая фигура и нажмите кнопку Добавить *Your элемента списка.* В этом примере используется команда "Добавить песню".

     Убедитесь, что элемент отображается в списке под новым именем.

6.  Щелкните один из элементов списка и проверьте окно "Свойства". В нем должны появиться свойства элементов списка.

7.  Откройте Обозреватель языка. Убедитесь, что узлы контейнера содержат узлы элементов списка.

 ![Созданный обозреватель DSL](../modeling/media/music_explorer.png "Music_Explorer")

 После первого тестирования фигуры секции можно откорректировать некоторые свойства и добавить расширенные свойства. Дополнительные сведения см. в разделе [настройку и расширение доменного языка](../modeling/customizing-and-extending-a-domain-specific-language.md).

### <a name="displaying-a-reference-link-in-a-compartment"></a>Отображение ссылочной связи в секции
 Обычно элемент, который отображается в секции, является дочерним для элемента, который представлен фигурой фрагмента. Однако в некоторых случаях можно отобразить элемент, который связан с ним ссылочным отношением.

 Например, можно добавить вторую секцию в элемент AlbumShape, отображающий список Исполнителей, которые связаны с Альбомом.

 В этом случае секция должна отображать связь вместо элемента, на который она ссылается. Это связано с тем, что, когда пользователь выбирает элемент в секции и нажимает клавишу DELETE, должна удаляться связь, а не элемент, на который создана ссылка.

 Тем не менее можно сделать так, чтобы имя элемента, на который создана ссылка, отображалось в секции.

 Следующая процедура предполагает, что вы уже создали класс домена, ссылочное отношение, фигуру секции и карту элементов схемы, как описано выше в этом разделе.

##### <a name="to-display-a-reference-link-in-a-compartment"></a>Отображение ссылочной связи в секции

1.  **Добавление секции фигура секции**. На схема определения DSL, щелкните правой кнопкой мыши фигуру класса секции, укажите **добавить**, а затем нажмите кнопку **секции**.

2.  Задать **отображаемые элементы коллекции путь** для перехода к ссылке, вместо его целевого элемента. Откройте раскрывающееся меню и выберите в представлении дерева вместо цели ссылочное отношение. В примере связь является **ArtistAppearedOnAlbums**.

3.  Задать **путь к свойству отображения** для перехода по ссылке в целевой элемент. В этом примере это **исполнителя**.

4.  Задать **отображаемое свойство** в соответствующее свойство целевого элемента, например **имя**.

5.  **Преобразовать все шаблоны**, построения и запуска DSL и откройте модель тестового.

6.  В схеме модели создайте соответствующие классы фигур, присвойте им имена и создайте связь между ними. В фигуре секции должны появиться имена связанных элементов.

7.  Выберите связь или элемент в фигуре секции. Связь и элемент должны исчезнуть.

##  <a name="ports"></a> Определение портов на границе другую форму
 Порт — это фигура, которая находится на границе с другой фигурой.

 Порты могут также использоваться для предоставления фиксированной точки соединения с другой фигурой, для которой пользователь может нарисовать соединители. В данном случае фигуру порта можно сделать прозрачной.

 Чтобы увидеть пример, использующий порты, выберите **схема компонентов** шаблона при создании нового решения DSL. В данном примере показаны основные точки, которые можно использовать при определении портов.

-   Класс домена, который представляет контейнер портов (`Component`).

-   Класс домена, который представляет порты. В этом примере используется класс `ComponentPort`.

-   Отношение внедрения между классом домена контейнера и классом домена порта. Дополнительные сведения см. в разделе [определение доменные классы](#classes).

-   Если в одном контейнере нужно смешать разные типы портов, можно создать подклассы класса домена порта. В данном примере `InPort` и `OutPort` наследуются от `ComponentPort`.

-   Класс домена контейнера может быть сопоставлен с любым видом фигуры. В этом примере используется `ComponentShape`. Дополнительные сведения см. в разделе [определение фигуры](#shapes).

-   Классы доменов портов сопоставлены с фигурами портов. Можно сопоставить либо производные классы с отдельными классами фигур портов, либо базовый класс с одним классом фигуры порта.

 В других отношениях фигур портов вести себя, как описано в [определение фигуры](#shapes).

 Дополнительные сведения см. в разделе [свойства фигур портов](../modeling/properties-of-port-shapes.md).

##  <a name="swimlanes"></a> Определение DSL с дорожки
 Дорожки — это вертикальные или горизонтальные разделения схемы. Каждая дорожка соответствует элементу модели. Определение DSL требует одного класса домена для элементов дорожек.

 Лучший способ создать DSL с дорожками — это создать новое решение DSL и выбрать шаблон решения "Поток задач". В определении DSL класс субъекта является классом домена, сопоставленным с дорожкой. Переименуйте его и другие классы в соответствии со своим проектом.

 Чтобы добавить класс, который будет отображаться как фигура внутри дорожки, создайте отношение внедрения между классом дорожки и новым классом. Пользователи смогут перетаскивать элементы из одной дорожки в другую, но каждый элемент всегда будет находиться внутри конкретной дорожки. В шаблоне решения "Поток задач", FlowElement является дочерним классом класса дорожки.

 Чтобы добавить класс, который будет отображаться как фигура, независимая от дорожки, создайте отношение внедрения между корневым и новым классами. Пользователи смогут размещать эти фигуры в любом месте схемы, в т. ч. на границах и за пределами дорожек. В шаблоне решения "Поток задач", Comment является дочерним классом класса дорожки.

 Дополнительные сведения см. в разделе [свойства дорожки](../modeling/properties-of-swimlanes.md).

##  <a name="addTypes"></a> Добавление типов свойств

### <a name="domain-enumerations-and-literals"></a>Доменные перечисления и литералы
 Доменное перечисление — это тип с несколькими значениями литералов.

 Добавление доменного перечисления, щелкните правой кнопкой мыши корень модели в **обозреватель DSL** и нажмите кнопку **Добавление нового домена перечисления**. Элемент будет отображаться в **обозреватель DSL** под **типы доменов** узла. Этот элемент не отображается в схеме.

 Добавление литералы перечисления доменного перечисления, щелкните правой кнопкой мыши домен перечисления **обозреватель DSL** и нажмите кнопку **добавить новое перечисление литерала**.

 По умолчанию свойство, которое имеет тип перечисления, может иметь только одно значение перечисления за раз. Пользователей и программисты, чтобы иметь возможность установить любое сочетание значений - «битовое поле -» задайте **IsFlags** свойства перечисления.

### <a name="external-types"></a>Внешние типы
 Если при задании типа свойства домена, не найден тип требуется в **тип** раскрывающегося списка можно добавить во внешний тип. Например, можно добавить **System.Drawing.Color** типом в список.

 Чтобы добавить тип, щелкните правой кнопкой мыши корень модели в обозревателе DSL и нажмите кнопку **добавить новый внешний тип**. В окне свойств задайте имя **цвет** и пространство имен **System.Drawing**. Этот тип теперь отображается в обозревателе DSL в **типы доменов**. и будет доступен для выборе при установке типа свойства домена.

##  <a name="custom"></a> Настройка языка DSL
 Используя техники, описанные в этом разделе, можно быстро создать DSL со схематическим представлением, читаемой формой XML и основными инструментами, необходимыми для генерирования кода или других артефактов.

 Существуют два метода расширения определения DSL.

1.  Точная настройка DSL с использованием многочисленных функций определения DSL. Например, можно сделать единое средство подключения, способное создавать несколько типов соединителей, и настроить правила, по которым удаление одного элемента ведет к удалению связанных элементов. Большинство этих техник требуют установки значений в определении DSL, а некоторые — написания нескольких строк программного кода.

     Дополнительные сведения см. в разделе [настройку и расширение доменного языка](../modeling/customizing-and-extending-a-domain-specific-language.md).

2.  Расширение инструментов моделирования с помощью программного кода для достижения более сложных эффектов. Например, можно создать команды меню, способные изменять модель, а также инструменты, соединяющие в себе два и более DSL. VMSDK разработан специально для того, чтобы облегчить интеграцию расширений с кодом, который генерируется из определения DSL.  Дополнительные сведения см. в разделе [написание кода для настройки доменного языка](../modeling/writing-code-to-customise-a-domain-specific-language.md).

### <a name="changing-the-dsl-definition"></a>Изменение определения DSL
 При создании любого элемента в определении DSL многие значения устанавливаются автоматически. Установленные значения можно изменять. Это упрощает разработку DSL и в то же время позволяет осуществлять значительные настройки.

 Например, когда фигура сопоставляется с элементом, путь родительского элемента сопоставления автоматически устанавливается согласно отношению внедрения соответствующего класса домена. Если же впоследствии отношение внедрения корректируется, путь родительского элемента автоматически не изменяется.

 Следовательно, необходимо знать, что при изменении некоторых взаимосвязей в определении DSL нет ничего необычного в том, что при сохранении определения или трансформации всех шаблонов будут выдаваться сообщения об ошибках. Большинство этих ошибок легко исправить. Откройте сообщение об ошибке двойным щелчком кнопки мыши, чтобы найти расположение ошибки.

 См. также [как: изменить пространство имен доменного языка](../modeling/how-to-change-the-namespace-of-a-domain-specific-language.md).

##  <a name="trouble"></a> Устранение неполадок
 В следующей таблице перечислено большинство стандартных проблем, возникающих при разработке DSL, а также предложения по их решению. Дополнительные советы можно найти в [форум Extensibililty средств визуализации](http://go.microsoft.com/fwlink/?LinkId=186074).

|Проблема|Предложение|
|-------------|----------------|
|Изменения, внесенные в файл определения DSL, не работают.|Нажмите кнопку **преобразовать все шаблоны** на панели инструментов над обозревателя решений и перестройте решение.|
|Фигуры показывают имя декоратора вместо значения свойства.|Настройте сопоставление декоратора. В схеме определения DSL щелкните карту элементов схемы — это серая линия между классом домена и классом фигуры.<br /><br /> Откройте **сведений DSL** окна. Если не отображается, в меню «Вид», выберите **другие окна**, а затем нажмите кнопку **сведений DSL**.<br /><br /> Нажмите кнопку **Decorator Maps** вкладки. Выберите имя декоратора. Убедитесь, что флажок рядом с ним установлен. В разделе **отобразить свойство**, выберите имя свойства домена.<br /><br /> Дополнительные сведения см. в разделе [фигур на схеме](#shapes).|
|В Обозревателе DSL не удается добавить коллекцию. Например, при щелчке правой кнопкой мыши по пункт "Инструменты" в меню не отображается команда "Добавить инструмент".<br /><br /> В Обозревателе DSL не удается добавить элемент в список.|Щелкните элемент над интересующим вас узлом правой кнопкой мыши. Если вы хотите добавить элемент в список, ищите команду "Добавить" не в узле списка, а во владельце.|
|Я создал класс домена, но не могу создать экземпляры в Обозревателе языка.|Каждый класс домена, кроме корневого, должен быть целевым объектом отношения внедрения.|
|В Обозревателе DSL элементы отображаются только с именами их типов.|В определении DSL, выберите свойство класса домена и в окне свойств задайте **является имя элемента** значение true.|
|DSL всегда открывается в XML-редакторе.|Это происходит из-за ошибки чтения файла. Даже если вы исправите эту ошибку, необходимо будет специально сбросить редактор, чтобы он больше не выступал в качестве конструктора DSL.<br /><br /> Щелкните правой кнопкой мыши элемент проекта, нажмите кнопку **открыть с помощью** и выберите * YourLanguage ***конструктор (по умолчанию)**.|
|Панель элементов в DSL не отображается после изменения имен сборки.|Проверьте и обновите **DslPackage\GeneratedCode\Package.tt** Дополнительные сведения см. в разделе [как: изменить пространство имен доменного языка](../modeling/how-to-change-the-namespace-of-a-domain-specific-language.md).|
|Панель элементов в DSL не отображается, хотя имя сборки не изменялось.<br /><br /> Либо появляется сообщение о невозможности загрузить расширение.|Сбросьте экспериментальный экземпляр и выполните сборку решения заново.<br /><br /> 1.  В Windows меню «Пуск», в разделе **все программы**, разверните [!INCLUDE[vssdk_current_long](../misc/includes/vssdk_current_long_md.md)], затем **средства**и нажмите кнопку **Сброс Microsoft Visual Studio экспериментальный экземпляр**.<br />2.  В Visual Studio**построения** меню, нажмите кнопку **Перестроить решение**.|

## <a name="see-also"></a>См. также

- [Начало работы с доменными языками](../modeling/getting-started-with-domain-specific-languages.md)
- [Создание доменного языка на основе Windows Forms](../modeling/creating-a-windows-forms-based-domain-specific-language.md)
- [Создание доменного языка на основе WPF](../modeling/creating-a-wpf-based-domain-specific-language.md)