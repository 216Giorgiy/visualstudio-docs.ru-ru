---
title: "Общие сведения о коде DSL | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords: Domain-Specific Language, generated code
ms.assetid: 8e5c10e4-6323-433e-b88a-5d3d92639030
caps.latest.revision: "19"
author: alancameronwills
ms.author: awills
manager: douge
ms.workload: multiple
ms.openlocfilehash: 294d10eb8a8fab361ddf5b3dadf4d779a95947a0
ms.sourcegitcommit: 32f1a690fc445f9586d53698fc82c7debd784eeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2017
---
# <a name="understanding-the-dsl-code"></a>Общие сведения о коде доменных языков
Доменный язык (DSL) создает API, который можно использовать для чтения и обновления экземпляров DSL в [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)]. Этот API определяется в коде, созданном из определения DSL. В этом разделе описывается созданный API.  
  
## <a name="the-example-solution-component-diagrams"></a>Пример решения: схемы компонентов  
 Чтобы создать решение, которое является источником в большинстве примеров в этом разделе, создайте DSL из **компонент модели** шаблон решения. Это один из стандартных шаблонов, которые появляются при создании нового решения DSL.  
  
> [!NOTE]
>  Шаблон DSL компонентов схемы не связаны с UML-схемы компонентов, которые можно создать с помощью меню «архитектура» в Visual Studio. В **новый проект** диалогового окна разверните **другие проекта Types\Extensibility** и нажмите кнопку **конструктора доменного языка**.  
  
 Нажмите клавишу F5 и поэкспериментируйте с этим шаблоном решения, если вы с ним еще не знакомы. В частности, обратите внимание на то, что порты создаются перетаскиванием инструмента порта на компонент, и порты можно подключать.  
  
 ![Компоненты и взаимосвязанные порты](../modeling/media/componentsample.png "ComponentSample")  
  
## <a name="the-structure-of-the-dsl-solution"></a>Структура решения DSL  
 **Dsl** проекта определяет API для доменного языка. **DslPackage** проекта определяет, как интегрируется с [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)]. Вы можете также добавить собственные проекты, которые могут содержать код, созданный из модели.  
  
### <a name="the-code-directories"></a>Каталоги кода  
 Большая часть кода в каждом из этих проектов создается на основе **Dsl\DslDefinition.dsl**. Созданный код находится в **кода, созданного** папки. Для просмотра созданного файла щелкните **[+]** рядом с формирование **.tt** файла.  
  
 Чтобы лучше понять технологию DSL, рекомендуем проверить созданный код. Чтобы посмотреть созданные файлы, разверните файлы *.TT в окне "Обозреватель решений".  
  
 \*Tt-файлы содержат очень мало создающий код. Вместо него они используют директивы `<#include>`, которые включают общие файлы шаблонов. Общие файлы можно найти в **10.0\Common7\IDE\Extensions\Microsoft\DSL Visual Studio \Program Files\Microsoft SDK\DSL Designer\11.0\TextTemplates**  
  
 Добавляя собственный программный код в решение DSL, вставляйте его в отдельный файл и не сохраняйте его в папку с созданным кодом. Может потребоваться создать **пользовательский код** папки. (При добавлении нового файла кода в пользовательскую папку не забудьте исправить пространство имен в структуре исходного кода.)  
  
 Настоятельно рекомендуем не изменять созданный код напрямую, потому что при перестроении решения эти изменения будут утеряны. Вместо этого используйте настройку DSL.  
  
-   Настройте многочисленные параметры в определении DSL.  
  
-   Напишите частичные классы в отдельных файлах кода, чтобы переопределить методы, определенные в созданных классах или унаследованные из них. В некоторых случаях необходимо установить **приводит к возникновению ошибки производного типа Double** параметр класса в определение DSL, чтобы иметь возможность переопределять созданный метод.  
  
-   Настройка параметров в определении DSL, созданный код может указать собственный код «обработчики».  
  
     Например, если задать **имеет пользовательский конструктор** параметр доменного класса и затем выполните сборку решения, вы увидите сообщения об ошибках. Двойной щелчок по одному из этих сообщений об ошибках откроет в созданном коде комментарии, объясняющие, что должно быть указано в пользовательском коде.  
  
-   Напишите собственные текстовые шаблоны, чтобы создать отдельный код для этого приложения. Вы можете использовать файлы из общих частей шаблонов, доступных для многих проектов, и создавать шаблоны проекта [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] для настройки проектов, которые запускаются с помощью собственной структуры файла.  
  
## <a name="generated-files-in-dsl"></a>Файлы, созданные в DSL  
 Следующие созданные файлы отображаются в **Dsl** проекта.  
  
 *YourDsl*`Schema.xsd`  
  
 Схема для файлов, содержащая экземпляры DSL. Этот файл копируется в компиляции (**bin**) каталога. Если вы устанавливаете доменного языка, можно скопировать этот файл на **11.0\Xml\Schemas \Program Files\Microsoft Visual Studio** для проверки файлов модели. Дополнительные сведения см. в разделе [развертывание решений доменный язык](../modeling/deploying-domain-specific-language-solutions.md).  
  
 При настройке сериализации путем установки параметров в Обозревателе DSL схема изменится соответствующим образом. В случае написания собственного кода сериализации этот файл может больше не отражать фактическую схему. Дополнительные сведения см. в разделе [Настройка хранения файлов и XML-сериализация](../modeling/customizing-file-storage-and-xml-serialization.md).  
  
 `ConnectionBuilders.cs`  
  
 Построитель подключений — это класс, который создает отношения. Это код, лежащий в основе средства подключения. В этом файле содержится пара классов для каждого средства подключения. Их имена являются производными от имен средства связи и подключения домена: *связь*построителе и *ConnectorTool*ConnectAction.  
  
 (В примере решения компонента один из построителей подключений называется ConnectionBuilder. Это совпадение, поскольку доменная связь называется Connection.)  
  
 Создать связь в *связь* `Builder.Connect()` метод. Версия по умолчанию проверяет приемлемость элементов исходной и целевой модели, а затем создает экземпляр отношения. Пример:  
  
 `CommentReferencesSubject(sourceAccepted, targetAccepted);`  
  
 Каждый класс построителя создается из узла **построители подключения** раздела обозреватель DSL. Один метод `Connect` может создать отношения между одной или несколькими парами классов доменов. Каждая пара определяется директивой подключения связи, которая находится в Обозревателе DSL под узлом построителя.  
  
 Например, к одному построителю подключения можно добавить директивы подключения связи для каждого из трех типов отношений в примере DSL. Это позволяет обеспечить пользователя единым средством подключения. Тип созданного экземпляра отношений будет зависеть от типов исходных и целевых элементов, выбранных пользователем.  Чтобы добавить директивы подключения связи, в Обозревателе DSL щелкните построитель правой кнопкой мыши.  
  
 Чтобы написать пользовательский код, выполняемый при создании определенного типа доменной связи, выберите соответствующую директиву подключения связи, расположенную под узлом построителя. В окне свойств задайте **использует пользовательские подключения**. Перестройте решение, а потом добавьте код, чтобы исправить возникшие ошибки.  
  
 Чтобы написать пользовательский код, который выполняется всякий раз, когда пользователь использует этот инструмент подключения, задайте **— пользовательские** свойство построитель подключения. Вы можете добавить код, определяющий допустимость исходного элемента и определенной комбинации источника и цели, а также обновления, которые нужно применить к модели после установки подключения. Например, можно разрешить подключение только в том случае, если оно не создает в схеме цикл. Вместо одной ссылки отношения можно создать экземпляр более сложного шаблона из нескольких взаимосвязей между источником и целью.  
  
 `Connectors.cs`  
  
 Содержит классы для соединителей, являющихся элементами схемы, которые, как правило, представляют ссылочные отношения. Каждый класс создается из одного соединителя в определении DSL. Каждый класс соединителя является производным от класса <xref:Microsoft.VisualStudio.Modeling.Diagrams.BinaryLinkShape>.  
  
 Чтобы сделать цвет и некоторые другие переменной стиль функции во время выполнения, щелкните правой кнопкой мыши класс на схема определения DSL и пункты **добавьте предоставляется**.  
  
 Чтобы разрешить изменение дополнительных стилевых особенностей во время выполнения, см. примеры в разделах <xref:Microsoft.VisualStudio.Modeling.Diagrams.TextField> и <xref:Microsoft.VisualStudio.Modeling.Diagrams.ShapeElement>.  
  
 `Diagram.cs`  
  
 Содержит класс, определяющий схему. Это производный класс от класса <xref:Microsoft.VisualStudio.Modeling.Diagrams.Diagram>.  
  
 Чтобы сделать цвет и некоторые другие переменной стиль функции во время выполнения, щелкните правой кнопкой мыши класс на схема определения DSL и пункты **добавьте предоставляется**.  
  
 Кроме того, в этом файле содержится правило `FixupDiagram`, срабатывающее при добавлении в модель нового элемента. Правило добавляет новую фигуру и связывает ее с элементом модели.  
  
 `DirectiveProcessor.cs`  
  
 Этот процессор директив помогает пользователям создавать текстовые шаблоны, считывающие ваш экземпляр DSL. Процессор директив загружает сборки (DLL) для DSL и эффективно вставляет оператор `using` в пространство имен. Это позволяет коду, расположенному в текстовых шаблонах, использовать классы и отношения, определенные в DSL.  
  
 Дополнительные сведения см. в разделе [формирование кода из доменного языка](../modeling/generating-code-from-a-domain-specific-language.md) и [Создание настраиваемых T4 процессорами текстового шаблона директива](../modeling/creating-custom-t4-text-template-directive-processors.md).  
  
 `DomainClasses.cs`  
  
 Реализует определенные вами классы доменов, включая абстрактные классы и класс корня модели. Они являются производными от класса <xref:Microsoft.VisualStudio.Modeling.ModelElement>.  
  
 Каждый класс домена содержит  
  
-   Определение свойства и вложенный класс обработчика для каждого свойства домена. Функции OnValueChanging() и OnValueChanged() можно переопределить. Дополнительные сведения см. в разделе [обработчики изменений значений свойств домена](../modeling/domain-property-value-change-handlers.md).  
  
     В примере DSL класс `Comment` содержит свойство `Text` и класс обработчика `TextPropertyHandler`.  
  
-   Свойства методов доступа для отношений, в которых участвует этот класс домена. (Вложенного класса для свойств роли нет.)  
  
     В примере DSL класс `Comment` имеет методы доступа, которые обращаются к родительской модели через отношение внедрения `ComponentModelHasComments`.  
  
-   Конструкторы. Если требуется переопределить значение **имеет пользовательский конструктор** класса домена.  
  
-   Методы обработчика прототипа группы элементов (EGP). Это необходимо, если пользователь может *слияния* (Добавить) другой элемент на экземпляры этого класса. Обычно для этой цели пользователь перетаскивает элемент из средства элемента или другой фигуры или использует команду вставки.  
  
     В примере DSL порты ввода и вывода могут быть объединены в один компонент. Кроме того, компоненты и комментарии могут быть объединены в одну модель. Классу  
  
     Методы обработчика EGP в классе Component разрешают компоненту доступ к портам, но не к комментариям. Обработчик EGP в классе модели корня принимает комментарии и компоненты, но не порты.  
  
 `DomainModel.cs`  
  
 Класс, представляющий модель домена. Это производный класс от класса <xref:Microsoft.VisualStudio.Modeling.DomainModel>.  
  
> [!NOTE]
>  Этот класс отличается от корневого класса модели.  
  
 Замыкания копирования или удаления определяют, какие еще элементы следует включить при копировании или удалении элемента. Можно контролировать это поведение, задав **распространяет копирования** и **распространяет удалить** свойства ролей на каждой стороне каждой связи. Если необходимо, чтобы значения определялись динамически, можно написать код, переопределяющий методы классов замыкания. 
  
 `DomainModelResx.resx`  
  
 Содержит такие строки, как описания классов и свойств доменов, названия свойств, метки панели элементов, стандартные сообщения об ошибках и другие строки, которые могут демонстрироваться пользователю. Также содержит значки инструментов и изображения для фигур изображений.  
  
 Этот файл связан с построенной сборкой и предоставляет значения этих ресурсов по умолчанию. Локализовать DSL можно путем создания вспомогательной сборки, содержащей локализованную версию ресурсов. Эта версия будет использоваться при установке DSL в среде, соответствующей локализованным ресурсам. Дополнительные сведения см. в разделе [развертывание решений доменный язык](../modeling/deploying-domain-specific-language-solutions.md).  
  
 `DomainRelationships.cs`  
  
 Каждая связь между двумя элементами в модели представлена экземпляром класса доменной связи. Все классы отношений являются производными от класса <xref:Microsoft.VisualStudio.Modeling.ElementLink>, который, в свою очередь, является производным от класса <xref:Microsoft.VisualStudio.Modeling.ModelElement>. Так как речь идет о классе ModelElement, экземпляр отношения может иметь свойства и быть источником или целевым объектом отношения.  
  
 `HelpKeywordHelper.cs`  
  
 Предоставляет функции, которые используются при нажатии клавиши F1.  
  
 `MultiplicityValidation.cs`  
  
 В ролях отношений, где указана кратность 1..1 или 1..*, пользователя следует предупреждать о том, что требуется как минимум один экземпляр отношения. В этом файле содержатся проверочные ограничения, которые реализуют эти предупреждения. Ссылка типа 1..1 к родительскому объекту внедрения не проверяется.  
  
 Для этих ограничений для выполнения, необходимо задать один из **использует...**  параметры в **Editor\Validation** узел в обозревателе DSL. Дополнительные сведения см. в разделе [проверка доменного языка](../modeling/validation-in-a-domain-specific-language.md).  
  
 `PropertiesGrid.cs`  
  
 В этом файле код содержится только в том случае, если к свойству домена был присоединен дескриптор пользовательского типа. Дополнительные сведения см. в разделе [Настройка окна свойств](../modeling/customizing-the-properties-window.md).  
  
 `SerializationHelper.cs`  
  
-   Метод проверки, которые предотвращает ссылку одного моникера на два элемента. Дополнительные сведения см. в разделе [Настройка хранения файлов и XML-сериализация](../modeling/customizing-file-storage-and-xml-serialization.md).  
  
-   Класс SerializationHelper предоставляет функции, широко используемые классами сериализации.  
  
 `Serializer.cs`  
  
 Класс сериализатора для каждого класса домена, отношения, фигуры, соединителя, схемы и модели.  
  
 Многие возможности этих классов можно управлять с помощью параметров в обозревателе DSL в **поведением при сериализации Xml**.  
  
 `Shapes.cs`  
  
 Класс для каждого класса фигуры в определении DSL. Формы являются производными от класса <xref:Microsoft.VisualStudio.Modeling.Diagrams.NodeShape>. Дополнительные сведения см. в разделе [Настройка хранения файлов и XML-сериализация](../modeling/customizing-file-storage-and-xml-serialization.md).  
  
 Чтобы переопределить созданные методы своими собственными методами в разделяемом классе, установите **приводит к возникновению ошибки производного типа Double** для соединителя в определении DSL. Чтобы заменить конструктор собственный код, задайте **имеет пользовательский конструктор**.  
  
 Чтобы сделать цвет и некоторые другие переменной стиль функции во время выполнения, щелкните правой кнопкой мыши класс на схема определения DSL и пункты **добавьте предоставляется**.  
  
 Чтобы разрешить изменение дополнительных стилевых особенностей во время выполнения, см. примеры в разделах <xref:Microsoft.VisualStudio.Modeling.Diagrams.TextField> и <xref:Microsoft.VisualStudio.Modeling.Diagrams.ShapeElement>.  
  
 `ToolboxHelper.cs`  
  
 Устанавливает панель элементов путем установки прототипов группы элементов в средства элементов. Когда пользователь запускает это средство, копии этих прототипов объединяются с целевыми элементами.  
  
 Вы можете переопределить `CreateElementPrototype()` и изменить элемент панели элементов, который создает группу из нескольких объектов. Например, можно определить элемент для представления объектов, имеющих субкомпоненты. После изменения кода сбросьте экспериментальный экземпляр [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)], чтобы очистить кэш панели элементов.  
  
## <a name="generated-files-in-the-dslpackage-project"></a>Файлы, создаваемые в проекте DslPackage  
 Проект DslPackage связывает модель DSL с оболочкой [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)], управляющей командами окна, панели элементов и меню. Большинство классов являются двойными производными, а значит, любой из их методов можно переопределить.  
  
 `CommandSet.cs`  
  
 Команды контекстного меню, отображаемые на схеме. Этот набор можно адаптировать или добавить в него дополнительные элементы. В этом файле содержится код для команд. Расположение команд в меню определяется в файле Commands.vsct. Дополнительные сведения см. в разделе [написание пользовательских команд и действий](../modeling/writing-user-commands-and-actions.md).  
  
 `Constants.cs`  
  
 Идентификаторы GUID.  
  
 `DocData.cs`  
  
 *YourDsl* `DocData` управляет загрузки и сохранения модели в файл и создает экземпляр хранилища.  
  
 Например, если DSL необходимо сохранить не в файл, а в базу данных, можно переопределить методы `Load` и `Save`.  
  
 `DocView.cs`  
  
 *YourDsl* `DocView` управляет окно, в котором отображается поле. Например, схему можно встроить в форму окна:  
  
 Добавьте файл пользовательского элемента управления в проект DslPackage. Добавьте панель, в которой может отображаться схема. Добавьте кнопки и другие элементы управления. В представлении кода формы добавьте следующий код, изменив имена в соответствии со своим DSL:  
  
```  
using System;  
using System.Collections.Generic;  
using System.ComponentModel;  
using System.Drawing;  
using System.Data;  
using System.Linq;  
using System.Text;  
using System.Windows.Forms;  
using Microsoft.VisualStudio.Modeling;  
using Microsoft.VisualStudio.Modeling.Shell;  
  
namespace Company.EmbedInForm  
{  
  public partial class UserControl1 : UserControl  
  {  
    public UserControl1()  
    {  
      InitializeComponent();  
    }  
  
    private DiagramDocView docView;  
  
    public UserControl1(DiagramDocView docView, Control content)  
      : this()  
    {  
      this.docView = docView;  
      panel1.Controls.Add(content);  
    }  
  
    private void button1_Click(object sender, EventArgs e)  
    {  
      ExampleModel modelRoot = this.docView.CurrentDiagram.ModelElement as ExampleModel;  
      foreach (ExampleElement element in modelRoot.Elements)  
      {  
       listBox1.Items.Add(element.Name);  
      }  
    }  
  }  
  internal partial class EmbedInFormDocView  
  {  
  
    private ContainerControl container;  
  
    /// <summary>  
    /// Return a User Control instead of the DSL window.   
    /// The user control will contain the DSL window.  
    /// </summary>  
  
    public override System.Windows.Forms.IWin32Window Window  
    {  
      get  
      {  
        if (container == null)  
        {  
          // Put the normal DSL Window inside our control  
          container = new UserControl1(this, (Control)base.Window);  
        }  
        return container;  
      }  
    }  
  }  
  
}  
  
```  
  
 `EditorFactory.cs`  
  
 Создает экземпляр `DocData` и `DocView`. Он выполняет стандартный интерфейс, который [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] использует для открытия редактора при запуске пакета DSL. На него ссылается атрибут `ProvideEditorFactory` в файле Package.cs  
  
 `GeneratedVSCT.vsct`  
  
 Находит стандартных команд меню, например, в контекстном меню диаграммы **изменить** меню и т. д. Код для команд находится в файле CommandSet.cs. Стандартные команды можно переместить или изменить. Также можно добавить собственные команды. Дополнительные сведения см. в разделе [написание пользовательских команд и действий](../modeling/writing-user-commands-and-actions.md).  
  
 `ModelExplorer.cs`  
  
 Определяет проводник по модели для DSL. Представляет собой дерево модели, которое пользователь видит рядом со схемой.  
  
 Вы можете переопределить `InsertTreeView()` и изменить порядок отображения элементов в проводнике по модели.  
  
 Если необходимо, чтобы выбор в проводнике по модели был синхронизирован с выбором схемы, можно использовать следующий код:  
  
```  
protected override void OnSelectionChanged(global::System.EventArgs e)  
{  
base.OnSelectionChanged(e);  
// get the selected element  
DslModeling::ModelElement selectedElement =   
this.PrimarySelection as DslModeling::ModelElement;  
// Select in the model explorer  
SelectInModelExplorer<YOURLANGUAGEExplorerToolWindow>(selectedElement);  
}  
private void SelectInModelExplorer<T>(DslModeling::ModelElement modelElement)  
where T : DslShell.ModelExplorerToolWindow  
{  
DslShell::ModelingPackage package =   
this.GetService(typeof(VSShell.Package)) as DslShell::ModelingPackage;  
  
if (package != null)  
{  
// find the model explorer window  
T explorerWindow = package.GetToolWindow(typeof(T), true) as T;  
if (explorerWindow != null)  
{  
// get the tree container  
DslShell.ModelExplorerTreeContainer treeContainer =   
explorerWindow.TreeContainer;  
// find the tree node  
DslShell.ExplorerTreeNode treeNode =   
treeContainer.FindNodeForElement(modelElement);  
// select the node  
explorerWindow.TreeContainer.ObjectModelBrowser.SelectedNode = treeNode;  
}  
}  
}  
  
```  
  
 `ModelExplorerToolWindow.cs`  
  
 Определяет окно, в котором отображается проводник по модели. Обрабатывает выбор элементов в проводнике.  
  
 `Package.cs`  
  
 В этом файле определяется порядок интеграции DSL в [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)]. Атрибуты в классе пакета регистрируют DSL в качестве обработчика файлов, которые имеют свое расширение файла и определяют ее панель элементов и порядок открытия нового окна. Метод Initialize() вызывается один раз при загрузке первого DSL в экземпляр [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)].  
  
 `Source.extension.vsixmanifest`  
  
 Чтобы настроить этот файл, измените файл `.tt`.  
  
> [!WARNING]
>  Если целью изменения файла .TT является включение ресурсов, таких как значки или изображения, необходимо, чтобы эти ресурсы входили в сборку VSIX. В обозревателе решений выберите файл и убедитесь, что **включить в VSIX** свойство `True`.  
  
 Этот файл управляет порядком упаковки DSL в Visual Studio Integration Extension (VSIX). Дополнительные сведения см. в разделе [развертывание решений доменный язык](../modeling/deploying-domain-specific-language-solutions.md).  
  
## <a name="see-also"></a>См. также  
 [Способ определения доменного языка](../modeling/how-to-define-a-domain-specific-language.md)   
 [Общие сведения о моделях, классы и отношения](../modeling/understanding-models-classes-and-relationships.md)   
 [Настройка и расширение доменного языка](../modeling/customizing-and-extending-a-domain-specific-language.md)   
 [Написание кода для настройки доменного языка](../modeling/writing-code-to-customise-a-domain-specific-language.md)
