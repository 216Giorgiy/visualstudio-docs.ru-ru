---
title: "Создание форм Windows доменного языка | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 452318ff-8ecf-46d0-8ca0-4013d0cdafaf
caps.latest.revision: "17"
author: alancameronwills
ms.author: awills
manager: douge
ms.workload: multiple
ms.openlocfilehash: b17355eae0ca7462fa08173b3a6986c033924080
ms.sourcegitcommit: 32f1a690fc445f9586d53698fc82c7debd784eeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2017
---
# <a name="creating-a-windows-forms-based-domain-specific-language"></a>Создание доменного языка на основе Windows Forms
Windows Forms можно использовать для отображения состояния модели доменного языка (DSL), вместо использования схема DSL. В этом разделе описывается привязка к DSL формы Windows Forms, с помощью [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] визуализации и моделирования SDK.  
  
 ![DSL &#45; WPF &#45; 2](../modeling/media/dsl-wpf-2.png "DSL-Wpf-2")  
DSL экземпляра, показывая формы пользовательского интерфейса Windows и обозреватель модели.  
  
## <a name="creating-a-windows-forms-dsl"></a>Создание Windows Forms DSL  
 **Минимальной WinForm конструктор** DSL шаблон создает минимальный доменный язык DSL, можно изменить в соответствии с собственными требованиями.  
  
#### <a name="to-create-a-minimal-winforms-dsl"></a>Чтобы создать минимальный DSL WinForms  
  
1.  Создать доменный язык DSL из **минимальной WinForm конструктор** шаблона.  
  
     В этом пошаговом руководстве предполагается следующие имена:  
  
    |||  
    |-|-|  
    |Имя решения и DSL|FarmApp|  
    |Пространство имен|Company.FarmApp|  
  
2.  Поэкспериментируйте с исходный пример, который предоставляет шаблон:  
  
    1.  Преобразовать все шаблоны.  
  
    2.  Построение и запуск образца (**CTRL + F5**).  
  
    3.  В экспериментальном экземпляре Visual Studio, откройте `Sample` файл отладки проекта.  
  
         Обратите внимание, что он отображается в элементе управления Windows Forms.  
  
         Также вы увидите элементы модели, отображаемое в обозревателе.  
  
         Добавить некоторые элементы в форму или обозревателя и обратите внимание на то, они отображаются в других отображения.  
  
 В основном экземпляре [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)], обратите внимание на следующие аспекты DSL решения:  
  
-   `DslDefinition.dsl`не содержит схему элементов. Это происходит потому DSL схемы не будет использовать для просмотра моделей экземпляр из этого DSL. Вместо этого выполняется привязка к модели формы Windows Forms и элементов в форме отображаются модели.  
  
-   В дополнение к `Dsl` и `DslPackage` проекты, решение содержит третий проект с именем `UI.` **пользовательского интерфейса** проект содержит определение элемента управления Windows Forms. `DslPackage`зависит от `UI`, и `UI` зависит от `Dsl`.  
  
-   В `DslPackage` проекта, `UI\DocView.cs` содержит код, который отображает элемент управления Windows Forms, которая определена в `UI` проекта.  
  
-   `UI` Проект содержит рабочий образец элемента управления формы, привязанный к DSL. Однако он не будет работать при изменении определения DSL. `UI` Проект содержит:  
  
    -   Класс Windows Forms с именем `ModelViewControl`.  
  
    -   Файл с именем `DataBinding.cs` , содержащий дополнительные частичное определение `ModelViewControl`. Чтобы просмотреть его содержимое в **обозревателе решений**, откройте контекстное меню для файла и выберите **Просмотр кода**.  
  
### <a name="about-the-ui-project"></a>О проекте пользовательского интерфейса  
 При обновлении файла определения DSL для определения собственных DSL, необходимо обновить элемент управления в `UI` проект, чтобы отобразить доменного языка. В отличие от `Dsl` и `DslPackage` проекты, образец `UI` проекта не создан из `DslDefinitionl.dsl`. Можно добавить файлы для создания кода, если требуется, несмотря на то, что не рассматривается в этом пошаговом руководстве.  
  
## <a name="updating-the-dsl-definition"></a>Обновление определения DSL  
 Следующие определения DSL используется в этом пошаговом руководстве.  
  
 ![DSL &#45; WPF &#45; 1](../modeling/media/dsl-wpf-1.png "DSL-Wpf-1")  
  
#### <a name="to-update-the-dsl-definition"></a>Для обновления определения DSL  
  
1.  Откройте DslDefinition.dsl в конструктор DSL.  
  
2.  Удалить **ExampleElement**  
  
3.  Переименуйте **ExampleModel** класса домена `Farm`.  
  
     Присвойте ему свойства дополнительного домена с именем `Size` типа **Int32**, и `IsOrganic` типа **логическое**.  
  
    > [!NOTE]
    >  При удалении домена в корневом классе и затем создать новый корневой элемент, необходимо установить свойство корневого класса редактора. В **обозреватель DSL**выберите **редактор**. В окне «Свойства» установите **корневой класс** для `Farm`.  
  
4.  Используйте **класс с именем домена** средство для создания домена следующие классы:  
  
    -   `Field`— Присвоить это свойство дополнительного домена с именем `Size`.  
  
    -   `Animal`-В окне «Свойства» присвойте **модификатор наследования** для **абстрактный**.  
  
5.  Используйте **класса домена** средство для создания следующих классов:  
  
    -   `Sheep`  
  
    -   `Goat`  
  
6.  Используйте **наследования** инструмент для упрощения `Goat` и `Sheep` наследовать от `Animal`.  
  
7.  Используйте **Embedding** средство для внедрения `Field` и `Animal` под `Farm`.  
  
8.  Может потребоваться очистка на диаграмме. Чтобы уменьшить число повторяющихся элементов, используйте **перевести здесь поддерево** контекстном меню конечных элементов.  
  
9. **Преобразовать все шаблоны** на панели инструментов обозревателя решений.  
  
10. Построение **Dsl** проекта.  
  
    > [!NOTE]
    >  На этом этапе других проектов не будет построен без ошибок. Тем не менее мы хотим построить проект Dsl, чтобы его сборка была доступна в мастере источников данных.  
  
## <a name="updating-the-ui-project"></a>Обновление проекта пользовательского интерфейса  
 Теперь можно создать новый пользовательский элемент управления, который будет отображать данные, хранящиеся в модели DSL. Через привязки данных — самый простой способ подключения к модели пользовательского элемента управления. Привязка с именем типа адаптера данных **ModelingBindingSource** разработан специально для подключения к интерфейсам не VMSDK доменного языка.  
  
#### <a name="to-define-your-dsl-model-as-a-data-source"></a>Для определения модели DSL в качестве источника данных  
  
1.  На **данные** меню, выберите **Показать источники данных**.  
  
     **Источники данных** открывается окно.  
  
     Выберите **добавить новый источник данных**. **Мастер настройки источника данных** открывается.  
  
2.  Выберите **объекта**, **Далее**.  
  
     Разверните **Dsl**, **Company.FarmApp**и выберите **фермы**, который является корневой класс модели. Выберите **Готово**.  
  
     В обозревателе решений щелкните **пользовательского интерфейса** проекта теперь содержит **Properties\DataSources\Farm.datasource**  
  
     Свойства и отношения класса модели отображаются в окне Источники данных.  
  
     ![DslWpf &#45; 3](../modeling/media/dslwpf-3.png "DslWpf-3")  
  
#### <a name="to-connect-your-model-to-a-form"></a>Для подключения к модели в форму  
  
1.  В **пользовательского интерфейса** проекта, удалите все существующие файлы .cs.  
  
2.  Добавьте новый **пользовательский элемент управления** файл с именем `FarmControl` для **пользовательского интерфейса** проекта.  
  
3.  В **источники данных** в раскрывающемся меню окна **фермы**, выберите **сведения**.  
  
     Оставьте настройки по умолчанию для других свойств.  
  
4.  Откройте FarmControl.cs в режиме конструктора.  
  
     Перетащите **фермы** из окна источников данных на FarmControl.  
  
     Набор элементов управления появится, один для каждого свойства. Свойства связи не создают элементы управления.  
  
5.  Удалить **farmBindingNavigator**. Этот элемент также автоматически создается в `FarmControl` конструктор, но он не является полезным для этого приложения.  
  
6.  С помощью панели элементов, создайте два экземпляра **DataGridView**и назовите их `AnimalGridView` и `FieldGridView`.  
  
    > [!NOTE]
    >  Альтернативные всего перетаскивать элементы животных и полей из окна источников данных на элементе управления. Это действие автоматически создает таблицы данных и привязки между представления сетки и источником данных. Тем не менее эта привязка не работает правильно для доменного языка. Поэтому лучше создавать таблицы данных и привязки вручную.  
  
7.  Если панель элементов содержит **ModelingBindingSource** инструмент, добавьте его. В контекстном меню **данные** выберите **Выбор элементов**. В **Выбор элементов панели элементов** диалогового окна выберите **ModelingBindingSource** из **вкладку .NET Framework**.  
  
8.  С помощью панели элементов, создайте два экземпляра **ModelingBindingSource**и назовите их `AnimalBinding` и `FieldBinding`.  
  
9. Задать **DataSource** каждого экземпляра **ModelingBindingSource** для **farmBindingSource**.  
  
     Задать **DataMember** свойства **животных** или **поля**.  
  
10. Задать **DataSource** свойства `AnimalGridView` для `AnimalBinding`и `FieldGridView` для `FieldBinding`.  
  
11. Измените макет элемента управления фермы для вашего стиля.  
  
 **ModelingBindingSource** является адаптер, который выполняет несколько функций, которые относятся к доменного языка:  
  
-   Поиск обновлений в хранилище VMSDK транзакции.  
  
     Например когда пользователь удаляет строку из представления сетки данных, регулярное привязки приведет к исключение транзакции.  
  
-   Это гарантирует, что, когда пользователь выбирает строку, окна «Свойства» отображает свойства соответствующий элемент модели, а не строку сетки данных.  
  
 ![DslWpf4](../modeling/media/dslwpf4.png "DslWpf4")  
Схема связи между источниками данных и представления.  
  
#### <a name="to-complete-the-bindings-to-the-dsl"></a>Для выполнения привязки к DSL  
  
1.  Добавьте следующий код в отдельном файле кода в **пользовательского интерфейса** проекта:  
  
    ```csharp  
    using System.ComponentModel;  
    using Microsoft.VisualStudio.Modeling;  
    using Microsoft.VisualStudio.Modeling.Design;  
  
    namespace Company.FarmApp  
    {  
      partial class FarmControl  
      {  
        public IContainer Components { get { return components; } }  
  
        /// <summary>Binds the WinForms data source to the DSL model.  
        /// </summary>  
        /// <param name="nodelRoot">The root element of the model.</param>  
        public void DataBind(ModelElement modelRoot)  
        {  
          WinFormsDataBindingHelper.PreInitializeDataSources(this);  
          this.farmBindingSource.DataSource = modelRoot;  
          WinFormsDataBindingHelper.InitializeDataSources(this);  
        }  
      }  
    }  
    ```  
  
2.  В **DslPackage** проекта, изменить **DslPackage\DocView.tt** для обновления переменной следующее определение:  
  
    ```csharp  
    string viewControlTypeName = "FarmControl";  
    ```  
  
## <a name="testing-the-dsl"></a>Тестирование DSL  
 Решение DSL теперь можно создать и запустить, несмотря на то, что может потребоваться добавить дополнительные усовершенствования позже.  
  
#### <a name="to-test-the-dsl"></a>Чтобы проверить DSL  
  
1.  Постройте и запустите это решение.  
  
2.  В экспериментальном экземпляре Visual Studio, откройте **пример** файла.  
  
3.  В **FarmApp Explorer**, откройте контекстное меню на **фермы** корневой узел и выберите **добавьте новый Goat**.  
  
     `Goat1`отображается в **животных** представления.  
  
    > [!WARNING]
    >  Необходимо использовать контекстное меню на **фермы** узел, не **животных** узла.  
  
4.  Выберите **фермы** корневой узел и просмотрите его свойства.  
  
     В представлении формы, измените **имя** или **размер** фермы.  
  
     При переходе от каждого поля в форме, соответствующей изменения свойств в окне «Свойства».  
  
## <a name="enhancing-the-dsl"></a>Улучшение DSL  
  
#### <a name="to-make-the-properties-update-immediately"></a>Чтобы немедленно обновить свойства  
  
1.  В представлении конструирования FarmControl.cs выберите простой поля, такие как имя, размер или IsOrganic.  
  
2.  В окне «Свойства» разверните **DataBindings** и откройте **(Дополнительно)**.  
  
     В **форматирование и дополнительная привязка** диалогового окна в разделе **режим обновления источника данных**, выберите **OnPropertyChanged**.  
  
3.  Постройте и запустите это решение.  
  
     Убедитесь, что при изменении содержимого поля с соответствующим свойством фермы модели изменения немедленно.  
  
#### <a name="to-provide-add-buttons"></a>Можно создать добавить кнопки  
  
1.  В представлении конструирования FarmControl.cs воспользуйтесь панелью инструментов для создания кнопки на форме.  
  
     Изменить имя и текст кнопки, например для `New Sheep`.  
  
2.  Откройте кода программной части кнопки (например, дважды щелкнув его).  
  
     Внесите следующие изменения:  
  
    ```csharp  
    private void NewSheepButton_Click(object sender, EventArgs e)  
    {  
      using (Transaction t = farm.Store.TransactionManager.BeginTransaction("Add sheep"))  
      {  
        elementOperations.MergeElementGroup(farm,  
          new ElementGroup(new Sheep(farm.Partition)));  
        t.Commit();  
      }  
    }  
  
    // The following code is shared with other add buttons:  
    private ElementOperations operationsCache = null;  
    private ElementOperations elementOperations  
    {  
      get  
      {  
        if (operationsCache == null)  
        {  
          operationsCache = new ElementOperations(farm.Store, farm.Partition);  
        }  
        return operationsCache;  
      }  
    }  
    private Farm farm  
    {  
      get { return this.farmBindingSource.DataSource as Farm; }  
    }  
  
    ```  
  
     Также необходимо вставить следующую директиву:  
  
    ```csharp  
  
    using Microsoft.VisualStudio.Modeling;  
  
    ```  
  
3.  Добавьте сходные кнопки, полей и Goats.  
  
4.  Постройте и запустите это решение.  
  
5.  Убедитесь, что «создать» добавляется элемент. Новый элемент появится в обозревателе FarmApp и в представлении сетки соответствующие данные.  
  
     Вы сможете изменить имя элемента в представлении сетки данных. Можно также удалить из него.  
  
 ![DSL &#45; WPF &#45; 2](../modeling/media/dsl-wpf-2.png "DSL-Wpf-2")  
  
### <a name="about-the-code-to-add-an-element"></a>Код для добавления элемента  
 Для кнопки нового элемента немного проще следующий альтернативный образец программного кода.  
  
```csharp  
private void NewSheepButton_Click(object sender, EventArgs e)  
{  
  using (Transaction t = farm.Store.TransactionManager.BeginTransaction("Add sheep"))  
  {  
    farm.Animals.Add(new Sheep(farm.Partition)); ;  
    t.Commit();  
  }  
}  
  
```  
  
 Тем не менее этот код не задано имя по умолчанию для нового элемента. Он не работает все настроенные слияния, которые определены в **директивы слияния элементов** из DSL, и он не работает любой слияния пользовательский код, который был определен.  
  
 Корпорация Майкрософт рекомендует использовать <xref:Microsoft.VisualStudio.Modeling.ElementOperations> для создания новых элементов. Дополнительные сведения см. в разделе [Настройка создания и перемещения элементов](../modeling/customizing-element-creation-and-movement.md).  
  
## <a name="see-also"></a>См. также  
 [Способ определения доменного языка](../modeling/how-to-define-a-domain-specific-language.md)   
 [Написание кода для настройки доменного языка](../modeling/writing-code-to-customise-a-domain-specific-language.md)   
 [SDK моделирования для Visual Studio — доменные языки](../modeling/modeling-sdk-for-visual-studio-domain-specific-languages.md)