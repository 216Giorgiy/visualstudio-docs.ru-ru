---
title: "Создание доменного языка Windows на основе форм | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 452318ff-8ecf-46d0-8ca0-4013d0cdafaf
caps.latest.revision: 17
author: alancameronwills
ms.author: awills
manager: douge
translationtype: Machine Translation
ms.sourcegitcommit: 5db97d19b1b823388a465bba15d057b30ff0b3ce
ms.openlocfilehash: c9caf1da3e6e9d065a94e6b12b7699cd5a381ea2
ms.lasthandoff: 02/22/2017

---
# <a name="creating-a-windows-forms-based-domain-specific-language"></a>Создание доменного языка на основе Windows Forms
Windows Forms можно использовать для отображения состояния модели доменного языка (DSL), вместо использования на схеме DSL. В этом разделе рассматриваются привязки формы Windows Forms для DSL, используя [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] визуализации и моделирования SDK.  
  
 ![DSL-Wpf-2](../modeling/media/dsl-wpf-2.png "DSL-Wpf-2")  
Экземпляр DSL, показывая пользовательский Интерфейс формы Windows и обозреватель моделей.  
  
## <a name="creating-a-windows-forms-dsl"></a>Создание Windows Forms DSL  
 **Минимальный конструктор WinForm** DSL шаблон создает минимальный DSL, который можно изменить в соответствии с вашими требованиями.  
  
#### <a name="to-create-a-minimal-winforms-dsl"></a>Чтобы создать минимальный WinForms DSL  
  
1.  Создайте DSL из **минимальный конструктор WinForm** шаблона.  
  
     В этом пошаговом руководстве считаются следующие имена:  
  
    |||  
    |-|-|  
    |Имя решения и DSL|FarmApp|  
    |Пространство имен|Company.FarmApp|  
  
2.  Поэкспериментируйте с исходный пример, который предоставляет шаблон:  
  
    1.  Преобразовать все шаблоны.  
  
    2.  Построение и запуск образца (**CTRL + F5**).  
  
    3.  В экспериментальном экземпляре Visual Studio, откройте `Sample` файл отладки проекта.  
  
         Обратите внимание, что он отображается в элементе управления Windows Forms.  
  
         Также можно видеть элементы модели, отображаемое в обозревателе.  
  
         Добавить некоторые элементы в форме или обозревателя и обратите внимание на то, что они отображаются в других отображения.  
  
 В основном экземпляре [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)], обратите внимание на следующие аспекты решения DSL:  
  
-   `DslDefinition.dsl`не содержит схему элементов. Это вызвано DSL схемы не будет использовать для просмотра моделей экземпляр этого DSL. Вместо этого выполняется привязка к модели в Windows Forms и элементы в форме отображаются модели.  
  
-   В дополнение к `Dsl` и `DslPackage` проекты, решения содержит третий проект с именем `UI.` **пользовательского интерфейса** проект содержит определение элемента управления Windows Forms. `DslPackage`зависит от `UI`, и `UI` зависит от `Dsl`.  
  
-   В `DslPackage` проекта, `UI\DocView.cs` содержит код, который отображает элемент управления Windows Forms, которая определена в `UI` проекта.  
  
-   `UI` Проект содержит рабочий пример элемента управления формы привязаны к линии DSL. Тем не менее он не будет работать при изменении определения DSL. `UI` Проект содержит:  
  
    -   Класс Windows Forms с именем `ModelViewControl`.  
  
    -   Файл с именем `DataBinding.cs` , содержащий дополнительные частичное определение класса `ModelViewControl`. Чтобы просмотреть его содержимое в **обозревателе решений**, откройте контекстное меню для файла и выберите **Просмотр кода**.  
  
### <a name="about-the-ui-project"></a>О проекте пользовательского интерфейса  
 При обновлении файла определения DSL для определения собственных DSL, необходимо обновить элемент управления в `UI` проект, чтобы отобразить DSL. В отличие от `Dsl` и `DslPackage` проектов образца `UI` проект не был создан из `DslDefinitionl.dsl`. Можно добавить файлы для создания кода, если необходимо, несмотря на то, что не рассматривается в этом пошаговом руководстве.  
  
## <a name="updating-the-dsl-definition"></a>Обновление определения DSL  
 Следующие определения DSL используется в этом пошаговом руководстве.  
  
 ![DSL-Wpf-1](../modeling/media/dsl-wpf-1.png "DSL-Wpf-1")  
  
#### <a name="to-update-the-dsl-definition"></a>Для обновления определения доменного языка  
  
1.  Откройте DslDefinition.dsl в конструкторе DSL.  
  
2.  Удалить **ExampleElement**  
  
3.  Переименуйте **ExampleModel** класс домена для `Farm`.  
  
     Присвойте ему свойства дополнительного домена с именем `Size` типа **Int32**, и `IsOrganic` типа **логическое**.  
  
    > [!NOTE]
    >  Если удалить корневой класс домена, а затем создать новый корневой каталог, необходимо сбросить свойство редактор корневой класс. В **обозреватель DSL**выберите **редактор**. В окне «Свойства» задайте **корневой класс** в `Farm`.  
  
4.  Используйте **именованный класс домена** инструмент для создания следующих классов доменов:  
  
    -   `Field`— Предоставить это свойство домена с именем `Size`.  
  
    -   `Animal`— В окне «Свойства» задайте **модификатор наследования** для **абстрактный**.  
  
5.  Используйте **класс домена** инструмент для создания следующих классов:  
  
    -   `Sheep`  
  
    -   `Goat`  
  
6.  Используйте **наследования** средство `Goat` и `Sheep` наследовать `Animal`.  
  
7.  Используйте **Embedding** средство для внедрения `Field` и `Animal` в `Farm`.  
  
8.  Может потребоваться очистка на схеме. Чтобы уменьшить количество повторяющихся элементов, используйте **перенести сюда поддерево** команду контекстного меню конечных элементов.  
  
9. **Преобразовать все шаблоны** на панели инструментов обозревателя решений.  
  
10. Построение **Dsl** проекта.  
  
    > [!NOTE]
    >  На этом этапе другие проекты будут компилироваться без ошибок. Тем не менее мы хотим построить проект Dsl, чтобы его сборка была доступна в мастере источников данных.  
  
## <a name="updating-the-ui-project"></a>Обновление проекта пользовательского интерфейса  
 Теперь можно создать новый пользовательский элемент управления, который будет отображать данные, хранящиеся в модели DSL. — Самый простой способ подключения к модели пользовательского элемента управления привязки данных. Привязка с именем типа адаптера данных **ModelingBindingSource** разработан специально для подключения к интерфейсы не VMSDK DSL.  
  
#### <a name="to-define-your-dsl-model-as-a-data-source"></a>Для определения модели DSL в качестве источника данных  
  
1.  На **данные** меню, выберите **Показать источники данных**.  
  
     **Источников данных** откроется окно.  
  
     Выберите **добавить новый источник данных**. **Data Source Configuration Wizard** открывает.  
  
2.  Выберите **объект**, **Далее**.  
  
     Разверните **Dsl**, **Company.FarmApp**и выберите **фермы**, который является корневой класс модели. Выберите **Готово**.  
  
     В обозревателе решений **пользовательского интерфейса** проекта теперь содержит **Properties\DataSources\Farm.datasource**  
  
     Свойства и связи класс модели отображаются в окне «Источники данных».  
  
     ![DslWpf&3;](../modeling/media/dslwpf-3.png "DslWpf-3")  
  
#### <a name="to-connect-your-model-to-a-form"></a>Для подключения к модели в форму  
  
1.  В **пользовательского интерфейса** проектов, удалите все существующие файлы .cs.  
  
2.  Добавить новую **пользовательский элемент управления** файл с именем `FarmControl` для **пользовательский Интерфейс** проекта.  
  
3.  В **источников данных** окна в раскрывающемся меню **фермы**, выберите **сведения о**.  
  
     Оставьте настройки по умолчанию для других свойств.  
  
4.  Откройте FarmControl.cs в режиме конструктора.  
  
     Перетащите **фермы** из окна источников данных на FarmControl.  
  
     Набор элементов управления отображается, одной для каждого свойства. Свойства связи не создают элементы управления.  
  
5.  Удалить **farmBindingNavigator**. Это также создается автоматически в `FarmControl` конструктор, но он не является полезным для этого приложения.  
  
6.  С помощью панели элементов, создайте два экземпляра **DataGridView**и назовите их `AnimalGridView` и `FieldGridView`.  
  
    > [!NOTE]
    >  Альтернативные делом необходимо перетащить элементы животных и поля из окна источников данных на элемент управления. Это действие автоматически создает таблицы данных и привязки между представлением сетки и источника данных. Тем не менее эта привязка не работает правильно для DSL. Поэтому лучше создать таблицы данных и привязки вручную.  
  
7.  Если панель элементов не содержит **ModelingBindingSource** инструмент, добавьте его. В контекстном меню **данные** выберите **выбрать элементы**. В **Выбор элементов панели элементов** диалогового окна выберите **ModelingBindingSource** из **вкладку .NET Framework**.  
  
8.  С помощью панели элементов, создайте два экземпляра **ModelingBindingSource**и назовите их `AnimalBinding` и `FieldBinding`.  
  
9. Задайте **источник данных** каждого экземпляра **ModelingBindingSource** для **farmBindingSource**.  
  
     Задайте **DataMember** свойства **животных** или **поля**.  
  
10. Задайте **источник данных** свойства `AnimalGridView` для `AnimalBinding`и `FieldGridView` в `FieldBinding`.  
  
11. Измените макет элемента управления на свой вкус фермы.  
  
 **ModelingBindingSource** — это адаптер, выполняет несколько функций, которые относятся к DSL:  
  
-   Поиск обновлений в хранилище VMSDK транзакции.  
  
     Например когда пользователь удаляет строку из представления сетки данных, регулярных привязки приведет к исключение транзакции.  
  
-   Это гарантирует, что, когда пользователь выбирает строку, окна «Свойства» отображает свойства соответствующий элемент модели, а не строку сетки данных.  
  
 ![DslWpf4](../modeling/media/dslwpf4.png "DslWpf4")  
Схема связей между источники данных и представления.  
  
#### <a name="to-complete-the-bindings-to-the-dsl"></a>Для выполнения привязки к линии DSL  
  
1.  Добавьте следующий код в отдельном файле кода в **пользовательский Интерфейс** проекта:  
  
    ```c#  
    using System.ComponentModel;  
    using Microsoft.VisualStudio.Modeling;  
    using Microsoft.VisualStudio.Modeling.Design;  
  
    namespace Company.FarmApp  
    {  
      partial class FarmControl  
      {  
        public IContainer Components { get { return components; } }  
  
        /// <summary>Binds the WinForms data source to the DSL model.  
        /// </summary>  
        /// <param name="nodelRoot">The root element of the model.</param>  
        public void DataBind(ModelElement modelRoot)  
        {  
          WinFormsDataBindingHelper.PreInitializeDataSources(this);  
          this.farmBindingSource.DataSource = modelRoot;  
          WinFormsDataBindingHelper.InitializeDataSources(this);  
        }  
      }  
    }  
    ```  
  
2.  В **DslPackage** проекта, изменение **DslPackage\DocView.tt** обновление следующие определения переменных:  
  
    ```c#  
    string viewControlTypeName = "FarmControl";  
    ```  
  
## <a name="testing-the-dsl"></a>Тестирование DSL  
 Теперь решение DSL можно создать и запустить, несмотря на то, что может потребоваться добавление дополнительных улучшений позже.  
  
#### <a name="to-test-the-dsl"></a>Чтобы проверить DSL  
  
1.  Постройте и запустите это решение.  
  
2.  В экспериментальном экземпляре Visual Studio, откройте **пример** файла.  
  
3.  В **FarmApp Explorer**, откройте контекстное меню на **фермы** корневой узел и выберите **добавьте новый Goat**.  
  
     `Goat1`отображается в **животных** представления.  
  
    > [!WARNING]
    >  Необходимо использовать контекстное меню на **фермы** узел, не **животных** узла.  
  
4.  Выберите **фермы** корневой узел и просмотрите его свойства.  
  
     В представлении формы измените **имя** или **размер** фермы.  
  
     При переходе от каждого поля в форме, соответствующие изменения свойств в окне свойств.  
  
## <a name="enhancing-the-dsl"></a>Улучшение DSL  
  
#### <a name="to-make-the-properties-update-immediately"></a>Чтобы немедленно обновить свойства  
  
1.  В представлении конструктора FarmControl.cs выберите простой поля, такие как имя, размер или IsOrganic.  
  
2.  В окне «Свойства» разверните узел **DataBindings** и откройте **(Дополнительно)**.  
  
     В **форматирование и дополнительная привязка** диалогового окна в разделе **режим обновления источника данных**, выберите **OnPropertyChanged**.  
  
3.  Постройте и запустите это решение.  
  
     Убедитесь, что при изменении содержимого поля, соответствующего свойства фермы модели изменения немедленно.  
  
#### <a name="to-provide-add-buttons"></a>Для предоставления добавить кнопки  
  
1.  В представлении конструктора FarmControl.cs используйте панели элементов для создания кнопки на форме.  
  
     Изменить имя и текст кнопки, например для `New Sheep`.  
  
2.  Откройте кода программной части кнопки (например, дважды щелкнув его).  
  
     Внесите следующие изменения:  
  
    ```c#  
    private void NewSheepButton_Click(object sender, EventArgs e)  
    {  
      using (Transaction t = farm.Store.TransactionManager.BeginTransaction("Add sheep"))  
      {  
        elementOperations.MergeElementGroup(farm,  
          new ElementGroup(new Sheep(farm.Partition)));  
        t.Commit();  
      }  
    }  
  
    // The following code is shared with other add buttons:  
    private ElementOperations operationsCache = null;  
    private ElementOperations elementOperations  
    {  
      get  
      {  
        if (operationsCache == null)  
        {  
          operationsCache = new ElementOperations(farm.Store, farm.Partition);  
        }  
        return operationsCache;  
      }  
    }  
    private Farm farm  
    {  
      get { return this.farmBindingSource.DataSource as Farm; }  
    }  
  
    ```  
  
     Также необходимо вставить следующую директиву:  
  
    ```c#  
  
    using Microsoft.VisualStudio.Modeling;  
  
    ```  
  
3.  Добавьте сходные кнопки для полей и Goats.  
  
4.  Постройте и запустите это решение.  
  
5.  Убедитесь, что для новой кнопки добавляет элемент. Новый элемент появится в обозревателе FarmApp и в представлении сетки данных.  
  
     Вы сможете изменить имя элемента в представлении сетки данных. Можно также удалить из него.  
  
 ![DSL-Wpf-2](../modeling/media/dsl-wpf-2.png "DSL-Wpf-2")  
  
### <a name="about-the-code-to-add-an-element"></a>О коде, чтобы добавить элемент  
 Для новых кнопок элемент следующий альтернативный код немного проще.  
  
```c#  
private void NewSheepButton_Click(object sender, EventArgs e)  
{  
  using (Transaction t = farm.Store.TransactionManager.BeginTransaction("Add sheep"))  
  {  
    farm.Animals.Add(new Sheep(farm.Partition)); ;  
    t.Commit();  
  }  
}  
  
```  
  
 Тем не менее этот код не задано имя по умолчанию для нового элемента. Он не выполняет все настроенные слияния, которые определены в **директивы слияния элементов** доменного, и ее нельзя запустить любой код настраиваемого объединения, который был определен.  
  
 Корпорация Майкрософт рекомендует использовать <xref:Microsoft.VisualStudio.Modeling.ElementOperations>для создания новых элементов.</xref:Microsoft.VisualStudio.Modeling.ElementOperations> Дополнительные сведения см. в разделе [Настройка создания и перемещения элементов](../modeling/customizing-element-creation-and-movement.md).  
  
## <a name="see-also"></a>См. также  
 [Способ определения доменного языка](../modeling/how-to-define-a-domain-specific-language.md)   
 [Написание кода для настройки доменного языка](../modeling/writing-code-to-customise-a-domain-specific-language.md)   
 [SDK моделирования для Visual Studio — доменные языки](../modeling/modeling-sdk-for-visual-studio-domain-specific-languages.md)
