---
title: "Вычисляемые и пользовательские свойства хранилища | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "Доменный язык, программирование свойств домена"
ms.assetid: 42b785f9-2b0f-4f13-a6b4-246e5e0d477a
caps.latest.revision: 19
author: "alancameronwills"
ms.author: "awills"
manager: "douge"
caps.handback.revision: 19
---
# Вычисляемые и пользовательские свойства хранилища
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

Все свойства домена в доменный язык \(DSL\) могут отображаться на диаграмме и в обозревателе языка и может осуществляться программного кода. Однако свойства отличаются тем, что их значения сохраняются.  
  
## Типы свойств домена  
 В определении DSL можно установить **Вид** свойства домена, как показано в следующей таблице:  
  
|Тип свойства домена|Описание|  
|-------------------------|--------------|  
|**Стандартная** \(по умолчанию\)|Свойства домена, который сохраняется в *хранения* и сериализации для файла.|  
|**Вычисляемый**|Свойство домена только для чтения, не сохраняются в хранилище, но вычисляется из других значений.<br /><br /> Например `Person.Age` может вычисляться на основе `Person.BirthDate`.<br /><br /> Необходимо предоставить код, который выполняет вычисление. Как правило можно вычислить значение от других свойств домена. Вы также можете использовать внешние ресурсы.|  
|**Пользовательское хранилище**|Свойства домена, не записываются напрямую в хранилище, но может быть get и set.<br /><br /> Вы должны предоставить методы, которые получают и задают значение.<br /><br /> Например `Person.FullAddress` может храниться в `Person.StreetAddress`, `Person.City`, и `Person.PostalCode`.<br /><br /> Также можно получить доступ к внешним ресурсам, например для получения и задания значений из базы данных.<br /><br /> Код не следует задавать значения в хранилище при `Store.InUndoRedoOrRollback` имеет значение true. В разделе [транзакций и пользовательские задания](#setters).|  
  
## Предоставив код для хранения вычисляемых или пользовательские свойства  
 Если выбран тип свойства домена вычисляемое или пользовательского хранилища необходимо предоставить методы доступа. При построении решения отчет об ошибке сообщит, что требуется.  
  
#### Чтобы определить вычисляемые и пользовательские свойства хранилища  
  
1.  В файле DslDefinition.dsl, выберите свойство домена на схеме или в **Обозреватель DSL**.  
  
2.  В **Свойства** установите **Вид** на **вычисляемое** или **пользовательского хранилища**.  
  
     Убедитесь в том, что можно также задать его **тип** нужное.  
  
3.  Щелкните **Преобразовать все шаблоны** на панели инструментов **обозревателе решений**.  
  
4.  В меню **Сборка** выберите **Собрать решение**.  
  
     Появляется следующее сообщение об ошибке: «*Вашкласс* содержит определения для Get*YourProperty*.»  
  
5.  Дважды щелкните сообщение об ошибке.  
  
     Откроется Dsl\\GeneratedCode\\DomainClasses.cs или DomainRelationships.cs. Выше вызова метода выделенный комментарий предложит предоставить реализацию для Get*YourProperty*\(\).  
  
    > [!NOTE]
    >  Этот файл создается из DslDefinition.dsl. Если изменить этот файл, изменения будут потеряны при последующем нажатии **Преобразовать все шаблоны**. Вместо этого добавьте необходимый метод в отдельном файле.  
  
6.  Создайте или откройте файл класса в отдельную папку, например CustomCode\\*YourDomainClass*. cs.  
  
     Убедитесь, что пространство имен является таким же, как созданный код.  
  
7.  В файле класса записи частичная реализация класса домена. В классе записи определение отсутствующих `Get` метод, аналогичный следующему примеру:  
  
    ```  
    namespace Company.FamilyTree  
    {  public partial class Person  
       {  int GetAgeValue()  
          { return System.DateTime.Today.Year - this.BirthYear; }  
    }  }  
    ```  
  
8.  Если задать **Вид** для **пользовательского хранилища**, вы также должны предоставить `Set` метод. Например:  
  
    ```  
    void SetAgeValue(int value)  
    { if (!Store.InUndoRedoOrRollback)  
        this.BirthYear =   
            System.DateTime.Today.Year - value; }  
    ```  
  
     Код не следует задавать значения в хранилище при `Store.InUndoRedoOrRollback` имеет значение true. В разделе [транзакций и пользовательские задания](#setters).  
  
9. Постройте и запустите это решение.  
  
10. Проверьте свойство. Убедитесь, что попробуйте **Отменить** и **Повторить**.  
  
##  <a name="setters"></a> Транзакции и пользовательские задания  
 Метода Set свойства пользовательского хранилища не нужно открывать транзакцию, так как метод обычно вызывается внутри активной транзакции.  
  
 Тем не менее метод Set может также вызываться, если пользователь вызывает отмены или повтора или производится откат транзакции. Когда <xref:Microsoft.VisualStudio.Modeling.Store.InUndoRedoOrRollback%2A> имеет значение true, Set\-метод должно вести себя следующим образом:  
  
-   Не следует вносить изменения в хранилище, например для присвоения значений других свойств домена. Менеджер отмены задайте их значения.  
  
-   Тем не менее он должен быть обновлен любым внешним ресурсам, например базы данных или содержимого файла или объекты за пределами хранилища. Это будет убедитесь, что они хранятся в synchronism со значениями в хранилище.  
  
 Например:  
  
```  
void SetAgeValue(int value)  
{   
  // If we are in Undo, no changes to Store objects:  
  if (!this.Store.InUndoRedoOrRollback)  
  {   
    this.BirthYear = System.DateTime.Today.Year - value;   
  }  
  // But always update external objects:  
  System.IO.File.WriteAllText(AgeFile, value);  
}  
```  
  
 Дополнительные сведения о транзакциях см. в разделе [Перемещение по модели и обновление модели в коде программы](../modeling/navigating-and-updating-a-model-in-program-code.md).  
  
## См. также  
 [Перемещение по модели и обновление модели в коде программы](../modeling/navigating-and-updating-a-model-in-program-code.md)   
 [Свойства доменных свойств](../modeling/properties-of-domain-properties.md)   
 [Определение доменного языка](../modeling/how-to-define-a-domain-specific-language.md)