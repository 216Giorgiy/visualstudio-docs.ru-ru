---
title: "Вычисляемые и пользовательские свойства хранилища | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords: Domain-Specific Language, programming domain properties
ms.assetid: 42b785f9-2b0f-4f13-a6b4-246e5e0d477a
caps.latest.revision: "19"
author: alancameronwills
ms.author: awills
manager: douge
ms.openlocfilehash: 0be1527c82264ef388eb01d3a06702c1c4bb4f7d
ms.sourcegitcommit: aadb9588877418b8b55a5612c1d3842d4520ca4c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/27/2017
---
# <a name="calculated-and-custom-storage-properties"></a>Вычисляемые и пользовательские свойства хранилища
Все свойства домена в доменный язык (DSL) могут отображаться для пользователя на диаграмме и в обозревателе ваш язык и может осуществляться программного кода. Однако свойства различаются способами, их значения должны храниться.  
  
## <a name="kinds-of-domain-properties"></a>Типы свойств домена  
 В определении DSL можно задать **тип** свойства домена, перечисленные в следующей таблице:  
  
|Вид Свойства домена|Описание|  
|--------------------------|-----------------|  
|**Стандартная** (по умолчанию)|Свойства домена, который сохраняется в *хранения* и сериализован в файл.|  
|**Вычисляемый**|Свойство домена только для чтения, которое не сохраняется в хранилище, но вычисляется на основе других значений.<br /><br /> Например `Person.Age` может вычисляться из `Person.BirthDate`.<br /><br /> Вы должны предоставить код, который выполняет вычисление. Как правило можно вычислить значение от других свойств домена. Вы также можете использовать внешние ресурсы.|  
|**Пользовательского хранилища**|Свойства домена, не сохраняются непосредственно в хранилище, но может быть get и set.<br /><br /> Вы должны предоставить методы, которые получают и задают значение.<br /><br /> Например `Person.FullAddress` могут храниться в `Person.StreetAddress`, `Person.City`, и `Person.PostalCode`.<br /><br /> Также можно получить доступ к внешним ресурсам, например получать и задавать значения из базы данных.<br /><br /> Код не следует задавать значения в хранилище при `Store.InUndoRedoOrRollback` имеет значение true. В разделе [транзакций и пользовательские задания](#setters).|  
  
## <a name="providing-the-code-for-a-calculated-or-custom-storage-property"></a>Предоставляет код для хранения вычисляемых или пользовательские свойства  
 Если значение вид свойства домена Calculated и пользовательские хранилища вы должны предоставить методы доступа. При построении решения отчет об ошибке будет указано, то, которое требуется.  
  
#### <a name="to-define-a-calculated-or-custom-storage-property"></a>Для определения вычисляемое или свойства пользовательского хранилища  
  
1.  В DslDefinition.dsl, выберите свойство домена в диаграмме или в **обозреватель DSL**.  
  
2.  В **свойства** задайте **вид** на **вычисляемое** или **пользовательского хранилища**.  
  
     Убедитесь, что вы указали также его **тип** вам необходимо.  
  
3.  Нажмите кнопку **преобразовать все шаблоны** на панели инструментов **обозревателе решений**.  
  
4.  В меню **Сборка** выберите **Собрать решение**.  
  
     Появляется следующее сообщение об ошибке: «*YourClass* содержит определения для Get*YourProperty*.»  
  
5.  Дважды щелкните сообщение об ошибке.  
  
     Открывает Dsl\GeneratedCode\DomainClasses.cs или DomainRelationships.cs. Выше вызова метода выделенный комментарий предложит пользователю предоставить реализацию для получения*YourProperty*().  
  
    > [!NOTE]
    >  Этот файл создается на основе DslDefinition.dsl. При редактировании этого файла, изменения будут потеряны при очередном щелчке **преобразовать все шаблоны**. Вместо этого добавьте необходимый метод в отдельном файле.  
  
6.  Создайте или откройте файл класса в отдельную папку, например CustomCode\\*YourDomainClass*. cs.  
  
     Убедитесь, что пространство имен является такой же, как созданный код.  
  
7.  В файле класса записи частичная реализация класса домена. В классе записи определения отсутствующей `Get` метод, аналогичный следующему примеру:  
  
    ```  
    namespace Company.FamilyTree  
    {  public partial class Person  
       {  int GetAgeValue()  
          { return System.DateTime.Today.Year - this.BirthYear; }  
    }  }  
    ```  
  
8.  Если задать **вид** для **пользовательского хранилища**, вы также должны предоставить `Set` метод. Пример:  
  
    ```  
    void SetAgeValue(int value)  
    { if (!Store.InUndoRedoOrRollback)  
        this.BirthYear =   
            System.DateTime.Today.Year - value; }  
    ```  
  
     Код не следует задавать значения в хранилище при `Store.InUndoRedoOrRollback` имеет значение true. В разделе [транзакций и пользовательские задания](#setters).  
  
9. Постройте и запустите это решение.  
  
10. Проверьте свойство. Убедитесь, что повторите **отменить** и **повтора**.  
  
##  <a name="setters"></a>Транзакции и пользовательские задания  
 Метода Set свойства пользовательского хранилища у вас открыть транзакцию, так как этот метод обычно вызывается внутри активной транзакции.  
  
 Тем не менее метод Set может также вызываться, если пользователь вызывает отмены или повтора или производится откат транзакции. Когда <xref:Microsoft.VisualStudio.Modeling.Store.InUndoRedoOrRollback%2A> имеет значение true, Set-метод должны вести себя следующим образом:  
  
-   Не следует вносить изменения в хранилище, например присвоение значений других свойств домена. Диспетчер отмены будет устанавливать их значения.  
  
-   Тем не менее он должен быть обновлен любым внешним ресурсам, например базы данных или содержимое файла или объекты за пределами хранилища. Это будет убедитесь, что они хранятся в synchronism со значениями в хранилище.  
  
 Пример:  
  
```  
void SetAgeValue(int value)  
{   
  // If we are in Undo, no changes to Store objects:  
  if (!this.Store.InUndoRedoOrRollback)  
  {   
    this.BirthYear = System.DateTime.Today.Year - value;   
  }  
  // But always update external objects:  
  System.IO.File.WriteAllText(AgeFile, value);  
}  
```  
  
 Дополнительные сведения о транзакциях см. в разделе [перехода и обновления модели в программном коде](../modeling/navigating-and-updating-a-model-in-program-code.md).  
  
## <a name="see-also"></a>См. также  
 [Навигация по модели и обновление модели в программном коде](../modeling/navigating-and-updating-a-model-in-program-code.md)   
 [Свойств для свойств домена](../modeling/properties-of-domain-properties.md)   
 [Определение доменного языка](../modeling/how-to-define-a-domain-specific-language.md)