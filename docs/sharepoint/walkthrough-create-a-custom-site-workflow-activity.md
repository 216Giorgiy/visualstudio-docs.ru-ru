---
title: "Пошаговое руководство. Создание пользовательского действия рабочего процесса сайта | Microsoft Docs"
ms.custom: ""
ms.date: "02/02/2017"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "office-development"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
  - "VB"
  - "CSharp"
helpviewer_keywords: 
  - "пользовательские действия рабочих процессов [разработка приложений SharePoint в Visual Studio]"
  - "разработка приложений SharePoint в Visual Studio, пользовательские действия рабочих процессов"
  - "разработка приложений SharePoint в Visual Studio, рабочие процессы сайта"
  - "рабочие процессы сайта [разработка приложений SharePoint в Visual Studio]"
  - "действия рабочих процессов [разработка приложений SharePoint в Visual Studio]"
ms.assetid: 8219a779-c27b-4186-92c9-5bda03328aa9
caps.latest.revision: 20
author: "kempb"
ms.author: "kempb"
manager: "ghogen"
caps.handback.revision: 19
---
# Пошаговое руководство. Создание пользовательского действия рабочего процесса сайта
  В этом пошаговом руководстве показано, как создать пользовательское действие для рабочего процесса на уровне сайта с помощью [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)]. \(Рабочие процессы на уровне сайта действуют для всего сайта, а не для определенного списка на сайте.\) Пользовательское действие создает резервную копию списка Announcements и копирует в него содержимое списка Announcements.  
  
 В этом пошаговом руководстве показано выполнение следующих задач.  
  
-   Создание рабочего процесса на уровне сайта.  
  
-   Создание пользовательского действия рабочего процесса.  
  
-   Создание и удаление списка SharePoint.  
  
-   Копирование элементов из одного списка в другой.  
  
-   Отображение списка на панели быстрого запуска.  
  
 [!INCLUDE[note_settings_general](../sharepoint/includes/note-settings-general-md.md)]  
  
## Обязательные компоненты  
 Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.  
  
-   Поддерживаемые выпуски [!INCLUDE[TLA#tla_win](../sharepoint/includes/tlasharptla-win-md.md)] и SharePoint.  Для получения дополнительной информации см. [Требования по разработке решений SharePoint](../sharepoint/requirements-for-developing-sharepoint-solutions.md).  
  
-   Visual Studio.  
  
## Создание проекта пользовательского действия рабочего процесса сайта  
 Сначала создайте проект, в котором предстоит разместить и протестировать пользовательское действие рабочего процесса.  
  
#### Создание проекта пользовательского действия рабочего процесса сайта  
  
1.  В строке меню последовательно выберите пункты **Файл**, **Создать**, **Проект**, чтобы открыть диалоговое окно **Новый проект**.  
  
2.  Разверните узел **SharePoint**, расположенный в области **Visual C\#** или **Visual Basic**, и выберите узел **2010**.  
  
3.  На панели **Шаблоны** выберите шаблон **Проект SharePoint 2010**.  
  
4.  В поле **Имя** введите AnnouncementBackup и нажмите кнопку **ОК**.  
  
     Появится окно **Мастер настройки SharePoint**.  
  
5.  На странице **Укажите сайт и уровень безопасности для отладки** выберите переключатель **Развернуть как решение фермы**, а затем нажмите кнопку **Готово**, чтобы принять уровень доверия и сайт по умолчанию.  
  
     На этом этапе для решения задается уровень доверия "решение фермы" — единственно возможный вариант для проектов рабочего процесса.  
  
6.  В области **Обозреватель решений** выберите узел проекта, затем в меню **Проект** выберите **Добавить новый элемент**.  
  
7.  Разверните узел **SharePoint**, расположенный в области **Visual C\#** или **Visual Basic**, и выберите узел **2010**.  
  
8.  В области **Шаблоны** выберите шаблон **Последовательный рабочий процесс \(только для решения фермы\)**, а затем нажмите кнопку **Добавить**.  
  
     Появится окно **Мастер настройки SharePoint**.  
  
9. На странице **Имя рабочего процесса для отладки** нажмите кнопку "Далее", чтобы принять имя по умолчанию \(AnnouncementBackup \- Workflow1\).  Измените тип шаблона рабочего процесса на **Рабочий процесс сайта** и нажмите кнопку **Далее**.  
  
10. Нажмите кнопку **Готово**, чтобы принять значения по умолчанию для остальных параметров.  
  
## Добавление класса пользовательского действия рабочего процесса  
 Теперь добавьте в проект класс, в котором будет содержаться код для пользовательского действия рабочего процесса.  
  
#### Добавление класса пользовательского действия рабочего процесса  
  
1.  Для отображения диалогового окна **Добавление нового элемента** выберите в меню **Проект** команду **Добавить новый элемент**.  
  
2.  В древовидном представлении **Установленные шаблоны** выберите узел **Код** и выберите шаблон **Класс** в списке шаблонов элементов проектов.  Используйте имя по умолчанию \(Class1\).  Нажмите кнопку **Добавить**.  
  
3.  Удалите весь код в шаблоне Class1 на следующий код.  
  
     [!code-csharp[SP_AnnBackup#1](../snippets/csharp/VS_Snippets_OfficeSP/sp_annbackup/cs/class1.cs#1)]
     [!code-vb[SP_AnnBackup#1](../snippets/visualbasic/VS_Snippets_OfficeSP/sp_annbackup/vb/class1.vb#1)]  
  
4.  Сохраните проект и в строке меню выберите **Построение**, **Построить решение**.  
  
     Class1 отображается как пользовательское действие на **панели элементов** на вкладке **Компоненты AnnouncementBackup**.  
  
## Добавление пользовательского действия в рабочий процесс сайта  
 Теперь добавьте в рабочий процесс действие, в котором будет содержаться пользовательский код.  
  
#### Добавление пользовательского действия в рабочий процесс сайта  
  
1.  Откройте рабочий процесс Workflow1 в конструкторе рабочих процессов.  
  
2.  Перетащите Class1 с **панели элементов** под действие `onWorkflowActivated1` или откройте контекстное меню для Class1, выберите **Копировать**, откройте контекстное меню для строки под действием `onWorkflowActivated1` и выберите **Вставить**.  
  
3.  Сохраните проект.  
  
## Тестирование пользовательского действия рабочего процесса сайта  
 Теперь запустите проект и начните рабочий процесс сайта.  Пользовательское действие создает резервную копию списка Announcements и копирует в него содержимое текущего списка Announcements.  Перед созданием резервной копии списка проверяется наличие существующей резервной копии.  Если резервная копия существует, она удаляется.  Кроме того, на панель быстрого запуска сайта SharePoint добавляется ссылка на новый список.  
  
#### Тестирование пользовательского действия рабочего процесса сайта  
  
1.  Нажмите клавишу F5 для запуска проекта и его развертывания в SharePoint.  
  
2.  На панели быстрого запуска выберите **Списки**, чтобы отобразить все списки, имеющиеся на сайте SharePoint.  Обратите внимание, что имеется только один список объявлений с именем **Announcements**.  
  
3.  В верхней части веб\-страницы SharePoint выберите ссылку **Рабочие процессы сайта**.  
  
4.  В разделе "Запуск нового рабочего процесса" выберите ссылку **AnnouncementBackup – Workflow1**.  При этом запустится рабочий процесс сайта и выполнится код в пользовательском действии.  
  
5.  На панели быстрого запуска выберите ссылку **Резервное копирование списка Announcements**.  Обратите внимание, что в этот список скопированы все объявления, содержавшиеся в списке **Announcements**.  
  
## См. также  
 [Практическое руководство. Создание приемника событий](../sharepoint/how-to-create-an-event-receiver.md)   
 [Разработка решений SharePoint](../sharepoint/developing-sharepoint-solutions.md)  
  
  