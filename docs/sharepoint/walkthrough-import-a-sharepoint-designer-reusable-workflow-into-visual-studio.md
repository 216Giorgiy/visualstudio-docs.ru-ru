---
title: "Пошаговое руководство. Импорт рабочего процесса SharePoint Designer с возможностью повторного использования в Visual Studio"
ms.custom: ""
ms.date: "02/02/2017"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "office-development"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "VS.SharePointTools.WSPImport.ImportWF"
dev_langs: 
  - "VB"
  - "CSharp"
  - "VB"
  - "CSharp"
helpviewer_keywords: 
  - "Разработка приложений SharePoint в Visual Studio, импорт рабочих процессов с возможностью повторного использования"
  - "рабочие процессы с возможностью повторного использования [разработка приложений SharePoint в Visual Studio]"
ms.assetid: a6550615-4433-4aba-8bdf-0fcbf8dbcf97
caps.latest.revision: 35
author: "kempb"
ms.author: "kempb"
manager: "ghogen"
caps.handback.revision: 34
---
# Пошаговое руководство. Импорт рабочего процесса SharePoint Designer с возможностью повторного использования в Visual Studio
  В этом пошаговом руководстве показано, как импортировать рабочий процесс с возможностью повторного использования, созданный с помощью SharePoint Designer 2010, в проект рабочего процесса [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] SharePoint.  
  
 Рабочие процессы, созданные с помощью SharePoint Designer, или *декларативные рабочие процессы*, составляются из [!INCLUDE[TLA2#tla_xml](../sharepoint/includes/tla2sharptla-xml-md.md)]\-операторов, а не из кода.  В SharePoint Designer 2010 добавлена поддержка *рабочих процессов с возможностью повторного использования* — портативных декларативных рабочих процессов, которые можно использовать в различных списках на сайтах SharePoint.  
  
 Рабочие процессы, созданные в [!INCLUDE[vs_dev11_long](../sharepoint/includes/vs-dev11-long-md.md)], например рабочие процессы конечного автомата и последовательные рабочие процессы, называются *рабочими процессами с кодом* Рабочие процессы с кодом состоят из XML\-файлов и модулей кода, которые пользователи могут изменять, чтобы настраивать поведение рабочих процессов.  
  
 Visual Studio позволяет импортировать рабочие процессы с возможностью повторного использования, созданные в SharePoint Designer 2010, и преобразовывать их в рабочие процессы с кодом, используемые на сайтах SharePoint.  
  
 В этом пошаговом руководстве показано выполнение следующих задач.  
  
-   Создание простого рабочего процесса с возможностью повторного использования в SharePoint Designer.  
  
-   Экспорт рабочего процесса SharePoint Designer с возможностью повторного использования в WSP\-файл и в SharePoint.  
  
-   Импорт WSP\-файла в [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] с помощью проекта импорта рабочего процесса для повторного использования.  
  
-   Изменение рабочего процесса путем добавления кода.  
  
-   Использование импортированного рабочего процесса на сайте SharePoint.  
  
 [!INCLUDE[note_settings_general](../sharepoint/includes/note-settings-general-md.md)]  
  
## Обязательные компоненты  
 Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.  
  
-   Поддерживаемые выпуски [!INCLUDE[TLA#tla_win](../sharepoint/includes/tlasharptla-win-md.md)] и SharePoint.  Для получения дополнительной информации см. [Требования по разработке решений SharePoint](../sharepoint/requirements-for-developing-sharepoint-solutions.md).  
  
-   Visual Studio.  
  
-   Microsoft [!INCLUDE[TLA2#tla_office](../sharepoint/includes/tla2sharptla-office-md.md)] SharePoint Designer 2010.  
  
## Создайте целевые дочерние сайты SharePoint  
 Сначала необходимо создать два дочерних сайта SharePoint: один для размещения рабочих процессов с возможностью повторного использования, созданных в SharePoint Designer, другой для размещения преобразованных рабочих процессов.  
  
#### Создание целевых дочерних сайтов SharePoint  
  
1.  В конструкторе SharePoint 2010, в строке меню выберите **Файл**, **Новый пустой веб\-сайт**.  
  
2.  В диалоговом окне **Открытие сайта** выберите сайт SharePoint, в котором требуется создать рабочий процесс \(или примите значение http:\/\/*SystemName*\/ и нажмите кнопку **OK**.  
  
     Отобразится домашняя страница.  
  
3.  В разделе **Дочерние сайты**, нажмите кнопку **Создать**.  
  
4.  В диалоговом окне **Создать** выберите из списка **Шаблоны SharePoint** в левой области и выберите **Сайт группы** из списка в правой области.  
  
5.  В поле **Укажите расположение веб\-сайта** замените слово **subsite** в URL\-адресе на SPD1 и выберите кнопку **ОК**.  
  
     В SharePoint Designer откроется новый дочерний сайт.  Закройте этот экземпляр SharePoint Designer и вернитесь к первому экземпляру этого приложения \(на сайт верхнего уровня\).  
  
6.  Повторите шаги 3–5, чтобы создать второй дочерний сайт, но на этот раз замените слово **subsite** в [!INCLUDE[TLA2#tla_url](../sharepoint/includes/tla2sharptla-url-md.md)] на SPD2.  
  
## Создайте рабочий процесс с возможностью повторного использования в SharePoint Designer  
 Поскольку в SharePoint нет рабочего процесса с возможностью повторного использования, который можно применить в этом примере, необходимо его создать.  В этом простом примере рабочего процесса когда пользователь создает задачу в списке задач с определенным названием, эта задача назначается этому пользователю.  
  
#### Создание рабочего процесса с возможностью повторного использования в SharePoint Designer  
  
1.  В разделе **Дочерние сайты**, выберите**SPD1** сайт чтобы изменить его.  
  
2.  На ленте нажмите кнопку **Повторно используемый рабочий процесс**.  
  
     Откроется мастер создания рабочего процесса с возможностью повторного использования.  
  
3.  В поле **Имя** введите SPD Task Workflow.  
  
4.  В списке **Тип содержимого** выберите **Задачи** и нажмите кнопку **ОК**.  
  
     В конструкторе рабочих процессов SharePoint Designer откроется рабочий процесс.  
  
5.  В конструкторе рабочих процессов, выберите шаг 1, а затем на ленте нажмите кнопку **Условие**.  
  
6.  В списке условий, выберите **Если в текущем элементе поле \= значение**.  
  
     На этом шаге добавляется с именем **Если поле \= значение** условия.  
  
7.  Щелкните ссылку **поле** в условии **Если поле \= значение**.  
  
8.  В списке значений выберите **Название**.  
  
9. Выберите ссылку **значение** в условии **Если поле \= значение**.  
  
10. В текстовом поле введите Новая задача.  
  
     Теперь оператор условия выглядит следующим образом: **Если текущее название:элемента \= новая задача**.  
  
11. Выберите линию под условным выражением, а затем на ленте нажмите кнопку **Действие**.  
  
12. В списке действий, выберите **Задать поле в текущем элементе**.  
  
13. Щелкните ссылку **поле** в действии **Задать полю значение** и выберите **Состояние назначения**.  
  
14. В действии **Задать полю значение** выберите ссылку **значение** и затем в списке существующих пользователей и групп, выберите команду **Пользователь, который создал элемент**.  
  
15. Нажмите кнопку **Добавить**, а затем — кнопку **ОК**.  
  
     Теперь оператор действия выглядит следующим образом **Задать полю "Состояние назначения" значение "Пользователь, создавший текущий элемент"**.  
  
## Сохранение и развертывание рабочего процесса с возможностью повторного использования  
 Поскольку [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] поддерживает импорт только WSP\-файлов, необходимо сохранить рабочий процесс с возможностью повторного использования в виде WSP\-файла и развернуть его в SharePoint перед импортом в [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)].  
  
> [!IMPORTANT]  
>  Если в ходе этой процедуры возникает ошибка среды выполнения, необходимо выполнить ее в системе с доступом к сайту SharePoint.  
  
#### Сохранение и развертывание рабочего процесса с возможностью повторного использования  
  
1.  Нажмите кнопку **Сохранить** в верхней части окна SharePoint Designer, чтобы сохранить изменения, затем нажмите кнопку **Опубликовать**, чтобы развернуть рабочий процесс на сайте SharePoint **SPD1**.  
  
2.  В области навигации выберите объект **Рабочие процессы**.  
  
3.  В разделе **Повторно используемый рабочий процесс** выберите **SPD Task Workflow**.  
  
4.  На ленте щелкните кнопку **Сохранить как шаблон** для сохранения рабочего процесса в виде WSP\-файла.  
  
5.  Откройте сайт SharePoint **SPD1** в браузере для просмотра WSP\-файла в SharePoint.  
  
6.  На панели быстрого запуска выберите ссылку **Библиотеки**.  
  
7.  Щелкните ссылку **Ресурсы сайта** в разделе **Библиотеки документов**.  
  
     Файл **SPD Task Workflow** перечислен среди других ресурсов сайта.  
  
8.  В списке файлов выберите имя этого файла  
  
9. Нажмите кнопку **Сохранить** в окне **Загрузка файла** и сохраните файл в системе.  
  
## Импортируйте WSP\-файл в Visual Studio  
 Импортируйте WSP\-файл в [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] с помощью проекта импорта рабочего процесса с возможностью повторного использования.  Этот проект преобразует рабочий декларативный рабочий процесс с возможностью повторного использования в рабочий процесс с кодом.  Преобразовав рабочий процесс, можно изменять его поведение с помощью кода.  
  
#### Импорт рабочего процесс из WSP\-файла и его редактирование  
  
1.  В строке меню [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] выберите **ФайлСоздать**, **Проект**.  
  
2.  В диалоговом окне **Новый проект** разверните узел **SharePoint** в разделах **Visual C\#** или **Visual Basic**, а затем щелкните узел **2010**.  
  
3.  В области **Шаблоны** выберите шаблон **Импорт повторно используемого рабочего процесса SharePoint 2010**, оставьте имя проекта **WorkflowImportProject1**, а затем нажмите кнопку **ОК**.  
  
     Появится окно "Мастер настройки SharePoint".  
  
4.  На странице **Укажите сайт и уровень безопасности для отладки** введите [!INCLUDE[TLA2#tla_url](../sharepoint/includes/tla2sharptla-url-md.md)] второго дочернего сайта SharePoint, созданного ранее: http:\/\/*system name*\/SPD2.  
  
5.  В разделе **Какова степень доверия для этого решения SharePoint?** выберите **Развернуть как решение фермы** и нажмите клавишу **Далее**.  
  
     Дополнительные сведения о сравнительных особенностях обезвреженных решений и решений фермы см. в разделе [Замечания об обезвреженных решениях](../sharepoint/sandboxed-solution-considerations.md).  
  
6.  На странице **Укажите новый исходный файл проекта** перейдите в расположение в системе, где сохранен WSP\-файл, откройте файл и нажмите кнопку **Далее**.  
  
    > [!NOTE]  
    >  Нажмите кнопку **Готово**, чтобы импортировать все доступные элементы в wsp\-файл.  
  
     Отображается список рабочих процессов с возможностью повторного использования, доступных для импорта.  
  
7.  В поле **Выберите элементы для импорта** выберите рабочий процесс **SPD Task Workflow** и нажмите кнопку **Готово**.  
  
     По завершении операции импорта создается проект **WorkflowImportProject1**, содержащий рабочий процесс с именем **SPD\_Workflow\_TestFT**.  В этой папке содержится файл определения рабочего процесса Elements.xml и файл конструктора рабочих процессов \(XOML\-файл\).  В конструкторе содержатся два файла: файл правил \(с расширением RULES\) и файл с выделенным кодом \(с расширением CS или VB, в зависимости от языка программирования проекта\).  
  
8.  В **Обозревателе решений** удалите папку **Другие импортированные файлы**.  
  
9. В файле Elements.xml, удалите `InstantiationURL="_layouts/IniErkflIP.sspx"`.  
  
10. В **Обозревателе решений** выберите **WorkflowImportProject1**, а затем в строке меню выберите **Проект**, **Назначить запускаемым проектом**, чтобы задать **WorkflowImportProject1** автозапускаемым проектом.  
  
     Это позволяет немедленно отображать список при отладке проекта.  
  
11. Поскольку шаблон **Импорт повторно используемого рабочего процесса SharePoint 2010** не импортирует связанные значения свойств импортируемого рабочего процесса, их необходимо ввести самостоятельно.  Описание процедуры  
  
    1.  В **Обозревателе Решений** выберите узел проекта **SPD\_Workflow\_TestFT**.  
  
    2.  Нажмите кнопку с многоточием \(![Эллипс конструктора ASP.NET для мобильных устройств](~/sharepoint/media/mwellipsis.gif "Эллипс конструктора ASP.NET для мобильных устройств")\) рядом с одним из списковых свойств, например свойство **Конечный список**.  
  
    3.  Введите недостающие значения в мастере настройки SharePoint, а затем нажмите кнопку **Готово**.  
  
12. Выберите файл .xoml и затем в строке меню выберите **Вид**, **Конструктор**, чтобы просмотреть импортированный рабочий процесс в конструкторе рабочих процессов.  
  
13. В узле **Windows Workflow v3.0Панели элементов** выполните один из указанных ниже шагов:  
  
    -   Откройте контекстное меню для действия **Code** и выберите **Копировать**.  В конструкторе рабочих процессов откройте контекстное меню для строки, расположенной под действием **SequenceActivity1**, и выберите **Вставить**.  
  
    -   Перетащите действие **Code** из окна **Панель элементов** в конструктор рабочих процессов и подключите его к линии под действием **SequenceActivity1**.  
  
     В результате в конструкторе рабочих процессов добавится действие **CodeActivity1**.  В это действие необходимо добавить код, создающий список Announcements при запуске рабочего процесса пользователем.  
  
14. Выполните одно из следующих действий.  
  
    -   Дважды щелкните **CodeActivity1**, чтобы создать обработчик событий и просмотреть код.  
  
    -   В окне **Свойства** в поле **CodeActivity1** задайте свойству **ExecuteCode** значение **codeActivity\_ExecuteCode**.  
  
15. Добавьте следующий код под существующие операторы **using** или **Imports**.  
  
     [!code-csharp[SP_SPDWFImport#1](../snippets/csharp/VS_Snippets_OfficeSP/sp_spdwfimport/cs/workflows/spd_task_workflowft/spd task workflow.xoml.cs#1)]
     [!code-vb[SP_SPDWFImport#1](../snippets/visualbasic/VS_Snippets_OfficeSP/sp_spdwfimport/vb/workflowimportproject1/workflows/spd_task_workflowft/spd task workflow.xoml.vb#1)]  
  
16. Замените оператор `codeActivity1_ExecuteCode` следующим кодом:  
  
     [!code-csharp[SP_SPDWFImport#2](../snippets/csharp/VS_Snippets_OfficeSP/sp_spdwfimport/cs/workflows/spd_task_workflowft/spd task workflow.xoml.cs#2)]
     [!code-vb[SP_SPDWFImport#2](../snippets/visualbasic/VS_Snippets_OfficeSP/sp_spdwfimport/vb/workflowimportproject1/workflows/spd_task_workflowft/spd task workflow.xoml.vb#2)]  
  
## Выполните развертывание проекта и связывание рабочего процесса  
 Теперь запустите проект WorkflowImportProject1, чтобы развернуть его на сайте SharePoint, и свяжите его со списком задач, чтобы просмотреть и протестировать измененный преобразованный рабочий процесс.  
  
#### Развертывание проекта и связывание рабочего процесса  
  
1.  Нажмите клавишу F5 в [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)], чтобы запустить и развернуть проект преобразованного рабочего процесса.  
  
2.  Щелкните элемент **Задачи** на панели быстрого запуска, чтобы вывести список задач.  
  
3.  На вкладке **Инструменты списка**, нажмите кнопку **Элементы**, а затем нажмите кнопку **Создать элемент**.  
  
     Открывается диалоговое окно **Задачи: Новый элемент**.  
  
4.  В поле **Заголовок** введите Новую задачу и нажмите кнопку **Сохранить**.  
  
5.  На вкладке **Инструменты списка**, нажмите кнопку **Список**, а затем нажмите кнопку **Параметры списка**.  
  
     Появится страница **Параметры списка**.  
  
6.  Щелкните ссылку **Параметры рабочих процессов** в разделе **Разрешения и управление**.  
  
     Отображается страница **Параметры рабочих процессов**.  
  
7.  Выберите ссылку **Добавление рабочего процесса**.  
  
8.  В списке **Рабочий процесс** выберите **WorkflowImportProject1 — SPD Workflow Test**.  
  
9. В поле **Имя** введите SPD Workflow Test, и нажмите кнопку **ОК**.  
  
10. На панели быстрого запуска выберите список **Задачи**.  
  
11. Нажмите стрелку рядом с кнопкой **Новая задача**, а затем в списке выберите **Рабочие процессы**.  
  
12. В разделе **Запуск нового рабочего процесса** щелкните по ссылке **SPD Workflow Test**, затем нажмите кнопку **Запуск** для запуска нового рабочего процесса.  
  
    > [!NOTE]  
    >  Также можно автоматически связать рабочий процесс со списком, запустив мастер параметров рабочего процесса и указав автоматическое связывание рабочего процесса.  
  
     Обратите внимание, что рабочий процесс выполняет два действия: указывает имя пользователя в столбце задания **Состояние назначения** и отображает объявление в списке **Announcements**.  
  
## См. также  
 [Импорт элементов из существующего сайта SharePoint](../sharepoint/importing-items-from-an-existing-sharepoint-site.md)   
 [Разработка решений SharePoint](../sharepoint/developing-sharepoint-solutions.md)   
 [Создание многократно используемых пользовательских элементов управления для веб-частей или страниц приложений](../sharepoint/creating-reusable-controls-for-web-parts-or-application-pages.md)  
  
  