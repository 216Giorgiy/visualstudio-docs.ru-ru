---
title: "Walkthrough: Calling into the SharePoint Client Object Model in a Server Explorer Extension | Microsoft Docs"
ms.custom: ""
ms.date: "02/02/2017"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "office-development"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
helpviewer_keywords: 
  - "SharePoint development in Visual Studio, client object model"
  - "SharePoint commands [SharePoint development in Visual Studio]"
ms.assetid: 897d3798-42c1-4fff-b280-8b84b53d80c6
caps.latest.revision: 100
author: "kempb"
ms.author: "kempb"
manager: "ghogen"
caps.handback.revision: 96
---
# Walkthrough: Calling into the SharePoint Client Object Model in a Server Explorer Extension
  В этом пошаговом руководстве показано, как вызывать клиентскую объектную модель SharePoint из расширения узла **Подключения SharePoint** в **обозревателе серверов**.  Дополнительные сведения об использовании клиентской объектной модели SharePoint см. в разделе [Calling into the SharePoint Object Models](../sharepoint/calling-into-the-sharepoint-object-models.md).  
  
 В этом пошаговом руководстве показано выполнение следующих задач.  
  
-   Создание расширения [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)], которое следующим образом расширяет узел **Подключения SharePointобозревателя серверов**:  
  
    -   Расширение добавляет узел **Коллекция веб\-части** под каждым узлом сайта SharePoint в **Обозреватель серверов**.  Этот новый узел содержит дочерние узлы, представляющие каждую из веб\-частей в коллекции веб\-частей на сайте;  
  
    -   Расширение определяет новый тип узла, который представляет экземпляр веб\-части.  Этот новый узел является базовым для дочерних узлов нового узла **Коллекция веб\-частей**.  Новый тип узла " веб\-часть " отображает сведения в окне **Свойства** о веб\-части, которое представляет узел.  
  
-   Построение пакета расширения Visual Studio \(VSIX\) для расширения.  
  
-   Отладка и тестирование расширения.  
  
> [!NOTE]  
>  Расширение, который будет создан в этом пошаговом руководстве показано расширение, которое создается в [Walkthrough: Extending Server Explorer to Display Web Parts](../sharepoint/walkthrough-extending-server-explorer-to-display-web-parts.md).  Пошаговое руководство, использующего объектную модель сервера SharePoint, однако в этом пошаговом руководстве выполняет те же задачи с помощью клиентской объектной модели.  
  
## Обязательные компоненты  
 Для выполнения данного пошагового руководства на компьютере разработчика должны быть установлены следующие компоненты:  
  
-   Поддерживаемые выпуски Windows, SharePoint и Visual Studio.  Дополнительные сведения см. в разделе [Требования по разработке решений SharePoint](../sharepoint/requirements-for-developing-sharepoint-solutions.md).  
  
-   Пакет SDK для Visual Studio.  В этом пошаговом руководстве шаблон **Проект VSIX** из пакета SDK используется для создания пакета VSIX, который служит для развертывания расширения.  Дополнительные сведения см. в разделе [Extending the SharePoint Tools in Visual Studio](../sharepoint/extending-the-sharepoint-tools-in-visual-studio.md).  
  
 Знание следующих подходов может оказаться полезным, но не требуется для выполнения пошагового руководства.  
  
-   использование клиентской объектной модели SharePoint.  Дополнительные сведения см. в разделе [Managed Client Object Model](http://go.microsoft.com/fwlink/?LinkId=177797).  
  
-   Веб\-части SharePoint.  Дополнительные сведения см. в разделе [Web Parts Overview](http://go.microsoft.com/fwlink/?LinkId=177803).  
  
## Создание проектов  
 Чтобы выполнить это пошаговое руководство, необходимо создать два проекта:  
  
-   Проект VSIX, который позволит создать пакет VSIX для развертывания расширения **Обозреватель серверов**.  
  
-   Проект библиотеки классов, средства расширения **Обозреватель серверов**.  
  
 Начните выполнение пошагового руководства с создания проектов.  
  
#### Создание проекта VSIX  
  
1.  Запустите [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)].  
  
2.  В строке меню выберите **Файл**, **Создать**, **Проект**.  
  
3.  В диалоговом окне **Создать проект** разверните узлы **Visual C\#** или **Visual Basic**, а затем выберите **Расширение среды**.  
  
    > [!NOTE]  
    >  Узел **Расширение среды** доступен, только если установить пакет SDK для Visual Studio.  Дополнительные сведения см. в параграфе предварительных требований ранее в этом разделе.  
  
4.  В верхней части диалогового окна, выберите **платформа .NET Framework 4,5** в списке версий платформы .NET Framework.  
  
     Расширения средств SharePoint требуют функций в данной версии платформы .NET Framework.  
  
5.  Выберите шаблон **Проект VSIX**.  
  
6.  В окне **Имя**, введите **WebPartNode**, а затем нажмите кнопку **ОК**.  
  
     [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] добавит в **Обозреватель решений** проект **WebPartNode**.  
  
#### Создание проекта расширения  
  
1.  В **Обозреватель решений** открыть контекстное меню для узла решения выберите **Добавить**, а затем выберите **Создать проект**.  
  
    > [!NOTE]  
    >  В проектах Visual Basic узел решения отображается в **обозревателе решений**, только если в диалоговом окне ["Общие", страница "Проекты и решения", диалоговое окно "Параметры"](http://msdn.microsoft.com/ru-ru/8f8e37e8-b28d-4b13-bfeb-ea4d3312aeca) установлен флажок **Всегда показывать решение**.  
  
2.  В диалоговом окне  **Создать проект** разверните узлы **Visual C\#** или **Visual Basic**, а затем выберите **Окна**.  
  
3.  В верхней части диалогового окна, выберите **платформа .NET Framework 4,5** в списке версий платформы .NET Framework.  
  
4.  В списке шаблонов проектов выберите **Библиотека классов**.  
  
5.  В окне **Имя**, вставки **WebPartNodeExtension**, а затем кнопку **ОК**.  
  
     [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] добавит проект **WebPartNodeExtension** в решение и откроет заданный по умолчанию файл с кодом Class1.  
  
6.  Удалите из проекта файл c кодом Class1.  
  
## Настройка проекта расширения  
 Перед разработкой кода для создания расширения, необходимо добавить ссылки на файлы с кодом и на сборки в проект, и необходимо обновить пространство имен по умолчанию.  
  
#### Настройка проекта  
  
1.  В проекте добавьте **WebPartNodeExtension** 2 файла с кодом SiteNodeExtension, называются и WebPartNodeTypeProvider.  
  
2.  Открыть контекстное меню для проекта WebPartNodeExtension, а затем выберите **Добавить ссылку**.  
  
3.  В диалоговом окне **Диспетчер ссылок – WebPartNodeExtension** выберите узел **Платформа**, а затем установите флажки для сборок System.ComponentModel.Composition и System.Windows.Forms.  
  
4.  Выберите узел **Расширения** установите флажок для каждой из следующих сборок, а затем нажмите кнопку **ОК**:  
  
    -   Microsoft.SharePoint.Client  
  
    -   Microsoft.SharePoint.Client.Runtime  
  
    -   Microsoft.VisualStudio.SharePoint  
  
5.  Открыть контекстное меню для проекта **WebPartNodeExtension**, а затем выберите **Свойства**.  
  
     Откроется **Конструктор проектов**.  
  
6.  Выберите вкладку **Приложение**.  
  
7.  В окне **Пространство имен по умолчанию** \(C\#\) или в окне **Корневое пространство имен** \(Visual Basic\) введите **ServerExplorer.SharePointConnections.WebPartNode**.  
  
## Создание значков для новых узлов  
 Создание значков для расширения **Обозреватель серверов** : 2 значок для нового узла **Коллекция веб\-части** и другой значок для каждого узла " веб\-часть " дочернего элемента под узлом **Коллекция веб\-части**.  Далее в этом пошаговом руководстве будет написан код, который связывает эти значки с узлами.  
  
#### Создание значков для узлов  
  
1.  В **Конструктор проектов** для проекта WebPartNodeExtension, выберите вкладку **Ресурсы**.  
  
2.  Выберите ссылку **на этот проект не содержит файла ресурсов по умолчанию. Щелкните эту ссылку для создания.**  
  
     Visual Studio создает файл ресурсов и открытые в конструкторе.  
  
3.  В верхней части конструктора выберите стрелка на команде меню **Добавить ресурс**, а затем выберите **Добавить новый значок**.  
  
4.  Введите **WebPartsNode** для нового имени, значка и затем нажмите кнопку **Добавить**.  
  
     Новый значок будет отрыт в **Редакторе изображений**.  
  
5.  Правка версия значок 16x16, чтобы он будет содержать конструкцию, которую можно легко распознать.  
  
6.  Открыть контекстное меню для версии значка размером 32x32, а затем выберите **Удалить тип изображений**.  
  
7.  Повторяющиеся секции 3 до 7, чтобы добавить второй значок к ресурсам проект и назовите этот значок **WebPart**.  
  
8.  В **Обозреватель решений** в папке **Ресурсы** для проекта **WebPartNodeExtension** выберите **WebPartsNode.ico**.  
  
9. В окне **Свойства** открыть список **Действие при построении**, а затем выберите **Внедренный ресурс**.  
  
10. Повторите последние два шага для значка **WebPart.ico**.  
  
## Добавление узла коллекции веб\-частей в обозреватель серверов  
 Создайте класс, который добавляет новый узел **Коллекция веб\-частей** в узел каждого из сайтов SharePoint.  Для добавления нового узла класс реализует интерфейс <xref:Microsoft.VisualStudio.SharePoint.Explorer.IExplorerNodeTypeExtension>.  Этот интерфейс следует реализовывать всякий раз, когда требуется расширить поведение имеющегося узла **Обозреватель серверов**, например добавить к узлу новый дочерний узел.  
  
#### Добавление узла коллекции веб\-частей в обозреватель серверов  
  
1.  Вставьте следующий код в файл кода **SiteNodeExtension** для проекта **WebPartNodeExtension**.  
  
    > [!NOTE]  
    >  После добавления этого кода, проект будет иметь некоторые компилировать ошибки.  Эти ошибки исчезнут при добавлении кода на следующих шагах.  
  
     [!code-csharp[SPExtensibility.SPExplorer.WebPartNode#1](../snippets/csharp/VS_Snippets_OfficeSP/spextensibility.spexplorer.webpartnode/cs/webpartnodeextension/sitenodeextension.cs#1)]
     [!code-vb[SPExtensibility.SPExplorer.WebPartNode#1](../snippets/visualbasic/VS_Snippets_OfficeSP/spextensibility.spexplorer.webpartnode/vb/webpartnodeextension/sitenodeextension.vb#1)]  
  
## Определение типа узла, представляющего веб\-часть  
 Создайте класс, который определяет новый тип узла, представляющий веб\-часть.  Visual Studio использует этот новый тип узла, чтобы отобразить дочерние узлы под узлом **Коллекция веб\-части**.  Каждый из этих дочерних узлов представляет отдельную веб\-часть сайта SharePoint.  
  
 Для определения нового типа узла класс реализует интерфейс <xref:Microsoft.VisualStudio.SharePoint.Explorer.IExplorerNodeTypeProvider>.  Этот интерфейс следует реализовывать всякий раз, когда требуется определить новый тип узла в **обозревателе серверов**.  
  
#### Определение типа узла веб\-части  
  
1.  Вставьте следующий код в файл кода **WebPartNodeTypeProvider** для проекта **WebPartNodeExtension**.  
  
     [!code-csharp[SPExtensibility.SPExplorer.WebPartNode#2](../snippets/csharp/VS_Snippets_OfficeSP/spextensibility.spexplorer.webpartnode/cs/webpartnodeextension/webpartnodetypeprovider.cs#2)]
     [!code-vb[SPExtensibility.SPExplorer.WebPartNode#2](../snippets/visualbasic/VS_Snippets_OfficeSP/spextensibility.spexplorer.webpartnode/vb/webpartnodeextension/webpartnodetypeprovider.vb#2)]  
  
## Контрольная точка  
 На данный момент проект содержит весь код узла **Коллекция веб\-частей**.  Постройте проект **WebPartNodeExtension** убедиться, что он будет компилироваться без ошибок.  
  
#### Построение проекта  
  
1.  В **Обозреватель решений** открыть контекстное меню для проекта **WebPartNodeExtension**, а затем выберите **Построение**.  
  
## Создание пакета VSIX для развертывания расширения  
 Для развертывания расширения воспользуйтесь проектом VSIX в своем решении для создания пакета VSIX.  Сначала настроить пакет VSIX, изменив файл source.extension.vsixmanifest, который включен в проект.  Затем создайте пакет VSIX путем построения решения.  
  
#### Настройка пакета VSIX  
  
1.  В **Обозреватель решений** в проекте **WebPartNode**, **source.extension.vsixmanifest** открыть файл в редакторе манифестов.  
  
     Файл source.extension.vsixmanifest качестве основы для файла extension.vsixmanifest которого все пакеты VSIX.  Дополнительные сведения об этом файле см. в разделе [Справочник по схеме расширения VSIX](http://msdn.microsoft.com/ru-ru/76e410ec-b1fb-4652-ac98-4a4c52e09a2b).  
  
2.  В окне **Название продукта** введите **Узел коллекции веб\-части для обозревателя серверов**.  
  
3.  В окне **Автор** введите **Contoso**.  
  
4.  В окне **Описание** введите **Добавляет пользовательский узел коллекции веб\-части в узле подключения SharePoint в обозревателе сервера**.  
  
5.  На вкладке **Активы** редактор выберите кнопку **Создать**.  
  
6.  В диалоговом окне **Добавить новый актив** в списке **Тип** выберите **Microsoft.VisualStudio.MefComponent**.  
  
    > [!NOTE]  
    >  Это значение соответствует элементу `MefComponent`, описанному в файле extension.vsixmanifest.  Этот элемент задает имя сборки расширения в пакете VSIX.  Дополнительные сведения см. в разделе [NIB: MEFComponent Element \(VSX Schema\)](http://msdn.microsoft.com/ru-ru/8a813141-8b73-44c9-b80b-ca85bbac9551).  
  
7.  В списке **Источник** выберите **Проект в текущем решении**.  
  
8.  В списке **Проект** выберите **WebPartNodeExtension**, а затем нажмите кнопку **ОК**.  
  
9. В строке меню выберите **Построение**, **Построить решение** и убедитесь, что решение будет компилироваться без ошибок.  
  
10. Убедитесь, что в выходную папку построения для проекта WebPartNode теперь содержит файл WebPartNode.vsix.  
  
     По умолчанию выходной папкой построения является папка ..  \\bin\\Debug, расположенная в папке, содержащей файл проекта.  
  
## Тестирование расширения  
 Новый узел **Коллекция веб\-частей** в **обозревателе серверов** готов к тестированию.  Во\-первых, начните отладку проекта расширения в экспериментальном экземпляре Visual Studio.  Затем используйте новый узел **веб\-части** в экспериментальном экземпляре Visual Studio.  
  
#### Запуск отладки расширения  
  
1.  Перезапустите Visual Studio с учетными данными администратора, а затем откройте решение **WebPartNode**.  
  
2.  В проекте WebPartNodeExtension, откройте файл кода **SiteNodeExtension**, а затем добавьте точку останова на первой строки кода в методах `NodeChildrenRequested` и `CreateWebPartNodes`.  
  
3.  Выберите ключ F5, чтобы начать отладку.  
  
     Visual Studio устанавливает расширения до %UserProfile% \\ AppData \\ local \\ Microsoft \\ VisualStudio \\ 11.0Exp \\ extensions \\ Contoso \\ расширение узла коллекции веб\-части для обозревателя серверов \\ 1.0 и запускает экспериментальном экземпляре Visual Studio.  Тестировании элемент проекта в данном экземпляре Visual Studio.  
  
#### Тестирование расширения  
  
1.  В экспериментальном экземпляре Visual Studio в строке меню выберите **Вид**, **Обозреватель серверов**.  
  
2.  Проверьте, что сайт SharePoint, который предполагается использовать для тестирования, отображается в узле **Подключения SharePoint** в **обозревателе серверов**.  Если она не перечислитьа, выполните следующие шаги:  
  
    1.  Открыть контекстное меню для **Подключения SharePoint**, а затем выберите **Добавить подключение**.  
  
    2.  В диалоговом окне **Добавление подключения к SharePoint** введите URL\-адрес сайта SharePoint, к которому нужно подключиться, а затем нажмите кнопку **ОК**.  
  
         Чтобы задать сайт SharePoint на компьютере разработчика, введите **http:\/\/localhost**.  
  
3.  Разверните узел подключения сайта \(который указывает URL\-адрес вашего сайта\), а затем разверните узел подчиненного сайта \(например, **сайт группы**\).  
  
4.  Убедитесь, что выполнение кода в другом экземпляре Visual Studio прерывается на точке останова, которая имеет ранее в методе `NodeChildrenRequested`, а затем выбрать ключ F5, чтобы продолжить отладку проекта.  
  
5.  В экспериментальном экземпляре Visual Studio разверните узел **Коллекция веб\-части**, который отображается в узле сайта верхнего уровня.  
  
6.  Убедитесь, что выполнение кода в другом экземпляре Visual Studio прерывается на точке останова, которая имеет ранее в методе `CreateWebPartNodes`, а затем выбрать ключ F5, чтобы продолжить отладку проекта.  
  
7.  В экспериментальном экземпляре Visual Studio убедитесь, что все веб\-части на подключенном сайте доступны в узле **Коллекция веб\-частей** в **обозревателе серверов**.  
  
8.  Открыть контекстное меню для веб\-части, а затем выберите **Свойства**.  
  
9. В окне **Свойства**, убедитесь, что сведения о веб\-части.  
  
10. В **Обозреватель серверов** открыть контекстное меню для одного и того же " веб\-часть ", а затем выберите **Вывод сообщения**.  
  
     В появившемся окне сообщения нажмите кнопку **ОК**.  
  
## Удаление расширения из Visual Studio  
 После завершения тестирования расширения удалите его из Visual Studio.  
  
#### Удаление расширения  
  
1.  В экспериментальном экземпляре Visual Studio в строке меню выберите **Сервис**, **Расширения и обновления**.  
  
     Будет открыто диалоговое окно **Расширения и обновления**.  
  
2.  В списке расширений выберите **Узел коллекции веб\-части для обозревателя серверов**, а затем нажмите кнопку **Удалить**.  
  
3.  В появившемся диалоговом окне нажмите кнопку **Да**.  
  
4.  Нажмите кнопку **Перезагрузить сейчас** для завершения удаления.  
  
     Также будет удален элемент проекта.  
  
5.  Закройте оба экземпляра Visual Studio \(экспериментальном экземпляра и экземпляр Visual Studio, в котором открыто решение WebPartNode\).  
  
## См. также  
 [Calling into the SharePoint Object Models](../sharepoint/calling-into-the-sharepoint-object-models.md)   
 [Extending the SharePoint Connections Node in Server Explorer](../sharepoint/extending-the-sharepoint-connections-node-in-server-explorer.md)   
 [Walkthrough: Extending Server Explorer to Display Web Parts](../sharepoint/walkthrough-extending-server-explorer-to-display-web-parts.md)   
 [Image Editor for Icons](/visual-cpp/windows/image-editor-for-icons)   
 [Creating an Icon or Other Image &#40;Image Editor for Icons&#41;](/visual-cpp/windows/creating-an-icon-or-other-image-image-editor-for-icons)  
  
  