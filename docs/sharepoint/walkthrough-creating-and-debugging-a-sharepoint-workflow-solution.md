---
title: 'Пошаговое руководство: Создание и отладка решения рабочих процессов SharePoint | Документы Microsoft'
ms.custom: ''
ms.date: 02/02/2017
ms.technology:
- office-development
ms.topic: conceptual
f1_keywords:
- VS.SharePointTools.Workflow.WorkflowConditions
- VS.SharePointTools.Workflow.WorkflowList
dev_langs:
- VB
- CSharp
- VB
- CSharp
helpviewer_keywords:
- SharePoint development in Visual Studio, workflows
- workflows [SharePoint development in Visual Studio]
author: TerryGLee
ms.author: tglee
manager: douge
ms.workload:
- office
ms.openlocfilehash: 90015dce107eb15859fcb707cc265b84840ca546
ms.sourcegitcommit: 6a9d5bd75e50947659fd6c837111a6a547884e2a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
---
# <a name="walkthrough-creating-and-debugging-a-sharepoint-workflow-solution"></a>Пошаговое руководство. Создание и отладка решения рабочих процессов SharePoint
  В этом пошаговом руководстве демонстрируется создание шаблона простого последовательного рабочего процесса. Рабочий процесс выполняет проверку свойства общей библиотекой, чтобы определить, выполнялось ли рецензирование документа. Если документ были проверены, рабочий процесс завершается.  
  
 В данном пошаговом руководстве рассмотрены следующие задачи:  
  
-   Создание проекта последовательного рабочего процесса определения списка SharePoint в [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)].  
  
-   Создание действий рабочего процесса.  
  
-   Обработка событий действий рабочего процесса.  
  
> [!NOTE]  
>  Хотя в этом пошаговом руководстве используется проект последовательного рабочего процесса, процесс является одинаковым для проекта рабочего процесса состояние компьютера.  
>   
>  Кроме того, на компьютере могут отображаться другие имена или расположения некоторых пользователей Visual Studio элементы интерфейса в следующих инструкциях. Это зависит от имеющегося выпуска Visual Studio и используемых параметров. Дополнительные сведения см. в разделе [Персонализация интегрированной среды разработки Visual Studio](../ide/personalizing-the-visual-studio-ide.md).  
  
## <a name="prerequisites"></a>Предварительные требования  
 Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.  
  
-   Поддерживаемые редакции Microsoft Windows и SharePoint. Дополнительные сведения см. в разделе [требования к разработке решений SharePoint](../sharepoint/requirements-for-developing-sharepoint-solutions.md).  
  
-   Visual Studio.  
  
## <a name="adding-properties-to-the-sharepoint-shared-documents-library"></a>Добавление свойств в SharePoint библиотеку общих документов  
 Для отслеживания состояния просмотра документов в **общих документов** библиотеки, мы создадим три новых свойства для общих документов на сайте SharePoint: `Status`, `Assignee`, и `Review Comments`. Определим эти свойства в **Общие документы** библиотеки.  
  
#### <a name="to-add-properties-to-the-sharepoint-shared-documents-library"></a>Для добавления свойств в SharePoint, в общих документах по объектной модели библиотеки  
  
1.  Откройте сайт SharePoint, например http://\<системное имя > / SitePages/Home.aspx в веб-браузере.  
  
2.  На панели быстрого запуска выберите **SharedDocuments**.  
  
3.  Выберите **библиотеки** на **Инструменты библиотеки** ленты, а затем выберите **создать столбец** кнопка на ленте, чтобы создать новый столбец.  
  
4.  Имя столбца **статус документа**, установите для него **Выбор (меню)**, укажите один из следующих трех вариантов, а затем выберите **ОК** кнопки:  
  
    -   **Требуется рецензирование**  
  
    -   **Обзор завершен**  
  
    -   **Запрос на изменение**  
  
5.  Создайте еще два столбца и назовите их **уполномоченный** и **комментарии к проверке**. Задайте тип столбца уполномоченный как одна строка текста и комментариев к проверке тип столбца как несколько строк текста.  
  
## <a name="enabling-documents-to-be-edited-without-requiring-a-check-out"></a>Включение редактирования без необходимости их извлечения документов  
 Проверка шаблона рабочего процесса при редактировании документы без необходимости их извлечения проще. В следующей процедуре настраивается для сайта SharePoint.  
  
#### <a name="to-enable-documents-to-be-edited-without-checking-them-out"></a>Включение редактирования без их извлечения документов  
  
1.  На панели быстрого запуска выберите **Общие документы** ссылку.  
  
2.  На **Инструменты библиотеки** ленте, выберите **библиотеки** , а затем выберите **параметры библиотеки** кнопку, чтобы отобразить **параметры библиотеки документов** страницы.  
  
3.  В **Общие параметры** выберите **параметры управления версиями** ссылку, чтобы отобразить **параметры управления версиями** страницы.  
  
4.  Убедитесь, что параметр **требовать документов извлечь, прежде чем их можно изменить** — **нет**. Если это не так, измените его на **нет** и выберите **ОК** кнопки.  
  
5.  Закройте браузер.  
  
## <a name="creating-a-sharepoint-sequential-workflow-project"></a>Создание проекта последовательного рабочего процесса SharePoint  
 Последовательный рабочий процесс — это набор действий, выполняемых в порядке до завершения последнего действия. В этой процедуре мы создадим последовательного рабочего процесса, которое будет применяться к наш список Общие документы. Мастер рабочего процесса позволяет связать рабочий процесс с помощью определения сайта или определения списка и позволяет определить начала рабочего процесса.  
  
#### <a name="to-create-a-sharepoint-sequential-workflow-project"></a>Чтобы создать проект последовательного рабочего процесса SharePoint  
  
1.  Запустите [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)].  
  
2.  В строке меню выберите **файл**, **New**, **проекта** для отображения **новый проект** диалоговое окно.  
  
3.  Разверните **SharePoint** узел в рамках одного **Visual C#** или **Visual Basic**, а затем выберите **2010** узла.  
  
4.  В **шаблоны** области, выберите **проект SharePoint 2010** шаблона.  
  
5.  В **имя** введите **MySharePointWorkflow** и выберите **ОК** кнопки.  
  
     **Мастер настройки SharePoint** отображается.  
  
6.  В **Укажите сайт и уровень безопасности для отладки** выберите **развернуть как решение фермы** переключатель, а затем выберите **Готово** кнопку, чтобы принять уровень доверия и по умолчанию сайт.  
  
     Этот шаг задается уровень доверия для решения фермы, единственно возможный вариант для проектов рабочего процесса. Дополнительные сведения см. в разделе [замечания об изолированных решениях](../sharepoint/sandboxed-solution-considerations.md).  
  
7.  В **обозревателе решений**, выберите узел проекта и затем в строке меню выберите **проекта**, **Добавление нового элемента**.  
  
8.  В рамках одного **Visual C#** или **Visual Basic**, разверните **SharePoint** узла, а затем выберите **2010** узла.  
  
9. В **шаблоны** области, выберите **последовательный рабочий процесс (только для решения фермы)** шаблона и выберите **добавить** кнопки.  
  
     **Мастер настройки SharePoint** отображается.  
  
10. В **укажите имя рабочего процесса для отладки** примите имя по умолчанию (**MySharePointWorkflow - Workflow1**). Сохранять значения типа шаблона рабочего процесса по умолчанию **рабочий процесс списка**и нажмите кнопку **Далее** кнопки.  
  
11. В **будет ли Visual Studio автоматически связывать рабочий процесс в сеансе отладки?** выберите **Далее** кнопку, чтобы принять все настройки по умолчанию.  
  
     Этот шаг автоматически связываются с библиотекой Общие документы.  
  
12. В **укажите условия запуска рабочего процесса** оставьте параметры по умолчанию, выбранные в **как требуется запускать рабочий процесс?** и кнопку **Готово** кнопки.  
  
     Эта страница позволяет указать, при запуске рабочего процесса. По умолчанию рабочий процесс запускается либо когда пользователь вручную запускает его в SharePoint или при создании элемента, с которой связан рабочий процесс.  
  
## <a name="creating-workflow-activities"></a>Создание действий рабочего процесса  
 Рабочие процессы содержат одно или несколько *действия* , представляющие выполняемых действий. Используйте конструктор рабочих процессов для упорядочивания действий рабочего процесса. В этой процедуре мы добавим два действия рабочего процесса: HandleExternalEventActivity и OnWorkFlowItemChanged. Эти действия отслеживают состояние рецензирования документов в **Общие документы** списка  
  
#### <a name="to-create-workflow-activities"></a>Создание действий рабочего процесса  
  
1.  Процесс должен быть открыт в конструкторе рабочих процессов. Если это не так, затем откройте **Workflow1.cs** или **Workflow1.vb** в **обозревателе решений**.  
  
2.  В конструкторе выберите **OnWorkflowActivated1** действия.  
  
3.  В **свойства** окна, введите **onWorkflowActivated** рядом с **вызывать** свойства, а затем нажмите клавишу ВВОД.  
  
     Открывается редактор кода, и метод обработчика событий с именем onWorkflowActivated добавляется в файл кода Workflow1.  
  
4.  Вернитесь в конструктор рабочих процессов, откройте панель элементов и разверните **Windows Workflow v3.0** узла.  
  
5.  В **Windows Workflow v3.0** узел **элементов**, выполните одно из следующих действий:  
  
    1.  Откройте контекстное меню для **во время** действия, а затем выберите **копирования**. В конструкторе рабочих процессов откройте контекстное меню для строки в группе **onWorkflowActivated1** действия, а затем выберите **вставить**.  
  
    2.  Перетащите **при** действия из **элементов** в конструктор рабочих процессов и подсоедините действие к строке под **onWorkflowActivated1** действия.  
  
6.  Выберите **WhileActivity1** действия.  
  
7.  В **свойства** задайте **условие** условие кода.  
  
8.  Разверните **условие** свойство, введите **isworkflowpending свойством** рядом с дочерним **условие** свойство и нажмите клавишу ВВОД.  
  
     Открывается редактор кода и метод с именем isworkflowpending свойством добавляется в файл кода Workflow1.  
  
9. Вернитесь в конструктор рабочих процессов, откройте панель элементов и разверните **рабочего процесса SharePoint** узла.  
  
10. В **рабочего процесса SharePoint** узел **элементов**, выполните одно из следующих действий:  
  
    -   Откройте контекстное меню для **OnWorkflowItemChanged** действия, а затем выберите **копирования**. В конструкторе рабочих процессов откройте контекстное меню для строки внутри **whileActivity1** действия, а затем выберите **вставить**.  
  
    -   Перетащите **OnWorkflowItemChanged** действия из **элементов** в конструктор рабочих процессов и подсоедините действие к строке внутри **whileActivity1** действия.  
  
11. Выберите **onWorkflowItemChanged1** действия.  
  
12. В **свойства** окна, задайте свойства, как показано в следующей таблице.  
  
    |Свойство.|Значение|  
    |--------------|-----------|  
    |**CorrelationToken**|**workflowToken**|  
    |**Вызывается**|**onWorkflowItemChanged**|  
  
## <a name="handling-activity-events"></a>Обработка событий действий  
 Наконец проверьте состояние документа в каждом действии. Если документ были проверены, рабочий процесс завершается.  
  
#### <a name="to-handle-activity-events"></a>Обработка событий действий  
  
1.  В Workflow1.cs или Workflow1.vb, добавьте в поле в верхней части `Workflow1` класса. Это поле используется в действии, чтобы определить, завершена ли рабочий процесс.  
  
    ```vb  
    Dim workflowPending As Boolean = True  
    ```  
  
    ```csharp  
    Boolean workflowPending = true;  
    ```  
  
2.  Добавьте следующий метод в класс `Workflow1`. Этот метод проверяет значение `Document Status` свойства списка документов, чтобы определить, выполнялось ли рецензирование документа. Если `Document Status` свойству `Review Complete`, то `checkStatus` метода задает `workflowPending` на **false** означает все готово для завершения рабочего процесса.  
  
    ```vb  
    Private Sub checkStatus()  
        If CStr(workflowProperties.Item("Document Status")) = "Review Complete" Then  
            workflowPending = False  
        End If  
    End Sub   
    ```  
  
    ```csharp  
    private void checkStatus()  
    {  
        if ((string)workflowProperties.Item["Document Status"] == "Review Complete")  
        workflowPending = false;  
    }  
    ```  
  
3.  Добавьте следующий код в `onWorkflowActivated` и `onWorkflowItemChanged` методы для вызова `checkStatus` метод. При запуске рабочего процесса, `onWorkflowActivated` вызовы метода `checkStatus` метод, чтобы определить, является ли документ уже были проверены. Если он не были проверены, рабочий процесс продолжает работу. При сохранении документа `onWorkflowItemChanged` вызовы метода `checkStatus` метод, чтобы определить, выполнялось ли рецензирование документа. Хотя `workflowPending` имеет значение **true**, рабочий процесс продолжает выполняться.  
  
    ```vb  
    Private Sub onWorkflowActivated(ByVal sender As System.Object, ByVal e As System.Workflow.Activities.ExternalDataEventArgs)  
        checkStatus()  
    End Sub  
  
    Private Sub onWorkflowItemChanged(ByVal sender As System.Object, ByVal e As System.Workflow.Activities.ExternalDataEventArgs)  
        checkStatus()  
    End Sub  
    ```  
  
    ```csharp  
    private void onWorkflowActivated(object sender, ExternalDataEventArgs e)  
    {  
        // Check the status.  
        checkStatus();  
    }  
  
    private void onWorkflowItemChanged(object sender, ExternalDataEventArgs e)  
    {  
        // Check the status.  
        checkStatus();  
    }  
    ```  
  
4.  Добавьте следующий код в `isWorkflowPending` метод для проверки состояния `workflowPending` свойство. Каждый раз при сохранении документа **whileActivity1** вызывает действие `isWorkflowPending` метод. Этот метод проверяет <xref:System.Workflow.Activities.ConditionalEventArgs.Result%2A> свойство <xref:System.Workflow.Activities.ConditionalEventArgs> объектом, чтобы определить ли **WhileActivity1** следует продолжить или завершить действие. Если свойство имеет значение **true**, действие продолжает свою работу. В противном случае завершения действия и рабочий процесс завершается.  
  
    ```vb  
    Private Sub isWorkflowPending(ByVal sender As System.Object, ByVal e As System.Workflow.Activities.ConditionalEventArgs)  
        e.Result = workflowPending  
    End Sub  
    ```  
  
    ```csharp  
    private void isWorkflowPending(object sender, ConditionalEventArgs e)  
    {  
        e.Result = workflowPending;  
    }  
    ```  
  
5.  Сохраните проект.  
  
## <a name="testing-the-sharepoint-workflow-template"></a>Проверка шаблона рабочего процесса SharePoint  
 При запуске отладчика, [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] развертывает шаблон рабочего процесса на сервере SharePoint и связывает рабочий процесс с **Общие документы** списка. Чтобы проверить рабочий процесс, запустить экземпляр рабочего процесса из документа в **Общие документы** списка.  
  
#### <a name="to-test-the-sharepoint-workflow-template"></a>Проверка шаблона рабочего процесса SharePoint  
  
1.  В Workflow1.cs или Workflow1.vb, установите точку останова рядом с **onWorkflowActivated** метод.  
  
2.  Нажмите клавишу F5, чтобы собрать и запустить решение.  
  
     Откроется сайт SharePoint.  
  
3.  В области переходов в SharePoint выберите **Общие документы** ссылку.  
  
4.  В **Общие документы** выберите **документов** ссылку **Инструменты библиотеки** , а затем выберите **отправить документ** кнопки .  
  
5.  В **отправить документ** диалогового окна выберите **Обзор** , выберите любой файл документа, нажмите **откройте** , а затем кнопку **ОК** кнопки.  
  
     Этот документ будет отправлен в выбранной в **Общие документы** списка и запускает рабочий процесс.  
  
6.  В [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)], убедитесь, что отладчик останавливается в точке останова рядом с `onWorkflowActivated` метод.  
  
7.  Нажмите клавишу F5, чтобы возобновить выполнение.  
  
8.  Можно изменять параметры документа, но оставьте их значения по умолчанию по Выбор **Сохранить** кнопки.  
  
     Возвращает для **Общие документы** страницы веб-сайта SharePoint по умолчанию.  
  
9. В **Общие документы** убедитесь, что значение под **MySharePointWorkflow - Workflow1** столбцу присваивается **выполняется**. Это означает, что рабочий процесс выполняется и что документ ожидает рассмотрения.  
  
10. В **Общие документы** страницы, выберите его, нажмите стрелку, которая появится, а затем выберите **изменить свойства** элемента меню.  
  
11. Задать **статус документа** для **Рецензирование завершено**и нажмите кнопку **Сохранить** кнопки.  
  
     Возвращает для **Общие документы** страницы веб-сайта SharePoint по умолчанию.  
  
12. В **Общие документы** убедитесь, что значение под **статус документа** столбцу присваивается **Рецензирование завершено**. Обновить **Общие документы** и удостоверьтесь, что значение под **MySharePointWorkflow - Workflow1** столбцу присваивается **завершено**. Это означает, что рабочий процесс завершается, и рецензирование документа.  
  
## <a name="next-steps"></a>Следующие шаги  
 Дополнительные сведения о создании шаблонов рабочих процессов в следующих разделах:  
  
-   Дополнительные сведения о действиях рабочего процесса SharePoint см. в разделе [действий рабочего процесса для SharePoint Foundation](http://go.microsoft.com/fwlink/?LinkId=178992).  
  
-   Дополнительные сведения о действиях Windows Workflow Foundation см. в разделе [System.Workflow.Activities имен](http://go.microsoft.com/fwlink/?LinkId=178993).  
  
## <a name="see-also"></a>См. также  
 [Создание решений рабочих процессов SharePoint](../sharepoint/creating-sharepoint-workflow-solutions.md)   
 [Проект SharePoint и шаблоны элементов проекта](../sharepoint/sharepoint-project-and-project-item-templates.md)   
 [Построение и отладка решений SharePoint](../sharepoint/building-and-debugging-sharepoint-solutions.md)  
  
  