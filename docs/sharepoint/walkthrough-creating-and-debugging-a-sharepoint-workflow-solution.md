---
title: "Пошаговое руководство. Создание и отладка решения рабочих процессов SharePoint | Microsoft Docs"
ms.custom: ""
ms.date: "02/02/2017"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "office-development"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "VS.SharePointTools.Workflow.WorkflowConditions"
  - "VS.SharePointTools.Workflow.WorkflowList"
dev_langs: 
  - "VB"
  - "CSharp"
  - "VB"
  - "CSharp"
helpviewer_keywords: 
  - "разработка приложений SharePoint в Visual Studio, рабочие процессы"
  - "рабочие процессы [разработка приложений SharePoint в Visual Studio]"
ms.assetid: 81756490-ab5a-4fa4-96c6-eed2cfbf8374
caps.latest.revision: 28
author: "kempb"
ms.author: "kempb"
manager: "ghogen"
caps.handback.revision: 27
---
# Пошаговое руководство. Создание и отладка решения рабочих процессов SharePoint
  В этом пошаговом руководстве демонстрируется создание простого последовательного шаблона рабочего процесса.  Рабочий процесс проверяет одно из свойств библиотеки общих документов, чтобы определить, рецензирован ли документ.  Если документ был рецензирован, рабочий процесс завершается.  
  
 В данном пошаговом руководстве рассмотрены следующие задачи:  
  
-   Создание проекта определения списка последовательного рабочего процесса SharePoint в [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)].  
  
-   Создание действий рабочего процесса.  
  
-   Обработка событий действий рабочего процесса.  
  
> [!NOTE]  
>  В этом руководстве рассматривается проект последовательного рабочего процесса, но инструкции для рабочего процесса конечного автомата аналогичны.  
>   
>  Кроме того, имена и расположения некоторых элементов пользовательского интерфейса Visual Studio, отображаемые на вашем компьютере, могут отличающиеся от указанных в следующих инструкциях.  Эти элементы определяются используемой версией Visual Studio и ее параметрами.  Для получения дополнительной информации см. [Customizing Development Settings in Visual Studio](http://msdn.microsoft.com/ru-ru/22c4debb-4e31-47a8-8f19-16f328d7dcd3).  
  
## Обязательные компоненты  
 Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.  
  
-   Поддерживаемые выпуски Microsoft Windows и SharePoint.  Для получения дополнительной информации см. [Требования по разработке решений SharePoint](../sharepoint/requirements-for-developing-sharepoint-solutions.md).  
  
-   Visual Studio.  
  
## Добавление свойств в библиотеку общих документов SharePoint  
 Чтобы отслеживать состояние рецензирования документов в библиотеке **Общие документы**, создадим три новых свойства для общих документов на сайте SharePoint: `Status`, `Assignee` и `Review Comments`.  Определим эти свойства в библиотеке **Общие документы**.  
  
#### Добавление свойств в библиотеку общих документов SharePoint  
  
1.  Откройте в веб\-браузере сайт SharePoint, например http:\/\/\<имя\_системы\>\/SitePages\/Home.aspx.  
  
2.  На панели быстрого запуска выберите **Общиедокументы**.  
  
3.  Чтобы создать новый столбец, выберите элемент **Библиотека** на ленте **Инструменты библиотеки** и нажмите кнопку **Создать столбец**.  
  
4.  Присвойте столбцу имя "Статус документа", задайте для него тип **Выбор \(меню\)** и укажите следующие три варианта выбора, после чего нажмите кнопку **ОК**.  
  
    -   **Требуется рецензирование**  
  
    -   **Рецензирование завершено**  
  
    -   **Запрос изменений**  
  
5.  Создайте еще два столбца и присвойте им имена Уполномоченный и Комментарии.  Для столбца "Уполномоченный" задайте тип "однострочный текст", а для столбца "Комментарии" — "многострочный текст".  
  
## Включение редактирования документов без необходимости их извлечения  
 Протестировать шаблон рабочего процесса проще, если документы можно редактировать без необходимости их извлечения.  В следующей процедуре показано, как настроить эту возможности для сайта SharePoint.  
  
#### Включение редактирования документов без извлечения  
  
1.  На панели быстрого запуска щелкните ссылку **Общие документы**.  
  
2.  Выберите вкладку **Библиотека** на ленте **Инструменты библиотеки** и нажмите кнопку **Параметры библиотеки**, чтобы открыть страницу **Параметры библиотеки документов**.  
  
3.  В разделе **Общие параметры** выберите **Параметры управления версиями**, чтобы открыть страницу **Параметры управления версиями**.  
  
4.  Убедитесь, что в поле **Требовать извлечения документов перед редактированием?** выбрано **Нет**.  Если выбран другой вариант, измените его на **Нет** и нажмите кнопку **ОК**.  
  
5.  Закройте браузер.  
  
## Создание проекта последовательного рабочего процесса SharePoint  
 Последовательный рабочий процесс представляет собой последовательность действий, выполняемых поочередно до завершения последнего действия.  В этой процедуре демонстрируется создание рабочего процесса, применяемого к списку "Общие документы".  Мастер настройки рабочего процесса позволяет связать рабочий процесс либо с определением сайта, либо с определением списка, а также определить точку начала его выполнения.  
  
#### Создание проекта последовательного рабочего процесса SharePoint  
  
1.  Запустите [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)].  
  
2.  В строке меню последовательно выберите пункты **Файл**, **Создать**, **Проект**, чтобы открыть диалоговое окно **Новый проект**.  
  
3.  Разверните узел **SharePoint**, расположенный в области **Visual C\#** или **Visual Basic**, и выберите узел **2010**.  
  
4.  На панели **Шаблоны** выберите шаблон **Проект SharePoint 2010**.  
  
5.  В поле **Имя** введите MySharePointWorkflow и нажмите кнопку **ОК**.  
  
     Появится окно **Мастер настройки SharePoint**.  
  
6.  На странице **Укажите сайт и уровень безопасности для отладки** выберите переключатель **Развернуть как решение фермы**, а затем нажмите кнопку **Готово**, чтобы принять уровень доверия и сайт по умолчанию.  
  
     На этом этапе для решения задается уровень доверия "решение фермы" — единственно возможный вариант для проектов рабочего процесса.  Для получения дополнительной информации см. [Замечания об обезвреженных решениях](../sharepoint/sandboxed-solution-considerations.md).  
  
7.  В области **Обозреватель решений** выберите узел проекта, затем в меню **Проект** выберите **Добавить новый элемент**.  
  
8.  Разверните узел **SharePoint**, расположенный в области **Visual C\#** или **Visual Basic**, и выберите узел **2010**.  
  
9. В области **Шаблоны** выберите шаблон **Последовательный рабочий процесс \(только для решения фермы\)**, а затем нажмите кнопку **Добавить**.  
  
     Появится окно **Мастер настройки SharePoint**.  
  
10. На странице **Имя рабочего процесса для отладки** нажмите кнопку "Далее", чтобы принять имя по умолчанию \(**MySharePointWorkflow \- Workflow1**\).  Для типа шаблона рабочего процесса оставьте значение по умолчанию \(**Рабочий процесс списка**\) и нажмите кнопку **Далее**.  
  
11. На странице **Будет ли Visual Studio автоматически связывать рабочий процесс в сеансе отладки?** нажмите кнопку **Далее**, чтобы принять все настройки по умолчанию.  
  
     На этом этапе рабочий процесс автоматически связывается с библиотекой "Общие документы".  
  
12. На странице **Укажите условия запуска рабочего процесса** в разделе **Как требуется запускать рабочий процесс?** оставьте выбранными параметры по умолчанию и нажмите кнопку **Готово**.  
  
     Эта страница позволяет определить, когда стартует рабочий процесс.  По умолчанию рабочий процесс стартует либо после запуска пользователем в SharePoint вручную, либо при создании элемента, с которым ассоциирован рабочий процесс.  
  
## Создание действий рабочего процесса  
 Рабочие процессы содержат одно или несколько выполняемых *действий*.  Действия в рабочем процессе можно организовать с помощью конструктора рабочих процессов.  В этой процедуре в рабочий процесс будут добавлены два действия: HandleExternalEventActivity и OnWorkFlowItemChanged.  Эти действия отслеживают состояние рецензирования документов в списке **Общие документы**  
  
#### Создание действий рабочего процесса  
  
1.  Процесс должен быть открыт в конструкторе рабочих процессов.  Если он не открыт, откройте файл **Workflow1.cs** или **Workflow1.vb** в **обозревателе решений**.  
  
2.  В конструкторе выберите действие **OnWorkflowActivated1**.  
  
3.  В окне **Свойства** введите onWorkflowActivated рядом со свойством **Invoked** и нажмите клавишу ВВОД.  
  
     Откроется редактор кода, и в файл кода Workflow1 будет добавлен обработчик событий onWorkflowActivated.  
  
4.  В конструкторе рабочих процессов откройте панель элементов и разверните узел **Рабочий процесс Windows версии 3.0**.  
  
5.  В узле **Windows Workflow v3.0Панели элементов** выполните одну из указанных ниже последовательностей действий:  
  
    1.  Откройте контекстное меню для действия **While** и выберите **Копировать**.  В конструкторе рабочих процессов откройте контекстное меню для строки, расположенной под действием **onWorkflowActivated1**, и выберите **Вставить**.  
  
    2.  Перетащите действие **While** из **панели элементов** на конструктор рабочих процессов, на линию, расположенную под действием **onWorkflowActivated1**.  
  
6.  Выберите действие **WhileActivity1**.  
  
7.  В окне **Свойства** установите для свойства **Условие** значение "Code Condition".  
  
8.  Разверните свойство **Условие** и введите isWorkflowPending рядом с дочерним свойством **Условие**, после чего нажмите клавишу ВВОД.  
  
     Откроется редактор кода, и в файл кода Workflow1 будет добавлен метод isWorkflowPending.  
  
9. В конструкторе рабочих процессов откройте панель элементов и разверните узел **Рабочий процесс SharePoint**.  
  
10. В узле **Рабочий процесс SharePointПанели элементов** выполните одну из указанных ниже последовательностей действий:  
  
    -   Откройте контекстное меню для действия **OnWorkflowItemChanged**, а затем выберите **Копировать**.  В конструкторе рабочих процессов откройте контекстное меню для внутренней строки действия **whileActivity1** и выберите **Вставить**.  
  
    -   Перетащите действие **OnWorkflowItemChanged** из **панели элементов** на конструктор рабочих процессов, на внутреннюю линию действия **whileActivity1**.  
  
11. Выберите действие **onWorkflowItemChanged1**.  
  
12. В окне **Свойства** задайте значения свойств, указанные в следующей таблице.  
  
    |Свойство|Значение|  
    |--------------|--------------|  
    |**CorrelationToken**|**workflowToken**|  
    |**Invoked**|**onWorkflowItemChanged**|  
  
## Обработка событий действий  
 Последний шаг — проверка состояния документа в каждом действии.  Если документ рецензирован, рабочий процесс завершается.  
  
#### Обработка событий действий  
  
1.  В файле Workflow1.cs или Workflow1.vb добавьте следующее поле над классом `Workflow1`.  При выполнении действия с помощью этого поля определяется, завершен ли рабочий процесс.  
  
    ```vb  
    Dim workflowPending As Boolean = True  
    ```  
  
    ```csharp  
    Boolean workflowPending = true;  
    ```  
  
2.  Добавьте приведенный ниже метод в класс `Workflow1`.  Данный метод выполняет проверку значения свойства `Document Status` списка документов, чтобы определить, выполнялось ли рецензирование документа.  Если свойство `Document Status` имеет значение `Review Complete`, метод `checkStatus` присваивает полю `workflowPending` значение **false**, чтобы указать, что рабочий процесс готов к завершению.  
  
    ```vb  
    Private Sub checkStatus()  
        If CStr(workflowProperties.Item("Document Status")) = "Review Complete" Then  
            workflowPending = False  
        End If  
    End Sub   
    ```  
  
    ```csharp  
    private void checkStatus()  
    {  
        if ((string)workflowProperties.Item["Document Status"] == "Review Complete")  
        workflowPending = false;  
    }  
    ```  
  
3.  Для вызова метода `checkStatus` необходимо добавить в методы `onWorkflowActivated` и `onWorkflowItemChanged` приведенный ниже код.  При запуске рабочего процесса метод `onWorkflowActivated` вызывает метод `checkStatus`, чтобы определить, было ли уже выполнено рецензирование документа.  Если рецензирование документа не производилось, рабочий процесс продолжает работу.  При сохранении документа метод `onWorkflowItemChanged` вызывает метод `checkStatus`, чтобы определить, было ли уже выполнено рецензирование документа.  Пока поле `workflowPending` имеет значение **true**, рабочий процесс продолжает работу.  
  
    ```vb  
    Private Sub onWorkflowActivated(ByVal sender As System.Object, ByVal e As System.Workflow.Activities.ExternalDataEventArgs)  
        checkStatus()  
    End Sub  
  
    Private Sub onWorkflowItemChanged(ByVal sender As System.Object, ByVal e As System.Workflow.Activities.ExternalDataEventArgs)  
        checkStatus()  
    End Sub  
    ```  
  
    ```csharp  
    private void onWorkflowActivated(object sender, ExternalDataEventArgs e)  
    {  
        // Check the status.  
        checkStatus();  
    }  
  
    private void onWorkflowItemChanged(object sender, ExternalDataEventArgs e)  
    {  
        // Check the status.  
        checkStatus();  
    }  
    ```  
  
4.  Добавьте следующий код в метод `isWorkflowPending`, чтобы проверить состояние свойства `workflowPending`.  При каждом сохранении документа действие **whileActivity1** вызывает метод `isWorkflowPending`.  Этот метод проверяет свойство <xref:System.Workflow.Activities.ConditionalEventArgs.Result%2A> объекта <xref:System.Workflow.Activities.ConditionalEventArgs>, чтобы определить, должно ли действие **WhileActivity1** продолжать работу или завершиться.  Если свойство имеет значение **true**, действие продолжает свою работу.  В противном случае действие завершается; также завершается рабочий процесс.  
  
    ```vb  
    Private Sub isWorkflowPending(ByVal sender As System.Object, ByVal e As System.Workflow.Activities.ConditionalEventArgs)  
        e.Result = workflowPending  
    End Sub  
    ```  
  
    ```csharp  
    private void isWorkflowPending(object sender, ConditionalEventArgs e)  
    {  
        e.Result = workflowPending;  
    }  
    ```  
  
5.  Сохраните проект.  
  
## Тестирование шаблона рабочего процесса SharePoint  
 При запуске отладчика [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] развертывает шаблон рабочего процесса в сервере SharePoint и связывает рабочий процесс со списком **Общие документы**.  Чтобы протестировать рабочий процесс, запустите экземпляр рабочего процесса из документа в списке **Общие документы**.  
  
#### Тестирование шаблона рабочего процесса SharePoint  
  
1.  В файле Workflow1.cs или Workflow1.vb установите точку останова после метода **onWorkflowActivated**.  
  
2.  Нажмите клавишу F5, чтобы собрать и запустить решение.  
  
     Открывается сайт SharePoint.  
  
3.  В области переходов в SharePoint выберите ссылку **Общие документы**.  
  
4.  На странице **Общие документы** выберите ссылку **Документы** на вкладке **Инструменты библиотеки** и нажмите кнопку **Отправить документ**.  
  
5.  В диалоговом окне **Отправить документ** нажмите кнопку **Обзор**, выберите любой файл документа, нажмите кнопку **Открыть**, а затем нажмите кнопку **ОК**.  
  
     Выбранный документ будет отправлен в список **Общие документы**, и запустится рабочий процесс.  
  
6.  В [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] следует убедиться, что отладчик остановился в точке останова рядом с методом `onWorkflowActivated`.  
  
7.  Нажмите клавишу F5, чтобы возобновить выполнение.  
  
8.  Здесь можно изменять параметры документа, но в данном случае оставьте значения по умолчанию и нажмите кнопку **Сохранить**.  
  
     В результате вы вернетесь на страницу **Общие документы** для веб\-сайта SharePoint по умолчанию.  
  
9. На странице **Общие документы** удостоверьтесь, что в столбце **MySharePointWorkflow – Workflow1** указано значение **Выполняется**.  Это означает, что рабочий процесс выполняется, и документ ожидает рецензирования.  
  
10. На странице **Общие документы** выберите документ, нажмите на появившуюся стрелку, а затем выберите пункт меню **Изменить свойства**.  
  
11. Задайте для свойства **Статус документа** значение **Рецензирование завершено** и нажмите кнопку **Сохранить**.  
  
     В результате вы вернетесь на страницу **Общие документы** для веб\-сайта SharePoint по умолчанию.  
  
12. На странице **Общие документы** удостоверьтесь, что в столбце **Document Status** указано значение **Рецензирование завершено**.  Обновите страницу **Общие документы** и удостоверьтесь, что в столбце **MySharePointWorkflow – Workflow1** указано значение **Завершено**.  Это означает, что рабочий процесс завершился, и рецензирование документа было выполнено.  
  
## Следующие действия  
 Дополнительные сведения о создании шаблонов рабочих процессов см. в следующих разделах:  
  
-   Дополнительные сведения о действиях рабочих процессов SharePoint см. в разделе [Действия рабочих процессов для SharePoint Foundation](http://go.microsoft.com/fwlink/?LinkId=178992).  
  
-   Дополнительные сведения о действиях Windows Workflow Foundation см. в разделе [System.Workflow.Activities \- пространство имен](http://go.microsoft.com/fwlink/?LinkId=178993).  
  
## См. также  
 [Создание решений рабочих процессов SharePoint](../sharepoint/creating-sharepoint-workflow-solutions.md)   
 [Шаблоны проектов и элементов проектов SharePoint](../sharepoint/sharepoint-project-and-project-item-templates.md)   
 [Построение и отладка решений SharePoint](../sharepoint/building-and-debugging-sharepoint-solutions.md)  
  
  