---
title: "Пошаговое руководство. Профилирование приложения SharePoint | Microsoft Docs"
ms.custom: ""
ms.date: "02/02/2017"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "office-development"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
helpviewer_keywords: 
  - "тестирование производительности [разработка приложений SharePoint в Visual Studio]"
  - "профилирование [разработка приложений SharePoint в Visual Studio]"
  - "разработка приложений SharePoint в Visual Studio, тестирование производительности"
  - "разработка приложений SharePoint в Visual Studio, профилирование"
ms.assetid: 0b19d4b7-5fcc-42a2-b411-96eccd00137f
caps.latest.revision: 16
author: "kempb"
ms.author: "kempb"
manager: "ghogen"
caps.handback.revision: 15
---
# Пошаговое руководство. Профилирование приложения SharePoint
  В этом пошаговом руководстве рассказывается, как использовать средства профилирования в Visual Studio, чтобы оптимизировать производительность приложений SharePoint.  Примером приложения служит приемник событий компонентов SharePoint, который содержит цикл простоя, что ведет к снижению производительности приемника событий компонентов.  Профилировщик Visual Studio позволяет найти и исключить наиболее затратную \(имеющую самую низкую производительность\) часть проекта, также известную как *критический путь*.  
  
 В этом пошаговом руководстве описаны следующие задачи.  
  
-   [Добавление компонента и приемника событий компонента](#BKMK_AddFtrandFtrEvntReceiver).  
  
-   [Настройка и развертывание приложения SharePoint](#BKMK_ConfigSharePointApp).  
  
-   [Запуск приложения SharePoint](#BKMK_RunSPApp).  
  
-   [Просмотр и интерпретация результатов профилирования](#BKMK_ViewResults).  
  
 [!INCLUDE[note_settings_general](../sharepoint/includes/note-settings-general-md.md)]  
  
## Обязательные компоненты  
 Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.  
  
-   Поддерживаемые редакции Microsoft Windows и SharePoint.  [!INCLUDE[crdefault](../sharepoint/includes/crdefault-md.md)] [Требования по разработке решений SharePoint](../sharepoint/requirements-for-developing-sharepoint-solutions.md).  
  
-   [!INCLUDE[vs_dev11_long](../sharepoint/includes/vs-dev11-long-md.md)].  
  
## Создание проекта SharePoint  
 Сначала создайте проект SharePoint.  
  
#### Создание проекта SharePoint  
  
1.  В строке меню последовательно выберите пункты **Файл**, **Создать**, **Проект**, чтобы открыть диалоговое окно **Создать проект**.  
  
2.  Разверните узел **SharePoint**, расположенный в области **Visual C\#** или **Visual Basic**, и выберите узел **2010**.  
  
3.  На панели шаблонов выберите шаблон **Проект SharePoint 2010**.  
  
4.  В поле **Имя** введите ProfileTest и нажмите кнопку **ОК**.  
  
     Откроется окно **Мастер настройки SharePoint**.  
  
5.  На странице **Укажите сайт и уровень безопасности для отладки** введите URL\-адрес сайта сервера SharePoint, на котором будет выполняться отладка определения сайта, или примите значение по умолчанию \(http:\/\/*имя системы*\/\).  
  
6.  В разделе **Какова степень доверия для этого решения SharePoint?** выберите переключатель **Развернуть как решение фермы**.  
  
     В настоящее время можно профилировать только решения фермы.  Дополнительные сведения о сравнении изолированных решений и решений фермы см. в разделе [Замечания об обезвреженных решениях](../sharepoint/sandboxed-solution-considerations.md).  
  
7.  Нажмите кнопку **Готово**.  Проект отображается в **обозревателе решений**.  
  
##  <a name="BKMK_AddFtrandFtrEvntReceiver"></a> Добавление компонента и приемника событий компонента  
 Затем добавьте в проект компонент вместе с приемником событий для этого компонента.  Этот приемник событий будет содержать код для профилирования.  
  
#### Добавление компонента и приемника событий компонента  
  
1.  В **Обозревателе решений** откройте контекстное меню узла **Компоненты**, выберите **Добавить компонент** и оставьте имя по умолчанию — **Feature1**.  
  
2.  В **Обозревателе решений** откройте контекстное меню для **Feature1** и выберите **Добавить приемник событий**.  
  
     В результате в компонент будет добавлен и открыт для редактирования файл с кодом, содержащий несколько закомментированных обработчиков событий.  
  
3.  Добавьте следующие объявления переменных в класс приемника событий.  
  
    ```vb  
    ' SharePoint site/subsite.  
    Private siteUrl As String = "http://localhost"  
    Private webUrl As String = "/"  
    ```  
  
    ```csharp  
    // SharePoint site/subsite.  
    private string siteUrl = "http://localhost";  
    private string webUrl = "/";  
    ```  
  
4.  Замените процедуру `FeatureActivated` следующим кодом.  
  
    ```vb  
    Public Overrides Sub FeatureActivated(properties As SPFeatureReceiverProperties)  
        Try  
            Using site As New SPSite(siteUrl)  
                Using web As SPWeb = site.OpenWeb(webUrl)  
                    ' Reference the lists.  
                    Dim announcementsList As SPList = web.Lists("Announcements")  
  
                    ' Add a new announcement to the Announcements list.  
                    Dim listItem As SPListItem = announcementsList.Items.Add()  
                    listItem("Title") = "Activated Feature: " & Convert.ToString(properties.Definition.DisplayName)  
                    listItem("Body") = Convert.ToString(properties.Definition.DisplayName) & " was activated on: " & DateTime.Now.ToString()  
                    ' Waste some time.  
                    TimeCounter()  
                    ' Update the list.  
                    listItem.Update()  
                End Using  
            End Using  
  
        Catch e As Exception  
            Console.WriteLine("Error: " & e.ToString())  
        End Try  
    End Sub  
    ```  
  
    ```csharp  
    public override void FeatureActivated(SPFeatureReceiverProperties properties)  
    {  
        try  
        {  
            using (SPSite site = new SPSite(siteUrl))  
            {  
                using (SPWeb web = site.OpenWeb(webUrl))  
                {  
                    // Reference the lists.  
                    SPList announcementsList = web.Lists["Announcements"];  
  
                    // Add a new announcement to the Announcements list.  
                    SPListItem listItem = announcementsList.Items.Add();  
                    listItem["Title"] = "Activated Feature: " + properties.Definition.DisplayName;  
                    listItem["Body"] = properties.Definition.DisplayName + " was activated on: " +   
    DateTime.Now.ToString();  
                    // Waste some time.  
                    TimeCounter();  
                    // Update the list.  
                    listItem.Update();                          
                }  
            }  
        }  
  
        catch (Exception e)  
        {  
            Console.WriteLine("Error: " + e.ToString());  
        }  
    }  
    ```  
  
5.  Добавьте следующую процедуру ниже процедуры `FeatureActivated`.  
  
    ```vb  
  
    Public Sub TimeCounter()  
        Dim result As Integer  
        For i As Integer = 0 To 99999  
            For j As Integer = 0 To 9999  
                result = i * j  
            Next j  
        Next i  
    End Sub  
    ```  
  
    ```csharp  
    public void TimeCounter()  
    {  
        for (int i = 0; i < 100000; i++)  
        {  
            for (int j = 0; j < 10000; j++)  
            {  
                int result = i * j;  
            }  
        }  
    }  
    ```  
  
6.  В **Обозревателе решений** откройте контекстное меню для проекта \(**ProfileTest**\) и выберите пункт **Свойства**.  
  
7.  В диалоговом окне **Свойства** выберите вкладку **SharePoint**.  
  
8.  В списке **Активная конфигурация развертывания** выберите **Без активации**.  
  
     Выбор этой конфигурации развертывания позволяет в дальнейшем вручную активировать компонент в SharePoint.  
  
9. Сохраните проект.  
  
##  <a name="BKMK_ConfigSharePointApp"></a> Настройка и развертывание приложения SharePoint  
 Теперь, когда проект SharePoint готов, настройте и разверните его на сервере SharePoint.  
  
#### Методика настройки и развертывания приложения SharePoint  
  
1.  В меню **Анализ** выберите **Запустить мастер производительности**.  
  
2.  На первой странице **Мастера производительности** оставьте в качестве метода профилирования **Выборка циклов ЦП** и нажмите кнопку **Далее**.  
  
     В более сложных случаях профилирования можно использовать другие методы профилирования.  Дополнительные сведения см. в разделе [Общее представление о способах профилирования](../profiling/understanding-performance-collection-methods.md).  
  
3.  На второй странице **Мастера производительности** оставьте в качестве объекта для профилирования **ProfileTest** и нажмите кнопку **Далее**.  
  
     Если решение содержит несколько проектов, они появятся в этом списке.  
  
4.  На третьей странице **Мастера производительности** снимите флажок **Включить профилирование уровневого взаимодействия**, затем нажмите кнопку **Далее**.  
  
     Функция профилирования уровневого взаимодействия \(TIP\) полезна для измерения производительности приложений, которые обращаются к базам данных, и для отображения количества запросов какой\-либо веб\-страницы.  Поскольку эти данные не требуются в данном примере, эта функция не будет использоваться.  
  
5.  На четвертой странице **Мастера производительности** не снимайте флажок **Запустить профилирование после завершения работы мастера** и нажмите кнопку **Готово**.  
  
     Мастер включает профилирование приложения на сервере, отображает окно **Обозреватель производительности**, а затем собирает, развертывает и запускает приложение SharePoint.  
  
##  <a name="BKMK_RunSPApp"></a> Запуск приложения SharePoint  
 Активируйте компонент SharePoint, запустив код события `FeatureActivation`.  
  
#### Запуск приложения SharePoint  
  
1.  В SharePoint откройте меню **Действия сайта**, затем выберите пункт **Параметры сайта**.  
  
2.  В списке **Действия сайта** выберите ссылку **Управление компонентами сайта**.  
  
3.  В списке **Компоненты** нажмите кнопку **Активировать** рядом с **ProfileTest Feature1**.  
  
     При этом возникнет пауза из\-за вызова цикла простоя в функции `FeatureActivated`.  
  
4.  На панели **Быстрый запуск** выберите **Списки**, а затем в списке **Списки** выберите **Извещения**.  
  
     Обратите внимание, что новое извещение о том, что компонент был активирован, добавляется в список.  
  
5.  Закройте сайт SharePoint.  
  
     После закрытия SharePoint профилировщик создает и отображает отчет о профилировании выборки и сохраняет его как vsp\-файл в папке проекта **ProfileTest**.  
  
##  <a name="BKMK_ViewResults"></a> Просмотр и интерпретация результатов профилирования  
 Теперь, после запуска и профилирования приложения SharePoint, просмотрите результаты теста.  
  
#### Просмотр и интерпретация результатов профилирования  
  
1.  В разделе **Функции с максимальной индивидуальной работой** отчета о профилировании выборки обратите внимание на то, что `TimeCounter` находится в верхней части списка.  
  
     Это положение означает, что `TimeCounter` является одной из функций с наибольшим количеством выборок, а значит она — одно из самых узких мест производительности приложения.  Это не удивительно, поскольку она была специально так разработана в демонстрационных целях.  
  
2.  В разделе **Функции с максимальной индивидуальной работой** выберите ссылку `ProcessRequest` для отображения распределения стоимости для функции `ProcessRequest`.  
  
     В разделе **Вызываемые функции** для `ProcessRequest` обратите внимание, что функция **FeatureActiviated** указана как наиболее затратная вызываемая функция.  
  
3.  В разделе **Вызываемые функции** нажмите кнопку **FeatureActivated**.  
  
     В разделе **Вызываемые функции** для **FeatureActivated** функция `TimeCounter` указана как наиболее затратная вызываемая функция.  В области **Представление кода функции** выделенный код \(`TimeCounter`\) является наиболее часто используемым и указывает, где необходимы исправления.  
  
4.  Закройте отчет о профилировании выборки.  
  
     Чтобы еще раз просмотреть отчет в любое время, откройте vsp\-файл в окне **Обозреватель производительности**.  
  
## Исправление кода и перепрофилирование приложения  
 Теперь, когда наиболее часто используемая функция в приложении SharePoint определена, исправьте ее.  
  
#### Исправление кода и перепрофилирование приложения  
  
1.  В коде приемника событий компонента закомментируйте вызов метода `TimeCounter` в `FeatureActivated`, чтобы предотвратить его вызов.  
  
2.  Сохраните проект.  
  
3.  В **Обозревателе производительности** откройте папку целевых объектов, а затем выберите узел **ProfileTest**.  
  
4.  На панели инструментов **Обозревателя производительности** на вкладке **Действия** нажмите кнопку **Запустить профилирование**.  
  
     Если требуется изменить какие\-либо свойства профилирования до перепрофилирования приложения, вместо этого нажмите кнопку **Запустить мастер производительности**.  
  
5.  Следуйте инструкциям в подразделе **Запуск приложения SharePoint**, приведенном выше в этом разделе.  
  
     Теперь, когда вызов цикла простоя устранен, компонент должен активироваться гораздо быстрее.  Отчет о профилировании выборки должен отражать это.  
  
## См. также  
 [Использование средств профилирования](../profiling/performance-explorer.md)   
 [Общие сведения о сеансе анализа производительности средств профилирования](../profiling/performance-session-overview.md)   
 [Руководство по профилированию производительности для начинающих](../profiling/beginners-guide-to-performance-profiling.md)   
 [Поиск ограничений приложений с профилировщиком Visual Studio](http://go.microsoft.com/fwlink/?LinkID=137266)  
  
  