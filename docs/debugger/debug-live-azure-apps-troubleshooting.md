---
title: Устранение неполадок отладки моментальных снимков | Документация Майкрософт
ms.custom: seodec18
ms.date: 11/07/2018
ms.topic: troubleshooting
helpviewer_keywords:
- debugger
ms.assetid: 511a0697-c68a-4988-9e29-8d0166ca044a
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 7b7916cbd3a7faa633baf53a18686779dc2b386c
ms.sourcegitcommit: 53aa5a413717a1b62ca56a5983b6a50f7f0663b3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "58857766"
---
# <a name="troubleshooting-and-known-issues-for-snapshot-debugging-in-visual-studio"></a>Устранение неполадок и известные проблемы отладки моментальных снимков в Visual Studio

Если выполнение действий, описанных в этой статье, не помогло решить проблему, обратитесь в службу snaphelp@microsoft.com.

## <a name="issue-snappoint-does-not-turn-on"></a>Проблема. Точка прикрепления к включению

Если со своей точкой моментальных снимков вместо обычного значка точки моментальных снимков отображается значок предупреждения ![значок предупреждения точки моментальных снимков](../debugger/media/snapshot-troubleshooting-snappoint-warning-icon.png "значок предупреждения точки моментальных снимков"), в таком случае точка моментальных снимков не включается.

![Точка моментальных снимков не включается](../debugger/media/snapshot-troubleshooting-dont-turn-on.png "Точка моментальных снимков не включается")

Выполните следующие шаги.

1. Убедитесь, что у вас та же версия исходного кода, которая использовалась для сборки и развертывания app.isua1. Убедитесь, что вы загружаете правильные символы для развертывания. Для выполнения этого действия во время отладки моментальных снимков откройте окно **Модули** и убедитесь, что в столбце "Файл символов" отображается PDB-файл, загруженный для модуля, который вы отлаживаете. Snapshot Debugger попытается загрузить и использовать символы для вашего развертывания автоматически.

## <a name="issue-symbols-do-not-load-when-i-open-a-snapshot"></a>Проблема. При открытии моментального снимка не загружать символы

Если отображается следующее окно, это означает, что символы не загрузились.

![Символы не загружаются](../debugger/media/snapshot-troubleshooting-symbols-wont-load.png "Символы не загружаются")

Выполните следующие шаги.

- Щелкните ссылку **Изменить параметры символов...** на этой странице. В параметрах **Отладка > Символ** добавьте каталог кэша символов. Перезапустите отладку моментального снимка после задания пути к символам.

   Символы или PDB-файлы, доступные в вашем проекте, должны соответствовать развертыванию Службы приложений. Большинство развертываний (развертывание через Visual Studio, CI/CD с помощью Azure Pipelines или Kudu и т. д.) опубликует ваши файлы символов вместе со Службой приложений. Установка каталога кэша символов позволяет Visual Studio использовать эти символы.

   ![Параметры символов](../debugger/media/snapshot-troubleshooting-symbol-settings.png "Параметры символов")

- В качестве альтернативы, если организация использует сервер символов или удаляет символы в другом пути, используйте параметры символов, чтобы загрузить правильные символы для своего развертывания.

## <a name="issue-i-cannot-see-the-attach-snapshot-debugger-option-in-the-cloud-explorer"></a>Проблема. Я не вижу параметр «Присоединить отладчик моментальных снимков» в Cloud Explorer

Выполните следующие шаги.

- Убедитесь, что компонент Snapshot Debugger установлен. Откройте Visual Studio Installer и проверьте компонент **Snapshot Debugger** в рабочей нагрузке Azure.
::: moniker range="< vs-2019"
- Убедитесь, что ваше приложение поддерживается. В настоящее время поддерживаются только приложения ASP.NET (4.6.1+) и ASP.NET Core (2.0+), развернутые в Службах приложений Azure.
::: moniker-end
::: moniker range=">= vs-2019"
- Убедитесь, что ваше приложение поддерживается.
  - Служба приложений Azure. Приложения ASP.NET, выполняющиеся на платформе .NET Framework 4.6.1 или более поздней версии.
  - Служба приложений Azure. Приложения ASP.NET Core, выполняющиеся на платформе .NET Core 2.0 или более поздней версии под управлением Windows.
  - Виртуальные машины Azure (и масштабируемый набор виртуальных машин). Приложения ASP.NET, выполняющиеся на платформе .NET Framework 4.6.1 или более поздней версии.
  - Виртуальные машины Azure (и масштабируемый набор виртуальных машин). Приложения ASP.NET, выполняющиеся на платформе .NET Core 2.0 или более поздней версии под управлением Windows.
  - Служба Azure Kubernetes. Приложения ASP.NET Core, выполняющиеся на платформе .NET Core 2.2 или более поздней версии под управлением Debian 9.
  - Служба Azure Kubernetes. Приложения ASP.NET Core, выполняющиеся на платформе .NET Core 2.2 или более поздней версии под управлением Alpine 3.8.
  - Служба Azure Kubernetes. Приложения ASP.NET Core, выполняющиеся на платформе .NET Core 2.2 или более поздней версии под управлением Ubuntu 18.04.
::: moniker-end

## <a name="issue-i-only-see-throttled-snapshots-in-the-diagnostic-tools"></a>Проблема. Я вижу только регулирование моментальные снимки в окне средств диагностики

![Регулируемый моментальный снимок](../debugger/media/snapshot-troubleshooting-throttled-snapshots.png "Регулируемый моментальный снимок")

Выполните следующие шаги.

- Моментальные снимки занимают мало памяти, но для них выделяется фиксированное количество памяти. Если Snapshot Debugger обнаружит, что ваш сервер находится под большой нагрузкой памяти, он не будет делать снимки. Вы можете удалить уже полученные снимки, остановив сеанс Snapshot Debugger и повторив попытку.

## <a name="issue-snapshot-debugging-with-multiple-versions-of-the-visual-studio-gives-me-errors"></a>Проблема. Отладка моментальных снимков с несколькими версиями Visual Studio дает мне ошибки

Для VS 2019 необходима более новая версия расширения сайта Snapshot Debugger в Службе приложений Azure.  Эта версия несовместима с более старой версией расширения сайта Snapshot Debugger, используемого VS 2017.  Попытка подключить Snapshot Debugger в VS 2019 к Службе приложений Azure, которая ранее была отлажена Snapshot Debugger в VS 2017, приведет к следующей ошибке.

![Несовместимое расширение сайта Snapshot Debugger VS 2019](../debugger/media/snapshot-troubleshooting-incompatible-vs2019.png "Несовместимое расширение сайта Snapshot Debugger VS 2019")

И наоборот, если вы используете VS 2017 для подключения Snapshot Debugger к Службе приложений Azure, которая ранее была отлажена Snapshot Debugger в VS 2019, это приведет к следующей ошибке.

![Несовместимое расширение сайта Snapshot Debugger VS 2017](../debugger/media/snapshot-troubleshooting-incompatible-vs2017.png "Несовместимое расширение сайта Snapshot Debugger VS 2017")

Чтобы устранить эту проблему, удалите следующие параметры приложения на портале Azure и подключите Snapshot Debugger повторно.

- INSTRUMENTATIONENGINE_EXTENSION_VERSION
- SNAPSHOTDEBUGGER_EXTENSION_VERSION

## <a name="issue-i-am-having-problems-snapshot-debugging-and-i-need-to-enable-more-logging"></a>Проблема. У меня возникли проблемы при отладке моментальных снимков и необходимо включить дополнительные ведения журнала

### <a name="enable-agent-logs"></a>Включение журналов агента

Чтобы включить и отключить ведение журнала агента, откройте Visual Studio и выберите *Средства > Параметры > Snapshot Debugger > Включить ведение журнала агента*. Обратите внимание, что если функция *Удалять старые журналы агента при запуске сеанса* также включена, каждое успешное вложение Visual Studio будет удалять предыдущие журналы агента.

Журналы агентов можно найти в следующей папке.

- Службы приложений.
  - Перейдите на сайт Kudu Службы приложений (то есть yourappservice.**scm**.azurewebsites.net), а затем на консоль отладки.
  - Журналы агента хранятся в следующем каталоге:  D:\home\LogFiles\SiteExtensions\DiagnosticsAgentLogs\
- Виртуальная машина / Масштабируемые наборы виртуальных машин.
  - Войдите на виртуальную Машину, агент, который журналы хранятся следующим образом:  C:\WindowsAzure\Logs\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<Version>\SnapshotDebuggerAgent_*.txt
- AKS
  - Перейдите к следующему каталогу: /tmp/diag/AgentLogs/*

### <a name="enable-profilerinstrumentation-logs"></a>Включите Profiler / Instrumentation Logs (журналы инструментирования)

Журналы инструментирования можно найти в следующей папке.

- Службы приложений.
  - Ведение журнала ошибок будет автоматически отправляться на D:\Home\LogFiles\eventlog.xml, события будут отмечены таким образом: <<Provider Name="Instrumentation Engine" //>> или "Production Breakpoints".
- Виртуальная машина / Масштабируемые наборы виртуальных машин.
  - Войдите на виртуальную машину и откройте "Просмотр событий".
  - Откройте следующее представление: *Журналы Windows > приложение*.
  - *Отфильтруйте текущий журнал* по *источнику события*, используя *производственные точки останова* или *ядро инструментирования*.
- AKS
  - Ведение журнала ядра инструментария происходит на /tmp/diag/log.txt (задается MicrosoftInstrumentationEngine_FileLogPath в DockerFile)
  - Ведение журнала ProductionBreakpoint происходит в /tmp/diag/shLog.txt

## <a name="known-issues"></a>Известные проблемы

- Отладка моментальных снимков с несколькими клиентами Visual Studio в одной и той же Службе приложений в настоящее время не поддерживается.
- Оптимизации Roslyn IL поддерживаются в проектах ASP.NET Core не полностью. В некоторых проектах ASP.NET Core вы не сможете увидеть некоторые переменные или использовать их в условных выражениях.
- Специальные переменные, такие как *$FUNCTION* или *$CALLER*, не могут выполняться в условных операторах или точках ведения журнала для проектов ASP.NET Core.
- Отладка моментальных снимков не работает в службах приложений, в которых включено [локальное кэширование](/azure/app-service/app-service-local-cache).
- Отладка моментальных снимков приложений API в настоящее время не поддерживается.

## <a name="site-extension-upgrade"></a>Обновление расширения сайта

Отладка моментальных снимков и Application Insights зависит от ICorProfiler, который загружается в процесс сайта и вызывает проблемы, состоящие в блокировке файлов во время обновления. Мы рекомендуем выполнить этот процесс, чтобы избежать простоя на производственном сайте.

- Создайте [слот развертывания](/azure/app-service/web-sites-staged-publishing) в Службе приложений и разверните свой сайт в слоте.
- Переключите слот с рабочей средой из Cloud Explorer в Visual Studio или с портала Azure.
- Остановите сайт слота. Завершение процесса сайта w3wp.exe во всех экземплярах займет несколько секунд.
- Обновите расширение сайта слота с сайта Kudu или портала Azure (*колонка "Служба приложений" > Средства разработки > Расширения > Обновление*).
- Запустите сайт слота. Мы рекомендуем посетить сайт, чтобы снова его подготовить.
- Переключите слот с рабочей средой.

## <a name="see-also"></a>См. также

- [Отладка в Visual Studio](../debugger/index.md)
- [Отладка работающих приложений ASP.NET, с помощью отладчика моментальных снимков](../debugger/debug-live-azure-applications.md)
- [Отладка динамического ASP.NET Azure Machines\Virtual машин масштабируемые наборы виртуальных машин с помощью отладчика моментальных снимков](../debugger/debug-live-azure-virtual-machines.md)
- [Отладка с помощью отладчика моментальных снимков Kubernetes динамической ASP.NET в Azure](../debugger/debug-live-azure-kubernetes.md)
- [Ответы на часто задаваемые вопросы по отладке моментальных снимков](../debugger/debug-live-azure-apps-faq.md)