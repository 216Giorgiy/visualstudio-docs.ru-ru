---
title: "Практическое руководство. Отладка оптимизированного кода | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-ide-debug"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "vs.debug"
dev_langs: 
  - "FSharp"
  - "VB"
  - "CSharp"
  - "C++"
  - "C++"
helpviewer_keywords: 
  - "точки останова, в оптимизированном коде"
  - "отладочные построения, оптимизация"
  - "отладка [C++], оптимизированный код"
  - "оптимизация, отладочные построения"
  - "оптимизированный код, отладка"
ms.assetid: fc8eeeb8-6629-4c9b-99f7-2016aee81dff
caps.latest.revision: 25
author: "mikejo5000"
ms.author: "mikejo"
manager: "ghogen"
caps.handback.revision: 25
---
# Практическое руководство. Отладка оптимизированного кода
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

> [!NOTE]
>  Отображаемые диалоговые окна и команды меню могут отличаться от описанных в справке в зависимости от текущих параметров или выпуска.  Чтобы изменить параметры, в меню "Сервис" выберите команду "Импорт и экспорт параметров".  Дополнительные сведения см. в разделе [Customizing Development Settings in Visual Studio](http://msdn.microsoft.com/ru-ru/22c4debb-4e31-47a8-8f19-16f328d7dcd3).  
  
> [!NOTE]
>  Параметр компилятора [\/Zo \(улучшение оптимизированного процесса отладки\)](/visual-cpp/build/reference/zo-enhance-optimized-debugging) и впервые появившийся в Visual Studio с обновлением 3, генерирует расширенные сведения по отладке для оптимизированного кода \(проекты, которые не были собраны с параметром компилятора **\/Od**.  Дополнительные сведения см. в разделе [Параметры \/O \(оптимизация кода\)](/visual-cpp/build/reference/o-options-optimize-code).  Это обеспечивает улучшенную поддержку отладки локальных переменных и встроенных функций.  
>   
>  Когда используется параметр компилятора [\/Zo](../debugger/edit-and-continue-visual-csharp.md), режим **Изменить и продолжить** отключается.  
  
 Когда компилятор оптимизирует код, он перераспределяет и реорганизует инструкции.  Это приводит к повышению эффективности скомпилированного кода.  В связи с этим перераспределением отладчик не всегда может идентифицировать исходный код, соответствующий набору инструкций.  
  
 Оптимизация может повлиять на:  
  
-   Локальные переменные \(могут быть удалены оптимизатором или перемещены в места, недоступные для отладки\).  
  
-   Код внутри функций \(изменяется расположение при слиянии оптимизатором блоков кода\).  
  
-   Имена функций в фреймах стека вызовов \(могут оказаться некорректными при слиянии оптимизатором двух функций\).  
  
 Фреймы в стеке вызовов почти всегда верные, но при условии наличия символов для всех фреймов.  Фреймы в стеке вызовов могут оказаться некорректными при повреждении стека, при наличии функций на ассемблере, или в фреймах операционной системы при отсутствии соответствующих символов в стеке вызовов.  
  
 Глобальные и статические переменные всегда отображаются правильно.  Это же относится к структурным типам.  Если существует указатель на структуру и его значение правильно, каждая переменная\-элемент структуры имеет правильное значение.  
  
 В связи с этими ограничениями следует по возможности отлаживать неоптимизированные версии программы.  По умолчанию оптимизация выключена в конфигурации отладки программы Visual C\+\+ и включена в конфигурации выпуска.  
  
 Тем не менее, ошибка может появиться только в оптимизированной версии программы.  В этом случае отлаживать нужно как раз оптимизированный код.  
  
### Включение оптимизации в конфигурации построения отладки  
  
1.  При создании нового проекта выберите в качестве конечного продукта `Win32 Debug`.  Используйте `Win32``Debug`, пока программа не будет полностью отлажена и готова к созданию сборки `Win32 Release`.  Компилятор не оптимизирует `Win32 Debug`.  
  
2.  Выберите проект в обозревателе решений.  
  
3.  В меню **Вид** выберите команду **Страницы свойств**.  
  
4.  В диалоговом окне **Страницы свойств** убедитесь, что в раскрывающемся списке **Конфигурация** выбран пункт `Debug`.  
  
5.  В окне папок слева выберите папку **C\/C\+\+**.  
  
6.  В папке **C\+\+** выберите пункт `Optimization`.  
  
7.  В списке свойств справа найдите `Optimization`.  Параметр этого свойства скорее всего будет `Disabled (`[\/Od](/visual-cpp/build/reference/od-disable-debug)`)`.  Выберите один из параметров \(`Minimum Size``(`[\/O1](/visual-cpp/build/reference/o1-o2-minimize-size-maximize-speed)`)`, `Maximum Speed``(`[\/O2](/visual-cpp/build/reference/o1-o2-minimize-size-maximize-speed)`)`, `Full Optimization``(`[\/Ox](/visual-cpp/build/reference/ox-full-optimization)`)` или `Custom`\).  
  
8.  Если для свойства `Custom` выбран параметр `Optimization`, это означает, что можно устанавливать параметры для любого из остальных свойств, показанных в списке.  
  
9. Выберите "Свойства конфигурации", "C\/C\+\+", узел "Командная строка" страницы свойств проекта и добавьте `(`[\/Zo](/visual-cpp/build/reference/zo-enhance-optimized-debugging)`)` в текстовое поле **Дополнительные параметры**  
  
    > [!WARNING]
    >  Для использования `/Zo` требуется Visual Studio 2013 с обновлением 3 или более поздняя версия.  
    >   
    >  Добавление параметра `/Zo` приведет к отключению режима [Изменить и продолжить](../debugger/edit-and-continue-visual-csharp.md).  
  
 При отладке оптимизированного кода перейдите в окно **Дизассемблирование**, чтобы просмотреть, какие инструкции в действительности создаются и выполняются.  При задании точек останова следует знать, что они могут двигаться вместе с инструкцией.  Рассмотрим следующий пример кода:  
  
```  
for (x=0; x<10; x++)  
```  
  
 Допустим, точка останова установлена на этой строке.  Можно ожидать, что точка останова будет пройдена 10 раз. Но если код оптимизирован, она будет пройдена всего один раз.  Это связано с тем, что первая инструкция задает для `x` значение 0.  Компилятор распознает, что конкретная инструкция должна быть выполнена один раз, и убирает ее из цикла.  Точка останова перемещается вместе с ней.  Инструкции, которые сравнивают и увеличивают `x`, остаются внутри цикла.  При просмотре окна **Дизассемблирование** для лучшего контроля [размер шага](http://msdn.microsoft.com/ru-ru/8791dac9-64d1-4bb9-b59e-8d59af1833f9) автоматически равен одной инструкции, что бывает полезно при пошаговом прохождении оптимизированного кода.  
  
## См. также  
 [Безопасность отладчика](../debugger/debugger-security.md)   
 [Отладка машинного кода](../debugger/debugging-native-code.md)