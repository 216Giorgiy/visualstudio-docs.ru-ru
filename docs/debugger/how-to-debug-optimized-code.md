---
title: 'Практическое: отладка оптимизированного кода | Документация Майкрософт'
ms.custom: ''
ms.date: 11/04/2016
ms.technology: vs-ide-debug
ms.topic: conceptual
f1_keywords:
- vs.debug
dev_langs:
- CSharp
- VB
- FSharp
- C++
helpviewer_keywords:
- breakpoints, in optimized code
- debugging [C++], optimized code
- optimization, debug builds
- debug builds, optimizing
- optimized code, debugging
ms.assetid: fc8eeeb8-6629-4c9b-99f7-2016aee81dff
author: mikejo5000
ms.author: mikejo
manager: douge
ms.workload:
- multiple
ms.openlocfilehash: 6d6ada3b5375737cb4deec777f64344096fbdaae
ms.sourcegitcommit: 0bf2aff6abe485e3fe940f5344a62a885ad7f44e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/27/2018
ms.locfileid: "37058514"
---
# <a name="how-to-debug-optimized-code"></a>Практическое руководство. Отладка оптимизированного кода
> [!NOTE]
>  Отображаемые диалоговые окна и команды меню могут отличаться от описанных в справке в зависимости от текущих параметров или выпуска. Чтобы изменить параметры, в меню "Сервис" выберите команду "Импорт и экспорт параметров". Дополнительные сведения см. в разделе [Персонализация интегрированной среды разработки Visual Studio](../ide/personalizing-the-visual-studio-ide.md).  
  
> [!NOTE]
>  [/Zo (Enhance Optimized Debugging)](/cpp/build/reference/zo-enhance-optimized-debugging)параметр компилятора (впервые представлено в Visual Studio с обновлением 3) генерирует расширенные сведения по отладке для оптимизированного кода (проекты, которые не были собраны с **/Od** параметр компилятора. См. в разделе [параметры /O (оптимизация кода)](/cpp/build/reference/o-options-optimize-code)). Это обеспечивает улучшенную поддержку отладки локальных переменных и встроенных функций.  
>   
>  [Изменить и продолжить](../debugger/edit-and-continue-visual-csharp.md) отключается **/Zo** используется параметр компилятора.  
  
 Когда компилятор оптимизирует код, он перераспределяет и реорганизует инструкции. Это приводит к повышению эффективности скомпилированного кода. В связи с этим перераспределением отладчик не всегда может идентифицировать исходный код, соответствующий набору инструкций.  
  
 Оптимизация может повлиять на:  
  
-   Локальные переменные (могут быть удалены оптимизатором или перемещены в места, недоступные для отладки).  
  
-   Код внутри функций (изменяется расположение при слиянии оптимизатором блоков кода).  
  
-   Имена функций в фреймах стека вызовов (могут оказаться некорректными при слиянии оптимизатором двух функций).  
  
 Фреймы в стеке вызовов почти всегда верные, но при условии наличия символов для всех фреймов. Фреймы в стеке вызовов могут оказаться некорректными при повреждении стека, при наличии функций на ассемблере, или в фреймах операционной системы при отсутствии соответствующих символов в стеке вызовов.  
  
 Глобальные и статические переменные всегда отображаются правильно. Это же относится к структурным типам. Если существует указатель на структуру и его значение правильно, каждая переменная-элемент структуры имеет правильное значение.  
  
 В связи с этими ограничениями следует по возможности отлаживать неоптимизированные версии программы. По умолчанию оптимизация выключена в конфигурации отладки программы Visual C++ и включена в конфигурации выпуска.  
  
 Тем не менее, ошибка может появиться только в оптимизированной версии программы. В этом случае отлаживать нужно как раз оптимизированный код.  
  
### <a name="to-turn-on-optimization-in-a-debug-build-configuration"></a>Включение оптимизации в конфигурации построения отладки  
  
1.  При создании нового проекта выберите в качестве конечного продукта `Win32 Debug`. Используйте `Win32``Debug` целевой, пока программа не будет полностью отлажена и готова к построению `Win32 Release` целевой объект. Компилятор не оптимизирует `Win32 Debug`.  
  
2.  Выберите проект в обозревателе решений.  
  
3.  На **представление** меню, щелкните **страницы свойств**.  
  
4.  В **страницы свойств** диалогового окна поле, убедитесь, что `Debug` выбран в **конфигурации** стрелку раскрывающегося списка.  
  
5.  В окне папок слева выберите **C/C++** папки.  
  
6.  В разделе **C++** папку, выберите `Optimization`.  
  
7.  В списке свойств справа найдите `Optimization`. Параметр этого свойства скорее всего будет `Disabled (` [/Od](/cpp/build/reference/od-disable-debug)`)`. Выберите один из других параметров (`Minimum Size``(`[/O1](/cpp/build/reference/o1-o2-minimize-size-maximize-speed)`)`, `Maximum Speed``(` [/O2](/cpp/build/reference/o1-o2-minimize-size-maximize-speed)`)`, `Full Optimization``(` [/Ox](/cpp/build/reference/ox-full-optimization) `)`, или `Custom`).  
  
8.  Если для свойства `Custom` выбран параметр `Optimization`, это означает, что можно устанавливать параметры для любого из остальных свойств, показанных в списке.  
  
9. Выберите "Свойства конфигурации", C/C++, узел командной строки, страницы свойств проекта и добавьте `(` [/Zo](/cpp/build/reference/zo-enhance-optimized-debugging) `)` для **Дополнительные параметры** текстовое поле.  
  
    > [!WARNING]
    >  Для использования `/Zo` требуется Visual Studio 2013 с обновлением 3 или более поздняя версия.  
    >   
    >  Добавление `/Zo` приведет к отключению [изменить и продолжить](../debugger/edit-and-continue-visual-csharp.md).  
  
 При отладке оптимизированного кода, использовать **Дизассемблированный код** окно, чтобы просмотреть, какие инструкции в действительности создаются и выполнения. При задании точек останова следует знать, что они могут двигаться вместе с инструкцией. Рассмотрим следующий пример кода:  
  
```cpp
for (x=0; x<10; x++)  
```  
  
 Допустим, точка останова установлена на этой строке. Можно ожидать, что точка останова будет пройдена 10 раз. Но если код оптимизирован, она будет пройдена всего один раз. Это связано с тем, что первая инструкция задает для `x` значение 0. Компилятор распознает, что конкретная инструкция должна быть выполнена один раз, и убирает ее из цикла. Точка останова перемещается вместе с ней. Инструкции, которые сравнивают и увеличивают `x`, остаются внутри цикла. При просмотре **Дизассемблированный код** окне [единицу шага](http://msdn.microsoft.com/en-us/8791dac9-64d1-4bb9-b59e-8d59af1833f9) автоматически равен одной инструкции для большего контроля, что бывает полезно при пошаговом прохождении оптимизированного кода.  
  
## <a name="see-also"></a>См. также  
 [Безопасность отладчика](../debugger/debugger-security.md)   
 [Отладка машинного кода](../debugger/debugging-native-code.md)
