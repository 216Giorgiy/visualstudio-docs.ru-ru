---
title: Установка контрольных значений для переменных в Visual Studio | Документация Майкрософт
ms.custom: H1Hack27Feb2017
ms.date: 10/11/2018
ms.technology: vs-ide-debug
ms.topic: conceptual
f1_keywords:
- vs.debug.watch
helpviewer_keywords:
- debugging [Visual Studio], Watch window
- expressions [debugger], evaluating
- variables [debugger], evaluating
- expression evaluation
- registers, evaluating
- debugging [Visual Studio], expression evaluation
author: mikejo5000
ms.author: mikejo
manager: douge
ms.workload:
- multiple
ms.openlocfilehash: ad08799c0dce3792e096291dfaf62d52e2515df4
ms.sourcegitcommit: 48bc8492973e93612e5afaba3b47d0f98aecf97c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/15/2018
ms.locfileid: "49325020"
---
# <a name="set-a-watch-on-variables-using-the-watch-and-quickwatch-windows-in-visual-studio"></a>Установка контрольных значений для переменных с помощью окна контрольных значений и "Быстрая проверка" в Visual Studio

Во время отладки, можно использовать **Watch** и **"Быстрая проверка"** для наблюдения за переменными и выражениями.  Отличие в том, что в окне **Контрольные значения** могут одновременно выводиться несколько переменных, а в окне **Быстрая проверка** — только одна.

Windows доступны только во время сеанса отладки. Чтобы открыть **Watch** окно, выберите **Отладка** > **Windows** > **Контрольные значения**и нажмите кнопку **Контрольное значение 1**, **Контрольные значения 2**, **Контрольное значение 3**, или **Контрольные значения 4**. Чтобы открыть **"Быстрая проверка"** окна, или щелкните правой кнопкой мыши переменную, а затем выберите **"Быстрая проверка"**, или просто нажмите **Отладка** > **"Быстрая проверка"** .

## <a name="observe-variables-with-the-watch-window"></a>Наблюдать за переменными в окне контрольных значений

Вы можете наблюдать за более чем одной переменной с **Watch** окна. Например, предположим, что имеется следующий код:

```C++
int main()
{
    int a, b, c;
    a = 1;
    b = 2;
    c = 0;

    for (int i = 0; i < 10; i++)
    {
        a++;
        b *= 2;
        c = a + b;
    }

    return 0;
}

```

Добавьте значения трех переменных для **Watch** окно следующим образом:

1. Выберите `c = a + b;` строки.

2. Установите точку останова (выбрав **Отладка** > **точка останова** или нажав клавишу F9).

3. Начните отладку (F5). Выполнение прекратится в точке останова.

4. Откройте **Контрольные значения** окна (выбрав **Отладка** > **Windows** > **Контрольные значения**  >   **Контрольные значения 1**, или нажав клавиши Ctrl + Alt + W, 1).

5. Выберите пустую строку и введите переменной `a`. Затем сделайте то же самое для переменных `b` и `c`.

   ![Наблюдать за переменными](../debugger/media/watchvariables.png "WatchVariables")

6. Продолжайте отладку, при необходимости для развития отладчик, нажав клавишу F11.

В процессе итерации по циклу `for` значения переменных должны меняться.

При программировании в машинном коде, иногда может потребоваться уточнить контекст имени переменной или выражение, содержащее имя переменной. Контекст — это функция, файл исходного кода и модуль, где находится переменная. Если вам нужно определить контекст, можно использовать синтаксис оператора контекста. Дополнительные сведения см. в разделе [(C++) с помощью оператора контекста](../debugger/context-operator-cpp.md).

## <a name="observe-expressions-with-the-watch-window"></a>Обратите внимание, выражения в окне контрольных значений

Теперь давайте попробуем использовать выражение. Добавить можно любое допустимое выражение, которое распознает отладчик.

Например если у вас есть код, приведенный в предыдущем разделе, можно получить с помощью этого выражения среднее трех значений:

![Посмотреть выражение](../debugger/media/watchexpression.png "WatchExpression")

Правила вычисления выражений в **Watch** окно чаще всего это так же, как правила вычисления выражений в используемом языке программирования. Если выражение содержит синтаксическую ошибку, ожидается, что та же ошибка компилятора, которые отображаются в редакторе кода. Ниже приведен пример:

![Просмотрите ошибки выражение](../debugger/media/watchexpressionerror.png "WatchExpressionError")

## <a name="bkmk_refreshWatch"></a> Обновление устаревших контрольных значений

При вычислении выражения в может появиться значок обновления (круговой стрелки) **Watch** окна. Если отключить вычисление свойств (выбрав **средства** > **параметры** > **Отладка**  >   **Общие**, сняв **включить вычисление свойств и другие неявные вызовы функций**), и вы написали следующий код:

```csharp
static void Main(string[] args)
{
    List<string> list = new List<string>();
    list.Add("hello");
    list.Add("goodbye");
}

```

Будет выглядеть приблизительно так: Если установка контрольных значений на `Count` свойства списка:

![RefreshWatch](../debugger/media/refreshwatch.png "RefreshWatch")

Ошибка или значение, устарела на предыдущем рисунке. Значение обычно можно обновить, выбрав значок, но в некоторых случаях вы предпочитаете не делать этого. Во-первых, необходимо знать, почему не было вычислено значение.

Всплывающая подсказка почему выражение не было вычислено при наведении указателя мыши на значок. Если изогнутыми стрелками может отображаться, выражение не было вычислено для одного из следующих причин:

- При вычислении выражения возникла ошибка. Например, истекло время ожидания или переменная находилась вне области действия.

- Выражение содержит вызов функции, который мог вызвать побочный эффект в приложении (см. в разделе [побочные эффекты и выражения](#bkmk_sideEffects) раздел).

- Отключить автоматическое вычисление свойств и неявных вызовов функций отладчиком (выбрав **средства** > **параметры** > **Отладка**  >  **Общие**, сняв **включить вычисление свойств и другие неявные вызовы функций**). Выражение нельзя вычислить автоматически затем.

Чтобы обновить значение, щелкните значок обновления, или нажмите клавишу ПРОБЕЛ. Отладчик попытается пересчитать выражение. Из-за отключения автоматического вычисления свойств и другие неявные вызовы функций, может появиться значок обновления. В этом случае отладчик может вычислять выражения.

Значок может оказаться, что отображается в виде круга с двумя волнистыми линиями, которые похожи на нити. Этот значок означает, что отладчик не вычисляет выражение, из-за потенциальных зависимостей между потоками. Иными словами, для вычисления коду требуется временно запустить другие потоки в приложении. Как правило, при нахождении в режиме приостановки выполнения все потоки в приложении остановлены. Разрешение временного запуска других потоков может привести к непредвиденным результатам, а также привести к тому, что отладчик будет игнорировать различные события, например точки останова и исключения, созданные в этих потоках.

## <a name="bkmk_sideEffects"></a> Побочные эффекты и выражения

Вычисление некоторых выражений может привести к изменению значения некоторой переменной или иным образом повлиять на состояние программы. Например, вычисление следующего выражения изменяет значение `var1`:

```csharp
var1 = var2
```

Этот код может привести к [побочный эффект](https://en.wikipedia.org/wiki/Side_effect_\(computer_science\)). Побочные эффекты могут усложнить отладку из-за изменения способа работы программы.

Выражение имеет побочные эффекты, вычисляется только один раз, при первом его вводе. Дальнейшие вычисления не выполняются. Этот режим можно отменить, щелкнув значок обновления, которое отображается рядом со значением.

Один из способов избежать любых побочных эффектов — отключить автоматическое вычисление функций (выбрав **средства** > **параметры** > **Отладка**  >  **Общие**, сняв **включить вычисление свойств и другие неявные вызовы функций**).

Если вычисление свойств и неявных вызовов функций отключено, можно принудительно вычислить выражение с помощью модификатора формата **ac** (только в C#). См. в разделе [описателях в C#](../debugger/format-specifiers-in-csharp.md).

## <a name="bkmk_objectIds"></a> Использование идентификаторов объектов в окне контрольных значений (C# и Visual Basic)

Иногда необходимо наблюдать за поведением определенного объекта. Например может потребоваться отслеживать объект, на который ссылается локальная переменная после эта переменная вышла за пределы области действия. В C# и Visual Basic, можно создавать идентификаторы объектов для определенных экземпляров ссылочных типов и их использование в **Watch** окно и в условиях точек останова. Идентификатор объекта создается службами отладки среды CLR и связан с объектом.

> [!NOTE]
> Идентификаторы объектов создают слабые ссылки, которые не препятствуют объект от сборщика мусора. Они действительны только в рамках текущего сеанса отладки.

В следующем коде создается один метод `Person` с помощью локальной переменной, но вы хотите узнать, что `Person`его имя — в другом методе:

```csharp
class Person
{
    public Person(string name)
    {
        Name = name;
    }
    public string Name { get; set; }
}

public class Program
{
    static List<Person> _people = new List<Person>();
    public static void Main(string[] args)
    {
        MakePerson();
        DoSomething();
    }

    private static void MakePerson()
    {
        var p = new Person("Bob");
        _people.Add(p);
    }

    private static void DoSomething()
    {
        // more processing
         Console.WriteLine("done");
    }
}

```

Вы можете добавить ссылку на этот объект `Person` в окно **Контрольные значения** , выполнив указанные ниже действия.

1. Выберите строку в коде, который происходит после создания объекта.

2. Установите точку останова (выбрав **Отладка** > **точка останова** или нажав клавишу F9).

3. Приступите к отладке.

4. Когда выполнение остановится в точке останова, откройте **"Локальные"** окна (выбрав **Отладка** > **Windows** > **"Локальные"**), щелкните переменную правой кнопкой мыши и выберите **создать идентификатор объекта**.

   Вы должны увидеть знак доллара (**$**) плюс количество в **"Локальные"** окно, именно это идентификатор объекта.

   > [!NOTE]
   > Если вы хотите увидеть свойства объекта, например `Person.Name`, необходимо включить вычисление свойств, выбрав **средства** > **параметры**  >   **Отладка** > **Общие**, задав **включить вычисление свойств и другие неявные вызовы функций**.

5. Добавьте идентификатор объекта для **Watch** окно, щелкните правой кнопкой мыши знак доллара и номер, а затем выбрав **Добавить контрольное значение**.

6. Установите точку останова, в которой вы хотите наблюдать за поведением объекта.  В приведенном выше коде это место находится внутри `DoSomething()` метод.

7. Продолжайте отладку. Когда выполнение остановится в `DoSomething()` метод, **Watch** окно отображает `Person` объекта.

## <a name="use-registers-in-the-watch-window-c-only"></a>Использование регистров в окне контрольных значений (C++)

Можно добавлять имена регистров и имена переменных с помощью  **$ \<зарегистрировать&nbsp;имя >** или  **@ \<зарегистрировать&nbsp;имя >** при отладке машинного кода. Для получения дополнительной информации см. [Pseudovariables](../debugger/pseudovariables.md).

## <a name="dynamic-view-and-the-watch-window"></a>Динамическое представление и окно контрольных значений

Некоторых скриптовых языках (например, JavaScript или Python) используется динамическая или [типизации по признакам](https://en.wikipedia.org/wiki/Duck_typing), и языках .NET (в версии 4.0 и более поздних) поддерживаются объекты, которые трудно наблюдать с помощью обычных окон отладки, так как они Возможно, среда выполнения свойства и методы, которые нельзя отобразить.

**Watch** окне могут отображаться динамический объект, который создается из типа, который реализует <xref:System.Dynamic.IDynamicMetaObjectProvider> интерфейс. При отображении этого объекта, отладчик добавляет специальный **динамическое представление** дочерний узел имени объекта, если вы откроете **"Видимые"** окно (выбрав **Отладка**  >  **Windows** > **"Видимые"**). Этот узел отображает динамические члены динамического объекта, но не допускает редактирования значений членов.

Для вставки нового контрольного значения переменных, приводит объект к динамическому объекту:

1. Щелкните правой кнопкой мыши любой дочерний **динамическое представление**.
2. Выберите **Добавить контрольное значение**. Затем `object.name` становится `((dynamic) object).name`.

Вычисление членов **динамического представления** может иметь побочные эффекты. Описание того, что такое побочные эффекты, см. в разделе [побочные эффекты и выражения](#bkmk_sideEffects) раздел. Для C# отладчик не автоматически пересчитывает значения, показанные на **динамическое представление** при переходе на новую строку кода. В Visual Basic выражения, добавляемые с помощью **динамического представления** , автоматически обновляются.

Инструкции о том, как обновить **динамическое представление** значения, см. в разделе [обновление контрольных значений, которые являются устаревшими](#bkmk_refreshWatch) раздел.

Если вы хотите отобразить только **динамическое представление** для объекта, можно использовать **динамического** описатель в формата **Watch** окно:

- В C#: `ObjectName, dynamic`
- В Visual Basic: `$dynamic, ObjectName`

**Динамическое представление** также улучшает процесс отладки для COM-объектов. Когда отладчик переходит к COM-объект в оболочку **System.__ComObject**, он добавляет **динамическое представление** узел для объекта.

## <a name="observe-a-single-variable-or-expression-with-quickwatch"></a>Наблюдать за одной переменной или выражения с "Быстрая проверка"

Окно **Быстрая проверка** можно использовать для наблюдения за одной переменной. Например, предположим, что имеется следующий код:

```csharp
static void Main(string[] args)
{
    int a, b;
    a = 1;
    b = 2;
    for (int i = 0; i < 10; i++)
    {
        a = a + b;
    }
}
```

Вы можете наблюдать за переменной в **"Быстрая проверка"** окно следующим образом:

1. Установите точку останова на строке `a = a + b;` .

2. Приступите к отладке. Выполнение прекратится в точке останова.

3. Выберите переменную `a`.

4. Выберите **Отладка** > **"Быстрая проверка"** или нажмите клавишу **Shift + F9**. **"Быстрая проверка"** появится окно. В **значение** », вкладка « `a` переменная отображается со значением 1.

   ![Переменная "Быстрая проверка"](../debugger/media/quickwatchvariable.png "QuickWatchVariable")

   Чтобы оценить выражение, с помощью переменной, введите выражение, например `a + b` для **выражение** поле и нажмите кнопку **пересчитать**.

   ![Выражение "Быстрая проверка"](../debugger/media/quickwatchexpression.png "QuickWatchExpression")

   Чтобы добавить переменную или выражение для **Watch** окна из **"Быстрая проверка"**, выберите **Добавить контрольное значение**.

   > [!NOTE]
   > **"Быстрая проверка"** — это модальное диалоговое окно, поэтому вы не можете продолжать отладку, пока он открыт.

5. Закройте окно **Быстрая проверка** . Теперь вы можете продолжать отладку, наблюдая за значением в окне **Контрольные значения** .

## <a name="see-also"></a>См. также

[Окна отладчика](../debugger/debugger-windows.md)
