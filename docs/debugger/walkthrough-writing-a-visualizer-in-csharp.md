---
title: 'Пошаговое руководство: Написание визуализатора на C# | Документация Майкрософт'
ms.custom: ''
ms.date: 08/01/2018
ms.technology: vs-ide-debug
ms.topic: conceptual
dev_langs:
- CSharp
helpviewer_keywords:
- visualizers, writing
- walkthroughs [Visual Studio], visualizers
ms.assetid: 53467461-8e0f-45ee-9bc4-374bbaeaf00f
author: mikejo5000
ms.author: mikejo
manager: douge
ms.workload:
- dotnet
ms.openlocfilehash: 12a2f16fcf96861df5f3c86f8fe44cb475b9ff23
ms.sourcegitcommit: 0cf1e63b6e0e6a0130668278489b21a6e5038084
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/02/2018
ms.locfileid: "39468498"
---
# <a name="walkthrough-writing-a-visualizer-in-c"></a>Пошаговое руководство. Написание визуализатора на C# #
В данном пошаговом руководстве показано, как написать простой визуализатор, используя C#. Визуализатор, который вы создадите в данном пошаговом руководстве, показывает содержание строки, используя окно сообщений Windows Forms. Этот простой визуализатор строки сам по себе не очень полезен, но он демонстрирует основные действия для создания более полезных визуализаторов других типов данных.  
  
> [!NOTE]
>  Отображаемые диалоговые окна и команды меню могут отличаться от описанных в справке в зависимости от действующих параметров или выпуска среды. Чтобы изменить параметры, перейдите к **средства** меню и выберите **Импорт и экспорт параметров**. Дополнительные сведения см. в разделе [Персонализация интегрированной среды разработки Visual Studio](../ide/personalizing-the-visual-studio-ide.md).  
  
 Код визуализатора должен быть помещен в библиотеку DLL, которая будет читаться отладчиком. Поэтому первым шагом является создание проекта библиотеки классов для библиотеки DLL.  

## <a name="create-a-visualizer-manually"></a>Создать визуализатор вручную

Выполните следующие задачи для создания визуализатора.
  
#### <a name="to-create-a-class-library-project"></a>Создание проекта библиотеки классов  
  
1.  На **файл** меню, выберите **Создать > проект**.  
  
2.  В **новый проект** диалогового **Visual C#**, а затем выберите **.NET Standard**.  
  
3.  В средней области выберите **библиотеки классов**.  
  
4.  В **имя** введите соответствующее имя для библиотеки класса, например MyFirstVisualizer.  
  
5.  Нажмите кнопку **ОК**.  
  
 После создания библиотеки классов необходимо добавить ссылку на Microsoft.VisualStudio.DebuggerVisualizers.DLL, таким образом вы сможете использовать определенные там классы. Однако, перед добавлением ссылки, необходимо присвоить некоторым классам осмысленные имена.  
  
#### <a name="to-rename-class1cs-and-add-microsoftvisualstudiodebuggervisualizers"></a>Чтобы переименовать Class1.cs и добавить Microsoft.VisualStudio.DebuggerVisualizers  
  
1.  В **обозревателе решений**, щелкните правой кнопкой мыши Class1.cs и выберите **Переименовать** в контекстном меню.  
  
2.  Измените имя с Class1.cs на что-нибудь осмысленное, например, DebuggerSide.cs.  
  
    > [!NOTE]
    >  [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] автоматически изменяет объявление класса в DebuggerSide.cs, чтобы оно соответствовало новому имени файла.  
  
3.  В **обозревателе решений**, щелкните правой кнопкой мыши **ссылки** и выберите **добавить ссылку** в контекстном меню.  
  
4.  В **добавить ссылку** диалоговом окне **.NET** вкладке, выберите Microsoft.VisualStudio.DebuggerVisualizers.DLL.  
  
5.  Нажмите кнопку **ОК**.  
  
6.  В файле DebuggerSide.cs добавьте следующий оператор к операторам `using`:  
  
    ```csharp  
    using Microsoft.VisualStudio.DebuggerVisualizers;  
    ```  
  
 Теперь можно приступить к написанию отладочной части кода. Этот код запускается отладчиком для отображения информации, которую требуется визуализировать. Прежде всего необходимо изменить объявление объекта `DebuggerSide` таким образом, чтобы он наследовал базовый класс `DialogDebuggerVisualizer`.  
  
#### <a name="to-inherit-from-dialogdebuggervisualizer"></a>Наследование от DialogDebuggerVisualizer  
  
1.  В DebuggerSide.cs перейдите к следующей строке кода:  
  
    ```csharp  
    public class DebuggerSide  
    ```  
  
2.  Измените код на:  
  
    ```csharp  
    public class DebuggerSide : DialogDebuggerVisualizer  
    ```  
  
 `DialogDebuggerVisualizer` имеет один абстрактный метод — `Show` — который необходимо переопределить.  
  
#### <a name="to-override-the-dialogdebuggervisualizershow-method"></a>Переопределение метода DialogDebuggerVisualizer.Show  
  
-   В `public class DebuggerSide`, добавьте следующий **метод:**  
  
    ```csharp  
    protected override void Show(IDialogVisualizerService windowService, IVisualizerObjectProvider objectProvider)  
    {  
    }  
    ```  
  
 Метод `Show` содержит код, который фактически создает диалоговое окно визуализатора или другой интерфейс пользователя и отображает сведения, которые были переданы визуализатору из отладчика. Необходимо вручную добавить код, который создает диалоговое окно и отображает информацию. В данном пошаговом руководстве используется окно сообщения Windows Forms. Прежде всего необходимо добавить ссылку и инструкцию `using` для System.Windows.Forms.  
  
#### <a name="to-add-systemwindowsforms"></a>Добавление пространства имен System.Windows.Forms  
  
1.  В **обозревателе решений**, щелкните правой кнопкой мыши **ссылки** и выберите **добавить ссылку** в контекстном меню.  
  
2.  В **добавить ссылку** диалоговом окне **.NET** вкладке, выберите System.Windows.Forms.DLL.  
  
3.  Нажмите кнопку **ОК**.  
  
4.  В файле DebuggerSide.cs добавьте следующий оператор к операторам `using`:  
  
    ```csharp  
    using System.Windows.Forms;  
    ```  
  
 Сейчас необходимо добавить некоторый код для создания и отображения пользовательского интерфейса визуализатора. Поскольку это первый визуализатор, то ограничимся написанием простого пользовательского интерфейса и используем окно сообщения.  
  
#### <a name="to-show-the-visualizer-output-in-a-dialog-box"></a>Чтобы отобразить выходные данные визуализатора в диалоговом окне  
  
1.  Добавьте следующую строку кода в метод `Show`:  
  
    ```csharp  
    MessageBox.Show(objectProvider.GetObject().ToString());  
    ```  
  
     В этом примере отсутствует код для обработки ошибок. Следует включать обработку ошибок в настоящем визуализаторе или в любом другом типе приложений.  
  
2.  На **построения** меню, выберите **построить MyFirstVisualizer**. Построение проекта должно пройти без ошибок. Если при построении все же возникнут ошибки, исправьте их, прежде чем продолжить.  
  
 Отладочная часть кода написана. Тем не менее, необходимо выполнить еще одно действие: добавить атрибут, который сообщает отлаживаемому коду, какой набор классов формирует визуализатор.  
  
#### <a name="to-add-the-debuggee-side-code"></a>Чтобы добавить код отлаживаемого объекта  
  
1.  Добавьте следующий код атрибута в DebuggerSide.cs — после операторов `using`, но перед `namespace MyFirstVisualizer`:  
  
    ```csharp  
    [assembly:System.Diagnostics.DebuggerVisualizer(  
    typeof(MyFirstVisualizer.DebuggerSide),  
    typeof(VisualizerObjectSource),  
    Target = typeof(System.String),  
    Description = "My First Visualizer")]  
    ```  
  
2.  На **построения** меню, выберите **построить MyFirstVisualizer**. Построение проекта должно пройти без ошибок. Если при построении все же возникнут ошибки, исправьте их, прежде чем продолжить.  
  
 На этом написание вашего первого визуализатора окончено. Если вы правильно следовали описанной выше процедуре, можно построить визуализатор и установить его в [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)]. Однако перед установкой визуализатора в [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] следует проверить, что он работает правильно. Для этого следует создать тестовое окружение, в котором визуализатор будет запускаться без установки в [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)].  
  
#### <a name="to-add-a-test-method-to-show-the-visualizer"></a>Чтобы добавить тестовый метод для запуска визуализатора  
  
1.  Добавьте следующий метод в класс `public DebuggerSide`:  
  
    ```csharp  
    public static void TestShowVisualizer(object objectToVisualize)  
    {  
       VisualizerDevelopmentHost visualizerHost = new VisualizerDevelopmentHost(objectToVisualize, typeof(DebuggerSide));  
       visualizerHost.ShowVisualizer();  
    }  
    ```  
  
2.  На **построения** меню, выберите **построить MyFirstVisualizer**. Построение проекта должно пройти без ошибок. Если при построении все же возникнут ошибки, исправьте их, прежде чем продолжить.  
  
 Далее необходимо создать проект исполняемого файла, из которого будет вызваться библиотека DLL визуализатора. Для простоты используем проект консольного приложения.  
  
#### <a name="to-add-a-console-application-project-to-the-solution"></a>Добавление проекта консольного приложения в решение  
  
1.  На **файл** меню, выберите **добавить** и нажмите кнопку **новый проект**.  
  
2.  В **Добавление нового проекта** диалоговое окно, выберите **Visual C#** > **Windows Desktop**и нажмите кнопку **консольное приложение**.  
  
3.  В **имя** введите понятное имя для консольного приложения, такие как `MyTestConsole`.  
  
4.  Нажмите кнопку **ОК**.  
  
 Теперь необходимо добавить необходимые ссылки, чтобы программа MyTestConsole могла вызывать MyFirstVisualizer.  
  
#### <a name="to-add-necessary-references-to-mytestconsole"></a>Добавление необходимых ссылок в MyTestConsole  
  
1.  В **обозревателе решений**, щелкните правой кнопкой мыши **MyTestConsole** и выберите **добавить ссылку** в контекстном меню.  
  
2.  В **добавить ссылку** диалоговом окне **.NET** вкладке, выберите Microsoft.VisualStudio.DebuggerVisualizers.DLL.  
  
3.  Нажмите кнопку **ОК**.  
  
4.  Щелкните правой кнопкой мыши **MyTestConsole** и выберите **добавить ссылку** еще раз.  
  
5.  В **добавить ссылку** диалоговом окне щелкните **проекты** вкладку и выберите MyFirstVisualizer.  
  
6.  Нажмите кнопку **ОК**.  
  
 Теперь нужно добавить код, которым завершится создание тестового окружения.  
  
#### <a name="to-add-code-to-mytestconsole"></a>Добавление кода в MyTestConsole  
  
1.  В **обозревателе решений**, щелкните правой кнопкой мыши Program.cs и выберите **Переименовать** в контекстном меню.  
  
2.  Измените имя c Program.cs на что-нибудь более понятное, например на TestConsole.cs.  
  
     **Примечание** [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] автоматически изменяет объявление класса в TestConsole.cs в соответствии с новым именем файла.  
  
3.  В TestConsole.cs добавьте следующий код к инструкциям `using`:  
  
    ```csharp  
    using MyFirstVisualizer;  
    ```  
  
4.  В метод `Main` добавьте следующий код:  
  
    ```csharp  
    String myString = "Hello, World";  
    DebuggerSide.TestShowVisualizer(myString);  
    ```  
  
 Теперь все готово для проверки вашего первого визуализатора.  
  
#### <a name="to-test-the-visualizer"></a>Тестирование визуализатора  
  
1.  В **обозревателе решений**, щелкните правой кнопкой мыши **MyTestConsole** и выберите **Назначить запускаемым проектом** в контекстном меню.  
  
2.  На **Отладка** меню, выберите **запустить**.  
  
     Запускается консольное приложение, визуализатор появляется и отображает строку "Hello, World".  
  
 Поздравляем! Вы только что создали и протестировали ваш первый визуализатор.  
  
 Если вам удобнее вызывать визуализатор из [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)], а не из специально подготовленной тестовой программы, визуализатор необходимо установить. Дополнительные сведения см. в разделе [как: Установка визуализатора](../debugger/how-to-install-a-visualizer.md).  
  
## <a name="create-a-visualizer-using-the-visualizer-item-template"></a>Создать визуализатор, с помощью шаблона элемента визуализатора  
 На данном пошаговом руководстве было рассмотрено, как создать визуализатор вручную. Это было сделано в качестве упражнения для обучения. Теперь, когда вы знаете, как работает простой визуализатор, можно создать его проще — с помощью шаблона элемента визуализатора.  
  
 Во–первых, необходимо создать новый проект библиотеки классов.  
  
#### <a name="to-create-a-new-class-library"></a>Чтобы создать новую библиотеку классов  
  
1.  На **файл** меню, выберите **Создать > проект**.  
  
2.  В **новый проект** диалогового **Visual C#** выберите **.NET Standard**.  
  
3.  В средней области выберите **библиотеки классов**.   
  
4.  В **имя** введите соответствующее имя для библиотеки класса, например MySecondVisualizer.  
  
5.  Нажмите кнопку **ОК**.  
  
 Теперь можно добавить элемент визуализатора.  
  
#### <a name="to-add-a-visualizer-item"></a>Чтобы добавить элемент визуализатора  
  
1.  В **обозревателе решений**, щелкните правой кнопкой мыши MySecondVisualizer.  
  
2.  В контекстном меню выберите **добавить** и нажмите кнопку **новый элемент**.  
  
3.  В **Добавление нового элемента** диалогового **элементы Visual C#** выберите **визуализатор отладчика**.  
  
4.  В **имя** введите соответствующее имя, например SecondVisualizer.cs.  
  
5.  Нажмите кнопку **Добавить**.  
  
 Вот и все, что нужно! Просмотрите файл SecondVisualizer.cs для изучения кода, добавленного шаблоном. Можете поэкспериментировать с кодом. Теперь, когда вы изучили основы, вы сможете в будущем создавать свои собственные более сложные и полезные визуализаторы.  
  
## <a name="see-also"></a>См. также  
 [Архитектура визуализатора](../debugger/visualizer-architecture.md)   
 [Практическое: Установка визуализатора](../debugger/how-to-install-a-visualizer.md)   
 [Создание настраиваемых визуализаторов](../debugger/create-custom-visualizers-of-data.md)
