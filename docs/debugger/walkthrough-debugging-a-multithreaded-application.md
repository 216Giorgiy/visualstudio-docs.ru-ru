---
title: "Пошаговое руководство. Отладка многопоточных приложений | Microsoft Docs"
ms.custom: ""
ms.date: "12/16/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-ide-debug"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "FSharp"
  - "VB"
  - "CSharp"
  - "C++"
helpviewer_keywords: 
  - "многопотоковая отладка, пошаговое руководство"
  - "пошаговые руководства, многопотоковая отладка"
ms.assetid: 590ffd57-0556-43d8-8962-ee27e5b2b7d7
caps.latest.revision: 38
caps.handback.revision: 38
author: "mikejo5000"
ms.author: "mikejo"
manager: "ghogen"
---
# Пошаговое руководство. Отладка многопоточных приложений
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

[!INCLUDE[vs_dev11_long](../data-tools/includes/vs_dev11_long_md.md)] предоставляет улучшенное окно **Потоки** и другие улучшения пользовательского интерфейса для облегчения отладки многопоточных приложений.  Выполнение данного пошагового руководства занимает лишь несколько минут, но оно позволит ознакомиться с новыми возможностями интерфейса для отладки многопоточных приложений.  
  
 Чтобы начать работу с данным пошаговым руководством, необходим проект многопоточного приложения.  Выполните следующие действия для создания этого проекта.  
  
#### Чтобы создать проект для пошагового руководства  
  
1.  В меню **Файл** выберите команду **Создать** и нажмите кнопку **Проект**.  
  
     Откроется диалоговое окно **Создание проекта**.  
  
2.  В диалоговом окне **Типы проекта** выберите необходимый язык: **Visual Basic**, **Visual C\#** или **Visual C\+\+**.  
  
3.  В окне **Шаблоны** выберите пункт **Консольное приложение** или **Консольное приложение CLR**.  
  
4.  В поле **Имя** введите "MyThreadWalkthroughApp".  
  
5.  Нажмите кнопку **ОК**.  
  
     Появится новый проект консольного приложения.  Когда проект будет создан, откроется файл исходного кода.  В зависимости от выбранного языка файл исходного кода может называться Module1.vb, Program.cs или MyThreadWalkthroughApp.cpp  
  
6.  Удалите код, существующий в файле исходного кода, и замените его кодом примера, который рассматривается в подразделе "Создание потока" раздела [Creating Threads and Passing Data at Start Time](../Topic/Creating%20Threads%20and%20Passing%20Data%20at%20Start%20Time.md).  
  
7.  В меню **Файл** выберите команду **Сохранить все**.  
  
#### Чтобы начать работу над пошаговым руководством  
  
-   В окне исходного кода найдите следующий код:  
  
    ```vb  
    Thread.Sleep(3000)   
    Console.WriteLine(  
    ```  
  
```c#  
Thread.Sleep(3000);  
Console.WriteLine();  
```  
  
```cpp  
Thread::Sleep(3000);  
Console.WriteLine();  
```  
  
#### Начало отладки  
  
1.  Щелкните правой кнопкой мыши инструкцию `Console.WriteLine`, выберите пункт **точка останова** а затем команду **Вставить точка останова**.  
  
     В левом переплете окна исходного кода появится красный шар.  Это означает, что точка останова установлена в этом месте.  
  
2.  В меню **Отладка** щелкните **Начать отладку**.  
  
     Начнется отладка, консольное приложение запустится и прервется на точке останова.  
  
3.  Если в этот момент фокус находится на окне консольного приложения, щелкните окно [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] для возвращения фокуса в [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)].  
  
4.  В окне исходного кода найдите строку, содержащую следующий код:  
  
    ```vb  
    Thread.Sleep(5000)   
    ```  
  
```c#  
Thread.Sleep(3000);  
```  
  
```cpp  
Thread::Sleep(3000);  
```  
  
#### Чтобы обнаружить маркер потока  
  
1.  Щелкните правой кнопкой мыши в окне **Потоки** и выберите команду **Показать потоки в исходном коде**.  
  
2.  Посмотрите на переплет в левой части окна.  На этой строке появится значок, похожий на 2 тряпичных нити.  Одна нить красного цвета, другая — синего.  маркер потока указывает, что некий поток остановлен в этом месте.  Возможно, в данном месте остановлен наш поток.  
  
3.  Наведите указатель мыши на маркер потока.  Появится всплывающая подсказка.  Подсказка сообщает имя и идентификационный номер каждого остановившегося тут потока.  В нашем случае существует только один поток, имя которого, вероятно, `<noname>`.  
  
4.  Щелкните правой кнопкой мыши маркер потока.  Обратите внимание на варианты выбора в контекстном меню.  
  
 Этот значок — *маркер потока*:  
  
 ![Метка потока](../debugger/media/threadmarker.png "ThreadMarker")  
  
## Пометка потоков и ее снятие  
 В [!INCLUDE[vs_orcas_long](../debugger/includes/vs_orcas_long_md.md)] можно пометить поток, которому следует уделить особое внимание.  Пометка потоков — хороший способ отслеживать более важные потоки и игнорировать менее важные.  
  
#### Чтобы пометить потоки  
  
1.  В меню **Вид** выберите **Панели инструментов**.  
  
     Убедитесь, что панель инструментов **Место отладки** выбрана.  
  
2.  Перейдите к панели инструментов **Место отладки** и щелкните список **Поток**.  
  
    > [!NOTE]
    >  Эту панель инструментов можно узнать по трем заметным спискам: **Процесс**, **Поток** и **Стек вызова**.  
  
3.  Обратите внимание, сколько потоков отображается в списке.  
  
4.  Вернитесь в окно исходного кода и снова щелкните правой кнопкой мыши маркер **Поток**.  
  
5.  В контекстном меню выберите **Флаг** и затем щелкните имя и ИД потока.  
  
6.  Вернитесь обратно к панели инструментов **Место отладки** и снова щелкните список **Поток**.  
  
     Теперь в списке отображаются только отмеченные потоки.  Кнопка флага находится справа от списка **Поток**.  Значок флага на кнопке ранее был тусклым.  Теперь у него ярко–красная окраска.  
  
7.  Наведите указатель мыши на значок флага.  
  
     Появится всплывающее окно.  Это всплывающее окно сообщает, в каком режиме отображается список **Поток**: **Показывать только отмеченные потоки**.  
  
8.  Нажмите кнопку флага для переключения обратно в режим **Показывать все потоки**.  
  
9. Снова щелкните список **Поток** и убедитесь, что теперь снова отображаются все потоки.  
  
10. Нажмите кнопку флага для переключения обратно в режим **Показывать только отмеченные потоки**.  
  
11. В меню **Отладка** выберите пункт **Окна** и затем щелкните **Потоки**.  
  
     Появится окно **Потоки**.  К одному потоку прикреплен заметный значок флага.  
  
12. В окне исходного кода щелкните правой кнопкой мыши маркер потока еще раз.  
  
     Обратите внимание, какие варианты сейчас доступны в контекстном меню.  Вместо **Пометить** теперь отображается пункт **Снять отметку**.  Не нажимайте кнопку **Снять отметку**.  
  
13. Перейдите к следующему шагу — как снять отметку с потока.  
  
#### Чтобы снять отметку с потока  
  
1.  В окне **Потоки** щелкните правой кнопкой мыши строку, соответствующую отмеченному потоку.  
  
     Появится контекстное меню.  В нем представлены варианты **Снять отметку** и **Снять все отметки**.  
  
2.  Чтобы снять отметку с потока, щелкните **Снять отметку**.  
  
3.  Щелкните значок красного флажка.  
  
4.  Посмотрите на панель инструментов **Место отладки** еще раз.  Кнопка флага снова стала тусклой.  Вы сняли отметку с только что отмеченного потока.  Поскольку отсутствуют отмеченные потоки, панель инструментов вернулась в режим **Показывать все потоки**.  Щелкните список **Поток** и убедитесь, что отображаются все потоки.  
  
5.  Вернитесь к окну **Потоки** и просмотрите колонки сведений.  
  
     В верхней части каждой колонки большая часть кнопок имеет заголовки, которые идентифицируют колонку.  Однако первый столбец слева не имеет заголовка.  Вместо этого он имеет значок, являющийся контуром флага.  Можно заметить тот же контур в каждой строке списка потоков.  Контур означает, что поток не отмечен.  
  
6.  Щелкните контуры флагов у двух потоков, второго и третьего снизу в списке.  
  
     Вместо контуров будут отображаться значки красных флагов.  
  
7.  Нажмите кнопку в заголовке колонки флагов.  
  
     Порядок в списке потоков изменился, когда была нажата кнопка.  Список потоков теперь отсортирован так, что отмеченные потоки располагаются в верху списка.  
  
8.  Снова нажмите кнопку в заголовке колонки флагов.  
  
     Порядок сортировки изменился еще раз.  
  
## Дополнительные сведения об окне "Потоки"  
  
#### Чтобы получить дополнительные сведения об окне "Потоки"  
  
1.  В окне  **Потоки** просмотрите третий столбец слева.  Кнопка в верхней части этого столбца называется **ID**.  
  
2.  Нажмите кнопку **ID**.  
  
     Теперь список потоков отсортирован по идентификатору потока.  
  
3.  Щелкните правой кнопкой мыши любой поток в списке.  В контекстном меню выберите команду **Шестнадцатеричный вывод**.  
  
     Формат идентификаторов потоков изменился.  
  
4.  Наведите указатель мыши на любой поток в списке.  
  
     После небольшой задержки появится Подсказка Данных.  Она отображает частичный стек вызова для этого потока.  
  
5.  Просмотрите четвертый столбец слева, который называется **Категория**.  Потоки делятся на категории.  
  
     Первый поток, созданный в процессе, называется "основной поток".  Найдите его в списке потоков.  
  
6.  Щелкните правой кнопкой мыши основной поток и выберите **Переключиться на поток**.  
  
     Появится диалоговое окно с предупреждением.  Оно сообщает, что [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] не может отобразить исходный код для основного потока.  
  
     Нажмите кнопку **ОК**.  
  
7.  Посмотрите на окно **Стек вызовов** и панель инструментов **Место отладки**.  
  
     Содержимое окна **Стек вызовов** изменилось.  
  
## Переключение активного потока  
  
#### Чтобы переключаться между потоками  
  
1.  В окне **Потоки** просмотрите второй столбец слева.  Кнопка в верхней части этого столбца не содержит текста или значка.  Этот столбец является столбцом **Активный поток**.  
  
2.  Просмотрите столбец **Активный поток** и обратите внимание на то, что у одного потока есть желтая стрелка.  Это *индикатор активного потока*.  
  
3.  Запишите идентификатор потока, на котором установлен индикатор активного потока.  Индикатор активного потока будет перемещен на другой поток, но после завершения его необходимо будет вернуть.  
  
4.  Щелкните правой кнопкой мыши другой поток и выберите пункт **Переключиться на поток**.  
  
5.  Посмотрите на окно **Стек вызовов** в окне исходного кода.  Его содержимое изменилось.  
  
6.  Посмотрите на панель инструментов **Место отладки**.  Здесь активный поток тоже был изменен.  
  
7.  Перейдите к панели инструментов **Место отладки**.  Щелкните поле **Поток** и выберите другой поток из раскрывающегося списка.  
  
8.  Посмотрите на окно **Потоки**.  Здесь изменился индикатор активного потока.  
  
9. В окне исходного кода щелкните правой кнопкой мыши маркер потока.  В контекстном меню выберите **Переключиться на** и затем выберите имя или идентификатор потока.  
  
     Было рассмотрено три способа изменения активного потока: с помощью окна **Потоки**, поля **Поток** в панели инструментов **Место отладки**, а также индикатора потока в окне исходного кода.  
  
     С помощью индикатора потока можно переключаться только на потоки, остановленные в этом конкретном расположении.  С помощью окна **Потоки** и панели инструментов **Место отладки** можно переключиться на любой поток.  
  
## Замораживание и размораживание потоков  
  
#### Чтобы заморозить и разморозить потоки  
  
1.  В окне **Потоки** щелкните правой кнопкой мыши любой поток и нажмите кнопку **Заморозить**.  
  
2.  Посмотрите на столбец "Активный поток".  В нем появилась пара вертикальных полос.  Эти две синие полосы указывают, что поток заморожен.  
  
3.  Посмотрите на столбец **Приостановлен**.  Счетчик приостановки для потока теперь имеет значение 1.  
  
4.  Щелкните правой кнопкой мыши замороженный поток и выберите команду **Разморозить**.  
  
     Столбцы "Активный поток" и **Приостановлен** изменятся.  
  
## См. также  
 [Отладка многопоточных приложений](../debugger/debug-multithreaded-applications-in-visual-studio.md)   
 [Практическое руководство. Переключение на другой поток при отладке](../debugger/how-to-switch-to-another-thread-while-debugging.md)