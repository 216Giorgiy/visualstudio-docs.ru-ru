---
title: "Практическое руководство. Создание меню, подменю и контекстных меню | Microsoft Docs"
ms.custom: ""
ms.date: "12/15/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-csharp"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "панели команд, архитектура"
  - "меню, создание"
  - "меню, архитектура"
  - "команды, меню"
  - "меню"
ms.assetid: 62004fd9-7f99-4f00-8d01-1dde53e23dbb
caps.latest.revision: 46
caps.handback.revision: 46
manager: "douge"
---
# Практическое руководство. Создание меню, подменю и контекстных меню
Чтобы добавить меню в интегрированную среду разработки Visual Studio \(IDE\), VSPackage должен использовать архитектуру [!INCLUDE[vsipsdk](../extensibility/includes/vsipsdk_md.md)] для меню групп команд. Меню групп команд позволяет совместное использование команд компонентами и IDE. Дополнительные сведения о меню групп команд см. в разделе [Как добавить элементы пользовательского интерфейса в пакеты VSPackage](../extensibility/internals/how-vspackages-add-user-interface-elements.md).  
  
 В пакетах VSPackage меню задаются в разделе [Menus](../extensibility/menus-element.md) VSCT\-файла. VSCT\-файл задает меню, панели инструментов, группы и команды. Команда — это то, что щелкает пользователь для выполнения функции. Группа — это контейнер для команд. Меню — это контейнер для групп. Чтобы создать базовое меню, вы должны создать меню, группу команд и хотя бы одну команду.  
  
 Существует три основных способа отображения меню в [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)]:  
  
-   как меню в главной строке меню;  
  
-   как подменю другого меню;  
  
-   как контекстное меню \(как правило, отображаемое при щелчке правой кнопкой мыши\).  
  
 В этом разделе показано, как создать каждый вид меню. Также это показывается в следующих пошаговых руководствах.  
  
-   [Добавление меню в строке меню Visual Studio](../extensibility/adding-a-menu-to-the-visual-studio-menu-bar.md)  
  
-   [Добавление подменю в меню](../extensibility/adding-a-submenu-to-a-menu.md)  
  
-   [Добавление контекстного меню в окне инструментов](../extensibility/adding-a-shortcut-menu-in-a-tool-window.md)  
  
### Создание меню, подменю или контекстного меню  
  
1.  В своем проекте дважды щелкните VSCT\-файл, чтобы открыть его в редакторе.  
  
     Если в проекте отсутствует VSCT\-файл, добавьте его. При создании пакета с помощью шаблона пакета Visual Studio выберите **Команда меню**; это создаст VSCT\-файл.  
  
2.  В разделе `Symbols` найдите элемент [GuidSymbol](../extensibility/guidsymbol-element.md), содержащий группы и команды.  
  
3.  Создайте по элементу [IDSymbol](../extensibility/idsymbol-element.md) для каждого меню, группы и команды, которые нужно добавить, как показано в следующем примере.  
  
     [!CODE [ButtonGroup#01](../CodeSnippet/VS_Snippets_VSSDK/buttongroup#01)]  
  
     Атрибуты `name` элементов `GuidSymbol` и `IDSymbol` предоставляют пару GUID:ID для каждого нового меню, группы или команды.`GUID` представляет набор команд, определенных для вашего VSPackage. Можно определить несколько наборов команд. Каждая пара GUID:ID должна быть уникальной.  
  
4.  Определите новое меню в разделе `Menus` следующим образом.  
  
    1.  Задайте поля `guid` и `id`, чтобы они соответствовали GUID:ID нового меню.  
  
    2.  Задайте атрибут `priority`.  
  
         Атрибут `priority` используется VSCT\-файлом для определения расположения меню среди других объектов в родительской группе.  
  
         Меню, имеющие более низкий приоритет, отображаются перед меню с более высоким приоритетом. Одинаковые значения приоритета разрешены, но относительное расположение меню с одинаковым приоритетом определяется порядком, в котором пакеты VSPackage обрабатываются во время выполнения, и этот порядок нельзя определить заранее. Если атрибут `priority` пропустить, он получает значение 0.  
  
         Не устанавливайте приоритет для контекстного меню, поскольку его размещение определяется кодом, который его вызывает.  
  
    3.  Для меню и подменю установите в атрибуте `type` значение `Menu`, которое описывает обычное меню. Для контекстных меню установите в атрибуте `type` значение `Context`.  
  
         Описания других допустимых типов меню, таких как панели инструментов и контроллеры меню, см. в разделе [Элемент меню](../extensibility/menu-element.md).  
  
    4.  В определении меню создайте раздел [Strings](../extensibility/strings-element.md), включающий элемент [ButtonText](../extensibility/buttontext-element.md), который содержит имя меню, отображаемое в IDE, и элемент [CommandName](../extensibility/commandname-element.md), который содержит имя команды, используемой для доступа к этому меню в окне **Команда**.  
  
         Если строка текста кнопки содержит символ "&", пользователь может открыть меню, нажав клавишу ALT и клавишу с символом после "&".  
  
    5.  Добавьте флаги команды, чтобы соответствующим образом изменить внешний вид и поведение меню. Для этого добавьте элемент [CommandFlag](../extensibility/command-flag-element.md) элемент в определение меню. Для получения дополнительной информации см. [Элемент Command флаг](../extensibility/command-flag-element.md).  
  
5.  Установите родительский объект меню. Для стандартного меню или подменю сделайте это одним из следующих способов, в зависимости от макета.  
  
    -   В элементе `Menu` создайте элемент [Parent](../extensibility/parent-element.md) и укажите в его полях `guid` и `id` значения GUID:ID группы, где будет размещаться меню; эта группа также называется *основной родительской группой*. Родительская группа может быть группой, созданной в разделе `Symbols`, группой из другого пакета или группой из IDE. Например, чтобы добавить меню в строку меню верхнего уровня IDE, рядом с меню **Средства**, в качестве родительского объекта задайте guidSHLMainMenu:IDG\_VS\_MM\_TOOLSADDINS.  
  
         В следующем примере показано меню, которое будет отображаться в строке меню Visual Studio.  
  
         [!CODE [TopLevelMenu#01](../CodeSnippet/VS_Snippets_VSSDK/toplevelmenu#01)]  
  
    -   Если меню будет размещаться с помощью команд размещения, элемент `Parent` можно опустить. Создайте раздел [CommandPlacements](../extensibility/commandplacements-element.md) перед разделом `Symbols` и добавьте элемент [CommandPlacement](../extensibility/commandplacement-element.md), имеющий GUID:ID меню, приоритет и родительский объект, как показано в следующем примере.  
  
         [!CODE [ButtonGroup#04](../CodeSnippet/VS_Snippets_VSSDK/buttongroup#04)]  
  
         Если создать несколько размещений команд, имеющих одинаковые пары GUID:ID и разные родительские группы, меню будет отображаться в нескольких местах. Для получения дополнительной информации см. [Элемент CommandPlacements](../extensibility/commandplacements-element.md).  
  
     Стандартные меню в качестве родительского объекта должны иметь группу в строке меню Visual Studio. Для подменю родительским объектом должна быть группа в другом меню \(или в панели инструментов, или в меню другого типа\). Чтобы меню или подменю отображалось, оно должно иметь группу, содержащую по крайней мере одну активную команду, или иметь установленный флаг команды `AlwaysCreate`.  
  
     Контекстные меню не имеют родительские объекты и команды размещения. Вместо этого их необходимо активировать в коде. Как правило, контекстное меню активируется в ответ на щелчок правой кнопкой мыши на поверхности элемента управления. В следующем примере определяется контекстное меню.  
  
     [!CODE [ButtonGroup#06](../CodeSnippet/VS_Snippets_VSSDK/buttongroup#06)]  
  
6.  В разделе [Groups](../extensibility/groups-element.md) создайте элемент [Group](../extensibility/group-element.md), который будет содержать команды, отображаемые в меню. Раздел `Symbols` должен содержать запись, имеющую ту же пару GUID:ID, что и новый элемент `Group`.  
  
    1.  Установите приоритет группы, чтобы она отображалась в нужном месте меню.  
  
         Границы каждой группы в меню будут показываться в виде горизонтальных линий.  
  
    2.  В качестве родительского объекта для этой новой группы задайте GUID:ID созданного меню. Таким образом группа команд помещается в данное меню.  
  
     Группа из следующего примера будет отображаться в меню верхнего уровня, показанном в предыдущем примере.  
  
     [!CODE [TopLevelMenu#02](../CodeSnippet/VS_Snippets_VSSDK/toplevelmenu#02)]  
  
     Меню могут содержать как команды, так и подменю. Подменю \(которое иногда называют вложенным меню\) — это просто меню, добавленное в группу другого меню, и оно предоставляется только в том случае, когда вызывается это другое меню. При помещении меню, которое показано в следующем примере, в группу в меню верхнего уровня оно становится подменю.  
  
     [!CODE [TopLevelMenu#06](../CodeSnippet/VS_Snippets_VSSDK/toplevelmenu#06)]  
  
7.  Добавьте команды в меню, создав записи команд в разделе [Buttons](../extensibility/buttons-element.md) и установив в качестве родительского объекта каждой команды пару GUID:ID вашей группы. Каждый элемент [Button](../extensibility/button-element.md) элемент должен иметь пару GUID:ID, соответствующую записи в разделе `Symbols`.  
  
     Используйте атрибут `priority` каждой записи кнопки, чтобы указать порядок, в котором команды должны отображаться в группе.  
  
     В следующем примере задается команда, которая будет отображаться в меню верхнего уровня.  
  
     [!CODE [TopLevelMenu#03](../CodeSnippet/VS_Snippets_VSSDK/toplevelmenu#03)]  
  
     Дополнительные сведения о кнопках и пунктах меню см. в разделе [Элемент Button](../extensibility/button-element.md).  
  
     Сведения о том, как реализуются команды меню в коде, см. в разделе [команды MenuCommand и OleMenuCommand](../misc/menucommands-vs-olemenucommands.md) и в пошаговых руководствах, указанных выше в этом разделе.  
  
### Активация контекстного меню  
  
1.  Получите GUID:ID контекстного меню. По умолчанию шаблон пакета создает класс `GuidList` в файле PkgCmdID.cs для хранения GUID набора команд. Этот шаблон также создает класс `PkgCmdIdList` в файле PkgCmdId.cs для хранения целочисленных значений идентификаторов команд, которые объявлены в шаблоне. Контекстные меню и все дополнительные команды должны объявляться после шаблона. Эти объявления показаны в следующих примерах.  
  
     [!CODE [TWShortcutMenu#12](../CodeSnippet/VS_Snippets_VSSDK/twshortcutmenu#12)]  
  
     Этот шаг можно пропустить, если значения GUID и ID будут использоваться напрямую. Тем не менее, для удобства чтения рекомендуется установить значения здесь.  
  
2.  Присоедините к обработчику событий. Как правило, контекстные меню присоединяются к щелчку правой кнопкой мыши поверхности элемента управления, как показано в следующем примере.  
  
     [!CODE [TWShortcutMenu#43](../CodeSnippet/VS_Snippets_VSSDK/twshortcutmenu#43)]  
  
     Метод <xref:System.Windows.Forms.Control.PointToScreen%2A> преобразует позицию щелчка относительно элемента управления в положение на экране. Метод <xref:Microsoft.VisualStudio.Shell.OleMenuCommandService.ShowContextMenu%2A> отображает контекстное меню.  
  
     Файл, содержащий обработчик событий, должен включать пространство имен <xref:System.ComponentModel.Design> для доступа к классу <xref:Microsoft.VisualStudio.Shell.OleMenuCommandService> и пространство имен <xref:Microsoft.VisualStudio.Shell> для доступа к интерфейсу <xref:System.ComponentModel.Design.IMenuCommandService>.  
  
     [!CODE [TWShortcutMenu#41](../CodeSnippet/VS_Snippets_VSSDK/twshortcutmenu#41)]  
  
## См. также  
 [команды MenuCommand и OleMenuCommand](../misc/menucommands-vs-olemenucommands.md)   
 [Справочник по схемам VSCT XML](../extensibility/vsct-xml-schema-reference.md)   
 [Расширение меню и команд](../extensibility/extending-menus-and-commands.md)