---
title: 'Разбор примера: Развертывание вручную приложения ClickOnce | Документы Microsoft'
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- vs-ide-deployment
ms.topic: conceptual
dev_langs:
- VB
- CSharp
- C++
helpviewer_keywords:
- Mage.exe, manual ClickOnce deployments
- MageUI.exe, manual ClickOnce deployments
- deploying applications [ClickOnce], manual ClickOnce deployments
- ClickOnce deployment, manually
- ClickOnce deployment, SDK tools
- manual ClickOnce deployments
- manifests [ClickOnce]
ms.assetid: ccee6551-a1b9-4ca2-8845-9c1cf4ac2560
author: stevehoag
ms.author: shoag
manager: wpickett
ms.workload:
- multiple
ms.openlocfilehash: 001aa8f3436e1594b198a81779c77258ca829a21
ms.sourcegitcommit: 6a9d5bd75e50947659fd6c837111a6a547884e2a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
---
# <a name="walkthrough-manually-deploying-a-clickonce-application"></a>Разбор примера: развертывание вручную приложения ClickOnce
Если Visual Studio нельзя использовать для развертывания вашего [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] приложения, или если необходимо использовать дополнительные функции развертывания, таких как развертывание надежных приложений следует использовать средство командной строки Mage.exe для создания вашего [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] манифесты. В этом пошаговом руководстве описывается создание [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] развертывания с помощью версии командной строки (Mage.exe) или графической версии (MageUI.exe) манифеста средства создания и редактирования.  
  
## <a name="prerequisites"></a>Предварительные требования  
 Это пошаговое руководство содержит некоторые необходимые компоненты и параметры, которые необходимо выбрать до создания развертывания.  
  
-   Установите Mage.exe и MageUI.exe.  
  
     Mage.exe и MageUI.exe являются частью [!INCLUDE[winsdklong](../deployment/includes/winsdklong_md.md)]. Необходимо иметь [!INCLUDE[winsdkshort](../debugger/debug-interface-access/includes/winsdkshort_md.md)] установлена или версии [!INCLUDE[winsdkshort](../debugger/debug-interface-access/includes/winsdkshort_md.md)] входящих в состав Visual Studio. Дополнительные сведения см. в разделе [пакета Windows SDK](http://go.microsoft.com/fwlink/?LinkId=158044) на сайте MSDN.  
  
-   Укажите приложение для развертывания.  
  
     В этом пошаговом руководстве предполагается, что приложение Windows, вы готовы к развертыванию. Это приложение будет называться AppToDeploy.  
  
-   Определите распределение развертывания.  
  
     Возможны следующие варианты: Web, общая папка или компакт-диска. Для получения дополнительной информации см. [ClickOnce Security and Deployment](../deployment/clickonce-security-and-deployment.md).  
  
-   Определите, требуется ли приложению повышенный уровень доверия.  
  
     Если приложению требуется полное доверие — например, полный доступ к системе пользователя, можно использовать `-TrustLevel` параметр Mage.exe для их установки. Если вы хотите определить пользовательский набор разрешений для приложения, можно скопировать раздел разрешений Интернета или интрасети из другого манифеста, изменить его в соответствии с потребностями и добавить его в манифест приложения с помощью текстового редактора или MageUI.exe. Для получения дополнительной информации см. [Trusted Application Deployment Overview](../deployment/trusted-application-deployment-overview.md).  
  
-   Получите сертификат Authenticode.  
  
     Необходимо подписать развертывание с помощью сертификата Authenticode. С помощью средств Visual Studio, MageUI.exe, или MakeCert.exe и Pvk2Pfx.exe можно создать тестовый сертификат или сертификат можно получить из сертификации (ЦС). Если вы решили использовать развертывание надежных приложений, необходимо также выполнить однократную установку сертификата на все клиентские компьютеры. Для получения дополнительной информации см. [Trusted Application Deployment Overview](../deployment/trusted-application-deployment-overview.md).  
  
    > [!NOTE]
    >  Также можно подписать развертывание с помощью сертификата CNG, который можно получить из центра сертификации.  
  
-   Убедитесь, что приложение не имеет манифест со сведениями контроля учетных Записей.  
  
     Необходимо определить, содержит ли приложение манифест со сведениями управления учетных записей (UAC), такие как `<dependentAssembly>` элемента. Чтобы проверить манифест приложения, можно использовать Windows Sysinternals [Sigcheck](http://go.microsoft.com/fwlink/?LinkId=158035) программы.  
  
     Если приложение содержит манифест со сведениями контроля учетных Записей, необходимо повторно создать его без информации контроля учетных Записей. Для проекта C# в Visual Studio откройте свойства проекта и перейдите на вкладку приложения. В **манифеста** раскрывающемся списке выберите **создать приложение без манифеста**. Для проекта Visual Basic в Visual Studio, откройте свойства проекта, перейдите на вкладку приложения и нажмите кнопку **параметры UAC представления**. В открытом файле манифеста, удалите все элементы с одним `<asmv1:assembly>` элемента.  
  
-   Определите, требуется ли приложению необходимые компоненты на клиентском компьютере.  
  
     [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] приложения, развернутые из Visual Studio могут включать предварительные условия для установки начального загрузчика (setup.exe) с развертыванием. В этом примере создается два манифеста, необходимые для [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] развертывания. Загрузчик необходимых компонентов можно создать с помощью [задача GenerateBootstrapper](../msbuild/generatebootstrapper-task.md).  
  
### <a name="to-deploy-an-application-with-the-mageexe-command-line-tool"></a>Чтобы развернуть приложение с помощью средства командной строки Mage.exe  
  
1.  Создайте каталог, где будут храниться вашей [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] файлов развертывания.  
  
2.  В каталоге развертывания, который вы только что создали создайте подкаталог версии. Если это первый раз, которое выполняется развертывание приложения, имя подкаталога версии **1.0.0.0**.  
  
    > [!NOTE]
    >  Версия развертывания может отличаться от версии приложения.  
  
3.  Скопируйте все файлы приложения в каталог версии, включая исполняемые файлы, сборки, ресурсы и файлы данных. При необходимости можно создать дополнительные вложенные каталоги, содержащие другие файлы.  
  
4.  Откройте [!INCLUDE[winsdkshort](../debugger/debug-interface-access/includes/winsdkshort_md.md)] или команды Visual Studio запрашивать и изменять в подпапку версии.  
  
5.  Создайте манифест приложения с помощью вызова Mage.exe. Следующая инструкция создает манифест приложения для кода, скомпилированного для выполнения на процессоре Intel x86.  
  
    ```  
    mage -New Application -Processor x86 -ToFile AppToDeploy.exe.manifest -name "My App" -Version 1.0.0.0 -FromDirectory .   
    ```  
  
    > [!NOTE]
    >  Не забудьте добавить точку (.) после `-FromDirectory` параметр, который указывает на текущий каталог. Если точка не будет включен, необходимо указать путь к файлам приложения.  
  
6.  Подпишите манифест приложения с помощью сертификата Authenticode. Замените *mycert.pfx* с путем к файлу сертификата. Замените *паролей* с паролем для файла сертификата.  
  
    ```  
    mage -Sign AppToDeploy.exe.manifest -CertFile mycert.pfx -Password passwd  
    ```  
  
     Чтобы подписать манифест приложения с помощью сертификата CNG, используйте следующий код. Замените *cngCert.pfx* с путем к файлу сертификата.  
  
    ```  
    mage -Sign AppToDeploy.exe.manifest -CertFile cngCert.pfx  
    ```  
  
7.  Измените корневой каталог развертывания.  
  
8.  Создайте манифест развертывания с помощью вызова Mage.exe. По умолчанию будут отмечены как Mage.exe вашей [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] развертывания как установленное приложение, так что он может выполняться как в интерактивном и в автономном режиме. Чтобы сделать приложение доступным только в том случае, если пользователь находится в оперативном режиме, используйте `-Install` параметр со значением `false`. Если пользователи будут устанавливать приложение с веб-сайта или общего ресурса по умолчанию, убедитесь, что значение `-ProviderUrl` указывает расположение приложения манифеста на веб-сервере или общем ресурсе.  
  
    ```  
    mage -New Deployment -Processor x86 -Install true -Publisher "My Co." -ProviderUrl "\\myServer\myShare\AppToDeploy.application" -AppManifest 1.0.0.0\AppToDeploy.exe.manifest -ToFile AppToDeploy.application  
    ```  
  
9. Подпишите манифест развертывания с помощью сертификата Authenticode или CNG.  
  
    ```  
    mage -Sign AppToDeploy.application -CertFile mycert.pfx -Password passwd  
    ```  
  
     или  
  
    ```  
    mage -Sign AppToDeploy.exe.manifest -CertFile cngCert.pfx  
    ```  
  
10. Скопируйте все файлы в каталоге развертывания назначение развертывания или носителя. Это может быть папка на веб-сайта или сайта FTP, общий файловый ресурс или компакт-диска.  
  
11. Предоставить пользователям URL-адрес, UNC-путь или физический носитель, необходимые для установки приложения. Если указать URL-адрес или UNC-имя, необходимо предоставить пользователям полный путь к манифесту развертывания. Например, если развертывается AppToDeploy http://webserver01/ в каталоге AppToDeploy полный путь URL-адрес будет иметь http://webserver01/AppToDeploy/AppToDeploy.application.  
  
### <a name="to-deploy-an-application-with-the-mageuiexe-graphical-tool"></a>Чтобы развернуть приложение с помощью графического средства MageUI.exe  
  
1.  Создайте каталог, где будут храниться вашей [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] файлов развертывания.  
  
2.  В каталоге развертывания, который вы только что создали создайте подкаталог версии. Если это первый раз, которое выполняется развертывание приложения, имя подкаталога версии **1.0.0.0**.  
  
    > [!NOTE]
    >  Версия развертывания может отличаться от версии приложения.  
  
3.  Скопируйте все файлы приложения в каталог версии, включая исполняемые файлы, сборки, ресурсы и файлы данных. При необходимости можно создать дополнительные вложенные каталоги, содержащие другие файлы.  
  
4.  Запустите графического средства MageUI.exe.  
  
    ```  
    MageUI.exe  
    ```  
  
5.  Создать новый манифест приложения, выбрав **файл**, **New**, **манифест приложения** в меню.  
  
6.  По умолчанию **имя** введите имя и номер версии данного развертывания. Также укажите **процессора** , ваше приложение построено для, например x86.  
  
7.  Выберите **файлы** и нажмите кнопку с многоточием (**...** ) рядом с **каталога приложения** текстовое поле. Появится диалоговое окно Выбор папки.  
  
8.  Выберите вложенный каталог версии, содержащий файлы приложения и нажмите кнопку **ОК**.  
  
9. При развертывании из Internet Information Services (IIS), выберите **при наполнении добавлять расширение .deploy для любого файла, который не имеет** флажок.  
  
10. Нажмите кнопку **заполнить** кнопку, чтобы добавить файлы приложения в список файлов. Если приложение содержит более одного исполняемого файла, пометьте главный исполняемый файл для этого развертывания в качестве запускаемого приложения, выбрав **точки входа** из **тип файла** раскрывающегося списка. (Если приложение содержит только один исполняемый файл, MageUI.exe пометит его автоматически.)  
  
11. Выберите **разрешения, необходимые** и выберите уровень доверия, необходимые приложению. Значение по умолчанию — **FullTrust**, которое подойдет для большинства приложений.  
  
12. Выберите **файл**, **Сохранить как** в меню. Диалоговое окно "Параметры подписи" выводится приглашение для подписания манифеста приложения.  
  
13. При наличии сертификата, хранящегося в виде файла в файловой системе, используйте **подписывать с файлом сертификата** и выбрать сертификат из файловой системы, нажав кнопку с многоточием (**...** ) кнопки. Затем введите пароль сертификата.  
  
     - или -  
  
     Если сертификат содержится в хранилище сертификатов, доступном с компьютера, выберите **подписывать с сохраненным сертификатом** и выбрать сертификат из предоставленного списка.  
  
14. Нажмите кнопку **ОК** для подписания манифеста приложения. Появится диалоговое окно «Сохранить как».  
  
15. В диалоговом окне Сохранить как укажите каталог версии и нажмите кнопку **Сохранить**.  
  
16. Выберите **файл**, **New**, **манифест развертывания** меню, чтобы создать манифест развертывания.  
  
17. На **имя** укажите имя и номер версии для этого развертывания (**1.0.0.0** в этом примере). Также укажите **процессора** , ваше приложение построено для, например x86.  
  
18. Выберите **описание** и укажите значения для **издатель** и **Produc *** t**. (**Продукта** имеет имя, заданное в приложение, в меню Пуск Windows при установке приложения на клиентском компьютере для автономного использования.)  
  
19. Выберите **варианты развертывания** вкладке и в **начальное местоположение** текст укажите расположение манифеста приложения для веб-сервера или общей папки. Например \\\myServer\myShare\AppToDeploy.application.  
  
20. Если вы добавили расширение .deploy на предыдущем шаге, также выберите **используйте расширение .deploy** здесь.  
  
21. Выберите **параметры обновления** и укажите, как часто следует обновлять это приложение. Если приложение использует <xref:System.Deployment.Application.UpdateCheckInfo> для самостоятельной проверки обновлений, снимите **это приложение должно проверять наличие обновлений** флажок.  
  
22. Выберите **ссылка приложения** и нажмите кнопку **выбрать манифест** кнопки. Откройте диалоговое окно.  
  
23. Выберите манифест приложения, созданного ранее и нажмите кнопку **откройте**.  
  
24. Выберите **файл**, **Сохранить как** в меню. Диалоговое окно "Параметры подписи" выводится приглашение для подписания манифеста развертывания.  
  
25. При наличии сертификата, хранящегося в виде файла в файловой системе, используйте **подписывать с файлом сертификата** и выбрать сертификат из файловой системы, нажав кнопку с многоточием (**...** ) кнопки. Затем введите пароль сертификата.  
  
     - или -  
  
     Если сертификат содержится в хранилище сертификатов, доступном с компьютера, выберите **подписывать с сохраненным сертификатом** и выбрать сертификат из предоставленного списка.  
  
26. Нажмите кнопку **ОК** для подписания манифеста развертывания. Появится диалоговое окно «Сохранить как».  
  
27. В **Сохранить как** диалоговое окно, перемещение на один уровень выше в корневой каталог развертывания и нажмите кнопку **Сохранить**.  
  
28. Скопируйте все файлы в каталоге развертывания назначение развертывания или носителя. Это может быть папка на веб-сайта или сайта FTP, общий файловый ресурс или компакт-диска.  
  
29. Предоставить пользователям URL-адрес, UNC-путь или физический носитель, необходимые для установки приложения. Если указать URL-адрес или UNC-имя, необходимо предоставить пользователям полный путь манифеста развертывания. Например, если развертывается AppToDeploy http://webserver01/ в каталоге AppToDeploy полный путь URL-адрес будет иметь http://webserver01/AppToDeploy/AppToDeploy.application.  
  
## <a name="next-steps"></a>Следующие шаги  
 Если необходимо развернуть новую версию приложения, создайте новый каталог с именем новой версии — например, 1.0.0.1—and скопировать новые файлы приложения в новый каталог. Далее необходимо выполнить предыдущие шаги, чтобы создать и подписать новый манифест приложения и обновить и подписать манифест развертывания. Укажите ту же версию, более поздней версии в Mage.exe `-New` и `-Update` вызовов, как [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] обновляет только новые версии с наибольшее целое число слева. Если вы использовали MageUI.exe, можно обновить манифест развертывания, открыв его, выбрав **ссылка приложения** вкладку, щелкнув **выбрать манифест** кнопку, а затем выбрав обновленный манифест приложения.  
  
## <a name="see-also"></a>См. также  
 [Mage.exe (средство создания и редактирования манифеста)](/dotnet/framework/tools/mage-exe-manifest-generation-and-editing-tool)   
 [MageUI.exe (средство создания и редактирования манифестов, графический клиент)](/dotnet/framework/tools/mageui-exe-manifest-generation-and-editing-tool-graphical-client)   
 [Публикация приложений ClickOnce](../deployment/publishing-clickonce-applications.md)   
 [Манифест развертывания ClickOnce](../deployment/clickonce-deployment-manifest.md)   
 [Манифест приложения ClickOnce](../deployment/clickonce-application-manifest.md)