---
title: "Вопросы настройки сервера и клиента в развертываниях ClickOnce | Microsoft Docs"
ms.custom: ""
ms.date: "12/15/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-ide-deployment"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
  - "C++"
helpviewer_keywords: 
  - "развертывание ClickOnce, устранение неполадок"
  - "развертывание приложений, ClickOnce"
  - "устранение неполадок развертывания ClickOnce"
  - "приложения Windows, развертывание ClickOnce"
ms.assetid: 929e5fcc-dd56-409c-bb57-00bd9549b20b
caps.latest.revision: 33
caps.handback.revision: 33
author: "stevehoag"
ms.author: "shoag"
manager: "wpickett"
---
# Вопросы настройки сервера и клиента в развертываниях ClickOnce
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

При использовании служб IIS в среде Windows Server, если развертывание содержит тип файла, который не распознается Windows \(например, файл Microsoft Word\), службы IIS откажут в передаче этого файла, и развертывание завершится неудачей.  
  
 Кроме того, программное обеспечение некоторых веб\-серверов и веб\-приложений, например [!INCLUDE[vstecasp](../code-quality/includes/vstecasp_md.md)], содержит список файлов и типов файлов, которые невозможно загрузить.  Например, [!INCLUDE[vstecasp](../code-quality/includes/vstecasp_md.md)] запрещает загрузку всех файлов Web.config.  Эти файлы могут содержать секретные сведения, такие как имена пользователей и их пароли.  
  
 Хотя это ограничение не должно приводить к проблемам загрузки основных файлов [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)], таких как манифесты и сборки, это ограничение может препятствовать загрузке файлов данных, включаемых как часть приложения [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)].  В [!INCLUDE[vstecasp](../code-quality/includes/vstecasp_md.md)] можно устранить эту ошибку путем удаления обработчика, который запрещает загрузку таких файлов, из диспетчера конфигурации служб IIS.  Дополнительные сведения см. в документации на сервер IIS.  
  
 Некоторые веб\-серверы могут блокировать файлы с расширениями, такими как DLL, CONFIG и MDF.  Обычно приложения Windows содержат файлы с некоторыми из этих расширений.  Если пользователь попытается запустить приложение [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)], которое обращается к блокированному файлу на веб\-сервере, возникнет ошибка.  Вместо разблокирования всех расширений файлов [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] публикует по умолчанию каждый файл приложения с расширением файла ".deploy".  Поэтому администратору необходимо настроить веб\-сервер только на разблокирование трех расширений файлов:  
  
-   APPLICATION  
  
-   MANIFEST  
  
-   DEPLOY  
  
 Однако этот режим можно отключить, сняв флажок **Использовать расширение файла ".deploy"** в [Publish Options Dialog Box](http://msdn.microsoft.com/ru-ru/fd9baa1b-7311-4f9e-8ffb-ae50cf110592), в таком случае необходимо настроить веб\-сервер, чтобы разблокировать все расширения файлов, используемые в приложении.  
  
 Например, потребуется настроить ".manifest", ".application" и ".deploy", если используются службы IIS в случаях, когда не выполнена установка [!INCLUDE[dnprdnshort](../code-quality/includes/dnprdnshort_md.md)], либо если применяется другой веб\-сервер \(например, Apache\).  
  
## ClickOnce и протокол SSL \(Secure Sockets Layer\)  
 Приложение [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] отлично работает по протоколу SSL за исключением случаев, когда Internet Explorer инициирует запрос SSL\-сертификата.  Запрос может инициироваться, когда с сертификатом что\-нибудь не так, например когда имена узлов не совпадают или когда истек срок действия сертификата.  Чтобы заставить [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] работать через SSL\-подключение, убедитесь, что сертификат обновлен и что дата сертификата совпадает с датой узла.  
  
## ClickOnce и проверка подлинности прокси\-сервера  
 [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] предоставляет поддержку встроенной проверки подлинности прокси\-сервера в Windows, начиная с версии .NET Framework 3.5.  Никаких специальных инструкций в файле machine.config не требуется.  [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] не поддерживает другие протоколы проверки подлинности, такие как "Обычная проверка подлинности" или "Краткая проверка подлинности".  
  
 Можно применить исправление к платформе .NET Framework 2.0 для включения этой функциональности.  Дополнительные сведения см. в разделе http:\/\/go.microsoft.com\/fwlink\/?LinkId\=158730.  
  
 Дополнительные сведения см. в разделе [Элемент \<defaultProxy\> \(параметры сети\)](../Topic/%3CdefaultProxy%3E%20Element%20\(Network%20Settings\).md).  
  
## Совместимость ClickOnce и веб\-браузера  
 В настоящее время установки [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] запускаются только в том случае, если URL\-адрес для манифеста развертывания открывается с помощью Internet Explorer.  Развертывание, URL\-адрес которого открывается из другого приложения, например Microsoft Office Outlook, успешно запускаются только в том случае, если Internet Explorer установлен в качестве веб\-браузера по умолчанию.  
  
> [!NOTE]
>  Обозреватель Mozilla Firefox так же поддерживается, но только в том случае, если поставщик развертывания не является пустым или установлено расширение Microsoft .NET Framework Assistant.  Данное расширение входит в состав пакета обновления 1 \(SP1\) для .NET Framework 3.5.  Для поддержки XBAP при необходимости активируется подключаемый модуль NPWPF.  
  
## Активация приложений ClickOnce с помощью скриптов браузера  
 Если разработана специальная веб\-страница, которая запускает приложение [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] с помощью активных сценариев, может оказаться, что приложение не запускается на некоторых компьютерах.  Internet Explorer содержит параметр **Автоматический запрос загрузки файлов**, который влияет на данный алгоритм поведения.  Этот параметр доступен на вкладке **Безопасность** в меню **Параметры** и влияет на данный алгоритм поведения.  Он называется **Автоматический запрос загрузки файлов** и содержится в категории **Загружаемые файлы**.  Значение свойства установлено равным **Enable** \(Включено\) по умолчанию для веб\-страниц интрасети и равным **Disable** \(Выключено\) по умолчанию для веб\-страниц Интернета.  Когда для этого параметра установлено значение **Отключить**, любая попытка активировать приложение [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] программным способом \(например путем назначения его URL\-адреса свойству `document.location`\) будет блокироваться.  В этих условиях пользователи могут запускать приложения только через инициируемую пользователем загрузку, например щелкая гиперссылку, установленную для URL\-адреса приложения.  
  
## Дополнительные вопросы настройки сервера  
  
##### Требуемые права администратора  
 Для публикации с помощью протокола HTTP необходимо обладать правами администратора на целевой сервер.  Данный уровень разрешений требуется для служб IIS.  Если публикация по протоколу HTTP не выполняется, необходимо только разрешение на запись по конечному пути.  
  
##### Вопросы проверки подлинности сервера  
 При публикации на расположенный удаленно сервер, для которого выключен "Анонимный доступ", будет выводиться следующее предупреждение:  
  
```  
"The files could not be downloaded from http://<remoteserver>/<myapplication>/.  The remote server returned an error: (401) Unauthorized."  
```  
  
> [!NOTE]
>  Можно заставить работать проверку подлинности NTLM \(запрос\-ответ NT\), если узел запрашивает учетные данные, отличные от учетных данных по умолчанию, и в диалоговом окне безопасности нажимается кнопка **OK** в ответ на запрос, следует ли сохранить предоставляемые учетные данные для будущих сеансов работы.  Однако этот искусственный прием не работает для обычной проверки подлинности.  
  
## Использование веб\-серверов сторонних компаний  
 Когда приложение [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] развертывается с веб\-сервера, отличного от IIS, может возникнуть проблема, если сервер возвращает неверный тип содержимого для ключевых файлов [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)], таких как манифест развертывания и манифест приложения.  Чтобы устранить эту проблему, ознакомьтесь в справочной документации на веб\-сервер со сведениями о добавлении на сервер новых типов содержимого, и убедитесь, что присутствуют все сопоставления расширений имен файлов, перечисляемые в следующей таблице.  
  
|Расширение имени файла|Тип содержимого|  
|----------------------------|---------------------|  
|`.application`|`application/x-ms-application`|  
|`.manifest`|`application/x-ms-manifest`|  
|`.deploy`|`application/octet-stream`|  
|`.msu`|`application/octet-stream`|  
|`.msp`|`application/octet-stream`|  
  
## ClickOnce и подключенные диски  
 Если для публикации приложения ClickOnce используется Visual Studio, в качестве расположения для установки нельзя указать подключенный диск.  Чтобы установить приложение ClickOnce с подключенного диска, в него можно внести изменения с помощью средства создания и редактирования манифеста \(Mage.exe и MageUI.exe\).  Дополнительные сведения см. в разделах [Mage.exe \(средство создания и редактирования манифеста\)](../Topic/Mage.exe%20\(Manifest%20Generation%20and%20Editing%20Tool\).md) и [MageUI.exe \(Manifest Generation and Editing Tool, Graphical Client\)](../Topic/MageUI.exe%20\(Manifest%20Generation%20and%20Editing%20Tool,%20Graphical%20Client\).md).  
  
## Протокол FTP не поддерживается для установки приложений  
 [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] поддерживает установку приложений с любого файлового сервера или веб\-сервера HTTP 1.1.  Протокол FTP \(File Transfer Protocol\) не поддерживается для установки приложений.  Протокол FTP можно использовать только для публикации приложений.  Эти различия обобщены в следующей таблице:  
  
|Тип URL\-адреса|Описание|  
|---------------------|--------------|  
|ftp:\/\/|С помощью этого протокола можно опубликовать приложение [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)].|  
|http:\/\/|Используя этот протокол, можно установить приложение [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)].|  
|https:\/\/|Используя этот протокол, можно установить приложение [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)].|  
|file:\/\/|Используя этот протокол, можно установить приложение [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)].|  
  
## Windows XP с пакетом обновления 2 \(SP2\): брандмауэр Windows  
 По умолчанию в Windows XP с пакетом обновления 2 \(SP2\) брандмауэр Windows включен.  Если приложение разрабатывается на компьютере с установленной операционной системой Windows XP, по\-прежнему можно публиковать и выполнять приложения [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] с локального сервера, на котором выполняются службы IIS.  Однако если не открыт брандмауэр Windows, невозможно получить доступ к этому серверу, на котором выполняются службы IIS, с другого компьютера.  Инструкции по управлению брандмауэром Windows см. в справке Windows.  
  
## Windows Server: включение серверных расширений FrontPage  
 Для публикации приложений на веб\-сервер Windows, работающий по протоколу HTTP, необходимы серверные расширения FrontPage от корпорации Майкрософт.  
  
 По умолчанию в Windows Server серверные расширения FrontPage не установлены.  Чтобы использовать [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] для публикации на работающий по протоколу HTTP веб\-сервер Windows Server с серверными расширениями FrontPage, необходимо сначала установить серверные расширения FrontPage.  Установить их можно с помощью средства администрирования "Управление данным сервером", предусмотренного в Windows Server.  
  
## Windows Server: блокированные типы контента  
 Службы IIS в [!INCLUDE[WinXPSvr](../debugger/includes/winxpsvr_md.md)] блокируют файлы всех типов за исключением определенных известных типов содержимого \(например, .htm, .html, .txt и так далее\) .  Чтобы включить развертывание приложений [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)], используя этот сервер, необходимо изменить параметры служб IIS для разрешения загрузки файлов типа ".application", ".manifest" и любых других настраиваемых типов файлов, используемых приложением.  
  
 Если развертывание выполняется с помощью сервера IIS, запустите программу inetmgr.exe и добавьте новые типы файлов для веб\-страницы по умолчанию:  
  
-   Для расширений ".application" и ".manifest" тип MIME должен быть равен "application\/x\-ms\-application". Для других типов файлов тип MIME должен быть равен "application\/octet\-stream."  
  
-   Если создан тип MIME с расширением "\*" и тип MIME "application\/octet\-stream", разрешается загрузка файлов незаблокированных типов.  \(Однако файлы заблокированных типов, таких как ".aspx" и ".asmx", не могут быть загружены.\)  
  
 Конкретные инструкции по настройке типов MIME в Windows Server см. в статье KB326965, "Службы IIS 6.0 не обслуживают неизвестные типы MIME" базы знаний Майкрософт по адресу [http:\/\/support.microsoft.com\/default.aspx?scid\=kb;ru\-ru;326965](http://support.microsoft.com/default.aspx?scid=kb;ru-ru;326965).  
  
## Сопоставления типов содержимого  
 При публикации по протоколу HTTP тип содержимого \(также известный как тип MIME\) для файла с расширением ".application" должен быть равен "application\/x\-ms\-application". Если на сервере выполнена установка [!INCLUDE[dnprdnlong](../code-quality/includes/dnprdnlong_md.md)], эта настройка задается автоматически.  Если это программное обеспечение не установлено, тогда необходимо создать ассоциацию MIME\-типа для виртуального корня приложения [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] \(или всего сервера\).  
  
 Если развертывание выполняется с помощью сервера IIS, запустите программу inetmgr.exe и добавьте для расширения ".application" новый тип содержимого, равный "application\/x\-ms\-application".  
  
## Вопросы HTTP\-сжатия  
 С помощью [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] можно выполнять загрузки, использующие HTTP\-сжатие, технологию веб\-сервера, которая применяет алгоритм GZIP для сжатия потока данных перед отправкой потока клиенту.  Клиент — в данном случае [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] — разворачивает поток, прежде чем прочитать файлы.  
  
 Если используются службы IIS, можно легко включить HTTP\-сжатие.  Однако при включении HTTP\-сжатия оно включается только для определенных типов файлов — а именно, HTML\-файлов и текстовых файлов.  Чтобы включить сжатие для сборок \(.dll\), XML \(.xml\), манифестов развертывания \(.application\) и манифестов приложений \(.manifest\), необходимо добавить эти типы файлов в список типов для сжатия службами IIS.  Пока типы файлов не добавлены в развертывание, будут сжиматься только текстовые файлы и HTML\-файлы.  
  
 Дополнительные инструкции по IIS см. в статье [How to specify additional document types for HTTP compression](http://go.microsoft.com/fwlink/?LinkId=178459).  
  
## См. также  
 [Устранение неполадок развертывания ClickOnce](../deployment/troubleshooting-clickonce-deployments.md)   
 [Выбор стратегии развертывания ClickOnce](../deployment/choosing-a-clickonce-deployment-strategy.md)   
 [Предварительные условия для развертывания приложения](../deployment/application-deployment-prerequisites.md)