---
title: "Пошаговое руководство. Развертывание вручную приложения ClickOnce, которое не нуждается в повторном подписывании и которое сохраняет фирменную символику | Microsoft Docs"
ms.custom: ""
ms.date: "12/15/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-ide-deployment"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
  - "C++"
helpviewer_keywords: 
  - "фирменная символика"
  - "приложения ClickOnce, развернутые другими"
  - "развертывание ClickOnce, вручную"
  - "развертывание ClickOnce, SDK - средства"
  - "клиентские развертывания"
  - "манифесты [ClickOnce]"
  - "развертывание ClickOnce вручную"
  - "развертывание и фирменная символика нескольких приложений ClickOnce"
  - "сохраненные сведения о фирменной символике"
ms.assetid: c21822fb-d4ee-42e4-b72d-41ee9786efe5
caps.latest.revision: 12
caps.handback.revision: 12
author: "stevehoag"
ms.author: "shoag"
manager: "wpickett"
---
# Пошаговое руководство. Развертывание вручную приложения ClickOnce, которое не нуждается в повторном подписывании и которое сохраняет фирменную символику
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

При создании приложения [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] и передаче его клиенту для публикации и развертывания клиент традиционно должен был обновить манифест развертывания и подписать его заново. Хотя в большинстве случаев этот метод по\-прежнему остается предпочтительным, платформа .NET Framework 3.5 позволяет создавать развертывания [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)], которые могут развертываться клиентами без повторного создания нового манифеста развертывания.  Дополнительные сведения см. в разделе [Развертывание приложений ClickOnce для тестовых и рабочих серверов без повторного подписывания](../deployment/deploying-clickonce-applications-for-testing-and-production-servers-without-resigning.md).  
  
 При создании приложения [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] и последующей передачи его клиенту для публикации и развертывания приложение может использовать торговую марку клиента или сохранять торговую марку создателя приложения.  Например, если приложение является одиночным фирменным приложением, у создателя может возникнуть желание сохранить свою торговую марку.  Если в приложении выполняется большой объем настроек для каждого клиента, возможно, потребуется использовать торговую марку клиента.  Платформа .NET Framework 3.5 позволяет сохранять стиль компании, сведения об издателе и подпись безопасности при передаче приложения в организацию для развертывания.  Дополнительные сведения см. в разделе [Создание приложений ClickOnce для развертывания другими](../deployment/creating-clickonce-applications-for-others-to-deploy.md).  
  
> [!NOTE]
>  В этом разборе примера создаются развертывания вручную с помощью средства командной строки, Mage.exe, или графического средства, MageUI.exe.  Дополнительные сведения о развертывания вручную см. в разделе [Разбор примера: развертывание вручную приложения ClickOnce](../deployment/walkthrough-manually-deploying-a-clickonce-application.md).  
  
## Обязательные компоненты  
 Для выполнения шагов в этом разборе примера необходимо следующее:  
  
-   Приложение Windows Forms, которое готово для развертывания.  Это приложение будет упоминаться как WindowsFormsApp1.  
  
-   Visual Studio или SDK для Windows.  
  
### Чтобы развернуть приложение ClickOnce с поддержкой нескольких развертываний и фирменного стиля, используя Mage.exe  
  
1.  Откройте окно командной строки Visual Studio или командной строки [!INCLUDE[winsdkshort](../debugger/debug-interface-access/includes/winsdkshort_md.md)] и измените каталог, в котором будут храниться файлы [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)].  
  
2.  Создайте каталог, называемый по текущей версии развертывания.  Если приложение развертывается в первый раз, скорее всего будет выбрана версия 1.0.0.0.  
  
    > [!NOTE]
    >  Версия развертывания может отличаться от версии файлов приложения.  
  
3.  Создайте подкаталог, именуемый как bin, и скопируйте в него все файлы приложения, включая исполняемые файлы, сборки, ресурсы и файлы данных.  
  
4.  Создайте манифест приложения, вызвав программное средство Mage.exe.  
  
    ```  
    mage -New Application -ToFile 1.0.0.0\WindowsFormsApp1.exe.manifest -Name "Windows Forms App 1" -Version 1.0.0.0 -FromDirectory 1.0.0.0\bin -UseManifestForTrust true -Publisher "A. Datum Corporation"  
    ```  
  
5.  Подпишите манифест приложения своей цифровой подписью.  
  
    ```  
    mage -Sign WindowsFormsApp1.exe.manifest -CertFile mycert.pfx  
    ```  
  
6.  Создайте манифест развертывания, вызвав программное средство Mage.exe.  По умолчанию программное средство Mage.exe пометит развертывание [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] как установленное приложение, чтобы оно могло выполняться как в интерактивном, так и в автономном режиме.  Чтобы сделать приложение доступным только тогда, когда пользователь находится в интерактивном режиме, используйте аргумент `-i` со значением `f`.  Поскольку это приложение будет использовать преимущества поддержки нескольких развертываний, исключите аргумент `-providerUrl` для программного средства Mage.exe.  \(В версиях .NET Framework, предшествующих версии 3.5, исключение аргумента `-providerUrl` для автономного приложения приводит к ошибке.\)  
  
    ```  
    mage -New Deployment -ToFile WindowsFormsApp1.application -Name "Windows Forms App 1" -Version 1.0.0.0 -AppManifest 1.0.0.0\WindowsFormsApp1.manifest   
    ```  
  
7.  Не подписывайте манифест развертывания.  
  
8.  Предоставьте все файлы клиенту, развертывающему приложение в своей сети.  
  
9. На этом этапе клиент должен подписать манифест развертывания своим собственным самообразующимся сертификатом.  Например, если клиент работает на компанию "Adventure Works", он может создать собственный сертификат, используя средство MakeCert.exe.  Далее используйте средство Pvk2pfx.exe, чтобы объединить файлы, созданные средством MakeCert.exe, в PFX\-файл, который может быть передан в программное средство Mage.exe.  
  
    ```  
    makecert -r -pe -n "CN=Adventure Works" -sv MyCert.pvk MyCert.cer  
    pvk2pfx.exe -pvk MyCert.pvk -spc MyCert.cer -pfx MyCert.pfx  
    ```  
  
10. Затем клиент использует этот сертификат для подписания манифеста развертывания.  
  
    ```  
    mage -Sign WindowsFormsApp1.application -CertFile MyCert.pfx  
    ```  
  
11. Клиент развертывает приложение для своих пользователей.  
  
### Чтобы развернуть приложение ClickOnce с поддержкой нескольких развертываний и фирменного стиля, используя MageUI.exe  
  
1.  Откройте окно командной строки Visual Studio или командной строки [!INCLUDE[winsdkshort](../debugger/debug-interface-access/includes/winsdkshort_md.md)] и перейдите в каталог, в котором будут храниться файлы [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)].  
  
2.  Создайте подкаталог, именуемый как bin, и скопируйте в него все файлы приложения, включая исполняемые файлы, сборки, ресурсы и файлы данных.  
  
3.  Создайте подкаталог, называемый по текущей версии развертывания.  Если приложение развертывается в первый раз, скорее всего будет выбрана версия 1.0.0.0.  
  
    > [!NOTE]
    >  Версия развертывания может отличаться от версии файлов приложения.  
  
4.  Переместите каталог \\bin в каталог, созданный на шаге 2.  
  
5.  Запустите графическое средство MageUI.exe.  
  
    ```  
    MageUI.exe  
    ```  
  
6.  Создайте новый манифест приложения, последовательно выбрав в меню **Файл** команды **Создать** и **Манифест приложения**.  
  
7.  На открытой по умолчанию вкладке **Имя** введите имя и номер версии данного развертывания.  Кроме того, присвойте значение параметру **Издатель**, которое будет использоваться как имя папки для ссылки на ярлык приложения в меню "Пуск" при развертывании приложения.  
  
8.  Перейдите на вкладку **Параметры приложения** и щелкните **Использовать манифест приложения для сведений о доверии**.  Эти действия включат фирменный стиль сторонней организации для данного приложения [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)].  
  
9. Перейдите на вкладку **Файлы** и нажмите кнопку **Обзор** рядом с текстовым полем "Каталог приложения".  
  
10. Выберите каталог, содержащий файлы приложения, которые были созданы на шаге 2, и нажмите кнопку **OK** в диалоговом окне выбора папки.  
  
11. Нажмите кнопку **Заполнить**, чтобы добавить все файлы приложения в список файлов.  Если приложение содержит более одного исполняемого файла, пометьте главный исполняемый файл для этого приложения как приложение, активизируемое при запуске, выбрав пункт **Точка входа** в раскрывающемся списке **Тип файла**.  \(Если приложение содержит только один исполняемый файл, средство MageUI.exe пометит его автоматически.\)  
  
12. Перейдите на вкладку **Требуемые разрешения** и выберите уровень доверия, который требуется обеспечить приложению.  По умолчанию установлено **Полное доверие**, которое подходит для большинства приложений.  
  
13. Выберите в меню **Файл** команду **Сохранить** и сохраните манифест приложения.  При сохранении манифеста приложения будет выведен запрос на его подписание.  
  
14. При наличии сертификата, хранящегося в виде файла в файловой системе, выберите вариант **Подписывать с файлом сертификата** и выберите сертификат в файловой системе, нажав кнопку с многоточием \(**...**\).  
  
     \-или\-  
  
     Если сертификат хранится в хранилище сертификатов, доступ к которому можно получить с компьютера, установите режим **Подписать хранимым сертификатом** и выберите сертификат из предлагаемого списка.  
  
15. Последовательно выберите в меню **Файл** пункты **Создать**, **Манифест развертывания**, чтобы создать манифест развертывания, а затем на вкладке **Имя** укажите имя и номер версии \(1.0.0.0 в этом примере\).  
  
16. Перейдите на вкладку **Обновление** и укажите, как часто требуется обновлять это приложение.  Если приложение использует API развертывания [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] для самостоятельной проверки обновлений, снимите флажок **Это приложение должно проверять наличие обновлений**.  
  
17. Перейдите на вкладку **Ссылка приложения**.  Можно предварительно заполнить все значения на этой вкладке, нажав кнопку **Выбрать манифест** и выбрав манифест приложения, созданный на предыдущих шагах.  
  
18. Выберите **Сохранить** и сохраните манифест развертывания на диск.  При сохранении манифеста приложения будет выведен запрос на его подписание.  Нажмите кнопку **Отменить**, чтобы сохранить манифест без его подписания.  
  
19. Предоставьте клиенту все файлы приложения.  
  
20. На этом этапе клиент должен подписать манифест развертывания своим собственным самообразующимся сертификатом.  Например, если клиент работает на компанию "Adventure Works", он может создать собственный сертификат, используя средство MakeCert.exe.  Далее используйте средство Pvk2pfx.exe, чтобы объединить файлы, созданные программой MakeCert.exe, в PFX\-файл, который может быть передан в MageUI.exe.  
  
    ```  
    makecert -r -pe -n "CN=Adventure Works" -sv MyCert.pvk MyCert.cer  
    pvk2pfx.exe -pvk MyCert.pvk -spc MyCert.cer -pfx MyCert.pfx  
    ```  
  
21. Имея созданный сертификат, клиент теперь подписывает манифест развертывания, открывая манифест развертывания в MageUI.exe и затем сохраняя его.  Когда открывается диалоговое окно подписания, клиент выбирает режим **Подписать как файл сертификата** и выбирает PFX\-файл, сохраненный на диске.  
  
22. Клиент развертывает приложение для своих пользователей.  
  
## Следующие действия  
  
## См. также  
 [Mage.exe \(средство создания и редактирования манифеста\)](../Topic/Mage.exe%20\(Manifest%20Generation%20and%20Editing%20Tool\).md)   
 [MageUI.exe \(Manifest Generation and Editing Tool, Graphical Client\)](../Topic/MageUI.exe%20\(Manifest%20Generation%20and%20Editing%20Tool,%20Graphical%20Client\).md)   
 [Makecert.exe \(Certificate Creation Tool\)](../Topic/Makecert.exe%20\(Certificate%20Creation%20Tool\).md)