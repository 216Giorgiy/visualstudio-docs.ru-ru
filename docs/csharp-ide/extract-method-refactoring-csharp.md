---
redirect_url: /visualstudio/csharp-ide/refactoring/extract-method
title: "Рефакторинг (C#) для извлечения метода | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology: vs-ide-general
ms.tgt_pltfrm: 
ms.topic: article
dev_langs: CSharp
helpviewer_keywords:
- refactoring [C#], Extract Method
- Extract Method refactoring operation [C#]
ms.assetid: eeba11df-a815-4bec-9c21-8a831891b783
caps.latest.revision: "29"
author: gewarren
ms.author: gewarren
manager: ghogen
ms.openlocfilehash: e85e745241d8fa880098b73a6306cbca3f19da70
ms.sourcegitcommit: f40311056ea0b4677efcca74a285dbb0ce0e7974
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2017
---
# <a name="extract-method-refactoring-c"></a>Рефакторинг для извлечения метода (C#)
**Извлечение метода** — это операция оптимизации, который предоставляет простой способ создать новый метод из фрагмента кода существующего члена.  
  
 С помощью **извлечение метода**, можно создать новый метод путем извлечения выделенного кода, находящегося внутри блока кода существующего члена. Новый, извлеченный метод содержит выделенный код и выделенный код в существующем члене заменяется вызова нового метода. Превращение фрагмента кода в отдельный метод позволяет быстро и точно реорганизовать код для использования и лучшей читаемости.  
  
 **Извлечение метода** имеет следующие преимущества:  
  
-   Рекомендует лучше всего написания безопасного кода, выделяя отдельные, многократно используемые методы.  
  
-   Рекомендует самодокументируемыми кода при наличии хорошей организации.  
  
     Когда описательные имена, используемые методы верхнего уровня можно читать как последовательности комментариев.  
  
-   Способствует созданию детализированных методов для упрощения переопределения.  
  
-   Сокращает дублирование кода.  
  
### <a name="to-use-extract-method"></a>Чтобы использовать извлечение метода  
  
1.  Создайте консольное приложение с именем `ExtractMethod`, а затем замените `Program` на следующий пример кода.  
  
    ```csharp  
    class A  
    {  
        const double PI = 3.141592;  
  
        double CalculatePaintNeeded(double paintPerUnit, double radius)  
        {  
            // Select any of the following:  
            // 1. The entire next line of code.  
            // 2. The right-hand side of the next line of code.  
            // 3. Just "PI *" of the right-hand side of the next line  
            //    of code (to see the prompt for selection expansion).  
            // 4.  All code within the method body.  
            // ...Then invoke Extract Method.  
  
            double area = PI * radius * radius;  
  
            return area / paintPerUnit;  
        }  
    }  
    ```  
  
2.  Выберите фрагмент кода, который нужно извлечь.  
  
    ```csharp  
    double area = PI * radius * radius;  
    ```  
  
3.  На **рефакторинг** меню, нажмите кнопку **извлечение метода**.  
  
     **Извлечение метода** откроется диалоговое окно.  
  
     Кроме того, можно также ввести сочетание клавиш CTRL + R, M, чтобы отобразить **извлечение метода** диалоговое окно.  
  
     Можно также щелкнуть выбранный кода, выберите пункт **рефакторинг**, а затем нажмите кнопку **извлечение метода** для отображения **извлечение метода** диалоговое окно.  
  
4.  Укажите имя для нового метода, например `CircleArea`в **имя нового метода** поле.  
  
     Предварительный просмотр сигнатуры нового метода отображается в области **Предварительный просмотр сигнатуры метода**.  
  
5.  Нажмите кнопку **ОК**.  
  
## <a name="remarks"></a>Примечания  
 При использовании **извлечение метода** команды новый метод вставляется после исходного члена в том же классе.  
  
## <a name="partial-types"></a>Разделяемые типы  
 Если класс является разделяемым типом, затем **извлечение метода** создает новый метод сразу же после исходного члена. **Извлечение метода** определяет сигнатуру нового метода, создавая статический метод, когда данные экземпляра не ссылается на код в новый метод.  
  
## <a name="generic-type-parameters"></a>Параметры универсального типа  
 При извлечении метода, имеющего произвольном параметре универсального типа, созданный код не будет добавлять `ref` модификатор в этот параметр, если только он присваивается значение. Если извлеченный метод будет поддерживать ссылочные типы в качестве аргумента универсального типа, то необходимо вручную добавить `ref` модификатор параметра в подписи метода.  
  
## <a name="anonymous-methods"></a>Анонимные методы  
 При попытке извлечь часть анонимного метода, включающего ссылку на локальную переменную, которое объявлено или ссылка за пределами анонимного метода, затем Visual Studio предупредит о возможных изменениях семантики.  
  
 При анонимном методе используется значение локальной переменной, значение получается в момент выполнения анонимного метода. При извлечении анонимного метода в другой метод значение локальной переменной получается в момент вызова метода.  
  
 Следующий пример демонстрирует это изменение семантики. Если этот код выполняется, затем **11** выводимого на консоль. Если вы используете **извлечение метода** для извлечения участок кода, помеченный в отдельный метод комментарии в коде и затем выполнить оптимизированный код **10** выводимого на консоль.  
  
```csharp  
class Program  
{  
    delegate void D();  
    D d;  
    static void Main(string[] args)  
    {  
        Program p = new Program();  
        int i = 10;  
        /*begin extraction*/  
            p.d = delegate { Console.WriteLine(i++); };  
        /*end extraction*/  
        i++;  
        p.d();  
    }  
}  
```  
  
 Чтобы обойти эту проблему, убедитесь в локальные переменные, которые используются в полях анонимного метода класса.  
  
## <a name="see-also"></a>См. также  
 [Рефакторинг (C#)](refactoring-csharp.md)