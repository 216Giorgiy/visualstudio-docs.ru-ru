---
title: Управление владельца блокировки документами | Документы Microsoft
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- vs-ide-sdk
ms.topic: conceptual
helpviewer_keywords:
- editors [Visual Studio SDK], custom - document locking
ms.assetid: fa1ce513-eb7d-42bc-b6e8-cb2433d051d5
author: gregvanl
ms.author: gregvanl
manager: douge
ms.workload:
- vssdk
ms.openlocfilehash: 65f5a38f5d4da0986b7f95c9287a94e657efa9c5
ms.sourcegitcommit: 6a9d5bd75e50947659fd6c837111a6a547884e2a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
ms.locfileid: "31130548"
---
# <a name="document-lock-holder-management"></a>Управление владельца блокировки документа
Запуск документа таблицы (RDT) содержит счетчик открытых документов и все блокировки изменения, которые у них есть. Можно разместить блокировки на изменение документа в RDT, если его программно изменять в фоновом режиме незаметно для пользователя отображается в окне документа, открытого документа. Эта функциональность часто используется конструкторами, изменяющие несколько файлов с помощью графического интерфейса пользователя.  
  
## <a name="document-lock-holder-scenarios"></a>Сценарии владельца блокировки документа  
  
### <a name="file-a-has-a-dependence-on-file-b"></a>Файл «» имеет зависимость от файла «b»  
 Рассмотрим ситуацию, в котором реализуется стандартного редактора «A» для типа файла «a» и каждый файл типа «» имеет ссылку (либо зависимость от) файл типа «b». Для файлов типа «b» существует стандартного редактора «B». Когда файл открывается редактор «A» «», он возвращает ссылку на соответствующий файл «b». Файл «b» не отображается, но ее можно изменить редактор «A». Редактор «A» получает ссылку на данные документа из файла «b» из <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.FindAndLockDocument%2A> метода и также поддерживает блокировку изменения для файла «b». После завершения редактор «A» изменение файла «b», можно уменьшить блокировки изменения счетчика для файла «b» путем вызова <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.UnlockDocument%2A> метод. Этот шаг можно пропустить, если бы метод <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.FindAndLockDocument%2A> метод с параметром `dwRDTLockType` значение <xref:Microsoft.VisualStudio.Shell.Interop._VSRDTFLAGS>.  
  
### <a name="file-b-is-opened-by-a-different-editor"></a>Файл «b» открыт в другом редакторе  
 В случае, если файл «b» уже открыт редактор «B» при попытке открыть его редактор «A», существует два отдельных сценария для обработки.  
  
-   Если файл «b» открыт в редакторе совместимые, необходимо иметь редактора «A» зарегистрировать блокировки изменения документа при помощи файла «b» <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.RegisterDocumentLockHolder%2A> метод. После завершения изменения файла «b» редактора «A» отменить регистрацию документа изменить блокировку с помощью <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.UnregisterDocumentLockHolder%2A> метод.  
  
-   Если недопустимым образом открыт файл «b», можно либо воспользоваться редактором «» сбой, или можно разрешить это представление, связанное с редактором «A» частично открыть и отобразить соответствующее сообщение об ошибке попытки открытия файла «b». Сообщение об ошибке следует сообщить пользователю о необходимости закрыть файл «b» в несовместимом редакторе, а затем снова откройте файл «» с помощью редактора «A». Вы также можете реализовать [!INCLUDE[vsipsdk](../extensibility/includes/vsipsdk_md.md)] метод <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable2.QueryCloseRunningDocument%2A> чтобы предложить пользователю закрыть файл «b», который открыт в несовместимом редакторе. Если пользователь закрывает файл «b», для открытия файла «» в редакторе «A» продолжается обычным образом.  
  
## <a name="additional-document-edit-lock-considerations"></a>Вопросы блокировки Правка дополнительных документов  
 Другое поведение возникает в том случае, если редактор «A» является единственным, как изменить блокировку файла «b», чем в случае редактора «B» также содержит документа документ редактирования блокировка на файл «b». В [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)], **конструктор классов** приведен пример визуального конструктора, которая не удерживает блокировки на изменение в связанном файле кода. То есть, если у пользователя есть схема открыть в конструкторе классов и одновременно открыть связанном файле кода и пользователь изменяет файл кода, но не сохраняет изменения, изменения теряются также файл схемы (.cd) класса. Если **конструктор классов** имеет только документа изменить блокировка на файл кода, у пользователя не запрашивается для сохранения изменений при закрытии файла кода. Интегрированной среды разработки запрашивает у пользователя, чтобы сохранить изменения только после того, что пользователь не закроет **конструктор классов**. Сохраненные изменения отражаются в обоих файлах. Если оба **конструктор классов** и редакторе кода файл удерживаются блокировки изменения документа в файле кода, то пользователю будет предложено сохранить при закрытии файла кода или формы. На этом этапе сохраненные изменения отражаются в форме и в файле кода. Дополнительные сведения о схемах классов см. в разделе [работа со схемами классов (конструктор классов)](../ide/working-with-class-diagrams-class-designer.md).  
  
 Обратите внимание, что если необходимо поместить в документе не редактора блокировки на изменение, необходимо реализовать <xref:Microsoft.VisualStudio.Shell.Interop.IVsDocumentLockHolder> интерфейса.  
  
 Сколько раз пользовательского интерфейса конструктора, программным образом изменяет файлы кода вносит изменения в более чем одного файла. В таких случаях <xref:Microsoft.VisualStudio.Shell.Interop.IVsUIShell2.SaveItemsViaDlg%2A> метод отвечает за сохранение одного или нескольких документов с помощью параметра **Вы действительно хотите сохранить изменения следующих элементов?** диалоговое окно.  
  
## <a name="see-also"></a>См. также  
 [Запуска таблицы документов](../extensibility/internals/running-document-table.md)   
 [Сохранение состояния и запуск таблицы документов](../extensibility/internals/persistence-and-the-running-document-table.md)