---
title: 'Как: переноса расширяемости проектов в Visual Studio 2017 г. | Документы Microsoft'
ms.custom: ''
ms.date: 11/09/2016
ms.technology:
- vs-ide-sdk
ms.topic: conceptual
ms.assetid: 8ca07b00-a3ff-40ab-b647-c0a93b55e86a
author: gregvanl
ms.author: gregvanl
manager: douge
ms.workload:
- vssdk
ms.openlocfilehash: 93f5d663a31d43dc7a52cbd11261ca78134c682a
ms.sourcegitcommit: 6a9d5bd75e50947659fd6c837111a6a547884e2a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
ms.locfileid: "31133544"
---
# <a name="how-to-migrate-extensibility-projects-to-visual-studio-2017"></a>Как: переноса расширяемости проектов в Visual Studio 2017 г.

В этом документе описывается порядок обновления расширяемости проектов для Visual Studio 2017 г. Кроме описания обновление файлов проекта, он также описывает, как обновление до новой версии 3 формат манифеста VSIX (VSIX v3) расширения манифеста версии 2 (VSIX v2).

## <a name="install-visual-studio-2017-with-required-workloads"></a>Установка Visual Studio 2017 г. с помощью рабочих нагрузок

Убедитесь, что установка включает следующие рабочие нагрузки:

* Разработка классических приложений .NET
* Разработка расширений Visual Studio

## <a name="open-vsix-solution-in-visual-studio-2017"></a>Откройте решение VSIX в Visual Studio 2017 г.

Все проекты VSIX будет требуют одностороннего обновления для Visual Studio 2017 г.

Файл проекта (например, *.csproj) будут обновлены:

* Теперь значение MinimumVisualStudioVersion - 15.0
* OldToolsVersion (если существует ранее) — теперь значение 14.0

## <a name="update-the-microsoftvssdkbuildtools-nuget-package"></a>Обновление пакета Microsoft.VSSDK.BuildTools NuGet

>**Примечание:** Если решение не ссылается пакет Microsoft.VSSDK.BuildTools NuGet, этот шаг можно пропустить.

Для сборки расширения в новой версии 3 VSIX формате (версия 3), решение потребуется создавать новые средства построения VSSDK. Устанавливается с Visual Studio 2017 г., но может, v2 расширение VSIX содержит ссылку на более старую версию через NuGet. В этом случае необходимо вручную установить обновление пакета Microsoft.VSSDK.BuildTools NuGet для вашего решения.

Обновление ссылок NuGet Microsoft.VSSDK.BuildTools:

* Щелкните правой кнопкой мыши решение и выберите **управление пакетами NuGet для решения...**
* Перейдите к **обновления** вкладки.
* Выберите Microsoft.VSSDK.BuildTools (последняя версия).
* Нажмите клавишу **обновление**.

![Средства построения VSSDK](media/vssdk-build-tools.png)

## <a name="make-changes-to-the-vsix-extension-manifest"></a>Вносить изменения в манифест расширения VSIX

Чтобы обеспечить установку пользователя Visual Studio все сборки, необходимые для запуска расширения, укажите все необходимые компоненты или пакетов в файл манифеста расширения. Когда пользователь пытается установить расширение, VSIXInstaller будет проверять наличие всех необходимых компонентов. Если отсутствуют некоторые, пользователю будет предложено установить отсутствующие компоненты в процессе установки расширения.

>**Примечание:** как минимум, все расширения следует указать компонент редактора основных компонентов Visual Studio как необходимый компонент.

* Измените файл манифеста расширения (обычно называемый source.extension.vsixmanifest).
* Убедитесь, `InstallationTarget` включает 15.0.
* Добавьте необходимые для установки необходимых компонентов (как показано в примере ниже).
  * Рекомендуется указывать только идентификаторы компонентов для установки необходимых компонентов.
  * См. в разделе в конце этого документа [инструкции определения идентификаторов компонентов](#finding-component-ids).

Пример

```xml
<PackageManifest>
 ...
    <Prerequisites>
        <Prerequisite Id="Microsoft.VisualStudio.Component.CoreEditor" Version="[15.0,16.0)" />
        <Prerequisite Id="Microsoft.VisualStudio.Component.DiagnosticTools" Version="[15.0.25814.0,16.0)" />
        <Prerequisite Id="Microsoft.VisualStudio.Shell.12.0" Version="[12.0]" />
    </Prerequisites>
 ...
</PackageManifest>
```

### <a name="option-use-the-designer-to-make-changes-to-the-vsix-extension-manifest"></a>Параметр: Конструктор позволяет вносить изменения манифеста расширения VSIX

Вместо непосредственного редактирования XML-манифест, можно использовать новый **необходимые компоненты** вкладку в конструкторе манифестов, чтобы выбрать необходимые компоненты и XML будет обновляться автоматически.

>**Примечание:** конструктор манифеста можно будет только для выбора компонентов (не рабочих нагрузок или пакетов), которые установлены в текущем экземпляре Visual Studio. Если необходимо добавить необходимый компонент для рабочей нагрузки, пакет или компонент, который еще не установлена, измените манифест XML напрямую.

* Откройте файл source.extension.vsixmanifest [Design].
* Выберите **необходимые компоненты** вкладку и нажмите клавишу **New** кнопки.

  ![Конструктор манифеста VSIX](media/vsix-manifest-designer.png)

* **Добавление новых необходимых компонентов** окно.

  ![Добавление необходимых компонентов vsix](media/add-vsix-prerequisite.png)

* Щелкните раскрывающийся список для **имя** и выберите нужный готовности к установке.
* При необходимости обновления версии.

  >Примечание: Поле версии будут заполнены, с версией, в настоящее время установленного компонента, с диапазоном охват до (но не включая) Далее основной номер версии компонента.

  ![Добавление необходимых компонентов roslyn](media/add-roslyn-prerequisite.png)

* Press **OK**.

## <a name="update-debug-settings-for-project"></a>Обновить параметры отладки для проекта

Если вы хотите выполнить отладку расширения в экспериментальном экземпляре Visual Studio, убедитесь, что параметры проекта для **отладки** > **действие при запуске** имеет **запустить внешний Программа:** значение файл devenv.exe установленной системы Visual Studio 2017 г.

Он может иметь вид:

```
C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\Common7\IDE\devenv.exe
```

![Запуск внешней программы](media/start-external-program.png)

>**Примечание:** отладки действие при запуске обычно хранится в. csproj.user файла. Этот файл обычно включаются в gitignore-файл и, следовательно, не сохраняется обычно с другими файлами проекта при фиксации в систему управления версиями. Таким образом Если были извлечены решение из системы управления версиями свежей вполне вероятно, проект будет содержать нет значения для Start Action. Будут иметь новые проекты VSIX, созданных с помощью Visual Studio 2017 г. csproj.user файл, созданный с параметрами по умолчанию, указывает на текущий каталог установки Visual Studio. Однако если вы переносите v2 расширение VSIX, весьма вероятно,. csproj.user файл будет содержать ссылки на каталог установки предыдущей версии Visual Studio. Значение свойства **отладки** > **действие при запуске** позволит правильно экспериментальный экземпляр Visual Studio для запуска при попытке выполнить отладку расширения.

## <a name="check-that-the-extension-builds-correctly-as-a-vsix-v3"></a>Проверьте, что расширение построений правильно (как VSIX v3)

* Выполните построение проекта VSIX.
* Распакуйте формируемый VSIX.
  * По умолчанию, жизни файла VSIX в bin/Debug или bin/Release как .vsix [YourCustomExtension].
  * Переименуйте .vsix на ZIP позволяет легко просмотреть содержимое.
* Проверка существования три файла:
  * файл Extension.vsixmanifest
  * manifest.JSON
  * Catalog.JSON

## <a name="check-when-all-required-prerequisites-are-installed"></a>Проверьте, если установлены все необходимые компоненты

Проверьте, VSIX успешно устанавливается на компьютере с установлены все необходимые необходимые компоненты.

>**Примечание:** перед установкой любого расширения, закройте все экземпляры Visual Studio.

Попытка установить расширение:

* В Visual Studio 2017 г.

![Установщик VSIX в Visual Studio 2017 г.](media/vsixinstaller-vs-2017.png)

* Необязательно: Установите в предыдущих версиях Visual Studio.
  * Подтверждает обратной совместимости.
  * Подойдут для Visual Studio 2012, Visual Studio 2013, Visual Studio 2015.
* Необязательно: Проверьте, что средство проверки версии установщик VSIX соответствует выбору версий.
  * Включает предыдущих версий Visual Studio (если он установлен).
  * Включает Visual Studio 2017 г.

Если недавно был открыт Visual Studio, может появиться диалоговое окно следующим образом:

![выполнение процессов VS](media/vs-running-processes.png)

Дождитесь процессов завершить работу, или вручную завершить задачи. Процессы можно найти по имени списка, или с Идентификатором, перечисленные в скобки.

>**Примечание:** эти процессы не будет завершать при запуске Visual Studio. Убедитесь, что завершения работы всех экземпляров Visual Studio на компьютере - включая те, у других пользователей, и повторять операцию.

## <a name="check-when-missing-the-required-prerequisites"></a>Проверьте при отсутствии необходимых компонентов

* Попытка установить расширение на компьютере с Visual Studio 2017 г., не СОДЕРЖАЩИЕ все компоненты, определенные в предварительных требованиях (выше).
* Убедитесь, что установки идентифицирует отсутствующий компонент/s и перечисляет их в качестве необходимого компонента в VSIXInstaller.
* Примечание: Повышение прав требуется, если все необходимые компоненты должны быть установлены с расширением.

![Отсутствует обязательный компонент vsixinstaller](media/vsixinstaller-missing-prerequisite.png)

## <a name="deciding-on-components"></a>Выбор компонентов

При поиске зависимостей, вы обнаружите, что несколько компонентов можно сопоставить одну зависимость. Для определения зависимости, которые следует указывать в необходимых компонентов рекомендуется выбрать компонент, имеющий функциональность, аналогичную расширения и для пользователей и какой тип компонентов будет они скорее установить или не забывайте установки. Также рекомендуется построение расширения таким образом, где необходимые условия удовлетворяют минимальным, обеспечивающие расширение для запуска и дополнительные функции имеют их быть неактивными, если некоторые компоненты не определяются.

Чтобы указать дополнительные рекомендации, мы нашли нескольких общих типов расширения и предлагаемые необходимых компонентах:

Тип расширения | Отображаемое имя | Идентификатор
--- | --- | ---
Редактор | Основной редактор Visual Studio  | Microsoft.VisualStudio.Component.CoreEditor
Roslyn | C# и Visual Basic | Microsoft.VisualStudio.Component.Roslyn.LanguageServices
WPF | Основные средства рабочей нагрузки управляемого рабочего стола | Microsoft.VisualStudio.Component.ManagedDesktop.Core
Отладчик | JIT-отладчик | Microsoft.VisualStudio.Component.Debugger.JustInTime

## <a name="finding-component-ids"></a>Поиск идентификаторов компонентов

Список компонентов, отсортированных по продуктам Visual Studio находится в [нагрузки 2017 г. Visual Studio и идентификаторов компонентов](https://aka.ms/vs2017componentIDs). Используйте эти идентификаторы компонента для вашей готовности к установке идентификаторов в манифесте.

Если неизвестно, какой компонент содержит определенный загружаемый файл двоичных данных, [компонентов -> Сопоставление двоичных объектов электронной таблицы](https://aka.ms/vs2017componentid-binaries).

### <a name="vs2017-componentbinarymappingxlsx"></a>vs2017 ComponentBinaryMapping.xlsx

В таблице Excel имеются четыре столбца: **имя компонента**, **ComponentId**, **версии**, и **двоичных и имена файлов**.  Можно использовать фильтры для поиска и нахождения конкретные компоненты и двоичные файлы.

Для всех ссылок сначала определите, какие из них относятся в основном компоненте редактор (Microsoft.VisualStudio.Component.CoreEditor).  Как минимум нам требуется компонент редактора core должен задаваться в качестве необходимого компонента для всех расширений. Ссылок, которые остаются, не входящие в базовый редактор, добавить фильтры в **двоичных файлов или имена файлов** раздел, чтобы найти компоненты, содержащие любое подмножество этих ссылок.

Примеры

* Если вы используете расширение отладчика и знать, что проект содержит ссылку на VSDebugEng.dll и VSDebug.dll, нажмите кнопку фильтра в **двоичных файлов или имена файлов** заголовок.  Поиск «VSDebugEng.dll» и нажмите кнопку OK.  Затем нажмите кнопку "Фильтр" в **двоичных файлов или имена файлов** заголовок еще раз и выполните поиск «VSDebug.dll».  Установите флажок «Добавить выделенный фрагмент в фильтр» и нажмите кнопку OK.  Теперь просмотрите **имя компонента** найти компонент, наиболее связанную с вашей типом расширения. В этом примере вы выбрали только время отладчика и добавить его в ваш vsixmanifest.
* Если вы знаете, проект посвящена элементы отладчика, можно выполнить поиск по «debugger» в поле фильтра поиска содержат компоненты отладчика в своем имени.

## <a name="specifying-a-visual-studio-2017-release"></a>Указание версии Visual Studio 2017 г.

Если расширение требует определенной версии Visual Studio 2017 г., например, зависит от компонентов, выпущенные в 15,3, необходимо указать номер сборки в вашего VSIX **InstallationTarget**. Например версия 15,3 содержит ряд построения "15.0.26730.3». Вы увидите сопоставление выпусков для номера построения [здесь](../install/visual-studio-build-numbers-and-release-dates.md). С помощью номера версии «15,3"будет работать неправильно.

Если для модуля требуется 15,3 или более поздней версии, можно объявить **InstallationTarget версии** как [15.0.26730.3, 16.0):

```xml
<Installation>
  <InstallationTarget Id="Microsoft.VisualStudio.Community" Version="[15.0.26730.3, 16.0)" />
</Installation>
```