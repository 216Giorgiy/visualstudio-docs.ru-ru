---
title: "Практическое руководство: перенести проекты расширения среды Visual Studio 2017 г. | Документы Microsoft"
ms.custom: 
ms.date: 11/09/2016
ms.reviewer: 
ms.suite: 
ms.technology:
- vs-ide-sdk
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 8ca07b00-a3ff-40ab-b647-c0a93b55e86a
caps.latest.revision: 1
author: gregvanl
ms.author: gregvanl
manager: ghogen
translation.priority.mt:
- cs-cz
- de-de
- es-es
- fr-fr
- it-it
- ja-jp
- ko-kr
- pl-pl
- pt-br
- ru-ru
- tr-tr
- zh-cn
- zh-tw
translationtype: Machine Translation
ms.sourcegitcommit: 4f93b8c1db59dd8d8a407c82002240641be43018
ms.openlocfilehash: 1f9248442357c4447703ac6d6dac8a27934904e8
ms.lasthandoff: 03/01/2017

---
# <a name="how-to-migrate-extensibility-projects-to-visual-studio-2017"></a>Практическое руководство: перенести проекты расширения среды Visual Studio 2017 г.

>**Примечание:** этот документ является предварительным и зависимости в выпуске версии-Кандидата Visual Studio 2017 г.

В этом документе объясняется, как обновить проекты расширения среды для Visual Studio 2017 г. Кроме описания обновление файлов проекта, он также описывает, как обновление до новой версии 3 VSIX манифеста формат (VSIX v3) расширения манифеста версии 2 (VSIX v2).

## <a name="install-visual-studio-2017-rc-with-required-workloads"></a>Установка Visual Studio RC 2017 г. с рабочих нагрузок

Убедитесь, что установка включает следующие рабочие нагрузки:

* Разработка настольных приложений .NET
* Разработка расширений Visual Studio

## <a name="open-vsix-solution-in-visual-studio-2017"></a>Откройте решение VSIX в Visual Studio 2017 г.

Все проекты VSIX будет требуют одностороннего обновления для Visual Studio 2017 г.

Файл проекта (например, *.csproj) будет обновлена:

* Теперь значение MinimumVisualStudioVersion - 15.0
* OldToolsVersion (если существует ранее) — теперь присвоено значение 14.0

## <a name="update-the-microsoftvssdkbuildtools-nuget-package"></a>Обновления пакета Microsoft.VSSDK.BuildTools NuGet

>**Примечание:** Если решение не ссылаются на пакет Microsoft.VSSDK.BuildTools NuGet, этот шаг можно пропустить.

Для создания расширения в новый v3 VSIX формат (версии 3), решение будет необходимо построить с помощью новых средств VSSDK сборки. Это будет устанавливается вместе с Visual Studio RC 2017 г., но v2 расширения VSIX может хранение ссылки на более старую версию через NuGet. В этом случае необходимо вручную установить обновление пакета Microsoft.VSSDK.BuildTools NuGet для вашего решения. Во время выпуска версии-КАНДИДАТА этот пакет будет находиться в состоянии «Предварительный выпуск».

Чтобы обновить ссылки на NuGet для Microsoft.VSSDK.BuildTools:

* Щелкните правой кнопкой мыши на решении и выберите **управление пакетами NuGet для решения...**
* Перейдите к **обновления** вкладки.
* Установите флажок, чтобы **включить предварительный выпуск**.
* Выберите Microsoft.VSSDK.BuildTools (последняя версия).
* Нажмите клавишу **обновление**.

![Средства построения VSSDK](media/vssdk-build-tools.png)

>**Примечание:** на снимке экрана показан другой версии BuildTools. Выберите версию-КАНДИДАТ.

## <a name="make-changes-to-the-vsix-extension-manifest"></a>Внесите изменения в манифест VSIX расширения

Чтобы гарантировать пользователя установки Visual Studio все сборки, необходимые для запуска расширения, укажите все необходимые компоненты и пакеты в файле манифеста расширения. Когда пользователь пытается установить расширение, VSIXInstaller проверит наличие всех необходимых компонентов. Если отсутствуют некоторые, пользователю будет предложено установить недостающие компоненты, как часть процесса установки расширения.

>**Примечание:** как минимум все расширения следует указать основной компонент редактора Visual Studio в качестве необходимого компонента.

* Измените расширение файла манифеста (обычно называемый source.extension.vsixmanifest).
* Обеспечить `InstallationTarget` включает 15,0.
* Добавление необходимых для установки компонентов (как показано в примере ниже).
  * Рекомендуется указывать только идентификаторы компонентов для установки необходимых компонентов.
  * В конце этого документа в разделе [инструкции по определению идентификаторов компонентов](#finding-component-ids).

Пример

```xml
<PackageManifest>
 ...
    <Prerequisites>
        <Prerequisite Id="Microsoft.VisualStudio.Component.CoreEditor" Version="[15.0,16.0)" />
        <Prerequisite Id="Microsoft.VisualStudio.Component.DiagnosticTools" Version="[15.0.25814.0,16.0)" />
        <Prerequisite Id="Microsoft.VisualStudio.Shell.12.0" Version="[12.0]" />
    </Prerequisites>
 ...
</PackageManifest>
```

### <a name="option-use-the-designer-to-make-changes-to-the-vsix-extension-manifest"></a>Параметр: Конструктор позволяет внести изменения в манифест VSIX расширения

Вместо непосредственного редактирования XML-манифеста, можно использовать новый **предварительные требования** вкладки конструктора манифеста, чтобы выбрать необходимые компоненты и XML будет обновляться автоматически.

>**Примечание:** конструкторе манифеста только позволяют выбрать компоненты (не рабочих нагрузок или пакетов), установленные в текущем экземпляре Visual Studio. Если необходимо добавить необходимое условие для рабочей нагрузки, пакет или компонент, который еще не установлена, измените манифест XML напрямую.

* Откройте файл source.extension.vsixmanifest [Design].
* Выберите **необходимые компоненты** и нажмите **New** кнопки.

  ![Конструктор манифеста VSIX](media/vsix-manifest-designer.png)

* **Добавление новых необходимых компонентов** окно.

  ![Добавление необходимых компонентов vsix](media/add-vsix-prerequisite.png)

* Щелкните раскрывающийся список для **имя** и выберите нужное готовности к установке.
* Обновите версию, если это требуется.

  >Примечание: Поле версии будет предварительно заполнен версии установленных компонента, с диапазоном охват до (но не включая) следующей основной версии компонента.

  ![Добавление необходимых компонентов roslyn](media/add-roslyn-prerequisite.png)

* Press **OK**.

## <a name="if-migrating-from-preview-4-or-preview-5"></a>Если миграция из предварительной версии 4 или 5 предварительного просмотра

* Замените `SetupDependencies` с `Prerequisites` и перемещать элементы из `Installer` элемента. `Prerequisites`Теперь документа прямо `PackageManifest` элемента.
* [Необязательно] Удалить `GenerateVsixV3` элемент. (Это требовалось в предварительной версии 5 только.) `GenerateVsixV3` Элемент будет учитываться в версий после предварительной версии 5.

## <a name="update-debug-settings-for-project"></a>Обновление параметров отладки для проекта

Если вы хотите выполнить отладку расширения в экспериментальном экземпляре Visual Studio, убедитесь, что параметры проекта для **отладки** > **действие при запуске** имеет **запуск внешней программы:** значение файл devenv.exe установки Visual Studio 2017 г.

Это может выглядеть:

```
C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\Common7\IDE\devenv.exe
```

![Запуск внешней программы](media/start-external-program.png)

>**Примечание:** отладки действие при запуске обычно хранится в. csproj.user файла. Этот файл обычно включается в файл .gitignore и таким образом, не сохраняется обычно с другими файлами проекта при фиксации в систему управления версиями. Таким образом Если были извлечены из системы управления версиями новые решения весьма вероятно, проект будет содержать значения не задать для запуска действия. Будет иметь новые проекты VSIX, созданные с помощью Visual Studio 2017 г. csproj.user файл, созданный с помощью значений по умолчанию, указывает на текущий каталог установки Visual Studio. Однако при переходе с расширением VSIX v2, вероятнее всего,. csproj.user файл будет содержать ссылки на каталог установки предыдущей версии Visual Studio. Для параметра **отладки** > **действие при запуске** позволит правильно экспериментальный экземпляр Visual Studio для запуска при попытке выполнить отладку расширения.

## <a name="check-that-the-extension-builds-correctly-as-a-vsix-v3"></a>Проверьте, что расширение построений правильно (как VSIX v3)

* Создайте проект VSIX.
* Распакуйте формируемый VSIX.
  * По умолчанию жизнь файл VSIX в bin/Debug или bin/Release как .vsix [YourCustomExtension].
  * Переименуйте .vsix на ZIP для более удобного просмотра содержимого.
* Проверьте наличие трех файлов:
  * Extension.vsixmanifest
  * manifest.JSON
  * Catalog.JSON

## <a name="check-when-all-required-prerequisites-are-installed"></a>Если установлены все необходимые компоненты

Убедитесь, что VSIX успешно устанавливает на компьютере установлены все необходимые условия.

>**Примечание:** перед установкой любого модуля, завершите работу всех экземпляров Visual Studio.

Попытка установить расширение:

* В Visual Studio RC 2017 г.

![Установщик VSIX в Visual Studio 2017 г.](media/vsixinstaller-vs-2017.png)

* Необязательно: Проверьте в предыдущих версиях Visual Studio.
  * Подтверждает обратной совместимости.
  * Должны работать для Visual Studio 2012, Visual Studio 2013, Visual Studio 2015.
* Необязательно: Проверьте, что проверка версии установщик VSIX соответствует выбору версий.
  * Включает предыдущие версии Visual Studio (если он установлен).
  * Включает в себя Visual Studio RC 2017 г.

Если недавно открыть Visual Studio, может появиться диалоговое окно следующим образом:

![VS запущенных процессов](media/vs-running-processes.png)

Подождите завершения работы процессов или вручную завершить задачи. Процессы можно найти по имени или с Идентификатором, перечисленные в скобках.

>**Примечание:** эти процессы будут автоматически не выключается при запуске Visual Studio. Убедитесь, что завершения работы всех экземпляров Visual Studio на компьютерах, включая те, у других пользователей, и повторять попытки.

## <a name="check-when-missing-the-required-prerequisites"></a>Если отсутствуют необходимые компоненты

* Предпринята попытка установить расширение на компьютере с Visual Studio 2017 г. версия-Кандидат, СОДЕРЖАЩИЕ не все компоненты, определенные в необходимых компонентов (см. выше).
* Убедитесь, что установка идентифицирует отсутствующий компонент/s и они перечислены в качестве необходимого компонента в VSIXInstaller.
* Примечание: Повышение потребуется, если все необходимые компоненты должны быть установлены с расширением.

![отсутствует необходимый компонент vsixinstaller](media/vsixinstaller-missing-prerequisite.png)

## <a name="deciding-on-components"></a>Выбор компонентов

При поиске зависимостей, вы увидите, что одна зависимость можно сопоставить несколько компонентов. Чтобы определить, какие зависимости следует указать в качестве своей условием, рекомендуется выбрать компонент, который содержит функциональные возможности, аналогичные расширения, а также рассмотреть пользователей и какого рода компоненты бы скорее установленного или не стал бы возражать установки. Рекомендуется построение расширения таким образом, где необходимые условия удовлетворяют минимальным, что позволит выполнять расширения для запуска и дополнительные функции попросите быть неактивными, если некоторые компоненты не определяются.

Для дальнейшего руководства, мы определили несколько распространенных типов расширения и предлагаемые необходимых компонентах:

Тип расширения | Отображаемое имя |    Идентификатор
--- | --- | ---
Редактор | Основной редактор Visual Studio    | Microsoft.VisualStudio.CoreEditor
Roslyn | C# и Visual Basic | Microsoft.VisualStudio.Component.Roslyn.LanguageServices
WPF | Основные управляемого рабочего стола рабочей нагрузки | Microsoft.VisualStudio.Component.ManagedDesktop.Core
Отладчик | Отладчик Just-In-Time | Microsoft.VisualStudio.Component.Debugger.JustInTime

## <a name="finding-component-ids"></a>Поиск идентификаторов компонентов

Список компонентов, отсортированных по продукту Visual Studio [нагрузки 2017 г. Visual Studio и идентификаторы компонента](https://aka.ms/vs2017componentIDs). Используйте эти идентификаторы компонента для вашей готовности идентификаторов в манифесте.

Если неизвестно, какой компонент содержит определенные загрузки двоичных данных, [компонента-> электронной таблицы сопоставление двоичных объектов](https://aka.ms/vs2017componentid-binaries).

### <a name="vs2017-componentbinarymappingxlsx"></a>vs2017 ComponentBinaryMapping.xlsx

Существует четыре столбца в таблице Excel: **имя компонента**, **ComponentId**, **версии**, и **двоичных и имена файлов**.  Можно использовать фильтры для поиска конкретных компонентов и двоичные файлы.

Для всех ссылок сначала определите, какие из них находятся в основной компонент редактора (Microsoft.VisualStudio.Component.CoreEditor).  Как минимум требуется основной редактор компонент должен задаваться как необходимый компонент для всех расширений. Ссылок, которые остаются, не входящие в базовый редактор, добавить фильтры в **двоичных файлов и имена файлов** для поиска компонентов, содержащие любое подмножество этих ссылок.

Примеры

* Если с расширением отладчика и знать, что проект содержит ссылку на VSDebugEng.dll и VSDebug.dll, нажмите кнопку фильтра в **двоичных файлов и имена файлов** заголовок.  Поиск «VSDebugEng.dll» и нажмите кнопку ОК.  Далее нажмите кнопку фильтра в **двоичных файлов и имена файлов** заголовок еще раз и выполните поиск «VSDebug.dll».  Установите флажок «Добавить выделенный фрагмент в фильтр» и нажмите кнопку ОК.  Теперь просмотрите **имя компонента** найти компонент, который наиболее часто связанные с типа расширения. В этом примере вы выбрали только время отладчика и добавить его в ваш vsixmanifest.
* Если вы знаете, проект посвящена элементы отладчика, вы можете выполнять поиск «отладчик» в поле фильтра поиска компонентов, которые содержат отладчика в его имя.

