---
title: "Практическое руководство: реализации вложенных проектов | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-ide-sdk"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "вложенные проекты, реализация"
  - "проекты [Visual Studio SDK] вложение"
ms.assetid: d20b8d6a-f0e0-4115-b3a3-edda893ae678
caps.latest.revision: 17
ms.author: "gregvanl"
manager: "ghogen"
caps.handback.revision: 17
---
# Практическое руководство: реализации вложенных проектов
[!INCLUDE[vs2017banner](../../code-quality/includes/vs2017banner.md)]

При создании вложенного типа проекта несколько дополнительных действий, которые должны быть реализованы.  Родительский проект принимает некоторые из одних и тех же ответственностей, имеющий для его решение вложенных проектов \(дочернего элемента\).  Родительский проект контейнера проектов, похожих на решение.  В частности, существует несколько событий, которые должны быть созданы решением и родительскими проектами построить иерархию вложенных проектов.  Эти события описаны в следующем процессе создания вложенных проектов.  
  
### Для создания вложенного проекты  
  
1.  Интегрированная среда разработки \(ide\) загружает данные родительского проекта и запуска файла проекта путем вызова <xref:Microsoft.VisualStudio.Shell.Interop.IVsProjectFactory> интерфейс.  Родительский проект создается и добавляется в решение.  
  
    > [!NOTE]
    >  На этом этапе он слишком в начале процесса родительского проекта создать вложенные проекта, поскольку родительский проект должен быть создан до того, как проекты дочернего элемента могут быть созданы.  После последовательности родительский проект может применить параметры к проектам дочернего элемента и проекты дочернего элемента могут получить сведения из родительских проектов.  Эта последовательность, если она необходима on клиентами как элемент управления исходным кодом \(SCC\) и обозреватель решений.  
  
     Родительский проект должен ожидать <xref:Microsoft.VisualStudio.Shell.Interop.IVsParentProject.OpenChildren%2A> метод, который будет вызывать среда разработки, прежде чем она могла создать его вложенный проект или проекты \(дочернего элемента\).  
  
2.  Вызовы интегрированной среды разработки `QueryInterface` в родительском проекте для  <xref:Microsoft.VisualStudio.Shell.Interop.IVsParentProject>.  Если этот вызов выполняется успешно, то среда разработки вызывает <xref:Microsoft.VisualStudio.Shell.Interop.IVsParentProject.OpenChildren%2A> метод родительского элемента для открытия всех вложенных проектов для родительского проекта.  
  
3.  Родительский проект вызывает <xref:Microsoft.VisualStudio.Shell.Interop.IVsFireSolutionEvents.FireOnBeforeOpeningChildren%2A> метод для уведомления прослушивателей, что вложенное проекты будет создан.  SCC, например прослушивает этим событиям, чтобы узнать, если шаги в процессе создания проекта и решения происходят в следующем порядке.  Если шаги выполняются вне очереди, решение не может быть зарегистрировано с элементом управления исходным кодом.  
  
4.  Вызовы родительского проекта <xref:Microsoft.VisualStudio.Shell.Interop.IVsSolution.AddVirtualProjectEx%2A> метод или  <xref:Microsoft.VisualStudio.Shell.Interop.IVsSolution.AddVirtualProject%2A> метод на каждом из проектов дочернего элемента.  
  
     Передать <xref:Microsoft.VisualStudio.Shell.Interop.__VSADDVPFLAGS> к  `AddVirtualProject` для указания того, что метод является виртуальным \(вложенных\) проект должен быть добавлен в окно проекта, исключенному из построения, добавил в систему управления исходным кодом и т д  `VSADDVPFLAGS` позволяет управлять видимостью вложенных проектов и отображения указывается, какие функции связана с ней.  
  
     При перезапуске ранее существующего проекта, то дочерний элемент, который имеет идентификатор GUID проекта, хранящиеся в файле проекта родительского проекта родительский проект вызывает `AddVirtualProjectEx`.  Единственное различие  <xref:Microsoft.VisualStudio.Shell.Interop.IVsSolution.GetProjectOfProjref%2A> и  <xref:Microsoft.VisualStudio.Shell.Interop.IVsSolution.GetProjectOfGuid%2A> значение  `AddVirtualProject` содержит параметр для включения родительский проект определить, а в экземпляр  `AddVirtualProjectEX` для проекта дочернего элемента разрешения  `AddVirtualProjectEX` и  `guidProjectID` работать правильно.  
  
     Если отсутствует GUID, например при добавлении нового вложенный проект, решение создает его для проекта при его добавлении к родительскому элементу.  Обязанностью родительского проекта сохранять то GUID проекта в файле проекта.  При удалении вложенных проекта GUID для проекта можно также удалять.  
  
5.  Интегрированная среда разработки вызывает `M:Microsoft.VisualStudio.Shell.Interop.IVsParentProject.OpenChildren` метод на каждом проекте дочернего элемента родительского проекта.  
  
     Родительский проект должен реализовать `IVsParentProject` если требуется вложить проектов.  Но никогда не вызывает родительского проекта `QueryInterface` для  `IVsParentProject` даже если он содержит родительские проектов под ним.  Решение обрабатывает вызов `IVsParentProject` и, если она имеется, то вызовы  `OpenChildren` создание вложенных проектов.  `AddVirtualProjectEX` всегда вызываются из  `OpenChildren`.  Он никогда не должен вызываться родительским проектом сохранить события в порядке создания иерархии.  
  
6.  Интегрированная среда разработки вызывает <xref:Microsoft.VisualStudio.Shell.Interop.IVsSolutionEvents3.OnAfterOpenProject%2A> метод в проекте дочернего элемента.  
  
7.  Родительский проект вызывает <xref:Microsoft.VisualStudio.Shell.Interop.IVsFireSolutionEvents.FireOnAfterOpeningChildren%2A> метод для уведомления прослушивателей, что созданных проектов дочернего элемента для родительского объекта.  
  
8.  Интегрированная среда разработки вызывает <xref:Microsoft.VisualStudio.Shell.Interop.IVsFireSolutionEvents.FireOnAfterOpenProject%2A> метод в родительском проекте после того, как все проекты дочернего элемента будут открывать.  
  
     , Если он еще не существует, то родительский проект создает идентификатор GUID для каждого вложенных проектов путем вызова `CoCreateGuid`.  
  
    > [!NOTE]
    >  `CoCreateGuid` API, называемого моделью COM, если идентификатор GUID.  Дополнительные сведения см. в разделе `CoCreateGuid` и GUID в библиотеке MSDN.  
  
     Родительский проект сохраняет этот идентификатор GUID в файле проекта, который требуется получить в следующий раз, ему открыты в интегрированной среде разработки.  См. раздел 4 дополнительные сведения, относящиеся к вызова `AddVirtualProjectEX` восстановление  `guidProjectID` для проекта дочернего элемента.  
  
9. <xref:Microsoft.VisualStudio.Shell.Interop.IVsHierarchy.GetProperty%2A> затем метод вызывается для родительского ItemID, соглашению для делегируете in с вложенным проект.  <xref:Microsoft.VisualStudio.Shell.Interop.IVsHierarchy.GetProperty%2A> извлекает свойства узла, который вложен проект котором необходимо делегировать когда он вызывается в родительском объекте.  
  
     Поскольку проекты родительского узла и дочернего элемента создается программным образом, и можно задать свойства для вложенных проектов на этом этапе.  
  
    > [!NOTE]
    >  Не только получить контекстные данные из вложенных проектов, но можно также запросить если родительский проект имеет любой контекст для этого элемента путем проверки <xref:Microsoft.VisualStudio.Shell.Interop.__VSHPROPID>.  В этом случае можно добавлять дополнительные атрибуты Справки и динамические параметры меню, относящиеся к отдельным вложенных проектов.  
  
10. Иерархия построена для отображения в обозревателе решений с вызовом <xref:Microsoft.VisualStudio.Shell.Interop.IVsHierarchy.GetNestedHierarchy%2A> метод.  
  
     Передаче иерархию для среды до конца `GetNestedHierarchy` построить иерархию для отображения в обозревателе решений.  Таким образом, решение знает, что проект существует и может быть управляемым диспетчером построения для построения или может разрешить файлы в проекте, помещаемая в систему управления исходным кодом.  
  
11. Если были созданы все вложенных проектов для Project1, элемент управления передается обратно в решение, и процесс повторенн для Project2.  
  
     Это тот же процесс создания вложенных проектов происходит для проекта дочернего элемента, имеющего дочерний элемент.  В этом случае, если BuildProject1, дочерний элемент Project1, имело проекты дочернего элемента, то они были бы созданы после BuildProject1 и перед Project2.  Процесс рекурсивн и построена сверху вниз.  
  
     Если вложенный проект закрыт, поскольку пользователь закрыл само решение или проект, определенный другой метод `IVsParentProject`"  <xref:Microsoft.VisualStudio.Shell.Interop.IVsParentProject.CloseChildren%2A>, вызывает.  Вызовы загрузки программы\-оболочек родительского проекта к <xref:Microsoft.VisualStudio.Shell.Interop.IVsSolutionEvents3.OnAfterClosingChildren%2A> метод с  <xref:Microsoft.VisualStudio.Shell.Interop.IVsSolutionEvents3.OnBeforeClosingChildren%2A> и  <xref:Microsoft.VisualStudio.Shell.Interop.IVsSolution.RemoveVirtualProject%2A> методы для уведомления прослушивателей на события решения, что вложенное проекты закрыть.  
  
 В следующих подразделах которых описывается несколько других понятий, которые необходимо учитывать при реализации вложенных проектов:  
  
 [Рекомендации по выгрузка и перезагрузка вложенных проектов](../../extensibility/internals/considerations-for-unloading-and-reloading-nested-projects.md)  
  
 [Поддержка мастера для вложенных проектов](../../extensibility/internals/wizard-support-for-nested-projects.md)  
  
 [Реализация команды обработки вложенных проектов](../../extensibility/internals/implementing-command-handling-for-nested-projects.md)  
  
 [Фильтрация AddItem диалоговым окном для вложенных проектов](../../extensibility/internals/filtering-the-additem-dialog-box-for-nested-projects.md)  
  
## См. также  
 [Добавление элементов, чтобы добавить новый элемент диалоговые окна](../../extensibility/internals/adding-items-to-the-add-new-item-dialog-boxes.md)   
 [Регистрация шаблонов проектов и элементов](../../extensibility/internals/registering-project-and-item-templates.md)   
 [Контрольный список: Создание новых типов проектов](../../extensibility/internals/checklist-creating-new-project-types.md)   
 [Контекстные параметры](../../extensibility/internals/context-parameters.md)   
 [Мастер \(. Файл VSZ\)](../../extensibility/internals/wizard-dot-vsz-file.md)