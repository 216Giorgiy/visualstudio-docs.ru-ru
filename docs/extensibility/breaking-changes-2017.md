---
title: "Критические изменения в расширения Visual Studio 2017 г. | Документы Microsoft"
ms.custom: 
ms.date: 11/09/2016
ms.reviewer: 
ms.suite: 
ms.technology:
- vs-ide-sdk
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 54d5af60-0b44-4ae1-aa57-45aa03f89f3d
caps.latest.revision: 1
author: gregvanl
ms.author: gregvanl
manager: ghogen
translation.priority.mt:
- cs-cz
- de-de
- es-es
- fr-fr
- it-it
- ja-jp
- ko-kr
- pl-pl
- pt-br
- ru-ru
- tr-tr
- zh-cn
- zh-tw
translationtype: Machine Translation
ms.sourcegitcommit: 221f4911981deec0330f76a82c0cc8a1b968e56e
ms.openlocfilehash: 081a569fc7e38fecc8cc1ae5b0f8138ae8f25521
ms.lasthandoff: 02/22/2017

---
# <a name="changes-in-visual-studio-2017-extensibility"></a>Изменения расширяемости Visual Studio 2017 г.

>**Примечание:** этот документ является предварительным и зависимости в выпуске версии-Кандидата Visual Studio 2017 г.

С помощью Visual Studio 2017 г., мы предлагаем [быстрее, облегченный возможности установки Visual Studio](https://blogs.msdn.microsoft.com/visualstudio/2016/04/01/faster-leaner-visual-studio-installer) , позволяет снизить нагрузку Visual Studio на компьютерах пользователей, одновременно обеспечивая для пользователей больше Выбор рабочих нагрузок и установленных компонентов. Для поддержки этих усовершенствований, мы внесли изменения в модель расширяемости и внесены изменения, критические по расширяемости Visual Studio. В этом документе описываются технические сведения, эти изменения и что можно сделать для их устранения. Обратите внимание, что некоторые данные в момент его реализации и может быть изменен.

## <a name="changes-affecting-vsix-format-and-installation"></a>Изменения, влияющие на формат VSIX и установки

Мы рассматриваем VSIX v3 формате (версия 3) для поддержки взаимодействия Упрощенная установка.

Внесены следующие изменения в формате VSIX.

* Объявление готовности к установке. Для доставки для обещания упрощенный, быстрый установка Visual Studio программа установки предлагает дополнительные параметры конфигурации для пользователей. В результате для обеспечения возможности и компоненты, необходимые для расширения устанавливаются расширения необходимо объявлять их зависимости.
  * После выпуска версии-КАНДИДАТА получить и установить необходимые компоненты для пользователя в рамках установки расширения автоматически предложит установщика Visual Studio 2017 г.
  * При попытке установить расширение, не был построен с использованием нового формата VSIX v3, даже если они были помечены в их манифесте как версией 15,0 пользователей также предупреждение.
* Улучшенные возможности для формата VSIX. Для достижения [установки серьезных последствий](https://blogs.msdn.microsoft.com/visualstudio/2016/04/25/anatomy-of-a-low-impact-visual-studio-install) Visual Studio, также поддерживает устанавливает side-by-side, мы больше не сохраните большую часть данных конфигурации в системный реестр и перемещены в Visual Studio сборки из глобального кэша СБОРОК. Мы также увеличить возможности формата VSIX и механизм установки VSIX, позволяя использовать его вместо MSI-файла или exe-ФАЙЛ для установки расширений, для некоторых типов установки.

  Новые возможности включают:

  * Регистрация в указанном экземпляре Visual Studio.
  * Установки вне [папку расширения](set-install-root.md).
  * Определение архитектуры процессора.
  * Зависимость от языка запятыми языковые пакеты.
  * Установка с [поддержки NGEN](ngen-support.md).

## <a name="building-an-extension-for-visual-studio-2017"></a>Разработка расширения для Visual Studio 2017 г.

Конструктор, набор инструментов для создания нового формата манифеста VSIX v3 теперь доступен в Visual Studio 2017 г. См. в соответствующем документе [как: перенос проекты расширения среды для Visual Studio 2017 г](how-to-migrate-extensibility-projects-to-visual-studio-2017.md) подробные сведения с помощью средств конструктора или внесении обновлений вручную в проект и манифеста для разработки расширений VSIX v3.

## <a name="change-visual-studio-user-data-path"></a>Изменения: Путь к данным пользователя Visual Studio

Ранее только одна копия каждой основной версии Visual Studio может присутствовать на каждом компьютере. Для поддержки side-by-side установки Visual Studio 2017 г., нескольких путей данных пользователя для Visual Studio могут существовать на компьютере пользователя.

Кодом, выполняемым внутри процесса Visual Studio должны быть обновлены для использования диспетчера параметров в Visual Studio. Код, выполняемый вне процесса Visual Studio можно найти путь пользователя конкретной установки Visual Studio [, следуя указаниям ниже](https://blogs.msdn.microsoft.com/heaths/2016/09/15/changes-to-visual-studio-15-setup).

## <a name="change-global-assembly-cache-gac"></a>Изменение: Глобальный кэш сборок (GAC)

Большинство основных сборок Visual Studio больше не устанавливаются в глобальном кэше СБОРОК. Следующие изменения были внесены, чтобы код, выполняемый в процесс Visual Studio по-прежнему можно найти необходимые сборки во время выполнения.

* Сборки, которые были установлены только в глобальном кэше СБОРОК:
  * Теперь эти сборки установлены в разделе %VsFolder%\Common7\IDE\, %VsFolder%\Common7\IDE\PublicAssemblies или % VsFolder%\Common7\IDE\PrivateAssemblies. Эти папки являются частью процесса Visual Studio путей поиска.
* Сборки, которые были установлены в путь без проверки и в глобальном кэше СБОРОК:
  * Копировать в глобальном кэше СБОРОК был удален из программы установки.
  * Файл pkgdef было добавлено для указания записи базы кода для сборки.

    Пример:
    
    ```xml
    [$RootKey$\RuntimeConfiguration\dependentAssembly\codeBase\{UniqueGUID}]
    "name"="AssemblyName" "codeBase"="$PackageFolder$\AssemblyName.dll"
    "publicKeyToken"="Public Key Token"
    "culture"="neutral"
    "version"=15.0.0.0
    ```
    Во время выполнения, подсистема pkgdef Visual Studio объединит эти записи в файл конфигурации среды выполнения процесса Visual Studio (в % VsAppDataFolder%\devenv.exe.config) как [ `<codeBase>` ](https://msdn.microsoft.com/en-us/library/efs781xb(v=vs.110).aspx) элементы. Это рекомендуемый способ позволяют найти сборку в процесс Visual Studio, потому что позволяет избежать проверки пути поиска.

### <a name="reacting-to-this-breaking-change"></a>Отклик на это критическое изменение

* Если расширения выполняется в рамках процесса Visual Studio:
  * Код смогут найти Visual Studio основные сборки.
  * Рассмотрите возможность использования pkgdef-файл для указания пути к сборки при необходимости.
* Если расширение выполняется вне процесса Visual Studio:
  * Рассмотрим поиск основных сборок Visual Studio под %VsFolder%\Common7\IDE\, %VsFolder%\Common7\IDE\PublicAssemblies или %VsFolder%\Common7\IDE\PrivateAssemblies с помощью распознавателя конфигурации файла или сборки.

## <a name="change-reduce-registry-impact"></a>Изменение: Уменьшить влияние реестра

### <a name="global-com-registration"></a>Глобальной регистрации COM

* Ранее Visual Studio устанавливается много разделов реестра в куст HKEY_CLASSES_ROOT и HKEY_LOCAL_MACHINE, для поддержки собственной регистрации COM. Чтобы устранить это влияние, Visual Studio использует [активации без регистрации для COM-компонентов](https://msdn.microsoft.com/en-us/library/ms973913.aspx).
* В результате большинство TLB / OLB или файлы DLL в % ProgramFiles (x86) %\Common Shared\MSEnv создаваемую больше не устанавливаются по умолчанию в Visual Studio. Теперь эти файлы устанавливаются в VsFolder % с манифестами соответствующий COM компонентов без регистрации, используемые в процессе размещения Visual Studio.
* В результате внешний код, который основывается на глобальной регистрации COM для интерфейсов Visual Studio COM больше не найти эти операции регистрации. Код, работающий внутри процесса Visual Studio не может заметить разницу.

### <a name="visual-studio-registry"></a>Visual Studio реестра

* Ранее Visual Studio установлено много разделов реестра в системе HKEY_LOCAL_MACHINE и HKEY_CURRENT_USER кустов Visual Studio конкретного раздела:
  * HKLM\Software\Microsoft\VisualStudio\\**версии**: ключи реестра, созданные MSI-установщики и расширения на уровне компьютера.
  * HKCU\Software\Microsoft\VisualStudio\\**версии**: разделы реестра, созданные с помощью Visual Studio для хранения пользовательских настроек.
  * HKCU\Software\Microsoft\VisualStudio\\**версии**_Config: слияние копии выше разделе Visual Studio HKLM, а также разделы реестра из файлов .pkgdef модулями.
* Чтобы снизить влияние на реестре, Visual Studio использует [RegLoadAppKey](https://msdn.microsoft.com/en-us/library/windows/desktop/ms724886(v=vs.85).aspx) функции для хранения разделов реестра в закрытый двоичный файл в каталоге % VsAppDataFolder%\privateregistry.bin. В системном реестре остаются только очень небольшое количество клавиш для определенного Visual Studio.
* Это не повлияет на существующий код, работающий внутри процесса Visual Studio. Visual Studio будет перенаправлять все операции реестра в разделе HKCU Visual Studio конкретного частный реестр. Чтение и запись в другие места реестра будет продолжать использовать системный реестр.
* Внешний код потребуется загрузить и прочитать из этого файла для записи реестра Visual Studio.

### <a name="reacting-to-this-breaking-change"></a>Отклик на это критическое изменение

* Для активации без регистрации для COM-компонентов также следует преобразовать внешний код.
* Внешние компоненты могут найти расположение Visual Studio [, следуя указаниям ниже](https://blogs.msdn.microsoft.com/heaths/2016/09/15/changes-to-visual-studio-15-setup).
* Мы рекомендуем использовать внешние компоненты [внешних диспетчер параметров](https://msdn.microsoft.com/en-us/library/microsoft.visualstudio.settings.externalsettingsmanager.aspx) вместо чтения/записи, непосредственно к разделам реестра Visual Studio.
* Проверьте, может ли реализовывать другая технология для регистрации компонентов, которые использует расширения. Например, можно попытаться воспользоваться преимуществами нового расширения отладчика [msvsmon регистрации COM JSON-файл](migrate-debugger-COM-registration.md).

## <a name="change-lightweight-solution-load"></a>Изменений: Простое решение нагрузки

Облегченная загрузить решение (LSL) уменьшает время загрузки решения путем загрузки не полностью проекты, пока пользователь начнет работу с ними. Это может влиять на расширения, которые предполагается, что проект полностью загружен. . В разделе [загрузке решения облегченного](lightweight-solution-load-extension-impact.md) ли расширение может отрицательно повлиять на и получите рекомендации по обновлению расширения.

