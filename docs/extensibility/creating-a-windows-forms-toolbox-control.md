---
title: "Создание элементов управления Windows Forms | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology:
- vs-ide-sdk
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- winforms
- toolbox
- windows forms
ms.assetid: 0be6ffc1-8afd-4d02-9a5d-e27dde05fde6
caps.latest.revision: 19
ms.author: gregvanl
manager: ghogen
translation.priority.mt:
- cs-cz
- de-de
- es-es
- fr-fr
- it-it
- ja-jp
- ko-kr
- pl-pl
- pt-br
- ru-ru
- tr-tr
- zh-cn
- zh-tw
translationtype: Machine Translation
ms.sourcegitcommit: 5658ecf52637a38bc3c2a5ad9e85b2edebf7d445
ms.openlocfilehash: 770963e06655c0d4da2946fa7981fd1e4496b7f0
ms.lasthandoff: 02/22/2017

---
# <a name="creating-a-windows-forms-toolbox-control"></a>Создание элементов управления Windows Forms
Шаблон элемента панели элементов управления Windows Forms, состава средств расширения Visual Studio (VS SDK) позволяет создать элемент управления, автоматически добавляется в **элементов** при установке расширения. В этом разделе показано, как использовать шаблон для создания простой счетчик элемента управления, который можно передавать другим пользователям.  
  
## <a name="prerequisites"></a>Предварительные требования  
 Начиная с Visual Studio 2015, не установить пакет SDK для Visual Studio из центра загрузки. Она будет включена в качестве дополнительного компонента в установку Visual Studio. VS SDK также можно установить позже. Дополнительные сведения см. в разделе [установка Visual Studio SDK](../extensibility/installing-the-visual-studio-sdk.md).  
  
## <a name="creating-a-windows-forms-toolbox-control"></a>Создание элементов управления Windows Forms  
 Создает не определен пользовательский элемент управления шаблона элементов управления Windows Forms и предоставляет все функциональные возможности, необходимые для добавления элемента управления для **элементов**.  
  
#### <a name="create-an-extension-with-a-windows-forms-toolbox-control"></a>Создайте расширение с помощью элементов управления Windows Forms  
  
1.  Создайте проект VSIX с именем `MyWinFormsControl`. Можно найти шаблон проекта VSIX в **новый проект** диалоговом окне под **Visual C# и расширяемость**.  
  
2.  При открытии проекта, добавить **элементов управления Windows Forms** шаблон элемента с именем `Counter`. В **обозревателе решений**, щелкните правой кнопкой мыши узел проекта и выберите **добавить или создать элемент**. В **Добавление нового элемента** диалоговое окно, последовательно выберите пункты **Visual C# и расширяемость** и выберите **элементов управления Windows Forms**  
  
3.  Это добавляет пользовательский элемент управления `ProvideToolboxControlAttribute` <xref:Microsoft.VisualStudio.Shell.RegistrationAttribute>для размещения элемента управления в **элементов**и **Microsoft.VisualStudio.ToolboxControl** запись ресурса в манифест VSIX для развертывания.</xref:Microsoft.VisualStudio.Shell.RegistrationAttribute>  
  
### <a name="building-a-user-interface-for-the-control"></a>Создание пользовательского интерфейса для элемента управления  
 `Counter` Управления требует два дочерних элемента управления: <xref:System.Windows.Forms.Label>для отображения текущего счетчика и <xref:System.Windows.Forms.Button>Сброс счетчика на 0.</xref:System.Windows.Forms.Button> </xref:System.Windows.Forms.Label> Другие дочерние элементы управления не являются необходимыми, поскольку вызывающих увеличивает значение счетчика программным способом.  
  
##### <a name="to-build-the-user-interface"></a>Создание пользовательского интерфейса  
  
1.  В **обозревателе**, дважды щелкните файл Counter.cs, чтобы открыть его в конструкторе.  
  
2.  Удалите «щелкните здесь!» **Кнопка** включается по умолчанию при добавлении шаблона элемента панели элементов управления Windows Forms.  
  
3.  От **элементов**, перетащите `Label` управления и затем `Button` управления под его на поверхность разработки.  
  
4.  Измените общий элемент управления на 150, 50 пикселей и изменение размера кнопки элемента управления значение 50, 20 пикселей.  
  
5.  В **свойства** установите следующие значения для элементов управления на поверхности разработки.  
  
    |Control|Свойство|Значение|  
    |-------------|--------------|-----------|  
    |`Label1`|**Текст**|""|  
    |`Button1`|**Имя**|btnReset|  
    |`Button1`|**Текст**|Сбросить|  
  
### <a name="coding-the-user-control"></a>Написание кода пользовательского элемента управления  
 Элемент управления `Counter` будет предоставлять метод для увеличения значения счетчика, событие, которое будет наступать всякий раз, когда значение счетчика увеличивается, кнопку `Reset` и три свойства для хранения текущего значения счетчика, отображаемого текста и значения, определяющего, должна ли кнопка `Reset` отображаться или скрываться. `ProvideToolboxControl` Атрибут определяет, где в **элементов** `Counter` появится элемент управления.  
  
##### <a name="to-code-the-user-control"></a>Код пользовательского элемента управления  
  
1.  Дважды щелкните форму, чтобы открыть его загрузки обработчика событий в окне кода.  
  
2.  Выше метод обработчика событий в классе элемента управления создайте целое число для хранения значения счетчика и строки для хранения текста, отображения, как показано в следующем примере.  
  
    ```c#  
    int currentValue;  
    string displayText;  
    ```  
  
3.  Создайте следующие объявления открытого свойства.  
  
    ```c#  
    public int Value {  
        get { return currentValue; }   
    }  
  
    public string Message {  
        get { return displayText; }  
        set { displayText = value; }  
    }  
  
    public bool ShowReset {  
        get { return btnReset.Visible; }  
        set { btnReset.Visible = value; }  
    }  
  
    ```  
  
     Вызывающие объекты могут обращаться к этим свойствам get и set счетчика отображаемый текст для отображения или скрытия `Reset` кнопки. Вызывающие объекты могут получить текущее значение только для чтения `Value` свойство, но они не удается задать значение напрямую.  
  
4.  Поместите следующий код `Load` событий для элемента управления.  
  
    ```c#  
    private void Counter_Load(object sender, EventArgs e)  
    {  
        currentValue = 0;  
        label1.Text = Message + Value;  
    }  
  
    ```  
  
     Установка **метка** текст в <xref:System.Windows.Forms.UserControl.Load>событий включает свойства целевого объекта для загрузки, прежде чем их значения применяются.</xref:System.Windows.Forms.UserControl.Load> Установка **метка** текста в конструкторе приведет к появлению пустой **метка**.  
  
5.  Создайте следующий открытый метод для увеличения значения счетчика.  
  
    ```c#  
    public void Increment()  
    {  
        currentValue++;  
        label1.Text = displayText + Value;  
        Incremented(this, EventArgs.Empty);  
    }  
  
    ```  
  
6.  Добавьте объявление для `Incremented` событий в класс элемента управления.  
  
    ```c#  
    public event EventHandler Incremented;  
    ```  
  
     Вызывающие объекты можно добавить обработчики для этого события и реагировать на изменения значения счетчика.  
  
7.  Возврат в режим конструктора и дважды щелкните `Reset` кнопку, чтобы создать `btnReset_Click` обработчик событий и заполнить его в, как показано в следующем примере.  
  
    ```c#  
    private void btnReset_Click(object sender, EventArgs e)  
    {  
        currentValue = 0;  
        label1.Text = displayText + Value;  
    }  
  
    ```  
  
8.  Непосредственно над определением класса в `ProvideToolboxControl` объявление атрибута, измените значение параметра из `"MyWinFormsControl.Counter"` в `"General"`. Таким образом задается имя группы элементов, в которой будет размещаться элемент управления на **панели элементов**.  
  
     В приведенном ниже примере показаны атрибут `ProvideToolboxControl` и скорректированное определение класса.  
  
    ```c#  
    [ProvideToolboxControl("General", false)]  
    public partial class Counter : UserControl  
    ```  
  
### <a name="testing-the-control"></a>Тестирование элемента управления  
 Чтобы проверить **элементов** управления, сначала проверить ее в среде разработки и его тестирование в скомпилированном приложении.  
  
##### <a name="to-test-the-control"></a>Тестирование элемента управления  
  
1.  Нажмите клавишу F5.  
  
     Это создает проект и открывает второй экспериментальный экземпляр Visual Studio с элементом управления установлен.  
  
2.  В экспериментальном экземпляре Visual Studio создайте **приложение Windows Forms** проекта.  
  
3.  В **обозревателе**, дважды щелкните файл Form1.cs, чтобы открыть его в конструкторе, если он еще не открыт.  
  
4.  В **элементов**, `Counter` элемент должен отображаться в **Общие** раздел.  
  
5.  Перетащите `Counter` управления в форму, а затем выберите его. `Value`, `Message`, И `ShowReset` свойства будут отображены в **свойства** окна, а также свойства, унаследованные от <xref:System.Windows.Forms.UserControl>.</xref:System.Windows.Forms.UserControl>  
  
6.  Задайте для свойства `Message` значение `Count:`.  
  
7.  Перетащите <xref:System.Windows.Forms.Button>управления на форму и задайте свойства name и text кнопки `Test`.</xref:System.Windows.Forms.Button>  
  
8.  Дважды щелкните кнопку откройте Form1.cs в представлении кода и создать обработчик щелчка.  
  
9. В обработчик щелчка вызвать `counter1.Increment()`.  
  
10. В функции конструктора, после вызова `InitializeComponent`, введите `counter1``.``Incremented +=` и нажмите клавишу TAB дважды.  
  
     Visual Studio создает уровне формы обработчик `counter1.Incremented` событий.  
  
11. Выделите `Throw` оператора в обработчике событий типа `mbox`, и нажмите клавишу TAB дважды, чтобы создать окно сообщения с mbox фрагмента кода.  
  
12. На следующей строке, добавьте следующий `if` / `else` блок, чтобы задать видимость `Reset` кнопки.  
  
    ```c#  
    if (counter1.Value < 5) counter1.ShowReset = false;  
    else counter1.ShowReset = true;  
    ```  
  
13. Нажмите клавишу F5.  
  
     Форма будет открыта. `Counter` Управления отображается следующий текст.  
  
     **Число: 0**  
  
14. Нажмите кнопку **Test**.  
  
     Увеличивает счетчик и Visual Studio отображает окно сообщения.  
  
15. Закройте окно сообщения.  
  
     **Сброс** исчезает кнопки.  
  
16. Щелкните **тест** пока не достигнет счетчика **5** Закрытие сообщения поля каждый раз.  
  
     **Сброс** кнопки появляется вновь.  
  
17. Нажмите кнопку **Reset**.  
  
     Сбрасывает счетчик **0**.  
  
## <a name="next-steps"></a>Дальнейшие действия  
 При создании элемента управления **панели элементов** Visual Studio создает файл с именем *Имя_проекта*.vsix в папке \bin\debug\ проекта. Чтобы развернуть элемент управления, можно отправить VSIX-файл в сеть или на веб-сайт. Когда пользователь открывает VSIX-файл, элемент управления установлена и добавлена в Visual Studio **элементов** на компьютере пользователя. Кроме того, можно загрузить VSIX-файл для [коллекции Visual Studio](http://go.microsoft.com/fwlink/?LinkID=123847) веб-узел, чтобы пользователи могли его найти, перейдя в **средства-расширения и обновления** диалогового окна.  
  
## <a name="see-also"></a>См. также  
 [Расширение панели элементов](../misc/extending-the-toolbox.md)   
 [Создание элементов управления WPF](../extensibility/creating-a-wpf-toolbox-control.md)   
 [Расширение других частей Visual Studio](../extensibility/extending-other-parts-of-visual-studio.md)   
 [Основы разработки элементов управления Windows Forms](http://msdn.microsoft.com/Library/6277bb81-90f7-4c5b-9f4b-b02bb42dd316)
