---
title: Создание Windows Forms элементов управления | Документы Microsoft
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- vs-ide-sdk
ms.topic: conceptual
helpviewer_keywords:
- winforms
- toolbox
- windows forms
ms.assetid: 0be6ffc1-8afd-4d02-9a5d-e27dde05fde6
author: gregvanl
ms.author: gregvanl
manager: douge
ms.workload:
- vssdk
ms.openlocfilehash: 6a7d5bae07d3596902f94417cda20c3d40feed2f
ms.sourcegitcommit: 6a9d5bd75e50947659fd6c837111a6a547884e2a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
---
# <a name="creating-a-windows-forms-toolbox-control"></a>Создание элементов управления Windows Forms
Шаблон элемента панели элементов управления Windows Forms, включенный в средства расширения Visual Studio (VS SDK) позволяет создать элемент управления, который автоматически добавляется в **элементов** при установке расширения. В этом разделе показано, как использовать шаблон для создания элемента управления простого счетчика, который можно передавать другим пользователям.  
  
## <a name="prerequisites"></a>Предварительные требования  
 Начиная с Visual Studio 2015, не установить пакет SDK для Visual Studio из центра загрузки Майкрософт. Он включен в качестве дополнительного компонента в программе установки Visual Studio. VS SDK также можно установить позже. Дополнительные сведения см. в разделе [Установка пакета SDK для Visual Studio](../extensibility/installing-the-visual-studio-sdk.md).  
  
## <a name="creating-a-windows-forms-toolbox-control"></a>Создание элементов управления Windows Forms  
 Шаблон элемента управления панели элементов Windows Forms создает неопределенный пользовательский элемент управления и предоставляет все функциональные возможности, необходимые для добавления элемента управления для **элементов**.  
  
#### <a name="create-an-extension-with-a-windows-forms-toolbox-control"></a>Создайте расширение с помощью элементов управления Windows Forms  
  
1.  Создайте проект VSIX с именем `MyWinFormsControl`. Шаблон проекта VSIX в можно найти **новый проект** диалогового окна в разделе **Visual C# / Extensibility**.  
  
2.  При открытии проекта, добавьте **элементов управления Windows Forms** шаблон элемента с именем `Counter`. В **обозревателе решений**, щелкните правой кнопкой мыши узел проекта и выберите **добавить / новый элемент**. В **Добавление нового элемента** диалоговое окно, перейдите на **Visual C# / Extensibility** и выберите **элементов управления Windows Forms**  
  
3.  Это добавляет пользовательский элемент управления `ProvideToolboxControlAttribute` <xref:Microsoft.VisualStudio.Shell.RegistrationAttribute> для размещения элемента управления в **элементов**и **Microsoft.VisualStudio.ToolboxControl** запись актива в манифесте VSIX для развертывания.  
  
### <a name="building-a-user-interface-for-the-control"></a>Создание пользовательского интерфейса для элемента управления  
 `Counter` Управления требуется два дочерних элемента управления: <xref:System.Windows.Forms.Label> для отображения текущего счетчика и <xref:System.Windows.Forms.Button> счетчик сбрасывается в значение 0. Другие дочерние элементы управления не являются обязательными, поскольку вызывающим объектам увеличению значения счетчика программным способом.  
  
##### <a name="to-build-the-user-interface"></a>Создание пользовательского интерфейса  
  
1.  В **обозревателе решений**, дважды щелкните Counter.cs, чтобы открыть его в конструкторе.  
  
2.  Удалите «щелкните здесь!» **Кнопка** включается по умолчанию при добавлении шаблона элемента управления панели элементов Windows Forms.  
  
3.  Из **элементов**, перетащите `Label` управления и затем `Button` управления под его на поверхность разработки.  
  
4.  Измените общий элемент управления на 150, 50 пикселей, а также изменить размер кнопки элемента управления значение 50, 20 пикселей.  
  
5.  В **свойства** задайте следующие значения для элементов управления в рабочей области конструирования.  
  
    |Элемент управления|Свойство|Значение|  
    |-------------|--------------|-----------|  
    |`Label1`|**Text**|""|  
    |`Button1`|**Name**|btnReset|  
    |`Button1`|**Text**|Сбросить|  
  
### <a name="coding-the-user-control"></a>Написание кода пользовательского элемента управления  
 Элемент управления `Counter` будет предоставлять метод для увеличения значения счетчика, событие, которое будет наступать всякий раз, когда значение счетчика увеличивается, кнопку `Reset` и три свойства для хранения текущего значения счетчика, отображаемого текста и значения, определяющего, должна ли кнопка `Reset` отображаться или скрываться. `ProvideToolboxControl` Атрибут определяет, где в **элементов** `Counter` появится элемент управления.  
  
##### <a name="to-code-the-user-control"></a>Код пользовательского элемента управления  
  
1.  Дважды щелкните форму, чтобы открыть ее обработчик события загрузки в окне кода.  
  
2.  Выше метод обработчика событий в класс элемента управления создается целое число для хранения значения счетчика и строки для хранения отображаемого текста, как показано в следующем примере.  
  
    ```csharp  
    int currentValue;  
    string displayText;  
    ```  
  
3.  Создайте следующие объявления открытого свойства.  
  
    ```csharp  
    public int Value {  
        get { return currentValue; }   
    }  
  
    public string Message {  
        get { return displayText; }  
        set { displayText = value; }  
    }  
  
    public bool ShowReset {  
        get { return btnReset.Visible; }  
        set { btnReset.Visible = value; }  
    }  
  
    ```  
  
     Вызывающим объектам можно обращаться к этим свойствам get и set счетчика отображаемый текст для отображения или скрытия `Reset` кнопки. Вызывающие объекты можно получить текущее значение только для чтения `Value` свойство, но они не удается задать значение напрямую.  
  
4.  Поместите следующий код `Load` событий для элемента управления.  
  
    ```csharp  
    private void Counter_Load(object sender, EventArgs e)  
    {  
        currentValue = 0;  
        label1.Text = Message + Value;  
    }  
  
    ```  
  
     Установка **метка** текста в <xref:System.Windows.Forms.UserControl.Load> событий включает свойства целевого объекта для загрузки перед применением их значения. Установка **метка** текст в конструкторе приведет пустой **метка**.  
  
5.  Создайте приведенный ниже открытый метод для увеличения значения счетчика.  
  
    ```csharp  
    public void Increment()  
    {  
        currentValue++;  
        label1.Text = displayText + Value;  
        Incremented(this, EventArgs.Empty);  
    }  
  
    ```  
  
6.  Добавьте объявление для `Incremented` событий в класс элемента управления.  
  
    ```csharp  
    public event EventHandler Incremented;  
    ```  
  
     Вызывающие объекты можно добавить обработчики это событие, чтобы реагировать на изменения значения счетчика.  
  
7.  Вернуться в режим конструктора и дважды щелкните `Reset` кнопку, чтобы создать `btnReset_Click` обработчика событий, а затем добавьте в, как показано в следующем примере.  
  
    ```csharp  
    private void btnReset_Click(object sender, EventArgs e)  
    {  
        currentValue = 0;  
        label1.Text = displayText + Value;  
    }  
  
    ```  
  
8.  Непосредственно над определением класса в `ProvideToolboxControl` объявление атрибута, измените значение первого параметра из `"MyWinFormsControl.Counter"` для `"General"`. Таким образом задается имя группы элементов, в которой будет размещаться элемент управления на **панели элементов**.  
  
     В приведенном ниже примере показаны атрибут `ProvideToolboxControl` и скорректированное определение класса.  
  
    ```csharp  
    [ProvideToolboxControl("General", false)]  
    public partial class Counter : UserControl  
    ```  
  
### <a name="testing-the-control"></a>Тестирование элемента управления  
 Чтобы проверить **элементов** управления, сначала протестируйте его в среде разработки и тестирования в скомпилированном приложении.  
  
##### <a name="to-test-the-control"></a>Тестирование элемента управления  
  
1.  Нажмите клавишу F5.  
  
     При этом создается проект и открывается второй экспериментальный экземпляр Visual Studio с установленным элементом управления.  
  
2.  В экспериментальном экземпляре Visual Studio, создайте **приложение Windows Forms** проекта.  
  
3.  В **обозревателе решений**, дважды щелкните файл Form1.cs, чтобы открыть его в конструкторе, если он еще не открыт.  
  
4.  В **элементов**, `Counter` элемент должен отображаться в **Общие** раздела.  
  
5.  Перетащите `Counter` управления в форму, а затем выберите его. `Value`, `Message`, И `ShowReset` свойства будут отображены в **свойства** окно вместе со свойствами, которые наследуются от <xref:System.Windows.Forms.UserControl>.  
  
6.  Задайте для свойства `Message` значение `Count:`.  
  
7.  Перетащите <xref:System.Windows.Forms.Button> управления на форму и задайте свойства имя и текст кнопки, чтобы `Test`.  
  
8.  Дважды щелкните кнопку, чтобы открыть файл Form1.cs в представлении кода и создайте обработчик щелчка.  
  
9. В обработчик щелчка, вызовите `counter1.Increment()`.  
  
10. В функции конструктора после вызова `InitializeComponent`, тип `counter1``.``Incremented +=` и затем нажмите клавишу TAB.  
  
     Visual Studio создает обработчик уровне формы `counter1.Incremented` событий.  
  
11. Выделите `Throw` инструкции в обработчике событий типа `mbox`, и нажмите клавишу TAB дважды, чтобы создать окно сообщения из почтового ящика фрагмента кода.  
  
12. На следующей строке добавьте следующий `if` / `else` блока для установки видимости `Reset` кнопки.  
  
    ```csharp  
    if (counter1.Value < 5) counter1.ShowReset = false;  
    else counter1.ShowReset = true;  
    ```  
  
13. Нажмите клавишу F5.  
  
     Форма будет открыта. `Counter` Элемент управления отображает следующий текст.  
  
     **Число: 0**  
  
14. Нажмите кнопку **Test**.  
  
     Увеличения значения счетчика и Visual Studio отображает окно сообщения.  
  
15. Закройте окно сообщения.  
  
     **Сброс** кнопка будет скрыта.  
  
16. Нажмите кнопку **тест** пока значение счетчика достигнет **5** Закрытие сообщения поля каждый раз.  
  
     **Сброс** кнопки появляется вновь.  
  
17. Нажмите кнопку **Reset**.  
  
     Сбрасывает счетчик **0**.  
  
## <a name="next-steps"></a>Следующие шаги  
 При создании элемента управления **панели элементов** Visual Studio создает файл с именем *Имя_проекта*.vsix в папке \bin\debug\ проекта. Чтобы развернуть элемент управления, можно отправить VSIX-файл в сеть или на веб-сайт. Когда пользователь открывает VSIX-файл, элемент управления устанавливается и добавляется в Visual Studio **элементов** на компьютере пользователя. Кроме того, можно отправить VSIX-файл для [коллекции Visual Studio](http://go.microsoft.com/fwlink/?LinkID=123847) веб-сайт, чтобы пользователи могли его найти, перейдя в **средства / расширения и обновления** диалогового окна.  
  
## <a name="see-also"></a>См. также  
 [Расширение других частей Visual Studio](../extensibility/extending-other-parts-of-visual-studio.md)   
 [Создание элемента управления панели элементов WPF](../extensibility/creating-a-wpf-toolbox-control.md)   
 [Расширение других частей Visual Studio](../extensibility/extending-other-parts-of-visual-studio.md)   
 [Основы разработки элементов управления форм Windows Forms](/dotnet/framework/winforms/controls/windows-forms-control-development-basics)