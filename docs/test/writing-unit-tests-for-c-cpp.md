---
title: Написание модульных тестов для C/C++ в Visual Studio
ms.date: 11/04/2017
ms.prod: visual-studio-dev15
ms.technology: vs-ide-test
ms.topic: conceptual
ms.author: mblome
manager: douge
ms.workload:
- cplusplus
author: mikeblome
ms.openlocfilehash: 227b12f2da07d3d610f3d043348dc59680fc17ab
ms.sourcegitcommit: e13e61ddea6032a8282abe16131d9e136a927984
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/26/2018
---
# <a name="write-unit-tests-for-cc-in-visual-studio"></a>Написание модульных тестов для C/C++ в Visual Studio

С помощью окна **Обозреватель тестов** вы можете создавать и выполнять модульные тесты для C++ так же, как для других языков. Дополнительные сведения об использовании **обозревателя тестов** см. в разделе [Выполнение модульных тестов с помощью обозревателя тестов](run-unit-tests-with-test-explorer.md).

> [!NOTE]
> Некоторые функции, такие как Live Unit Testing, закодированные тесты пользовательского интерфейса и IntelliTest, не поддерживаются для C++.

В состав Visual Studio входят следующие платформы тестирования C++ (скачивать их не требуется):

- Платформа модульного тестирования Майкрософт для C++
- Google Test
- Boost.Test
- CTest

Помимо установленных платформ, вы можете создавать собственные адаптеры тестов для платформ, которые вы хотели бы использовать в Visual Studio. Адаптер теста позволяет интегрировать модульные тесты с окном **Обозреватель тестов**. В [Visual Studio Marketplace](https://marketplace.visualstudio.com) доступно несколько адаптеров сторонних поставщиков. Дополнительные сведения см. в разделе [Установка платформ модульного тестирования сторонних поставщиков](install-third-party-unit-test-frameworks.md).

**Visual Studio 2017 версии 15.5**

- **Адаптер Google Test** включен по умолчанию в рабочую нагрузку **Разработка классических приложений на C++**. Он содержит шаблон проекта, который можно добавить в решение с помощью команды **Добавить новый проект** в контекстном меню узла решения в **обозревателе решений**, а также параметры, которые можно настроить в окне **Сервис | Параметры**. Дополнительные сведения см. в разделе [Практическое руководство. Создание проектов Office в Visual Studio](how-to-use-google-test-for-cpp.md).

- Компонент **Boost.Test** включен по умолчанию в рабочую нагрузку **Разработка классических приложений на C++**. Он интегрирован с **обозревателем тестов**, но в настоящее время не имеет шаблона проекта, поэтому его необходимо настроить вручную. Дополнительные сведения см. в разделе [Практическое руководство. Использование Boost.Test в Visual Studio](how-to-use-boost-test-for-cpp.md).

- Поддержка **CTest** включена в компонент [Инструменты CMake для Visual Studio](/cpp/ide/cmake-tools-for-cpp), который входит в рабочую нагрузку **Разработка классических приложений на C++**. Однако CTest пока не полностью интегрирован с **обозревателем тестов**. Дополнительные сведения см. в разделе [Практическое руководство. Использование CTest в Visual Studio](how-to-use-ctest-for-cpp.md).

**Visual Studio 2015 и более ранние версии**

Вы можете скачать расширения "Адаптер Google Test" и "Адаптер Boost.Test" в Visual Studio Marketplace на страницах [Test Adapter for Boost.Test](https://marketplace.visualstudio.com/items?itemName=VisualCPPTeam.TestAdapterforBoostTest) (Адаптер теста для Boost.Test) и [Test Adapter for Google Test](https://marketplace.visualstudio.com/items?itemName=VisualCPPTeam.TestAdapterforGoogleTest) (Адаптер теста для Google Test).

## <a name="basic-test-workflow"></a>Базовый процесс тестирования

В следующих разделах описываются основные действия по началу модульного тестирования для C++. Базовые конфигурации для платформ Майкрософт и Google Test в основном схожи. Boost.Test требует создать тестовый проект вручную.

### <a name="create-a-test-project"></a>Создание тестового проекта

Тесты определяются и выполняются в одном или нескольких тестовых проектах, которые входят в состав того же решения, что и тестируемый код. Чтобы добавить новый тестовый проект в существующее решение, в **обозревателе решений** щелкните узел решения правой кнопкой мыши и выберите пункты **Добавить | Новый проект**. Затем в левой области выберите **Visual C++ | Тест**, а в центральной области выберите один из типов проектов. На приведенном ниже рисунке показаны тестовые проекты, доступные при установке рабочей нагрузки **Разработка классических приложений на C++**.

![Тестовые проекты C++](media/cpp-new-test-project.png "Шаблоны новых тестовых проектов C++")

### <a name="create-references-to-other-projects-in-the-solution"></a>Создание ссылок на другие проекты в решении

Чтобы код теста имел доступ к функциям в тестируемом проекте, добавьте ссылку на этот проект в тестовый проект. Щелкните правой кнопкой мыши узел тестового проекта в **обозревателе решений** и выберите пункты **Добавить | Ссылка**. Затем в диалоговом окне выберите проекты, которые нужно тестировать.

![Добавление ссылки](media/cpp-add-ref-test-project.png "Тест C++ — добавление ссылки на тестируемые проекты")

### <a name="add-include-directives-for-header-files"></a>Добавление директив #include для файлов заголовков

Далее в CPP-файле модульного теста добавьте директивы `#include` для всех файлов заголовков, в которых объявляются тестируемые типы и функции. Введите `#include "`, после чего технология IntelliSense поможет вам выбрать файл. Повторите эти действия для всех нужных заголовков.

![Добавление директив include](media/cpp-add-includes-test-project.png "Тест C++ — добавление директив include для файлов заголовков")

### <a name="write-test-methods"></a>Написание методов теста

> [!NOTE]
> В этом разделе представлен синтаксис при использовании платформы модульного тестирования Майкрософт для C/C++. Он задокументирован в [справочнике по API Microsoft.VisualStudio.TestTools.CppUnitTestFramework](microsoft-visualstudio-testtools-cppunittestframework-api-reference.md). Документацию по Google Test см. на странице [Google Test Primer](https://github.com/google/googletest/blob/master/googletest/docs/Primer.md) (Начало работы с Google Test). Сведения о Boost.Test см. на странице [Boost Test Library: The Unit Test Framework](http://www.boost.org/doc/libs/1_46_0/libs/test/doc/html/utf.html) (Библиотека Boost.Test: платформа модульного тестирования).

В CPP-файле в тестовом проекте определены класс-заглушка и метод-заглушка в качестве примера того, как следует писать код теста. Обратите внимание, что в сигнатурах используются макросы TEST_CLASS и TEST_METHOD, что позволяет обнаруживать методы в окне обозревателя тестов.

![Добавление директив include](media/cpp-write-test-methods.png "Тест C++ — добавление директив include для файлов заголовков")

Макросы TEST_CLASS и TEST_METHOD входят в [собственную платформу тестирования Майкрософт]((microsoft-visualstudio-testtools-cppunittestframework-api-reference.md). **Обозреватель тестов** обнаруживает методы теста в других поддерживаемых платформах аналогичным образом.

TEST_METHOD возвращает пустое значение. Чтобы получить результат теста, используйте статические методы класса `Assert` для сравнения фактических результатов с ожидаемыми. В приведенном ниже примере предполагается, что `MyClass` имеет конструктор, принимающий `std::string`. Мы можем проверить, правильно ли конструктор инициализирует класс, следующим образом:

```cpp
        TEST_METHOD(TestClassInit)
        {
            std::string name = "Bill";
            MyClass mc(name);
            Assert::AreEqual(name, mc.GetName());
        }
```
В предыдущем примере результат вызова `Assert::AreEqual` определяет, пройден ли тест успешно. Класс Assert содержит множество других методов для сравнения ожидаемых и фактических результатов.

В методы теста можно добавлять *признаки*, определяющие владельцев теста, приоритет и другие характеристики. Затем с помощью этих значений можно сортировать и группировать тесты в **обозревателе тестов**. Дополнительные сведения см. в разделе [Выполнение модульных тестов с помощью обозревателя тестов](run-unit-tests-with-test-explorer.md).

### <a name="run-the-tests"></a>Запуск тестов

1. В меню **Тест** выберите пункт **Windows** > , а затем пункт **Обозреватель тестов**. На рисунке ниже показан тестовый проект, тесты которого еще не выполнялись.

   ![Обозреватель тестов до выполнения тестов](media/cpp-test-explorer.png "Обозреватель тестов C++")

   > [!NOTE]
   > Интеграция CTest с **обозревателем тестов** пока не доступна. Запустите тесты CTest в главном меню CMake.

1. Если в окне видны не все тесты, выполните сборку тестового проекта, щелкнув его узел в **обозревателе решений** правой кнопкой мыши и выбрав пункт **Сборка** или **Перестроить**.

1. В обозревателе тестов нажмите **Запустить все** или выберите тесты, которые следует запустить. Щелкните тест правой кнопкой мыши, чтобы получить доступ к другим командам, включая запуск в режиме отладки с включенными точками останова. После выполнения всех тестов в окне будет показано, какие из них были пройдены успешно, а какие — неудачно.

![Обозреватель тестов после выполнения тестов](media/cpp-test-explorer-passed.png "Обозреватель тестов C++ после выполнения тестов")

Для неудачных тестов приводятся подробные сведения, которые могут помочь установить причину. Вы можете щелкнуть неудачный тест правой кнопкой мыши и выбрать команду **Отладить выбранные тесты** для пошагового выполнения функции, в которой произошел сбой.

Дополнительные сведения об использовании **обозревателя тестов** см. в разделе [Выполнение модульных тестов с помощью обозревателя тестов](run-unit-tests-with-test-explorer.md).

Рекомендации по модульному тестированию см. в разделе [Основные сведения о модульных тестах](unit-test-basics.md).

## <a name="see-also"></a>См. также

[Модульное тестирование кода](unit-test-your-code.md)