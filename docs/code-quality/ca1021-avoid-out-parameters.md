---
title: 'CA1021: не используйте параметры out'
ms.date: 11/04/2016
ms.prod: visual-studio-dev15
ms.technology: vs-ide-code-analysis
ms.topic: reference
f1_keywords:
- CA1021
- AvoidOutParameters
helpviewer_keywords:
- AvoidOutParameters
- CA1021
ms.assetid: 970f2304-842c-4fb7-9734-f3871da8d479
author: gewarren
ms.author: gewarren
manager: douge
ms.workload:
- multiple
ms.openlocfilehash: f62a88d8b3462d50b92cf2c7bcdf577ff736d19b
ms.sourcegitcommit: e13e61ddea6032a8282abe16131d9e136a927984
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/26/2018
ms.locfileid: "31900463"
---
# <a name="ca1021-avoid-out-parameters"></a>CA1021: не используйте параметры out
|||
|-|-|
|TypeName|AvoidOutParameters|
|CheckId|CA1021|
|Категория|Microsoft.Design|
|Критическое изменение|Критическое|

## <a name="cause"></a>Причина
 Открытый или защищенный метод в открытом типе имеет `out` параметра.

## <a name="rule-description"></a>Описание правила
 Для реализации передачи типов по ссылке (с помощью `out` или `ref`) требуется опыт работы с указателями, понимание отличия между типами значения и ссылочными типами и умение работать с методами с несколькими возвращаемыми значениями. Кроме того, разница между `out` и `ref` параметры далеко не все понимают.

 Если ссылочный тип передается «по ссылке», метод предполагает использовать параметр для возвращения другого экземпляра объекта. Передача ссылочного типа по ссылке также называют использованием двойного указателя, указателя на указатель или двойного косвенного обращения. С помощью по умолчанию, соглашение о вызовах, который используется передача «по значению», параметр, принимающий ссылочный тип, уже получает указатель на объект. Указатель, а не объект, на который он указывает, передается по значению. Передача по значению означает, что метод не может изменить указатель, чтобы он указывал на новый экземпляр ссылочного типа. Однако его можно изменить содержимое объекта, на который он указывает. Для большинства приложений достаточно и обеспечивает желаемое поведение.

 Если метод должен возвращать другой экземпляр, используйте возвращаемое значение метода для выполнения этой задачи. В разделе <xref:System.String?displayProperty=fullName> класс для различных методов, которые обрабатывают строки и возвращают новый экземпляр строки. При использовании этой модели вызывающему объекту необходимо решить, сохраняются ли исходный объект.

 Несмотря на то, что возвращаемые значения всем знакомы и повсеместно используются устойчивого приложения `out` и `ref` параметры требуются промежуточные проектирование и кодирование навыки. Архитекторам библиотеки для широкого использования, не следует ожидать пользователям разрабатывающим `out` или `ref` параметров.

## <a name="how-to-fix-violations"></a>Устранение нарушений
 Чтобы устранить нарушение данного правила, связанную с типом значения, имеют метод возвращал объект в качестве возвращаемого значения. Если метод должен возвращать несколько значений, измените его возвращает один экземпляр объекта, содержащего значения.

 Чтобы устранить нарушение данного правила, причиной является ссылочным типом, убедитесь, что требуемое поведение должно возвращать новый экземпляр ссылки. Если это так, метод следует использовать ее возвращаемое значение для этого.

## <a name="when-to-suppress-warnings"></a>Отключение предупреждений
 Его можно безопасно подавить предупреждение из этого правила. Однако такой подход может привести к проблемах.

## <a name="example"></a>Пример
 В следующей библиотеке показаны две реализации класса, который приводит к возникновению ошибки ответы на отзывы от пользователя. Первая реализация (`BadRefAndOut`) вынуждает пользователя библиотеки управлять тремя возвращаемыми значениями. Во второй реализации (`RedesignedRefAndOut`) упрощает взаимодействие с пользователем, возвращают экземпляр класса контейнера (`ReplyData`), управляющий данных как единое целое.

 [!code-csharp[FxCop.Design.NoRefOrOut#1](../code-quality/codesnippet/CSharp/ca1021-avoid-out-parameters_1.cs)]

## <a name="example"></a>Пример
 В следующем приложении демонстрируется работы пользователя. Вызов модернизированный библиотеки (`UseTheSimplifiedClass` метод) является более простой и сведения, возвращаемые этим методом, легче управлять. Выходные данные из двух методов аналогична.

 [!code-csharp[FxCop.Design.TestNoRefOrOut#1](../code-quality/codesnippet/CSharp/ca1021-avoid-out-parameters_2.cs)]

## <a name="example"></a>Пример
 В следующем примере библиотеки показано, как `ref` используются параметры для ссылочных типов и показывает более эффективный способ реализации этой функции.

 [!code-csharp[FxCop.Design.RefByRefNo#1](../code-quality/codesnippet/CSharp/ca1021-avoid-out-parameters_3.cs)]

## <a name="example"></a>Пример
 Следующее приложение вызывает каждый метод в библиотеке с целью демонстрации поведения.

 [!code-csharp[FxCop.Design.TestRefByRefNo#1](../code-quality/codesnippet/CSharp/ca1021-avoid-out-parameters_4.cs)]

 В этом примере формируются следующие данные:

 **Изменение указателя - передаются по значению:**
**12345**
**12345**
**указатель Changing - передается по ссылке:** 
 ** 12345**
**12345 ABCDE**
**передача по возвращаемого значения:**
**12345 ABCDE**
## <a name="try-pattern-methods"></a>Повторите методы шаблона

### <a name="description"></a>Описание
 Методы, которые реализуют **повторите\<что-нибудь >** шаблонов, таких как <xref:System.Int32.TryParse%2A?displayProperty=fullName>, не приводит к нарушению данного правила. В следующем примере показано структуру (тип значения), которая реализует <xref:System.Int32.TryParse%2A?displayProperty=fullName> метод.

### <a name="code"></a>Код
 [!code-csharp[FxCop.Design.TryPattern#1](../code-quality/codesnippet/CSharp/ca1021-avoid-out-parameters_5.cs)]

## <a name="related-rules"></a>Связанные правила
 [CA1045: не передавайте типы по ссылке](../code-quality/ca1045-do-not-pass-types-by-reference.md)