---
title: "Реализация пользовательских политик возврата с анализом кода для управляемого кода | Microsoft Docs"
ms.custom: ""
ms.date: "12/12/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-ide-general"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "vs.code.analysis.selecttfsrulesets"
  - "vs.code.analysis.browsefortfsruleset"
  - "vs.code.analysis.policyeditor"
ms.assetid: fd029003-5671-4b24-8b6f-032e0a98b2e8
caps.latest.revision: 21
caps.handback.revision: 21
author: "stevehoag"
ms.author: "shoag"
manager: "wpickett"
---
# Реализация пользовательских политик возврата с анализом кода для управляемого кода
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

Политика возврата с анализом кода задает набор правил, которые участники командного проекта должны применять к исходному коду перед возвратом его в систему управления версиями.  Корпорация Майкрософт предоставляет стандартные *наборы правил*, в которых правила анализа кода сгруппированы по функциональным областям.  *Настраиваемые наборы правил политики возврата* задают набор правил анализа кода, характерный для командного проекта.  Набор правил хранится в RULESET\-файле.  
  
 Политики возврата задаются на уровне командного проекта и определяются расположением RULESET\-файла в дереве управления версиями.  Расположение системы управления версиями для настраиваемого набора правил командной политики может быть произвольным.  
  
 Выполнение анализа кода настраивается для индивидуальных проектов создания кода в окне свойств каждого проекта.  Настраиваемый набор правил для проекта кода определяется физическим расположением RULESET\-файла на локальном компьютере.  Если задан RULESET\-файл, расположенный на том же диске, что и проект кода, Visual Studio использует в конфигурации проекта относительный путь к файлу.  
  
 Предлагаемый принцип создания настраиваемого набора правил командного проекта заключается в сохранении RULESET\-файла политики возврата в специальной папке, которая не входит в состав проектов кода.  При хранении файла в особой папке можно применить разрешения, ограничивающие круг лиц, которые могут редактировать файл правил, и без труда переместить структуру каталогов, содержащую проект, в другой каталог на компьютере.  
  
## Создание настраиваемого набора правил возврата для командного проекта  
 Чтобы создать настраиваемый набор правил для командного проекта, нужно сначала создать особую папку для набора правил политики возврата в **обозревателе управления исходным кодом**.  Затем следует создать файл набора правил и добавить файл в систему управления версиями.  Наконец следует задать набор правил для командного проекта в виде политики возврата с анализом кода.  
  
> [!NOTE]
>  Чтобы создать папку в командном проекте нужно сначала сопоставить корень проекта с расположением на локальном компьютере.  Для получения дополнительной информации см. [Create and work with workspaces \(old\)](http://msdn.microsoft.com/ru-ru/db4d5692-179a-44fe-ad31-0c1c900c9cb2).  
  
#### Создание папки системы управления версиями для набора правил политики возврата  
  
1.  В [!INCLUDE[esprtfc](../code-quality/includes/esprtfc_md.md)] разверните узел командного проекта и выберите пункт **Система управления версиями**.  
  
2.  В области **Папки** щелкните правой кнопкой мыши командный проекта и выберите команду **Новая папка**.  
  
3.  В основной области системы управления версиями щелкните правой кнопкой мыши пункт **Новая папка**, выберите команду **Переименовать** и введите имя для папки набора правил.  
  
#### Создание набора правил политики возврата  
  
1.  В меню **Файл** выберите пункты **Создать** и **Файл**.  
  
2.  В списке **Категории** щелкните **Общие**.  
  
3.  В списке **Шаблоны** щелкните дважды пункт **Набор правил анализа кода**.  
  
4.  Задайте правила, которые необходимо включить в набор правил, а затем сохраните файл набора правил в созданной папке набора правил.  
  
     Дополнительные сведения см. в разделе [Создание настраиваемых наборов правил](../code-quality/creating-custom-code-analysis-rule-sets.md).  
  
#### Добавление файла набора правил в систему правления версиями  
  
1.  В **обозревателе управления исходным кодом** щелкните правой кнопкой мыши папку и выберите команду **Добавить элементы в папку**.  
  
     Для получения дополнительной информации см. [Использование управления версиями](../Topic/Use%20version%20control.md).  
  
2.  Щелкните созданный файл набора правил и нажмите кнопку **Готово**.  
  
     Файл будет добавлен в систему управления версиями и извлечен из нее.  
  
3.  В окне данных **обозревателя управления исходным кодом** щелкните правой кнопкой мыши имя файла и выберите команду **Вернуть ожидающие изменения**.  
  
4.  В диалоговом окне **Возврат** можно добавить примечание, а затем нажать кнопку **Вернуть**.  
  
    > [!NOTE]
    >  Если политика возврата с анализом кода для командного проекта уже настроена и установлен флажок **Включить возврат только для файлов, входящих в текущее решение**, будет активировано предупреждение о нарушении политики.  В диалоговом окне "Сбой политики" установите флажок **Переопределить сбой политики и продолжить возврат**.  Добавьте необходимое примечание и нажмите кнопку **ОК**.  
  
#### Определение файла набора правил в качестве политики возврата  
  
1.  В меню **Группа** подведите указатель к пункту **Параметры командного проекта** и выберите пункт **Система управления версиями**.  
  
2.  Щелкните **Политика возврата**, а затем нажмите кнопку **Добавить**.  
  
3.  В списке **Политика возврата** щелкните дважды пункт **Анализ кода** и убедитесь, что установлен флажок **Включить анализ кода для управляемого кода**.  
  
4.  В списке **Выполнить этот набор правил** выберите пункт **\<Выберите набор правил из системы управления версиями\>**.  
  
5.  Введите путь к файлу набора правил политики возврата в системе управления версиями.  
  
     Путь должен быть представлен с соблюдением следующего синтаксиса:  
  
     **$\/** `TeamProjectName` **\/** `VersionControlPath`  
  
    > [!NOTE]
    >  Путь можно скопировать, выполнив одну из следующих процедур в **обозревателе управления исходным кодом**.  
  
    -   В области **Папки** щелкните папку, содержащую файл набора правил.  Скопируйте путь к папке в системе управления версиями, отображающиеся в поле **Источник**, и вручную введите имя файла набора правил.  
  
    -   В окне данных щелкните правой кнопкой мыши файл набора правил и выберите пункт **Свойства**.  На вкладке **Общие** введите значение в поле **Имя сервера**.  
  
## Синхронизация проектов кода с набором правил системы управления версиями  
 Чтобы задать набор правил политики управления версиями для командного проекта в качестве набора правил анализа кода в конфигурации проекта кода, воспользуйтесь диалоговым окном свойств проекта кода.  Если набор правил расположен на том же диске, что и проект кода, для определения набора правил используется относительный путь, если этот путь выбран в диалоговом окне файла.  Относительный путь позволяет переносить значения свойств проекта на другие компьютеры, если на них используются аналогичные локальные структуры системы управления версиями.  
  
#### Определение набора правил командного проекта в качестве набора правил для проекта кода  
  
1.  При необходимости извлеките папку и файл набора правил политики возврата из системы управления версиями.  
  
     Этот шаг можно выполнить в **обозревателе управления исходным кодом**, щелкнув правой кнопкой мыши папку набора правил и выбрав команду **Получить последнюю версию**.  
  
2.  В окне **Обозреватель решений** щелкните правой кнопкой мыши проект кода и выберите команду **Свойства**.  
  
3.  Щелкните **Анализ кода**.  
  
4.  При необходимости выберите соответствующие параметры в списках **Конфигурация** и **Платформа**.  
  
5.  Для выполнения анализа кода при каждом построении проекта с помощью заданной конфигурации установите флажок **Включить анализ кода в построении \(определяет константу CODE\_ANALYSIS\)**.  
  
6.  Чтобы пропускать код в компонентах, предоставленный другими компаниями, установите флажок **Исключить результаты из созданного кода**.  
  
7.  В списке **Выполнить этот набор правил** выберите пункт **\<Обзор...\>**.  
  
8.  Задайте локальную версию файла набора правил политики возврата.