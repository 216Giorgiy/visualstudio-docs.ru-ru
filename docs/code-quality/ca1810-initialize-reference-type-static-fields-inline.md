---
title: "CA1810: инициализируйте статические поля ссылочного типа встроенными средствами | Microsoft Docs"
ms.custom: ""
ms.date: "12/05/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-devops-test"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "InitializeReferenceTypeStaticFieldsInline"
  - "CA1810"
helpviewer_keywords: 
  - "InitializeReferenceTypeStaticFieldsInline"
  - "CA1810"
ms.assetid: e9693118-a914-4efb-9550-ec659d8d97d2
caps.latest.revision: 21
caps.handback.revision: 21
author: "stevehoag"
ms.author: "shoag"
manager: "wpickett"
---
# CA1810: инициализируйте статические поля ссылочного типа встроенными средствами
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

|||  
|-|-|  
|TypeName|InitializeReferenceTypeStaticFieldsInline|  
|CheckId|CA1810|  
|Категория|Microsoft.Performance|  
|Критическое изменение|Не критическое|  
  
## Причина  
 Ссылочный тип объявляет явный статический конструктор.  
  
## Описание правила  
 Если в типе объявляется явный статический конструктор, компилятор JIT добавляет проверку в каждый статический метод и конструктор экземпляров этого типа, чтобы убедиться, что статический конструктор уже вызывался ранее.  Статическая инициализация выполняется при доступе к статическому члену или создании экземпляра типа.  Однако, если объявляется переменная типа, которая не используется, статическая инициализация не выполняется. Это может быть важным, если инициализация изменяет глобальное состояние.  
  
 Если инициализация всех статических данных реализуется встроенными средствами и явный статический конструктор не объявляется, то компиляторы MSIL добавляют к определению типа MSIL флаг `beforefieldinit` и неявный статический конструктор, который инициализирует статические данные.  Если компилятор JIT обнаруживает флаг `beforefieldinit`, то обычно проверки статических конструкторов не добавляются.  Статическая инициализация будет обязательно выполнена перед доступом к любому статическому полю, но после вызова статического метода или конструктора экземпляров.  Обратите внимание, что статическая инициализация может выполняться в любое время после объявления переменной типа.  
  
 Проверки статических конструкторов могут привести к снижению производительности.  Статический конструктор, как правило, используется только для инициализации статических полей. В таком случае требуется лишь проверить, что статическая инициализация происходит перед первым доступом к статическому полю.  Для этой и многих других целей прекрасно подходит флаг `beforefieldinit`.  Его нельзя использовать только в том случае, если статическая инициализация влияет на глобальное состояние и выполняется одно из перечисленных ниже условий.  
  
-   Изменение глобального состояния сопряжено с большими затратами, оно не требуется, если тип не используется.  
  
-   Изменение глобального состояния можно осуществить без доступа к какому\-либо статическому полю типа.  
  
## Устранение нарушений  
 Чтобы устранить нарушение данного правила, выполните инициализацию всех статических данных при их объявлении и удалите статический конструктор.  
  
## Отключение предупреждений  
 Отключение предупреждений о нарушении этого правила является безопасным в том случае, если не требуется высокая производительность, либо изменения глобального состояния за счет статической инициализации приводят к большим затратам, или необходимо обеспечить выполнение статической инициализации до вызова статического метода типа или создания экземпляра типа.  
  
## Пример  
 В следующем примере показан тип `StaticConstructor`, нарушающий данное правило, и тип `NoStaticConstructor`, который для устранения нарушения заменяет статический конструктор на встроенную инициализацию.  
  
 [!CODE [FxCop.Performance.RefTypeStaticCtor#1](../CodeSnippet/VS_Snippets_CodeAnalysis/FxCop.Performance.RefTypeStaticCtor#1)]  
  
 Обратите внимание на добавление флага `beforefieldinit` в определении MSIL для класса `NoStaticConstructor`.  
  
  **.class public auto ansi StaticConstructor**  
 **расширяет \[mscorlib\]System.Object**  
**{**  
**} \/\/ окончание класса StaticConstructor**  
**.class public auto ansi beforefieldinit NoStaticConstructor**  
 **расширяет \[mscorlib\]System.Object**  
**{**  
**} \/\/ окончание класса NoStaticConstructor**   
## Связанные правила  
 [CA2207: инициализируйте статические поля типа значений встроенными средствами](../code-quality/ca2207-initialize-value-type-static-fields-inline.md)