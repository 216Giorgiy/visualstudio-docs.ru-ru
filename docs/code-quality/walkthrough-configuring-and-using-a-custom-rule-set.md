---
title: "Пошаговое руководство. Настройка и использование набора настраиваемых правил | Microsoft Docs"
ms.custom: ""
ms.date: "12/16/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-devops-test"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "анализ кода, пошаговые руководства"
  - "анализ кода, наборы правил"
ms.assetid: 7fe0a4e3-1ce0-4f38-a87a-7d81238ec7cd
caps.latest.revision: 40
caps.handback.revision: 40
author: "stevehoag"
ms.author: "shoag"
manager: "wpickett"
---
# Пошаговое руководство. Настройка и использование набора настраиваемых правил
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

В этом пошаговом руководстве демонстрируется использование средств анализа кода, в которых настроено применение пользовательского *набора правил* для библиотеки классов.  При этом можно выбрать набор правил, связанный с типом проекта, заданным для решения, или выбрать другие наборы правил в соответствии с конкретными потребностями, например для поиска в устаревшем коде проблем, которые можно устранить без прерывания его выполнения.  В любом случае наборы правил можно настраивать в соответствии с требованиями проекта.  
  
 В этом пошаговом руководстве будут рассмотрены следующие процессы.  
  
-   Создание библиотеки классов.  
  
-   Выбор набора правил анализа кода **Базовые правила и рекомендации по разработке корпорации Майкрософт**.  
  
-   Добавление в класс собственного кода.  
  
-   Выполнение анализа кода.  
  
-   Настройка набора правил.  
  
-   Выполнение анализа кода и проверка поведения настроек набора правил.  
  
## Обязательные компоненты  
  
-   [!INCLUDE[vsUltLong](../code-quality/includes/vsultlong_md.md)], [!INCLUDE[vsPreLong](../code-quality/includes/vsprelong_md.md)] или [!INCLUDE[vsPro](../code-quality/includes/vspro_md.md)]  
  
## Использование наборов правил для анализа кода  
 Сначала необходимо создать простую библиотеку классов.  
  
#### Создание библиотеки классов  
  
1.  В меню **Файл** последовательно выберите пункты **Создать** и **Проект**.  
  
2.  В диалоговом окне **Новый проект** в области **Типы проектов** выберите **Visual C\#**.  
  
3.  В области **Visual C\#** выберите **Библиотека классов**.  
  
4.  В поле **Имя** введите «Пример\_набора\_правил» и нажмите кнопку **ОК**.  
  
 Затем следует выбрать набор правил **Базовые правила и рекомендации по разработке корпорации Майкрософт** и сохранить его вместе с проектом.  
  
#### Выбор набора правил анализа кода  
  
1.  В меню **Анализ** щелкните **Настройка анализа кода для Пример\_набора\_правил**.  
  
     Отобразятся параметры конфигурации для анализа кода.  
  
2.  В раскрывающемся списке выберите команду **Запустить этот набор правил** и выберите **Все правила Майкрософт**.  
  
     Дополнительные сведения о доступных наборах правил см. в разделе [Справочник по набору правил анализа кода](../code-quality/code-analysis-rule-set-reference.md).  
  
     В меню "Файл" выберите пункт **Сохранить выбранные элементы**, чтобы обновить файл проекта, добавив в него информацию о выбранном наборе правил и его параметрах.  
  
    > [!TIP]
    >  В реальных ситуациях для определения приоритета проблем, которые необходимо решить с помощью анализа кода, рекомендуется начать набора правил **Минимально рекомендованные правила Майкрософт** и устранить необходимые проблемы, а затем постепенно добавлять другие правила или наборы правил, чтобы устранить дополнительные проблемы.  
  
 Далее следует добавить определенный код в библиотеку классов, который будет использоваться для демонстрации нарушений правила анализа кода CA1704 "Идентификаторы должны иметь правильное правописание".  Для получения дополнительной информации см. [CA1704: идентификаторы должны иметь правильное написание](../code-quality/ca1704-identifiers-should-be-spelled-correctly.md).  
  
#### Добавление собственного кода  
  
-   В обозревателе решений откройте файл Class1.cs и замените имеющийся в нем код следующим кодом:  
  
    ```  
    using System;  
    using System.Collections.Generic;  
    using System.Text;  
  
    namespace RuleSetSample  
    {  
        public class Class1  
        {  
            //The variable parameter names "a" and "b" will cause  
            //the warning CA 1704 Microsoft.Naming "Consider   
            //providing a more meaningful name" to fire  
            public int AddIntegers(int a, int b)  
            {  
  
                int sum = a + b;  
  
                return (sum);  
            }  
        }  
    }  
  
    ```  
  
 Теперь можно выполнить анализ кода для проекта "Пример\_набора\_правил" и найти все ошибки и предупреждения, созданные в окне "Список ошибок".  
  
#### Выполнение анализа кода для проекта "Пример\_набора\_правил"  
  
1.  В меню **Анализ** щелкните команду **Запустить анализатор кода на Пример\_набора\_правил**.  
  
2.  В окне "Список ошибок" щелкните **Предупреждения**, а затем щелкните заголовок столбца **Описание**, чтобы отсортировать предупреждения в алфавитно\-цифровом порядке.  
  
     В реальном приложении все заслуживающие исправления нарушения правила устраняются именно в этот момент. При необходимости, если нарушение не требует исправления, это правило можно отключить.  Для получения дополнительной информации см. [Подавление предупреждений при помощи атрибута SuppressMessage](../code-quality/suppress-warnings-by-using-the-suppressmessage-attribute.md).  
  
3.  Обратите внимание на предупреждения CA1704.  Подобные нарушения этого правила показывают, что "Необходимо давать параметрам более значимые имена". В этом случае можно устранить проблему в коде или отключить правило, как описано в следующей процедуре.  
  
 Далее следует менять набор правил так, чтобы исключить предупреждение CA1704: "Идентификаторы должны иметь правильное написание".  
  
#### Настройка набора правил для проекта с целью отключения определенного правила  
  
1.  В меню **Анализ** щелкните **Настройка анализа кода для Пример\_набора\_правил**.  
  
2.  В раскрывающемся списке **Выполнить этот набор правил** убедитесь, что набор правил **Все правила Microsoft** все еще выделен, и нажмите кнопку **Открыть**.  Отобразится страница набора правил.  
  
3.  Разверните узел категории Microsoft.Naming и выберите предупреждение CA1704.  
  
4.  В столбце **Действие** выберите **Нет**. Это позволит избежать отображения правила CA1704 в виде предупреждения или ошибки в окне "Список ошибок".  
  
     Теперь самое время поэкспериментировать с различными кнопками панели инструментов и опциями фильтрации, чтобы ознакомиться с их назначением.  Например, с помощью раскрывающегося списка **Группировка** можно найти определенное правило или категорию правил.  А еще можно воспользоваться кнопкой **Скрыть отключенные правила** на страницах наборов правил, чтобы скрыть или отобразить все правила, для которых в столбце **Действие** задано значение **Нет**.  Такая возможность позволяет, например, найти все правила, отключенные ранее, и убедиться в том, что они по\-прежнему отключены.  
  
5.  В меню Вид выберите пункт Окно свойств.  В поле "Имя" в окне "Свойства" введите **My Custom Rule Set**.  Это изменит отображаемое имя набора правил в интегрированной среде разработки [!INCLUDE[vs_current_short](../code-quality/includes/vs_current_short_md.md)].  
  
6.  В меню **Файл** щелкните **Сохранить Microsoft All Rules.ruleset** для сохранения вашего пользовательского набора правил.  Перейдите в корневую папку проекта.  В текстовом поле **Имя файла** введите "Мой\_настраиваемый\_набор\_правил".  Теперь можно выбрать настраиваемый набор правил, который будет использоваться для данного проекта.  
  
 После создания нового набора правил нужно настроить параметры проекта, указав, что для него должен использоваться именно этот набор.  
  
#### Определение нового набора правил, используемого для проекта  
  
1.  В обозревателе решений щелкните правой кнопкой мыши проект и выберите пункт **Свойства**.  
  
2.  На вкладке **Свойства** щелкните **Анализ кода**.  
  
     В раскрывающемся списке **Выполнить этот набор правил** щелкните **\<Обзор...\>**.  Перейдите в корневую папку проекта кода, а затем выберите Мой\_настраиваемый\_набор\_правил.ruleset.  Это новый набор правил, созданный при выполнении предыдущей процедуры.  
  
3.  В меню **Файл** выберите команду **Сохранить все** для сохранения конфигурации проекта.  Теперь настраиваемый набор правил можно использовать для данного проекта.  
  
 В конце нужно опять выполнить анализ кода с использованием набора правил Мой\_настраиваемый\_набор\_правил.  Обратите внимание, что нарушение правила производительности CA1704 не отображается в окне "Список ошибок".  
  
#### Выполнение анализа кода для проекта "Пример\_набора\_правил" второй раз  
  
1.  В меню **Анализ** щелкните команду **Запустить анализатор кода на Пример\_набора\_правил**.  
  
2.  Обратите внимание, что если выбрать в окне "Список ошибок" вкладку **Предупреждения**, для нарушений правила CA1804 предупреждения "Идентификаторы должны иметь правильное написание" больше отображаться не будут.  
  
## См. также  
 [Практическое руководство. Настройка анализа кода для проекта управляемого кода](../code-quality/how-to-configure-code-analysis-for-a-managed-code-project.md)   
 [Справочник по набору правил анализа кода](../code-quality/code-analysis-rule-set-reference.md)