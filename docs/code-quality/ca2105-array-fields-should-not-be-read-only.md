---
title: "CA2105: поля массивов не должны быть доступны только для чтения | Microsoft Docs"
ms.custom: ""
ms.date: "12/15/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-devops-test"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "CA2105"
  - "ArrayFieldsShouldNotBeReadOnly"
helpviewer_keywords: 
  - "ArrayFieldsShouldNotBeReadOnly"
  - "CA2105"
ms.assetid: 0bdc3421-3ceb-4182-b30c-a992fbfcc35d
caps.latest.revision: 16
caps.handback.revision: 16
author: "stevehoag"
ms.author: "shoag"
manager: "wpickett"
---
# CA2105: поля массивов не должны быть доступны только для чтения
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

|||  
|-|-|  
|TypeName|ArrayFieldsShouldNotBeReadOnly|  
|CheckId|CA2105|  
|Категория|Microsoft.Security|  
|Критическое изменение|Критическое изменение|  
  
## Причина  
 Открытое или защищенное поле, в котором содержится массив, объявлено как доступное только для чтения.  
  
## Описание правила  
 При использовании модификатора `readonly` \(`ReadOnly` в [!INCLUDE[vbprvb](../code-quality/includes/vbprvb_md.md)]\) к полю, содержащему массив, это поле нельзя изменить для связи с другим массивом.  Однако элементы массива, хранящегося в доступном только для чтения поле, можно будет изменить.  Код, используемый для принятия решений или выполнения действий на основе элементов общедоступного массива только для чтения, может содержать уязвимые места.  
  
 Следует обратить внимание, что наличие открытых полей также приводит к нарушению правила разработки [CA1051: не объявляйте видимые поля экземпляров](../code-quality/ca1051-do-not-declare-visible-instance-fields.md).  
  
## Устранение нарушений  
 Чтобы устранить нарушения системы безопасности, выявленные данным правилом, не следует полагаться на содержимое массива только для чтения, который может быть общедоступным.  Настоятельно рекомендуется воспользоваться одной из следующих процедур.  
  
-   Замените массив типобезопасной неизменяемой коллекцией.  Для получения дополнительной информации см. <xref:System.Collections.ReadOnlyCollectionBase?displayProperty=fullName>.  
  
-   Замените открытое поле методом, возвращающим копию закрытого массива.  Поскольку код не использует копию, изменение элементов не будет представлять никакой опасности.  
  
 При выборе второго подхода не нужно заменять поле свойством; свойства, возвращающие массивы, оказывают негативное влияние на производительность.  Для получения дополнительной информации см. [CA1819: свойства не должны возвращать массивы](../code-quality/ca1819-properties-should-not-return-arrays.md).  
  
## Отключение предупреждений  
 Отключение вывода предупреждения для данного правила крайне нежелательно.  Случаев, в которых содержимое поля, доступного только для чтения, является маловажным, практически не существует.  Если это так в текущей ситуации, вместо отключения сообщения удалите модификатор `readonly`.  
  
## Пример  
 В следующем примере показана опасность нарушения данного правила.  В первой части представлена библиотека с типом `MyClassWithReadOnlyArrayField`, где содержатся два поля \(`grades` и `privateGrades`\), безопасность которых не гарантируется.  Поле `grades` является открытым и, следовательно, уязвимым к вызывающим методам.  Поле `privateGrades` является закрытым, но все еще уязвимым, поскольку оно возвращается вызывающим методам с помощью метода `GetPrivateGrades`.  Поле `securePrivateGrades` доступно в безопасном режиме за счет метода`GetSecurePrivateGrades`.  Для соответствия рекомендациям разработки оно объявляется закрытым.  Во второй части представлен код, изменяющий значения, которые хранятся в членах `grades` и `privateGrades`.  
  
 Образец библиотеки классов показан в следующем примере.  
  
 [!code-cs[FxCop.Security.ArrayFieldsNotReadOnly#1](../code-quality/codesnippet/CSharp/ca2105-array-fields-should-not-be-read-only_1.cs)]  
  
## Пример  
 В следующем коде образец библиотеки классов используется для демонстрации проблем с безопасностью в массиве, доступном только для чтения.  
  
 [!code-cs[FxCop.Security.TestArrayFieldsRead#1](../code-quality/codesnippet/CSharp/ca2105-array-fields-should-not-be-read-only_2.cs)]  
  
 Результатом выполнения примера являются следующие данные.  
  
  **До подделки: Уровни: 90, 90, 90 Частные уровни: 90, 90, 90  Защищенные уровни, 90, 90, 90**  
**После подделки: Уровни: 90, 555, 90 Частные уровни: 90, 555, 90  Защищенные уровни, 90, 90, 90**   
## См. также  
 <xref:System.Array?displayProperty=fullName>   
 <xref:System.Collections.ReadOnlyCollectionBase?displayProperty=fullName>