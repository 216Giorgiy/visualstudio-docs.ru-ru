---
title: "CA2117: APTCA-типы должны расширять только базовые APTCA-типы | Microsoft Docs"
ms.custom: ""
ms.date: "12/15/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-devops-test"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "CA2117"
  - "AptcaTypesShouldOnlyExtendAptcaBaseTypes"
helpviewer_keywords: 
  - "AptcaTypesShouldOnlyExtendAptcaBaseTypes"
  - "CA2117"
ms.assetid: c505b586-2f1e-47cb-98ee-a5afcbeda70f
caps.latest.revision: 16
caps.handback.revision: 16
author: "stevehoag"
ms.author: "shoag"
manager: "wpickett"
---
# CA2117: APTCA-типы должны расширять только базовые APTCA-типы
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

|||  
|-|-|  
|TypeName|AptcaTypesShouldOnlyExtendAptcaBaseTypes|  
|CheckId|CA2117|  
|Категория|Microsoft.Security|  
|Критическое изменение|Критическое изменение|  
  
## Причина  
 Открытый или защищенный тип в сборке, помеченный атрибутом <xref:System.Security.AllowPartiallyTrustedCallersAttribute?displayProperty=fullName>, наследует от объявленного в сборке типа, который не имеет данного атрибута.  
  
## Описание правила  
 По умолчанию открытые или защищенные типы в сборках со строгими именами неявно защищены [Inheritance Demands](http://msdn.microsoft.com/ru-ru/28b9adbb-8f08-4f10-b856-dbf59eb932d9) для обеспечения полного доверия.  Сборки со строгим именем, помеченные атрибутом <xref:System.Security.AllowPartiallyTrustedCallersAttribute> \(APTCA\), не имеют такой защиты..  Данный атрибут отменяет требование наследования.  Это позволяет предоставлять типы, объявленные в сборке, для наследования типами, не имеющими полного доверия.  
  
 Если сборка с полным доверием помечена атрибутом APTCA и тип в сборке наследует от типа, который не разрешает вызовы с неполным доверием, возможно возникновение уязвимости для эксплойта.  Если два типа — `T1` и `T2` — удовлетворяют этим условиям, злоумышленный вызывающий код может использовать тип `T1` для обхода неявного требования наследования с полным доверием, защищающего тип `T2`:  
  
-   `T1` — это открытый тип, объявленный в сборке с полным доверием, помеченной атрибутом APTCA.  
  
-   `T1` наследует от типа `T2` за пределами сборки.  
  
-   Сборка, содержащая тип `T2`, не помечена атрибутом APTCA и, как следствие, этот тип не может наследоваться типами в сборках с неполным доверием.  
  
 Тип `X` с неполным доверием наследует от типа `T1`, который предоставляет ему доступ к наследуемым членам, объявленным в типе `T2`.  Поскольку тип `T2` не имеет атрибута APTCA, производный тип, который непосредственно от него наследует \(`T1`\), должен удовлетворять требованию наследования с полным доверием; тип `T1` имеет полное доверие и может пройти проверку.  Угроза безопасности возникает вследствие того, что тип `X` не участвует в проверке требования наследования, которое защищает тип `T2` от наследования недоверяемыми классами.  По этой причине типы с атрибутом APTCA не должны расширять типы, не помеченные этим атрибутом.  
  
 Другая, и, возможно, более распространенная, проблема безопасности состоит в том, что в результате ошибки программиста производный тип \(`T1`\) может предоставить защищенные члены типа, требующего полного доверия \(`T2`\).  Если это происходит, ненадежный вызывающий код может получить доступ к данным, которые должны быть доступны только для типов с полным доверием.  
  
## Устранение нарушений  
 Если тип, указанный в сообщении о нарушении, находится в сборке, которую не требуется помечать атрибутом APTCA, удалите этот атрибут.  
  
 Если атрибут APTCA необходим, добавьте к типу требование наследования с полным доверием.  Это обеспечит защиту от наследования недоверяемыми типами.  
  
 Данное нарушение можно также исправить путем добавления атрибута APTCA в сборки, содержащие базовые типы, которые указаны в сообщении о нарушении.  Однако подобные действия можно выполнять только после тщательного изучения безопасности всего кода в сборках и всего кода, зависящего от этих сборок.  
  
## Отключение предупреждений  
 Для безопасного отключения предупреждений о нарушении данного правила необходимо убедиться, что защищенные члены, предоставляемые типом, не разрешают явным или неявным образом вызывающему коду с неполным доверием получать доступ к конфиденциальным сведениям, операциям или ресурсам и использовать их со злонамеренными целями.  
  
## Пример  
 В следующем примере для демонстрации уязвимости системы безопасности, обнаруженной данным правилом, используются две сборки и тестовое приложение.  Первая сборка не помечена атрибутом APTCA, и ее типы не могут наследоваться типами с неполным доверием \(представленными типом `T2` в предыдущем описании\).  
  
 [!code-cs[FxCop.Security.NoAptcaInherit#1](../code-quality/codesnippet/CSharp/ca2117-aptca-types-should-only-extend-aptca-base-types_1.cs)]  
  
## Пример  
 Вторая сборка, представленная в предыдущем описании типом `T1`, обладает полным доверием и разрешает вызовы с неполным доверием.  
  
 [!CODE [FxCop.Security.YesAptcaInherit#1](../CodeSnippet/VS_Snippets_CodeAnalysis/FxCop.Security.YesAptcaInherit#1)]  
  
## Пример  
 Тестовый тип, представленный в предыдущем описании типом `X`, является сборкой с неполным доверием.  
  
 [!CODE [FxCop.Security.TestAptcaInherit#1](../CodeSnippet/VS_Snippets_CodeAnalysis/FxCop.Security.TestAptcaInherit#1)]  
  
 В результате выполнения примера получается следующий результат:  
  
  **Встреча: тенистая долина 22.02.2003 00:00:00\!**  
**Из теста: солнечный луг**  
**Встреча: солнечный луг 22.02.2003 00:00:00\!**   
## Связанные правила  
 [CA2116: методы APTCA должны вызывать только методы APTCA](../Topic/CA2116:%20APTCA%20methods%20should%20only%20call%20APTCA%20methods.md)  
  
## См. также  
 [Secure Coding Guidelines](../Topic/Secure%20Coding%20Guidelines.md)   
 [.NET Framework Assemblies Callable by Partially Trusted Code](http://msdn.microsoft.com/ru-ru/a417fcd4-d3ca-4884-a308-3a1a080eac8d)   
 [Using Libraries from Partially Trusted Code](../Topic/Using%20Libraries%20from%20Partially%20Trusted%20Code.md)   
 [Inheritance Demands](http://msdn.microsoft.com/ru-ru/28b9adbb-8f08-4f10-b856-dbf59eb932d9)